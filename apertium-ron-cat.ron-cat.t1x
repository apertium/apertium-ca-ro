<?xml version="1.0" encoding="UTF-8"?>
<transfer default="chunk">
  <section-def-cats>
    <def-cat n="nom">
      <cat-item tags="n.*"/>
    </def-cat>
    <def-cat n="nom_dg">
      <cat-item tags="n.*.*.dg.*"/>
    </def-cat>
    <def-cat n="nom_dgdef">
      <cat-item tags="n.*.*.dg.def"/>
    </def-cat>

    <def-cat n="np">
      <cat-item tags="np.al.*"/>
      <cat-item tags="np.top.*"/>
      <cat-item tags="np.ant.*"/>
      <cat-item tags="np.cog.*"/>
    </def-cat>
    <def-cat n="np_dg">
      <cat-item tags="np.al.*"/>
      <cat-item tags="np.top.*"/>
      <cat-item tags="np.ant.*.*.dg.*"/>
      <cat-item tags="np.cog.*.*.dg.*"/>
    </def-cat>

    <def-cat n="adj">
      <cat-item tags="adj.*"/>
    </def-cat>
    <def-cat n="adjnorm">
      <cat-item tags="adj.m.*"/>
      <cat-item tags="adj.mn.*"/>
      <cat-item tags="adj.f.*"/>
      <cat-item tags="adj.fn.*"/>
      <cat-item tags="adj.mf.*"/>
      <cat-item tags="adj.mfn.*"/>
    </def-cat>
    <def-cat n="adj_lui">
      <cat-item lemma="lui" tags="adj.*"/>
    </def-cat>

    <def-cat n="det">
      <cat-item tags="det.dem.*"/>
      <cat-item tags="det.ind.*"/>
    </def-cat>
    <def-cat n="predet">
      <cat-item tags="predet.*"/>
    </def-cat>
    <def-cat n="det_predet">
      <cat-item tags="det.dem.*"/>
      <cat-item tags="det.ind.*"/>
      <cat-item tags="det.def.*"/>
      <cat-item tags="predet.*"/>
    </def-cat>
    <def-cat n="det_cel">
      <cat-item lemma="cel" tags="det.def.*"/>
    </def-cat>
    <def-cat n="det_al">
      <cat-item lemma="al" tags="det.def.*"/>
    </def-cat>

    <def-cat n="prep_gen">
      <cat-item tags="pr.gen"/>
    </def-cat>

    <def-cat n="vbcnj">
      <cat-item tags="vblex.pri.*"/>
      <cat-item tags="vbmod.pri.*"/>
      <cat-item tags="vbser.pri.*"/>
      <cat-item tags="vblex.pii.*"/>
      <cat-item tags="vbmod.pii.*"/>
      <cat-item tags="vbser.pii.*"/>
      <cat-item tags="vblex.prs.*"/>
      <cat-item tags="vbmod.prs.*"/>
      <cat-item tags="vbser.prs.*"/>
      <cat-item tags="vblex.imp.*"/>
      <cat-item tags="vbmod.imp.*"/>
      <cat-item tags="vbser.imp.*"/>
      <cat-item tags="vblex.pper.*"/>
      <cat-item tags="vbmod.pper.*"/>
      <cat-item tags="vbser.pper.*"/>
      <cat-item tags="vblex.ifi.*"/>
      <cat-item tags="vbmod.ifi.*"/>
      <cat-item tags="vbser.ifi.*"/>
    </def-cat>
    <def-cat n="vbcnj_doble1">
      <cat-item tags="vbavea.pri.*"/>
      <cat-item tags="vbavea.cni.*"/>
      <cat-item lemma="vrea" tags="vaux.pri.*"/>
    </def-cat>
    <def-cat n="vbcnj_doble2">
      <cat-item tags="vblex.pp.*"/>
      <cat-item tags="vbmod.pp.*"/>
      <cat-item tags="vbser.pp.*"/>
      <cat-item tags="vblex.inf"/>
      <cat-item tags="vbmod.inf"/>
      <cat-item tags="vbser.inf"/>
    </def-cat>
    <def-cat n="vbcnj_triple1">
      <cat-item lemma="vrea" tags="vaux.pri.*"/>
      <cat-item tags="vbavea.pri.*"/>
      <cat-item tags="vbavea.cni.*"/>
      <cat-item lemma="o" tags="adv"/>
    </def-cat>
    <def-cat n="vbcnj_triple2">
      <cat-item tags="vbser.inf"/>
      <cat-item tags="vbmod.inf"/>
      <cat-item lemma="să" tags="cnjsub"/>
    </def-cat>
    <def-cat n="vbcnj_triple3">
      <cat-item tags="vblex.pp.*"/>
      <cat-item tags="vbmod.pp.*"/>
      <cat-item tags="vbser.pp.*"/>
      <cat-item tags="vblex.prs.*"/>
      <cat-item tags="vbmod.prs.*"/>
      <cat-item tags="vbser.prs.*"/>
    </def-cat>

    <def-cat n="inf">
      <cat-item tags="vblex.inf"/>
      <cat-item tags="vbavea.inf"/>
      <cat-item tags="vbmod.inf"/>
      <cat-item tags="vbser.inf"/>
    </def-cat>
    <def-cat n="ger">
      <cat-item tags="vblex.ger"/>
      <cat-item tags="vbavea.ger"/>
      <cat-item tags="vbmod.ger"/>
      <cat-item tags="vbser.ger"/>
    </def-cat>

    <def-cat n="num_xifra">
      <cat-item tags="num"/>
    </def-cat>

    <def-cat n="cnjcoo">
      <cat-item tags="cnjcoo"/>
    </def-cat>

    <def-cat n="mesos">
      <cat-item lemma="ianuarie" tags="n.*"/>
      <cat-item lemma="februarie" tags="n.*"/>
      <cat-item lemma="martie" tags="n.*"/>
      <cat-item lemma="aprilie" tags="n.*"/>
      <cat-item lemma="mai" tags="n.*"/>
      <cat-item lemma="iunie" tags="n.*"/>
      <cat-item lemma="iulie" tags="n.*"/>
      <cat-item lemma="august" tags="n.*"/>
      <cat-item lemma="septembrie" tags="n.*"/>
      <cat-item lemma="octombrie" tags="n.*"/>
      <cat-item lemma="noiembrie" tags="n.*"/>
      <cat-item lemma="decembrie" tags="n.*"/>
    </def-cat>
    <def-cat n="nom_any">
      <cat-item lemma="an" tags="n.m.sg.nom.def"/>
    </def-cat>
    <def-cat n="sent">
      <cat-item tags="sent"/>
    </def-cat>




    <def-cat n="npant">
      <cat-item tags="np.ant.*"/>
    </def-cat>
    <def-cat n="nptop">
      <cat-item tags="np.top.*"/>
      <cat-item tags="np.loc.*"/>
    </def-cat>
    <def-cat n="npal">
      <cat-item tags="np.al.*"/>
    </def-cat>
    <def-cat n="detdem">
      <cat-item tags="det.dem.*"/>
    </def-cat>
     <def-cat n="dettuturor">
      <cat-item lemma="tuturor" tags="det.def.*"/>
    </def-cat>
    <def-cat n="detind">
      <cat-item tags="det.ind.*"/>
    </def-cat>
    <def-cat n="adjec">
      <cat-item tags="adj.*"/>
      <cat-item tags="vblex.pp.*"/>
      <cat-item tags="vbser.pp.*"/>
    </def-cat>
    <def-cat n="adjtot">
      <cat-item lemma="tot" tags="adj.*"/>
    </def-cat>
    <def-cat n="adjpos">
      <cat-item tags="adj.pos.*"/>
    </def-cat>
    <def-cat n="adv">
      <cat-item tags="adv"/>
      <cat-item tags="adv.itg"/>
      <cat-item tags="preadv"/>
    </def-cat>
    <def-cat n="advnespus">
      <cat-item lemma="nespus" tags="adv"/>
    </def-cat>
    <def-cat n="adv_mai">
      <cat-item lemma="mai" tags="adv"/>
    </def-cat>
    <def-cat n="advca">
      <cat-item lemma="ca" tags="adv"/>
    </def-cat>
   <def-cat n="advfel">
      <cat-item lemma="la fel de" tags="adv"/>
    </def-cat>
    <def-cat n="advdecât">
      <cat-item lemma="decât" tags="adv"/>
    </def-cat>
    <def-cat n="advnu">
      <cat-item lemma="nu" tags="adv"/>
    </def-cat>
    <def-cat n="advnici-">
      <cat-item lemma="niciodată" tags="adv"/>
      <cat-item lemma="nicicând" tags="adv"/>
      <cat-item lemma="niciunde" tags="adv"/>
      <cat-item lemma="nicicum" tags="adv"/>
    </def-cat>
    <def-cat n="advo">
      <cat-item lemma="o" tags="adv.*"/>
    </def-cat>
    <def-cat n="prep">
      <cat-item tags="pr"/>
      <cat-item tags="pr.gen"/>
    </def-cat>
    <def-cat n="prepnum">
      <cat-item lemma="în" tags="pr"/>
      <cat-item lemma="din" tags="pr"/>
    </def-cat>
    <def-cat n="prepa">
      <cat-item lemma="a" tags="pr"/>
    </def-cat>
    <def-cat n="prepde">
      <cat-item lemma="de" tags="pr"/>
    </def-cat>
    <def-cat n="prep_în">
      <cat-item lemma="în" tags="pr"/>
    </def-cat>
    <def-cat n="preppe">
      <cat-item lemma="pe" tags="pr"/>
    </def-cat>
    <def-cat n="conjsub">
      <cat-item lemma="să" tags="cnjsub"/>
    </def-cat>
    <def-cat n="conjnici">
      <cat-item lemma="nici" tags="cnjcoo"/>
    </def-cat>
    <def-cat n="relcărui">
      <cat-item lemma="cărui" tags="rel.*"/>
    </def-cat>
    <def-cat n="relat">
      <cat-item tags="rel.*"/>
    </def-cat>
    <def-cat n="prn">
      <cat-item tags="prn.*"/>
    </def-cat>
    <def-cat n="prntn">
      <cat-item tags="prn.tn.*"/>
    </def-cat>
    <def-cat n="prn_tnitg">
      <cat-item tags="prn.tn.*"/>
      <cat-item tags="prn.itg.*"/>
    </def-cat>
    <def-cat n="prnenc">
      <cat-item tags="prn.enc.*"/>
    </def-cat>
    <def-cat n="prnpro">
      <cat-item tags="prn.pro.*"/>
    </def-cat>
    <def-cat n="prnproref">
      <cat-item lemma="mă" tags="prn.pro.p1.mf.sg.*"/>
      <cat-item lemma="te" tags="prn.pro.p2.mf.sg.*"/>
      <cat-item lemma="se" tags="prn.pro.ref.p3.mfn.sp.*"/>
      <cat-item lemma="își" tags="prn.pro.ref.p3.mfn.sp.*"/>
      <cat-item lemma="ne" tags="prn.pro.p1.mf.pl.*"/>
      <cat-item lemma="vă" tags="prn.pro.p2.mf.pl.*"/>
    </def-cat>
    <def-cat n="prnpro3">
      <cat-item lemma="îl" tags="prn.pro.*"/>
<!-- eliminat EN pr adv -->
    </def-cat>
        <def-cat n="opronom">
      <cat-item lemma="o" tags="prn.pro.p3.f.sg"/>
    </def-cat>
    <def-cat n="avealex">
      <cat-item lemma="avea" tags="vblex.*"/>
    </def-cat>
    <def-cat n="catverb">
      <cat-item tags="vblex.ger"/>
      <cat-item tags="vbser.ger"/>
      <cat-item tags="vbavea.ger"/>
      <cat-item tags="vbmod.ger"/>
      <cat-item tags="vblex.imp.*"/>
      <cat-item tags="vbser.imp.*"/>
      <cat-item tags="vbavea.imp.*"/>
      <cat-item tags="vbmod.imp.*"/>
    </def-cat>

    <def-cat n="verbospron">
      <cat-item lemma="gândi" tags="vblex.*"/>
      <cat-item lemma="juca" tags="vblex.*"/>
    </def-cat>
    <def-cat n="verbfi">
      <cat-item lemma="fi" tags="vbser.*"/>
    </def-cat>
    <def-cat n="verbtrebui">
      <cat-item lemma="trebui" tags="vbmod.*"/>
    </def-cat>
    <def-cat n="vbaveapri">
      <cat-item tags="vbavea.pri.*"/>
    </def-cat>
    <def-cat n="vbaveacni">
      <cat-item tags="vbavea.cni.*"/>
      <cat-item lemma="avea" tags="vblex.prs.*"/>
        <cat-item lemma="avea" tags="vblex.pri.*"/>
<!-- el tagger no tria vbavea pri, afegim  vblex prs mentre el millorem-->
    </def-cat>
    <def-cat n="verbprs">
      <cat-item tags="vblex.prs.*"/>
      <cat-item tags="vbmod.prs.*"/>
    </def-cat>
     <def-cat n="verbpis">
      <cat-item tags="vblex.pis.*"/>
      <cat-item tags="vbmod.pis.*"/>
    </def-cat>
    <def-cat n="vrea">
      <cat-item lemma="vrea" tags="vaux.*"/>
    </def-cat>
    <def-cat n="infnm">
      <cat-item tags="vblex.inf"/>
<!-- eliminat SER inf -->
      <cat-item tags="vbavea.inf"/>
    </def-cat>
    <def-cat n="infnh">
      <cat-item tags="vblex.inf"/>
<!-- eliminat SER inf -->
      <cat-item tags="vbmod.inf"/>
    </def-cat>
    <def-cat n="pp">
      <cat-item tags="vblex.pp.*"/>
      <cat-item tags="vbavea.pp.*"/>
      <cat-item tags="vbmod.pp.*"/>
      <cat-item tags="vbser.pp.*"/>
    </def-cat>
    <def-cat n="ppf">
      <cat-item tags="vblex.pp.f.sg"/>
      <cat-item tags="vbavea.pp.f.sg"/>
      <cat-item tags="vbmod.pp.f.sg"/>
    </def-cat>
    <def-cat n="ppfmpl">
      <cat-item tags="vblex.pp.f.*"/>
<!-- eliminat AVEA pp m &f -->
      <cat-item tags="vbmod.pp.f.*"/>
      <cat-item tags="vblex.pp.m.pl"/>
      <cat-item tags="vbmod.pp.m.pl"/>
    </def-cat>
    <def-cat n="num">
      <cat-item tags="num.*"/>
      <cat-item tags="num"/>
    </def-cat>
   <def-cat n="xifra">
      <cat-item tags="num"/>
    </def-cat>
    <!-- <def-cat n="C">
      <cat-item tags="num"/>
    </def-cat> -->
    <def-cat n="anar">
      <cat-item lemma="anar" tags="vblex.pri.*"/>
    </def-cat>
    <def-cat n="molt">
      <cat-item lemma="molt" tags="preadv"/>
      <cat-item lemma="molt" tags="adv"/>
      <cat-item lemma="molt" tags="adj.m.sg"/>
    </def-cat>
<!-- introduiria tb. la prep.inf. a __ a vedea/to see__, pq apareix amb determinades prep.: sense saber-ho = fără a ști nimic. QQQ Es podria ficar una paraula en ro.ro que tingui una casella buida en espanyol, p.ex. que aq. prep.inf. A no es traduisqui? -->
    <def-cat n="in">
      <cat-item lemma="in" tags="pr"/>
    </def-cat>
    <def-cat n="la">
      <cat-item lemma="la" tags="pr"/>
    </def-cat>
    <def-cat n="pentru">
      <cat-item lemma="pentru" tags="pr"/>
    </def-cat>
<!-- s'ha de veure en romanès si fa falta aquesta categoria /// def-cat n="dir">
       <cat-item lemma="dir" tags="vblex.pri.*"/>
       <cat-item lemma="dir" tags="vblex.fti.*"/>
     </def-cat> -->
    <def-cat n="avea">
      <cat-item lemma="avea" tags="vbavea.*"/>
    </def-cat>

  </section-def-cats>

  <section-def-attrs>
    <def-attr n="a_nom">
      <attr-item tags="n"/>
      <attr-item tags="n.acr"/>
    </def-attr>
    <def-attr n="a_np">
      <attr-item tags="np.al"/>
      <attr-item tags="np.top"/>
      <attr-item tags="np.ant"/>
      <attr-item tags="np.cog"/>
    </def-attr>
    <def-attr n="a_npant">
      <attr-item tags="np.ant"/>
    </def-attr>
    <def-attr n="a_nptop">
      <attr-item tags="np.top"/>
    </def-attr>
    <def-attr n="a_npal">
      <attr-item tags="np.al"/>
    </def-attr>
    <def-attr n="a_det">
      <attr-item tags="det.def"/>
      <attr-item tags="det.ind"/>
      <attr-item tags="det.dem"/>
      <attr-item tags="det.pos"/>
      <attr-item tags="predet"/>
    </def-attr>
    <def-attr n="a_adj">
      <attr-item tags="adj.ind"/>
      <attr-item tags="adj.ord"/>
      <attr-item tags="adj.itg"/>
      <attr-item tags="adj.pos"/>
      <attr-item tags="adj"/>
      <attr-item tags="det.ind"/>
      <attr-item tags="num"/>
    </def-attr>
    <def-attr n="a_adjpos">
      <attr-item tags="adj.pos"/>
    </def-attr>
    <def-attr n="a_adv">
      <attr-item tags="adv"/>
      <attr-item tags="preadv"/>
    </def-attr>
    <def-attr n="a_prep">
      <attr-item tags="pr"/>
    </def-attr>
    <def-attr n="a_relat">
      <attr-item tags="rel.adv"/>
      <attr-item tags="rel.nn"/>
      <attr-item tags="rel.aa"/>
      <attr-item tags="rel.an"/>
    </def-attr>
    <def-attr n="a_prn">
      <attr-item tags="prn.tn"/>
      <attr-item tags="prn.tn.ref.p3"/>
      <attr-item tags="prn.tn.pos"/>
      <attr-item tags="prn.itg"/>
      <attr-item tags="prn.pro"/>
      <attr-item tags="prn.pro.ref"/>
    </def-attr>
    <def-attr n="a_prnref">
      <attr-item tags="ref"/>
    </def-attr>
    <def-attr n="a_prnenc">
      <attr-item tags="prn.enc"/>
      <attr-item tags="prn.enc.ref"/>
    </def-attr>
    <def-attr n="a_prnpro">
      <attr-item tags="prn.pro"/>
      <attr-item tags="prn.pro.ref"/>
    </def-attr>
    <def-attr n="a_verb">
      <attr-item tags="vblex"/>
      <attr-item tags="vbser"/>
      <attr-item tags="vbhaver"/>
      <attr-item tags="vbmod"/>
      <attr-item tags="vbavea"/>
      <attr-item tags="vaux"/>
    </def-attr>
    <def-attr n="a_inf">
      <attr-item tags="vblex.inf"/>
      <attr-item tags="vbavea.inf"/>
      <attr-item tags="vbmod.inf"/>
      <attr-item tags="vbser.inf"/>
    </def-attr>
    <def-attr n="a_infnm">
      <attr-item tags="vblex.inf"/>
      <attr-item tags="vbavea.inf"/>
      <attr-item tags="vbser.inf"/>
    </def-attr>
    <def-attr n="a_infnh">
      <attr-item tags="vblex.inf"/>
      <attr-item tags="vbmod.inf"/>
      <attr-item tags="vbser.inf"/>
    </def-attr>
    <def-attr n="a_pp">
      <attr-item tags="vblex.pp"/>
      <attr-item tags="vbmod.pp"/>
      <attr-item tags="vbser.pp"/>
    </def-attr>
    <def-attr n="a_num">
      <attr-item tags="num"/>
    </def-attr>
    <def-attr n="a_def">
      <attr-item tags="def"/>
      <attr-item tags="ind"/>
    </def-attr>
    <def-attr n="a_case">
      <attr-item tags="nom"/>
      <attr-item tags="dg"/>
      <attr-item tags="gen"/>
      <attr-item tags="dat"/>
    </def-attr>
    <def-attr n="a_cas">
      <attr-item tags="nom"/>
      <attr-item tags="dg"/>
    </def-attr>
    <def-attr n="gen">
      <attr-item tags="m"/>
      <attr-item tags="f"/>
      <attr-item tags="mf"/>
      <attr-item tags="mn"/>
      <attr-item tags="fn"/>
      <attr-item tags="mfn"/>
      <attr-item tags="GD"/>
      <attr-item tags="nt"/>
    </def-attr>
    <def-attr n="a_gen">
      <attr-item tags="m"/>
      <attr-item tags="f"/>
      <attr-item tags="mf"/>
      <attr-item tags="mn"/>
      <attr-item tags="fn"/>
      <attr-item tags="mfn"/>
      <attr-item tags="GD"/>
      <attr-item tags="nt"/>
    </def-attr>
   <def-attr n="a_gen_sense_mf">
      <attr-item tags="m"/>
      <attr-item tags="f"/>
      <attr-item tags="GD"/>
    </def-attr>
    <def-attr n="a_gen_mf">
      <attr-item tags="mf"/>
      <attr-item tags="nt"/>
    </def-attr>
    <def-attr n="a_nbr">
      <attr-item tags="sg"/>
      <attr-item tags="pl"/>
      <attr-item tags="sp"/>
      <attr-item tags="ND"/>
    </def-attr>
   <def-attr n="a_nbr_sense_sp">
      <attr-item tags="sg"/>
      <attr-item tags="pl"/>
      <attr-item tags="ND"/>
    </def-attr>
   <def-attr n="a_nbr_sp">
      <attr-item tags="sp"/>
    </def-attr>
    <def-attr n="a_pers">
      <attr-item tags="p1"/>
      <attr-item tags="p2"/>
      <attr-item tags="p3"/>
    </def-attr>
    <def-attr n="tipoadv">
      <attr-item tags="itg"/>
    </def-attr>
    <def-attr n="tipoenc_pro">
      <attr-item tags="ref.p3.mf.sp"/>
      <attr-item tags="p1.mf.sg"/>
      <attr-item tags="p1.mf.pl"/>
      <attr-item tags="p2.mf.sg"/>
      <attr-item tags="p2.mf.pl"/>
<!-- s'introduiria tb el neutre: Văd caietul(n.nt.sg.).Văzându-l (nt.sg.), i en pl. Văd caietele (n.nt.pl.) Văzându-le (nt.pl.)  <attr-item tags="p3.mfn.sg"/> -->
      <attr-item tags="p3.mfn.pl"/>
      <attr-item tags="p3.mf.sp"/>
<!--incorrecte, tradueix "li<prn><enc><p3><mf><sp>" per "se", cal canviar diccionari ja que és li-ho<sg> i los-ho<pl> (dárselo)-->
      <attr-item tags="p3.m.sg"/>
      <attr-item tags="p3.m.pl"/>
      <attr-item tags="p3.f.sg"/>
      <attr-item tags="p3.f.pl"/>
    </def-attr>
    <def-attr n="a_temps">
      <attr-item tags="inf"/>
      <attr-item tags="ger"/>
      <attr-item tags="cni"/>
      <attr-item tags="fti"/>
      <attr-item tags="pp"/>
      <attr-item tags="pri"/>
      <attr-item tags="pii"/>
      <attr-item tags="pis"/>
      <attr-item tags="pper"/>
      <attr-item tags="prs"/>
      <attr-item tags="imp"/>
      <attr-item tags="ifi"/>
      <attr-item tags="fts"/>
    </def-attr>
  </section-def-attrs>

  <section-def-vars>
    <def-var n="genere"/>
    <def-var n="genere_chunk"/>
    <def-var n="genere1"/>
    <def-var n="genere2"/>
    <def-var n="genere3"/>
    <def-var n="nombre"/>
    <def-var n="nombre_chunk"/>
    <def-var n="nombre1"/>
    <def-var n="nombre2"/>
    <def-var n="nombre3"/>
    <def-var n="temps"/>
    <def-var n="persona"/>
    <def-var n="auxiliar"/>
    <def-var n="auxiliar_lema"/>
    <def-var n="verb"/>
    <def-var n="verb_cua"/>

    <def-var n="uno"/>
    <def-var n="concDet"/>
    <def-var n="concAdj"/>
    <def-var n="concPrimero"/>
    <def-var n="concSegundo"/>
    <def-var n="concTercero"/>
    <def-var n="interrogativa"/>
    <def-var n="exclamativa"/>
  </section-def-vars>

  <section-def-lists>
    <def-list n="vb2vbref">
      <list-item v="sta"/>
      <list-item v="râde"/>
    </def-list>
    <def-list n="vbref2vb">
      <list-item v="pensar"/>
    </def-list>

    <def-list n="num_romans">
      <list-item v="I"/>
      <list-item v="V"/>
      <list-item v="X"/>
      <list-item v="L"/>
      <list-item v="C"/>
    </def-list>
  </section-def-lists>

  <section-def-macros>

    <def-macro n="mod_maj" npar="1" comment="Canvia la majúscula inicial d'un lema a minúscula">
      <choose>
          <when>
            <test>
              <and>
                <equal>
                  <case-of pos="1" side="sl" part="lemh"/>
                  <lit v="Aa"/>
                </equal>
                <not>
                  <in caseless="yes">
                    <clip pos="1" side="sl" part="lemh"/>
                    <list n="num_romans"/>
                  </in>
                </not>
              </and>
            </test>
            <modify-case>
              <clip pos="1" side="tl" part="lemh"/>
              <lit v="aa"/>
            </modify-case>
          </when>
        </choose>
    </def-macro>


    <def-macro n="conj_verb1" npar="1" comment="Conjuga un verb simple">
        <choose>
          <when>
            <test>
              <equal>
                <clip pos="1" side="sl" part="a_temps"/>
                <lit-tag v="pper"/>
              </equal>
            </test>
            <let>
              <clip pos="1" side="tl" part="a_temps"/>
              <lit-tag v="pii"/>
            </let>
            <let>
              <var n="temps"/>
              <lit-tag v="pli"/>
            </let>
            <let>
              <var n="persona"/>
              <clip pos="1" side="tl" part="a_pers"/>
            </let>
            <let>
              <var n="nombre"/>
              <clip pos="1" side="tl" part="a_nbr"/>
            </let>
            <let>
              <var n="auxiliar_lema"/>
              <lit v="haver"/>
            </let>
            <let>
              <var n="auxiliar"/>
              <concat>
                <lit-tag v="vaux"/>
                <clip pos="1" side="tl" part="a_temps"/>
                <clip pos="1" side="tl" part="a_pers" link-to="4"/>
                <clip pos="1" side="tl" part="a_nbr" link-to="5"/>
                <lit v="$ ^"/>
              </concat>
            </let>
            <let>
              <var n="verb"/>
              <concat>
                <clip pos="1" side="tl" part="lemh"/>
                <clip pos="1" side="tl" part="a_verb"/>
                <lit-tag v="pp"/>
                <lit-tag v="m"/>
                <lit-tag v="sg"/>
                <clip pos="1" side="tl" part="lemq"/>
              </concat>
            </let>
          </when>
          <when>
            <test>
              <equal>
                <clip pos="1" side="sl" part="a_temps"/>
                <lit-tag v="ifi"/>
              </equal>
            </test>
            <let>
              <clip pos="1" side="tl" part="a_temps"/>
              <lit-tag v="pri"/>
            </let>
            <let>
              <var n="temps"/>
              <lit-tag v="ifi"/>
            </let>
            <let>
              <var n="persona"/>
              <clip pos="1" side="tl" part="a_pers"/>
            </let>
            <let>
              <var n="nombre"/>
              <clip pos="1" side="tl" part="a_nbr"/>
            </let>
            <let>
              <var n="auxiliar_lema"/>
              <lit v="anar"/>
            </let>
            <let>
              <var n="auxiliar"/>
              <concat>
                <lit-tag v="vaux"/>
                <!--<clip pos="1" side="tl" part="a_temps"/>-->
                <clip pos="1" side="tl" part="a_pers" link-to="4"/>
                <clip pos="1" side="tl" part="a_nbr" link-to="5"/>
                <lit v="$ ^"/>
              </concat>
            </let>
            <let>
              <var n="verb"/>
              <concat>
                <clip pos="1" side="tl" part="lemh"/>
                <clip pos="1" side="tl" part="a_verb"/>
                <lit-tag v="inf"/>
                <clip pos="1" side="tl" part="lemq"/>
              </concat>
            </let>
          </when>

          <otherwise>
            <let>
              <var n="temps"/>
              <clip pos="1" side="tl" part="a_temps"/>
            </let>
            <let>
              <var n="persona"/>
              <clip pos="1" side="tl" part="a_pers"/>
            </let>
            <let>
              <var n="nombre"/>
              <clip pos="1" side="tl" part="a_nbr"/>
            </let>
            <let>
              <var n="auxiliar_lema"/>
              <lit v=""/>
            </let>
            <let>
              <var n="auxiliar"/>
              <lit v=""/>
            </let>
            <let>
              <var n="verb"/>
              <concat>
                <clip pos="1" side="tl" part="lemh"/>
                <clip pos="1" side="tl" part="a_verb"/>
                <clip pos="1" side="tl" part="a_temps"/>
                <clip pos="1" side="tl" part="a_pers" link-to="4"/>
                <clip pos="1" side="tl" part="a_nbr" link-to="5"/>
                <clip pos="1" side="tl" part="lemq"/>
              </concat>
            </let>
          </otherwise>
        </choose>

        <choose>
          <when>
            <test>
              <and>
                <equal>
                  <case-of pos="1" side="tl" part="lem"/>
                  <lit v="Aa"/>
                </equal>
                <not>
                  <equal>
                    <var n="auxiliar_lema"/>
                    <lit v=""/>
                  </equal>
                </not>
              </and>
            </test>
            <modify-case>
              <var n="auxiliar_lema"/>
              <lit v="Aa"/>
            </modify-case>
            <modify-case>
              <var n="verb"/>
              <lit v="aa"/>
            </modify-case>
          </when>
          <when>
            <test>
              <equal>
               <case-of pos="1" side="tl" part="lem"/>
               <lit v="AA"/>
              </equal>
            </test>
            <modify-case>
              <var n="auxiliar_lema"/>
              <lit v="Aa"/>
            </modify-case>
          </when>
        </choose>

    </def-macro>

    <def-macro n="conj_verb2" npar="2" comment="Conjuga un verb compost doble">
        <choose>
          <when>
            <test>
              <and>
                <equal>
                  <clip pos="1" side="sl" part="a_verb"/>
                  <lit-tag v="vbavea"/>
                </equal>
                <equal>
                  <clip pos="1" side="sl" part="a_temps"/>
                  <lit-tag v="pri"/>
                </equal>
              </and>
            </test>
            <let>
              <clip pos="2" side="tl" part="a_temps"/>
              <lit-tag v="inf"/>
            </let>
            <let>
              <var n="temps"/>
              <lit-tag v="ifi"/>
            </let>
            <let>
              <var n="persona"/>
              <clip pos="1" side="tl" part="a_pers"/>
            </let>
            <let>
              <var n="nombre"/>
              <clip pos="1" side="tl" part="a_nbr"/>
            </let>
            <let>
              <var n="auxiliar_lema"/>
              <lit v="anar"/>
            </let>
            <let>
              <var n="auxiliar"/>
              <concat>
                <lit-tag v="vaux"/>
                <clip pos="1" side="tl" part="a_pers" link-to="4"/>
                <clip pos="1" side="tl" part="a_nbr" link-to="5"/>
                <lit v="$ ^"/>
              </concat>
            </let>
            <let>
              <var n="verb"/>
              <concat>
                <clip pos="2" side="tl" part="lemh"/>
                <clip pos="2" side="tl" part="a_verb"/>
                <clip pos="2" side="tl" part="a_temps"/>
                <clip pos="2" side="tl" part="lemq"/>
              </concat>
            </let>
          </when>
        </choose>
        <choose>
          <when>
            <test>
              <and>
                <equal>
                  <clip pos="1" side="sl" part="a_verb"/>
                  <lit-tag v="vbavea"/>
                </equal>
                <equal>
                  <clip pos="1" side="sl" part="a_temps"/>
                  <lit-tag v="cni"/>
                </equal>
              </and>
            </test>
            <let>
              <clip pos="2" side="tl" part="a_temps"/>
              <lit-tag v="cni"/>
            </let>
            <let>
              <var n="temps"/>
              <lit-tag v="cni"/>
            </let>
            <let>
              <var n="persona"/>
              <clip pos="1" side="tl" part="a_pers"/>
            </let>
            <let>
              <var n="nombre"/>
              <clip pos="1" side="tl" part="a_nbr"/>
            </let>
            <let>
              <var n="auxiliar_lema"/>
              <lit v=""/>
            </let>
            <let>
              <var n="auxiliar"/>
              <lit v=""/>
            </let>
            <let>
              <var n="verb"/>
              <concat>
                <clip pos="2" side="tl" part="lemh"/>
                <clip pos="2" side="tl" part="a_verb"/>
                <clip pos="2" side="tl" part="a_temps"/>
                <clip pos="1" side="tl" part="a_pers" link-to="4"/>
                <clip pos="1" side="tl" part="a_nbr" link-to="5"/>
                <clip pos="2" side="tl" part="lemq"/>
              </concat>
            </let>
          </when>
        </choose>
        <choose>
          <when>
            <test>
              <equal>
                <clip pos="1" side="sl" part="a_verb"/>
                <lit-tag v="vaux"/>
              </equal>
            </test>
            <let>
              <clip pos="2" side="tl" part="a_temps"/>
              <lit-tag v="fti"/>
            </let>
            <let>
              <var n="temps"/>
              <lit-tag v="fti"/>
            </let>
            <let>
              <var n="persona"/>
              <clip pos="1" side="tl" part="a_pers"/>
            </let>
            <let>
              <var n="nombre"/>
              <clip pos="1" side="tl" part="a_nbr"/>
            </let>
            <let>
              <var n="auxiliar_lema"/>
              <lit v=""/>
            </let>
            <let>
              <var n="auxiliar"/>
              <lit v=""/>
            </let>
            <let>
              <var n="verb"/>
              <concat>
                <clip pos="2" side="tl" part="lemh"/>
                <clip pos="2" side="tl" part="a_verb"/>
                <clip pos="2" side="tl" part="a_temps"/>
                <clip pos="1" side="tl" part="a_pers" link-to="4"/>
                <clip pos="1" side="tl" part="a_nbr" link-to="5"/>
                <clip pos="2" side="tl" part="lemq"/>
              </concat>
            </let>
          </when>
        </choose>

        <choose>
          <when>
            <test>
              <and>
                <equal>
                  <case-of pos="1" side="tl" part="lem"/>
                  <lit v="Aa"/>
                </equal>
                <not>
                  <equal>
                    <var n="auxiliar_lema"/>
                    <lit v=""/>
                  </equal>
                </not>
              </and>
            </test>
            <modify-case>
              <var n="auxiliar_lema"/>
              <lit v="Aa"/>
            </modify-case>
            <modify-case>
              <var n="verb"/>
              <lit v="aa"/>
            </modify-case>
          </when>
          <when>
            <test>
              <equal>
                <case-of pos="1" side="tl" part="lem"/>
                <lit v="Aa"/>
              </equal>
            </test>
            <modify-case>
              <var n="verb"/>
              <lit v="Aa"/>
            </modify-case>
          </when>
          <when>
            <test>
              <equal>
               <case-of pos="1" side="tl" part="lem"/>
               <lit v="AA"/>
              </equal>
            </test>
            <modify-case>
              <var n="auxiliar_lema"/>
              <lit v="Aa"/>
            </modify-case>
          </when>
        </choose>

    </def-macro>

    <def-macro n="conj_verb3" npar="3" comment="Conjuga un verb compost triple">
        <choose>
          <when>
            <test>
              <and>
                <or>
                  <equal>
                    <clip pos="1" side="sl" part="a_verb"/>
                    <lit-tag v="vbavea"/>
                  </equal>
                  <equal caseless="yes">
                    <clip pos="1" side="sl" part="lem"/>
                    <lit v="o"/>
                  </equal>
                </or>
                <equal caseless="yes">
                  <clip pos="2" side="sl" part="lem"/>
                  <lit v="să"/>
                </equal>
                <equal>
                  <clip pos="3" side="sl" part="a_temps"/>
                  <lit-tag v="prs"/>
                </equal>
              </and>
            </test>
            <let>
              <clip pos="3" side="tl" part="a_temps"/>
              <lit-tag v="fti"/>
            </let>
            <let>
              <var n="temps"/>
              <lit-tag v="fti"/>
            </let>
            <let>
              <var n="persona"/>
              <clip pos="3" side="tl" part="a_pers"/>
            </let>
            <let>
              <var n="nombre"/>
              <clip pos="3" side="tl" part="a_nbr"/>
            </let>
            <let>
              <var n="auxiliar_lema"/>
              <lit v=""/>
            </let>
            <let>
              <var n="auxiliar"/>
              <lit v=""/>
            </let>
            <let>
              <var n="verb"/>
              <concat>
                <clip pos="3" side="tl" part="lemh"/>
                <clip pos="3" side="tl" part="a_verb"/>
                <clip pos="3" side="tl" part="a_temps"/>
                <clip pos="3" side="tl" part="a_pers" link-to="4"/>
                <clip pos="3" side="tl" part="a_nbr" link-to="5"/>
                <clip pos="3" side="tl" part="lemq"/>
              </concat>
            </let>
          </when>
          <when>
            <test>
              <and>
                <equal>
                  <clip pos="1" side="sl" part="a_verb"/>
                  <lit-tag v="vaux"/>
                </equal>
                <equal>
                  <clip pos="2" side="sl" part="a_temps"/>
                  <lit-tag v="inf"/>
                </equal>
                <equal>
                  <clip pos="3" side="sl" part="a_temps"/>
                  <lit-tag v="pp"/>
                </equal>
              </and>
            </test>
            <let>
              <clip pos="1" side="tl" part="a_temps"/>
              <lit-tag v="fti"/>
            </let>
            <let>
              <var n="temps"/>
              <lit-tag v="fti"/>
            </let>
            <let>
              <var n="persona"/>
              <clip pos="1" side="tl" part="a_pers"/>
            </let>
            <let>
              <var n="nombre"/>
              <clip pos="1" side="tl" part="a_nbr"/>
            </let>
            <let>
              <var n="auxiliar_lema"/>
              <lit v="haver"/>
            </let>
            <let>
              <var n="auxiliar"/>
              <concat>
                <lit-tag v="vaux"/>
                <clip pos="1" side="tl" part="a_temps"/>
                <clip pos="1" side="tl" part="a_pers" link-to="4"/>
                <clip pos="1" side="tl" part="a_nbr" link-to="5"/>
                <lit v="$ ^"/>
              </concat>
            </let>
            <let>
              <var n="verb"/>
              <concat>
                <clip pos="3" side="tl" part="lemh"/>
                <clip pos="3" side="tl" part="a_verb"/>
                <lit-tag v="pp"/>
                <lit-tag v="m"/>
                <lit-tag v="sg"/>
                <clip pos="3" side="tl" part="lemq"/>
              </concat>
            </let>
          </when>
          <when>
            <test>
              <and>
                <equal>
                  <clip pos="1" side="sl" part="a_verb"/>
                  <lit-tag v="vbavea"/>
                </equal>
                <equal>
                  <clip pos="1" side="sl" part="a_temps"/>
                  <lit-tag v="cni"/>
                </equal>
                <equal>
                  <clip pos="2" side="sl" part="a_temps"/>
                  <lit-tag v="inf"/>
                </equal>
                <equal>
                  <clip pos="3" side="sl" part="a_temps"/>
                  <lit-tag v="pp"/>
                </equal>
              </and>
            </test>
            <let>
              <var n="temps"/>
              <lit-tag v="cni"/>
            </let>
            <let>
              <var n="persona"/>
              <clip pos="1" side="tl" part="a_pers"/>
            </let>
            <let>
              <var n="nombre"/>
              <clip pos="1" side="tl" part="a_nbr"/>
            </let>
            <let>
              <var n="auxiliar_lema"/>
              <lit v="haver"/>
            </let>
            <let>
              <var n="auxiliar"/>
              <concat>
                <lit-tag v="vaux"/>
                <clip pos="1" side="tl" part="a_temps"/>
                <clip pos="1" side="tl" part="a_pers" link-to="4"/>
                <clip pos="1" side="tl" part="a_nbr" link-to="5"/>
                <lit v="$ ^"/>
              </concat>
            </let>
            <let>
              <var n="verb"/>
              <concat>
                <clip pos="3" side="tl" part="lemh"/>
                <clip pos="3" side="tl" part="a_verb"/>
                <lit-tag v="pp"/>
                <lit-tag v="m"/>
                <lit-tag v="sg"/>
                <clip pos="3" side="tl" part="lemq"/>
              </concat>
            </let>
          </when>
          <when>
            <test>
              <and>
                <equal>
                  <clip pos="1" side="sl" part="a_verb"/>
                  <lit-tag v="vbavea"/>
                </equal>
                <equal>
                  <clip pos="1" side="sl" part="a_temps"/>
                  <lit-tag v="pri"/>
                </equal>
                <equal>
                  <clip pos="2" side="sl" part="a_temps"/>
                  <lit-tag v="inf"/>
                </equal>
                <equal>
                  <clip pos="3" side="sl" part="a_temps"/>
                  <lit-tag v="pp"/>
                </equal>
              </and>
            </test>
            <let>
              <clip pos="1" side="tl" part="a_temps"/>
              <lit-tag v="fts"/>
            </let>
            <let>
              <var n="temps"/>
              <lit-tag v="fts"/>
            </let>
            <let>
              <var n="persona"/>
              <clip pos="1" side="tl" part="a_pers"/>
            </let>
            <let>
              <var n="nombre"/>
              <clip pos="1" side="tl" part="a_nbr"/>
            </let>
            <let>
              <var n="auxiliar_lema"/>
              <lit v="haver"/>
            </let>
            <let>
              <var n="auxiliar"/>
              <concat>
                <lit-tag v="vaux"/>
                <clip pos="1" side="tl" part="a_temps"/>
                <clip pos="1" side="tl" part="a_pers" link-to="4"/>
                <clip pos="1" side="tl" part="a_nbr" link-to="5"/>
                <lit v="$ ^"/>
              </concat>
            </let>
            <let>
              <var n="verb"/>
              <concat>
                <clip pos="3" side="tl" part="lemh"/>
                <clip pos="3" side="tl" part="a_verb"/>
                <lit-tag v="pp"/>
                <lit-tag v="m"/>
                <lit-tag v="sg"/>
                <clip pos="3" side="tl" part="lemq"/>
              </concat>
            </let>
          </when>
        </choose>

        <choose>
          <when>
            <test>
              <and>
                <equal>
                  <case-of pos="1" side="tl" part="lem"/>
                  <lit v="Aa"/>
                </equal>
                <not>
                  <equal>
                    <var n="auxiliar_lema"/>
                    <lit v=""/>
                  </equal>
                </not>
              </and>
            </test>
            <modify-case>
              <var n="auxiliar_lema"/>
              <lit v="Aa"/>
            </modify-case>
            <modify-case>
              <var n="verb"/>
              <lit v="aa"/>
            </modify-case>
          </when>
          <when>
            <test>
              <equal>
                <case-of pos="1" side="tl" part="lem"/>
                <lit v="Aa"/>
              </equal>
            </test>
            <modify-case>
              <var n="verb"/>
              <lit v="Aa"/>
            </modify-case>
          </when>
          <when>
            <test>
              <equal>
               <case-of pos="1" side="tl" part="lem"/>
               <lit v="AA"/>
              </equal>
            </test>
            <modify-case>
              <var n="auxiliar_lema"/>
              <lit v="Aa"/>
            </modify-case>
          </when>
        </choose>

    </def-macro>


    <def-macro n="f_concord1" npar="1" comment="Realitza la concordança d'un element i desa els valors a les variables del chunk">
      <!-- Gènere -->
      <choose>
        <when>
          <test>
            <not>
              <equal>
                <clip pos="1" side="tl" part="a_gen"/>
                <lit-tag v="mf"/>
              </equal>
            </not>
          </test>
          <let>
            <var n="genere_chunk"/>
            <clip pos="1" side="tl" part="a_gen"/>
          </let>
        </when>
        <otherwise>
          <let>
            <var n="genere_chunk"/>
            <clip pos="1" side="sl" part="a_gen"/>
          </let>
        </otherwise>
      </choose>
      <!-- Nombre -->
      <choose>
        <when>
          <test>
            <and>
            <not>
              <equal>
                <clip pos="1" side="tl" part="a_nbr"/>
                <lit-tag v="sp"/>
              </equal>
            </not>
            <not>
              <equal>
                <clip pos="1" side="tl" part="a_nbr"/>
                <lit v=""/>
              </equal>
            </not>
            </and>
          </test>
          <let>
            <var n="nombre_chunk"/>
            <clip pos="1" side="tl" part="a_nbr"/>
          </let>
        </when>
        <otherwise>
          <let>
            <var n="nombre_chunk"/>
            <clip pos="1" side="sl" part="a_nbr"/>
          </let>
        </otherwise>
      </choose>
      <!-- Si el gènere del chunk no és masculí o femení, cal adaptar-lo -->
      <choose>
        <when>
          <test>
            <or>
              <equal>
                <var n="genere_chunk"/>
                <lit-tag v="f"/>
              </equal>
              <equal>
                <var n="genere_chunk"/>
                <lit-tag v="fn"/>
              </equal>
            </or>
          </test>
          <let>
            <var n="genere_chunk"/>
            <lit-tag v="f"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <var n="genere_chunk"/>
              <lit-tag v="GD"/>
            </equal>
          </test>
          <let>
            <var n="genere_chunk"/>
            <lit-tag v="GD"/>
          </let>
        </when>
        <otherwise>
          <let>
            <var n="genere_chunk"/>
            <lit-tag v="m"/>
          </let>
        </otherwise>
      </choose>
    </def-macro>

    <def-macro n="f_concord2" npar="2" comment="Realitza la concordança de dos elements i desa els valors a les variables del chunk">
      <!-- Gènere -->
      <choose>
        <when>
          <test>
            <and>
              <not>
                <equal>
                  <clip pos="1" side="tl" part="a_gen"/>
                  <lit-tag v="mf"/>
                </equal>
              </not>
              <not>
                <equal>
                  <clip pos="1" side="tl" part="a_gen"/>
                  <lit-tag v="GD"/>
                </equal>
              </not>
            </and>
          </test>
          <let>
            <var n="genere_chunk"/>
            <clip pos="1" side="tl" part="a_gen"/>
          </let>
        </when>
        <otherwise>
          <choose>
            <when>
              <test>
                <not>
                  <equal>
                    <clip pos="1" side="sl" part="a_gen"/>
                    <lit-tag v="mf"/>
                  </equal>
                </not>
              </test>
              <let>
                <var n="genere_chunk"/>
                <clip pos="1" side="sl" part="a_gen"/>
              </let>
            </when>
            <otherwise>
              <choose>
                <when>
                  <test>
                    <and>
                      <not>
                        <equal>
                          <clip pos="2" side="tl" part="a_gen"/>
                          <lit-tag v="mf"/>
                        </equal>
                      </not>
                      <not>
                        <equal>
                          <clip pos="1" side="tl" part="a_gen"/>
                          <lit-tag v="GD"/>
                        </equal>
                      </not>
                    </and>
                  </test>
                  <let>
                    <var n="genere_chunk"/>
                    <clip pos="2" side="tl" part="a_gen"/>
                  </let>
                </when>
                <otherwise>
                  <let>
                    <var n="genere_chunk"/>
                    <lit-tag v="GD"/>
                  </let>
                </otherwise>
              </choose>
            </otherwise>
          </choose>
        </otherwise>
      </choose>
      <!-- Nombre -->
      <choose>
        <when>
          <test>
            <and>
            <not>
              <equal>
                <clip pos="1" side="tl" part="a_nbr"/>
                <lit-tag v="sp"/>
              </equal>
            </not>
            <not>
              <equal>
                <clip pos="1" side="tl" part="a_nbr"/>
                <lit-tag v="ND"/>
              </equal>
            </not>
            <not>
              <equal>
                <clip pos="1" side="tl" part="a_nbr"/>
                <lit v=""/>
              </equal>
            </not>
            </and>
          </test>
          <let>
            <var n="nombre_chunk"/>
            <clip pos="1" side="tl" part="a_nbr"/>
          </let>
        </when>
        <otherwise>
          <choose>
            <when>
              <test>
                <and>
                <not>
                  <equal>
                    <clip pos="1" side="sl" part="a_nbr"/>
                    <lit-tag v="sp"/>
                  </equal>
                </not>
                <not>
                  <equal>
                    <clip pos="1" side="sl" part="a_nbr"/>
                    <lit v=""/>
                  </equal>
                </not>
                </and>
              </test>
              <let>
                <var n="nombre_chunk"/>
                <clip pos="1" side="sl" part="a_nbr"/>
              </let>
            </when>
            <otherwise>
              <choose>
                <when>
                  <test>
                    <and>
                    <not>
                      <equal>
                        <clip pos="2" side="tl" part="a_nbr"/>
                        <lit-tag v="sp"/>
                      </equal>
                    </not>
                    <not>
                      <equal>
                        <clip pos="2" side="tl" part="a_nbr"/>
                        <lit-tag v="ND"/>
                      </equal>
                    </not>
                    <not>
                      <equal>
                        <clip pos="2" side="tl" part="a_nbr"/>
                        <lit v=""/>
                      </equal>
                    </not>
                    </and>
                  </test>
                  <let>
                    <var n="nombre_chunk"/>
                    <clip pos="2" side="tl" part="a_nbr"/>
                  </let>
                </when>
                <otherwise>
                  <let>
                    <var n="nombre_chunk"/>
                    <lit-tag v="ND"/>
                  </let>
                </otherwise>
              </choose>
            </otherwise>
          </choose>
        </otherwise>
      </choose>
      <!-- Si el gènere del chunk no és masculí o femení, cal adaptar-lo -->
      <choose>
        <when>
          <test>
            <or>
              <equal>
                <var n="genere_chunk"/>
                <lit-tag v="f"/>
              </equal>
              <equal>
                <var n="genere_chunk"/>
                <lit-tag v="fn"/>
              </equal>
            </or>
          </test>
          <let>
            <var n="genere_chunk"/>
            <lit-tag v="f"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <var n="genere_chunk"/>
              <lit-tag v="GD"/>
            </equal>
          </test>
          <let>
            <var n="genere_chunk"/>
            <lit-tag v="GD"/>
          </let>
        </when>
        <otherwise>
          <let>
            <var n="genere_chunk"/>
            <lit-tag v="m"/>
          </let>
        </otherwise>
      </choose>
    </def-macro>

    <def-macro n="f_concord3" npar="3" comment="Realitza la concordança de tres elements i desa els valors a les variables del chunk">
      <!-- Gènere -->
      <choose>
        <when>
          <test>
            <and>
              <not>
                <equal>
                  <clip pos="1" side="tl" part="a_gen"/>
                  <lit-tag v="mf"/>
                </equal>
              </not>
              <not>
                <equal>
                  <clip pos="1" side="tl" part="a_gen"/>
                  <lit-tag v="GD"/>
                </equal>
              </not>
            </and>
          </test>
          <let>
            <var n="genere_chunk"/>
            <clip pos="1" side="tl" part="a_gen"/>
          </let>
        </when>
        <otherwise>
          <choose>
            <when>
              <test>
                <not>
                  <equal>
                    <clip pos="1" side="sl" part="a_gen"/>
                    <lit-tag v="mf"/>
                  </equal>
                </not>
              </test>
              <let>
                <var n="genere_chunk"/>
                <clip pos="1" side="sl" part="a_gen"/>
              </let>
            </when>
            <otherwise>
              <choose>
                <when>
                  <test>
                    <and>
                      <not>
                        <equal>
                          <clip pos="2" side="tl" part="a_gen"/>
                          <lit-tag v="mf"/>
                        </equal>
                      </not>
                      <not>
                        <equal>
                          <clip pos="1" side="tl" part="a_gen"/>
                          <lit-tag v="GD"/>
                        </equal>
                      </not>
                    </and>
                  </test>
                  <let>
                    <var n="genere_chunk"/>
                    <clip pos="2" side="tl" part="a_gen"/>
                  </let>
                </when>
                <otherwise>
                  <choose>
                    <when>
                      <test>
                        <and>
                          <not>
                            <equal>
                              <clip pos="3" side="tl" part="a_gen"/>
                              <lit-tag v="mf"/>
                            </equal>
                          </not>
                          <not>
                            <equal>
                              <clip pos="1" side="tl" part="a_gen"/>
                              <lit-tag v="GD"/>
                            </equal>
                          </not>
                        </and>
                      </test>
                      <let>
                        <var n="genere_chunk"/>
                        <clip pos="3" side="tl" part="a_gen"/>
                      </let>
                    </when>
                    <otherwise>
                      <let>
                        <var n="genere_chunk"/>
                        <lit-tag v="GD"/>
                      </let>
                    </otherwise>
                  </choose>
                </otherwise>
              </choose>
            </otherwise>
          </choose>
        </otherwise>
      </choose>
      <!-- Nombre -->
      <choose>
        <when>
          <test>
            <and>
            <not>
              <equal>
                <clip pos="1" side="tl" part="a_nbr"/>
                <lit-tag v="sp"/>
              </equal>
            </not>
            <not>
              <equal>
                <clip pos="1" side="tl" part="a_nbr"/>
                <lit-tag v="ND"/>
              </equal>
            </not>
            <not>
              <equal>
                <clip pos="1" side="tl" part="a_nbr"/>
                <lit v=""/>
              </equal>
            </not>
            </and>
          </test>
          <let>
            <var n="nombre_chunk"/>
            <clip pos="1" side="tl" part="a_nbr"/>
          </let>
        </when>
        <otherwise>
          <choose>
            <when>
              <test>
                <and>
                <not>
                  <equal>
                    <clip pos="1" side="sl" part="a_nbr"/>
                    <lit-tag v="sp"/>
                  </equal>
                </not>
                <not>
                  <equal>
                    <clip pos="1" side="sl" part="a_nbr"/>
                    <lit v=""/>
                  </equal>
                </not>
                </and>
              </test>
              <let>
                <var n="nombre_chunk"/>
                <clip pos="1" side="sl" part="a_nbr"/>
              </let>
            </when>
            <otherwise>
              <choose>
                <when>
                  <test>
                    <and>
                    <not>
                      <equal>
                        <clip pos="2" side="tl" part="a_nbr"/>
                        <lit-tag v="sp"/>
                      </equal>
                    </not>
                    <not>
                      <equal>
                        <clip pos="2" side="tl" part="a_nbr"/>
                        <lit-tag v="ND"/>
                      </equal>
                    </not>
                    <not>
                      <equal>
                        <clip pos="2" side="tl" part="a_nbr"/>
                        <lit v=""/>
                      </equal>
                    </not>
                    </and>
                  </test>
                  <let>
                    <var n="nombre_chunk"/>
                    <clip pos="2" side="tl" part="a_nbr"/>
                  </let>
                </when>
                <otherwise>
                  <choose>
                    <when>
                      <test>
                        <and>
                        <not>
                          <equal>
                            <clip pos="3" side="tl" part="a_nbr"/>
                            <lit-tag v="sp"/>
                          </equal>
                        </not>
                        <not>
                          <equal>
                            <clip pos="3" side="tl" part="a_nbr"/>
                            <lit-tag v="ND"/>
                          </equal>
                        </not>
                        <not>
                          <equal>
                            <clip pos="3" side="tl" part="a_nbr"/>
                            <lit v=""/>
                          </equal>
                        </not>
                        </and>
                      </test>
                      <let>
                        <var n="nombre_chunk"/>
                        <clip pos="3" side="tl" part="a_nbr"/>
                      </let>
                    </when>
                    <otherwise>
                      <let>
                        <var n="nombre_chunk"/>
                        <lit-tag v="ND"/>
                      </let>
                    </otherwise>
                  </choose>
                </otherwise>
              </choose>
            </otherwise>
          </choose>
        </otherwise>
      </choose>
      <!-- Si el gènere del chunk no és masculí o femení, cal adaptar-lo -->
      <choose>
        <when>
          <test>
            <or>
              <equal>
                <var n="genere_chunk"/>
                <lit-tag v="f"/>
              </equal>
              <equal>
                <var n="genere_chunk"/>
                <lit-tag v="fn"/>
              </equal>
            </or>
          </test>
          <let>
            <var n="genere_chunk"/>
            <lit-tag v="f"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <var n="genere_chunk"/>
              <lit-tag v="GD"/>
            </equal>
          </test>
          <let>
            <var n="genere_chunk"/>
            <lit-tag v="GD"/>
          </let>
        </when>
        <otherwise>
          <let>
            <var n="genere_chunk"/>
            <lit-tag v="m"/>
          </let>
        </otherwise>
      </choose>
    </def-macro>

    <def-macro n="f_concord4" npar="4" comment="Realitza la concordança de quatre elements i desa els valors a les variables del chunk">
      <!-- Gènere -->
      <choose>
        <when>
          <test>
            <and>
              <not>
                <equal>
                  <clip pos="1" side="tl" part="a_gen"/>
                  <lit-tag v="mf"/>
                </equal>
              </not>
              <not>
                <equal>
                  <clip pos="1" side="tl" part="a_gen"/>
                  <lit-tag v="GD"/>
                </equal>
              </not>
            </and>
          </test>
          <let>
            <var n="genere_chunk"/>
            <clip pos="1" side="tl" part="a_gen"/>
          </let>
        </when>
        <otherwise>
          <choose>
            <when>
              <test>
                <not>
                  <equal>
                    <clip pos="1" side="sl" part="a_gen"/>
                    <lit-tag v="mf"/>
                  </equal>
                </not>
              </test>
              <let>
                <var n="genere_chunk"/>
                <clip pos="1" side="sl" part="a_gen"/>
              </let>
            </when>
            <otherwise>
              <choose>
                <when>
                  <test>
                    <and>
                      <not>
                        <equal>
                          <clip pos="2" side="tl" part="a_gen"/>
                          <lit-tag v="mf"/>
                        </equal>
                      </not>
                      <not>
                        <equal>
                          <clip pos="1" side="tl" part="a_gen"/>
                          <lit-tag v="GD"/>
                        </equal>
                      </not>
                    </and>
                  </test>
                  <let>
                    <var n="genere_chunk"/>
                    <clip pos="2" side="tl" part="a_gen"/>
                  </let>
                </when>
                <otherwise>
                  <choose>
                    <when>
                      <test>
                        <and>
                          <not>
                            <equal>
                              <clip pos="3" side="tl" part="a_gen"/>
                              <lit-tag v="mf"/>
                            </equal>
                          </not>
                          <not>
                            <equal>
                              <clip pos="1" side="tl" part="a_gen"/>
                              <lit-tag v="GD"/>
                            </equal>
                          </not>
                        </and>
                      </test>
                      <let>
                        <var n="genere_chunk"/>
                        <clip pos="3" side="tl" part="a_gen"/>
                      </let>
                    </when>
                    <otherwise>
                     <choose>
                        <when>
                          <test>
                            <and>
                              <not>
                                <equal>
                                  <clip pos="4" side="tl" part="a_gen"/>
                                  <lit-tag v="mf"/>
                                </equal>
                              </not>
                              <not>
                                <equal>
                                  <clip pos="1" side="tl" part="a_gen"/>
                                  <lit-tag v="GD"/>
                                </equal>
                              </not>
                            </and>
                          </test>
                          <let>
                            <var n="genere_chunk"/>
                            <clip pos="4" side="tl" part="a_gen"/>
                          </let>
                        </when>
                        <otherwise>
                          <let>
                            <var n="genere_chunk"/>
                            <lit-tag v="GD"/>
                          </let>
                        </otherwise>
                      </choose>
                    </otherwise>
                  </choose>
                </otherwise>
              </choose>
            </otherwise>
          </choose>
        </otherwise>
      </choose>
      <!-- Nombre -->
      <choose>
        <when>
          <test>
            <and>
            <not>
              <equal>
                <clip pos="1" side="tl" part="a_nbr"/>
                <lit-tag v="sp"/>
              </equal>
            </not>
            <not>
              <equal>
                <clip pos="1" side="tl" part="a_nbr"/>
                <lit-tag v="ND"/>
              </equal>
            </not>
            <not>
              <equal>
                <clip pos="1" side="tl" part="a_nbr"/>
                <lit v=""/>
              </equal>
            </not>
            </and>
          </test>
          <let>
            <var n="nombre_chunk"/>
            <clip pos="1" side="tl" part="a_nbr"/>
          </let>
        </when>
        <otherwise>
          <choose>
            <when>
              <test>
                <and>
                <not>
                  <equal>
                    <clip pos="1" side="sl" part="a_nbr"/>
                    <lit-tag v="sp"/>
                  </equal>
                </not>
                <not>
                  <equal>
                    <clip pos="1" side="sl" part="a_nbr"/>
                    <lit v=""/>
                  </equal>
                </not>
                </and>
              </test>
              <let>
                <var n="nombre_chunk"/>
                <clip pos="1" side="sl" part="a_nbr"/>
              </let>
            </when>
            <otherwise>
              <choose>
                <when>
                  <test>
                    <and>
                    <not>
                      <equal>
                        <clip pos="2" side="tl" part="a_nbr"/>
                        <lit-tag v="sp"/>
                      </equal>
                    </not>
                    <not>
                      <equal>
                        <clip pos="2" side="tl" part="a_nbr"/>
                        <lit-tag v="ND"/>
                      </equal>
                    </not>
                    <not>
                      <equal>
                        <clip pos="2" side="tl" part="a_nbr"/>
                        <lit v=""/>
                      </equal>
                    </not>
                    </and>
                  </test>
                  <let>
                    <var n="nombre_chunk"/>
                    <clip pos="2" side="tl" part="a_nbr"/>
                  </let>
                </when>
                <otherwise>
                  <choose>
                    <when>
                      <test>
                        <and>
                        <not>
                          <equal>
                            <clip pos="3" side="tl" part="a_nbr"/>
                            <lit-tag v="sp"/>
                          </equal>
                        </not>
                        <not>
                          <equal>
                            <clip pos="3" side="tl" part="a_nbr"/>
                            <lit-tag v="ND"/>
                          </equal>
                        </not>
                        <not>
                          <equal>
                            <clip pos="3" side="tl" part="a_nbr"/>
                            <lit v=""/>
                          </equal>
                        </not>
                        </and>
                      </test>
                      <let>
                        <var n="nombre_chunk"/>
                        <clip pos="3" side="tl" part="a_nbr"/>
                      </let>
                    </when>
                    <otherwise>
                     <choose>
                        <when>
                          <test>
                            <and>
                            <not>
                              <equal>
                                <clip pos="4" side="tl" part="a_nbr"/>
                                <lit-tag v="sp"/>
                              </equal>
                            </not>
                            <not>
                              <equal>
                                <clip pos="4" side="tl" part="a_nbr"/>
                                <lit-tag v="ND"/>
                              </equal>
                            </not>
                            <not>
                              <equal>
                                <clip pos="4" side="tl" part="a_nbr"/>
                                <lit v=""/>
                              </equal>
                            </not>
                            </and>
                          </test>
                          <let>
                            <var n="nombre_chunk"/>
                            <clip pos="4" side="tl" part="a_nbr"/>
                          </let>
                        </when>
                        <otherwise>
                          <let>
                            <var n="nombre_chunk"/>
                            <lit-tag v="ND"/>
                          </let>
                        </otherwise>
                      </choose>
                    </otherwise>
                  </choose>
                </otherwise>
              </choose>
            </otherwise>
          </choose>
        </otherwise>
      </choose>
      <!-- Si el gènere del chunk no és masculí o femení, cal adaptar-lo -->
      <choose>
        <when>
          <test>
            <or>
              <equal>
                <var n="genere_chunk"/>
                <lit-tag v="f"/>
              </equal>
              <equal>
                <var n="genere_chunk"/>
                <lit-tag v="fn"/>
              </equal>
            </or>
          </test>
          <let>
            <var n="genere_chunk"/>
            <lit-tag v="f"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <var n="genere_chunk"/>
              <lit-tag v="GD"/>
            </equal>
          </test>
          <let>
            <var n="genere_chunk"/>
            <lit-tag v="GD"/>
          </let>
        </when>
        <otherwise>
          <let>
            <var n="genere_chunk"/>
            <lit-tag v="m"/>
          </let>
        </otherwise>
      </choose>
    </def-macro>

    <def-macro n="f_concord5" npar="5" comment="Realitza la concordança de cinc elements i desa els valors a les variables del chunk">
      <!-- Gènere -->
      <choose>
        <when>
          <test>
            <and>
              <not>
                <equal>
                  <clip pos="1" side="tl" part="a_gen"/>
                  <lit-tag v="mf"/>
                </equal>
              </not>
              <not>
                <equal>
                  <clip pos="1" side="tl" part="a_gen"/>
                  <lit-tag v="GD"/>
                </equal>
              </not>
            </and>
          </test>
          <let>
            <var n="genere_chunk"/>
            <clip pos="1" side="tl" part="a_gen"/>
          </let>
        </when>
        <otherwise>
          <choose>
            <when>
              <test>
                <not>
                  <equal>
                    <clip pos="1" side="sl" part="a_gen"/>
                    <lit-tag v="mf"/>
                  </equal>
                </not>
              </test>
              <let>
                <var n="genere_chunk"/>
                <clip pos="1" side="sl" part="a_gen"/>
              </let>
            </when>
            <otherwise>
              <choose>
                <when>
                  <test>
                    <and>
                      <not>
                        <equal>
                          <clip pos="2" side="tl" part="a_gen"/>
                          <lit-tag v="mf"/>
                        </equal>
                      </not>
                      <not>
                        <equal>
                          <clip pos="1" side="tl" part="a_gen"/>
                          <lit-tag v="GD"/>
                        </equal>
                      </not>
                    </and>
                  </test>
                  <let>
                    <var n="genere_chunk"/>
                    <clip pos="2" side="tl" part="a_gen"/>
                  </let>
                </when>
                <otherwise>
                  <choose>
                    <when>
                      <test>
                        <and>
                          <not>
                            <equal>
                              <clip pos="3" side="tl" part="a_gen"/>
                              <lit-tag v="mf"/>
                            </equal>
                          </not>
                          <not>
                            <equal>
                              <clip pos="1" side="tl" part="a_gen"/>
                              <lit-tag v="GD"/>
                            </equal>
                          </not>
                        </and>
                      </test>
                      <let>
                        <var n="genere_chunk"/>
                        <clip pos="3" side="tl" part="a_gen"/>
                      </let>
                    </when>
                    <otherwise>
                     <choose>
                        <when>
                          <test>
                            <and>
                              <not>
                                <equal>
                                  <clip pos="4" side="tl" part="a_gen"/>
                                  <lit-tag v="mf"/>
                                </equal>
                              </not>
                              <not>
                                <equal>
                                  <clip pos="1" side="tl" part="a_gen"/>
                                  <lit-tag v="GD"/>
                                </equal>
                              </not>
                            </and>
                          </test>
                          <let>
                            <var n="genere_chunk"/>
                            <clip pos="4" side="tl" part="a_gen"/>
                          </let>
                        </when>
                        <otherwise>
                         <choose>
                            <when>
                              <test>
                                <and>
                                  <not>
                                    <equal>
                                      <clip pos="5" side="tl" part="a_gen"/>
                                      <lit-tag v="mf"/>
                                    </equal>
                                  </not>
                                  <not>
                                    <equal>
                                      <clip pos="1" side="tl" part="a_gen"/>
                                      <lit-tag v="GD"/>
                                    </equal>
                                  </not>
                                </and>
                              </test>
                              <let>
                                <var n="genere_chunk"/>
                                <clip pos="5" side="tl" part="a_gen"/>
                              </let>
                            </when>
                            <otherwise>
                              <let>
                                <var n="genere_chunk"/>
                                <lit-tag v="GD"/>
                              </let>
                            </otherwise>
                          </choose>
                        </otherwise>
                      </choose>
                    </otherwise>
                  </choose>
                </otherwise>
              </choose>
            </otherwise>
          </choose>
        </otherwise>
      </choose>
      <!-- Nombre -->
      <choose>
        <when>
          <test>
            <and>
            <not>
              <equal>
                <clip pos="1" side="tl" part="a_nbr"/>
                <lit-tag v="sp"/>
              </equal>
            </not>
            <not>
              <equal>
                <clip pos="1" side="tl" part="a_nbr"/>
                <lit-tag v="ND"/>
              </equal>
            </not>
            <not>
              <equal>
                <clip pos="1" side="tl" part="a_nbr"/>
                <lit v=""/>
              </equal>
            </not>
            </and>
          </test>
          <let>
            <var n="nombre_chunk"/>
            <clip pos="1" side="tl" part="a_nbr"/>
          </let>
        </when>
        <otherwise>
          <choose>
            <when>
              <test>
                <and>
                <not>
                  <equal>
                    <clip pos="1" side="sl" part="a_nbr"/>
                    <lit-tag v="sp"/>
                  </equal>
                </not>
                <not>
                  <equal>
                    <clip pos="1" side="sl" part="a_nbr"/>
                    <lit v=""/>
                  </equal>
                </not>
                </and>
              </test>
              <let>
                <var n="nombre_chunk"/>
                <clip pos="1" side="sl" part="a_nbr"/>
              </let>
            </when>
            <otherwise>
              <choose>
                <when>
                  <test>
                    <and>
                    <not>
                      <equal>
                        <clip pos="2" side="tl" part="a_nbr"/>
                        <lit-tag v="sp"/>
                      </equal>
                    </not>
                    <not>
                      <equal>
                        <clip pos="2" side="tl" part="a_nbr"/>
                        <lit-tag v="ND"/>
                      </equal>
                    </not>
                    <not>
                      <equal>
                        <clip pos="2" side="tl" part="a_nbr"/>
                        <lit v=""/>
                      </equal>
                    </not>
                    </and>
                  </test>
                  <let>
                    <var n="nombre_chunk"/>
                    <clip pos="2" side="tl" part="a_nbr"/>
                  </let>
                </when>
                <otherwise>
                  <choose>
                    <when>
                      <test>
                        <and>
                        <not>
                          <equal>
                            <clip pos="3" side="tl" part="a_nbr"/>
                            <lit-tag v="sp"/>
                          </equal>
                        </not>
                        <not>
                          <equal>
                            <clip pos="3" side="tl" part="a_nbr"/>
                            <lit-tag v="ND"/>
                          </equal>
                        </not>
                        <not>
                          <equal>
                            <clip pos="3" side="tl" part="a_nbr"/>
                            <lit v=""/>
                          </equal>
                        </not>
                        </and>
                      </test>
                      <let>
                        <var n="nombre_chunk"/>
                        <clip pos="3" side="tl" part="a_nbr"/>
                      </let>
                    </when>
                    <otherwise>
                     <choose>
                        <when>
                          <test>
                            <and>
                            <not>
                              <equal>
                                <clip pos="4" side="tl" part="a_nbr"/>
                                <lit-tag v="sp"/>
                              </equal>
                            </not>
                            <not>
                              <equal>
                                <clip pos="4" side="tl" part="a_nbr"/>
                                <lit-tag v="ND"/>
                              </equal>
                            </not>
                            <not>
                              <equal>
                                <clip pos="4" side="tl" part="a_nbr"/>
                                <lit v=""/>
                              </equal>
                            </not>
                            </and>
                          </test>
                          <let>
                            <var n="nombre_chunk"/>
                            <clip pos="4" side="tl" part="a_nbr"/>
                          </let>
                        </when>
                        <otherwise>
                         <choose>
                            <when>
                              <test>
                                <and>
                                <not>
                                  <equal>
                                    <clip pos="5" side="tl" part="a_nbr"/>
                                    <lit-tag v="sp"/>
                                  </equal>
                                </not>
                                <not>
                                  <equal>
                                    <clip pos="5" side="tl" part="a_nbr"/>
                                    <lit-tag v="ND"/>
                                  </equal>
                                </not>
                                <not>
                                  <equal>
                                    <clip pos="5" side="tl" part="a_nbr"/>
                                    <lit v=""/>
                                  </equal>
                                </not>
                                </and>
                              </test>
                              <let>
                                <var n="nombre_chunk"/>
                                <clip pos="5" side="tl" part="a_nbr"/>
                              </let>
                            </when>
                            <otherwise>
                              <let>
                                <var n="nombre_chunk"/>
                                <lit-tag v="ND"/>
                              </let>
                            </otherwise>
                          </choose>
                        </otherwise>
                      </choose>
                    </otherwise>
                  </choose>
                </otherwise>
              </choose>
            </otherwise>
          </choose>
        </otherwise>
      </choose>
      <!-- Si el gènere del chunk no és masculí o femení, cal adaptar-lo -->
      <choose>
        <when>
          <test>
            <or>
              <equal>
                <var n="genere_chunk"/>
                <lit-tag v="f"/>
              </equal>
              <equal>
                <var n="genere_chunk"/>
                <lit-tag v="fn"/>
              </equal>
            </or>
          </test>
          <let>
            <var n="genere_chunk"/>
            <lit-tag v="f"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <var n="genere_chunk"/>
              <lit-tag v="GD"/>
            </equal>
          </test>
          <let>
            <var n="genere_chunk"/>
            <lit-tag v="GD"/>
          </let>
        </when>
        <otherwise>
          <let>
            <var n="genere_chunk"/>
            <lit-tag v="m"/>
          </let>
        </otherwise>
      </choose>
    </def-macro>

    <def-macro n="f_concord1_i" npar="1" comment="Realitza la concordança d'un element intern i desa els valors a les variables internes">
      <!-- Gènere -->
      <choose>
        <when>
          <test>
            <not>
              <equal>
                <clip pos="1" side="tl" part="a_gen"/>
                <lit-tag v="mf"/>
              </equal>
            </not>
          </test>
          <let>
            <var n="genere"/>
            <clip pos="1" side="tl" part="a_gen"/>
          </let>
        </when>
        <otherwise>
          <let>
            <var n="genere"/>
            <clip pos="1" side="sl" part="a_gen"/>
          </let>
        </otherwise>
      </choose>
      <!-- Nombre -->
      <choose>
        <when>
          <test>
            <and>
            <not>
              <equal>
                <clip pos="1" side="tl" part="a_nbr"/>
                <lit-tag v="sp"/>
              </equal>
            </not>
            <not>
              <equal>
                <clip pos="1" side="tl" part="a_nbr"/>
                <lit v=""/>
              </equal>
            </not>
            </and>
          </test>
          <let>
            <var n="nombre"/>
            <clip pos="1" side="tl" part="a_nbr"/>
          </let>
        </when>
        <otherwise>
          <let>
            <var n="nombre"/>
            <clip pos="1" side="sl" part="a_nbr"/>
          </let>
        </otherwise>
      </choose>
      <!-- Si el gènere del chunk no és masculí o femení, cal adaptar-lo -->
      <choose>
        <when>
          <test>
            <or>
              <equal>
                <var n="genere"/>
                <lit-tag v="f"/>
              </equal>
              <equal>
                <var n="genere"/>
                <lit-tag v="fn"/>
              </equal>
            </or>
          </test>
          <let>
            <var n="genere"/>
            <lit-tag v="f"/>
          </let>
        </when>
        <otherwise>
          <let>
            <var n="genere"/>
            <lit-tag v="m"/>
          </let>
        </otherwise>
      </choose>
      <!-- Propaga els valors als elements -->
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="1" side="tl" part="a_gen_mf"/>
              <lit v=""/>
            </equal>
          </test>
          <let>
            <clip pos="1" side="tl" part="a_gen"/>
            <var n="genere"/>
          </let>
        </when>
      </choose>
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="1" side="tl" part="a_nbr_sp"/>
              <lit v=""/>
            </equal>
          </test>
          <let>
            <clip pos="1" side="tl" part="a_nbr"/>
            <var n="nombre"/>
          </let>
        </when>
      </choose>
      <!-- Propaga els valors a la variable definitiva -->
      <choose>
        <when>
          <test>
            <equal>
              <var n="genere1"/>
              <lit v=""/>
            </equal>
          </test>
          <let>
            <var n="genere1"/>
            <var n="genere"/>
          </let>
        </when>
        <otherwise>
          <choose>
            <when>
              <test>
                <equal>
                  <var n="genere2"/>
                  <lit v=""/>
                </equal>
              </test>
              <let>
                <var n="genere2"/>
                <var n="genere"/>
              </let>
            </when>
            <otherwise>
              <let>
                <var n="genere3"/>
                <var n="genere"/>
              </let>
            </otherwise>
          </choose>
        </otherwise>
      </choose>
      <choose>
        <when>
          <test>
            <equal>
              <var n="nombre1"/>
              <lit v=""/>
            </equal>
          </test>
          <let>
            <var n="nombre1"/>
            <var n="nombre"/>
          </let>
        </when>
        <otherwise>
          <choose>
            <when>
              <test>
                <equal>
                  <var n="nombre2"/>
                  <lit v=""/>
                </equal>
              </test>
              <let>
                <var n="nombre2"/>
                <var n="nombre"/>
              </let>
            </when>
            <otherwise>
              <let>
                <var n="nombre3"/>
                <var n="nombre"/>
              </let>
            </otherwise>
          </choose>
        </otherwise>
      </choose>
    </def-macro>

    <def-macro n="f_concord2_i" npar="2" comment="Realitza la concordança de dos elements interns i desa els valors a les variables internes">
      <!-- Gènere -->
      <choose>
        <when>
          <test>
            <and>
              <not>
                <equal>
                  <clip pos="1" side="tl" part="a_gen"/>
                  <lit-tag v="mf"/>
                </equal>
              </not>
              <not>
                <equal>
                  <clip pos="1" side="tl" part="a_gen"/>
                  <lit-tag v="GD"/>
                </equal>
              </not>
            </and>
          </test>
          <let>
            <var n="genere"/>
            <clip pos="1" side="tl" part="a_gen"/>
          </let>
        </when>
        <otherwise>
          <choose>
            <when>
              <test>
                <not>
                  <equal>
                    <clip pos="1" side="sl" part="a_gen"/>
                    <lit-tag v="mf"/>
                  </equal>
                </not>
              </test>
              <let>
                <var n="genere"/>
                <clip pos="1" side="sl" part="a_gen"/>
              </let>
            </when>
            <otherwise>
              <choose>
                <when>
                  <test>
                    <and>
                      <not>
                        <equal>
                          <clip pos="2" side="tl" part="a_gen"/>
                          <lit-tag v="mf"/>
                        </equal>
                      </not>
                      <not>
                        <equal>
                          <clip pos="1" side="tl" part="a_gen"/>
                          <lit-tag v="GD"/>
                        </equal>
                      </not>
                    </and>
                  </test>
                  <let>
                    <var n="genere"/>
                    <clip pos="2" side="tl" part="a_gen"/>
                  </let>
                </when>
                <otherwise>
                  <let>
                    <var n="genere"/>
                    <lit-tag v="m"/>
                  </let>
                </otherwise>
              </choose>
            </otherwise>
          </choose>
        </otherwise>
      </choose>
      <!-- Nombre -->
      <choose>
        <when>
          <test>
            <and>
            <not>
              <equal>
                <clip pos="1" side="tl" part="a_nbr"/>
                <lit-tag v="sp"/>
              </equal>
            </not>
            <not>
              <equal>
                <clip pos="1" side="tl" part="a_nbr"/>
                <lit-tag v="ND"/>
              </equal>
            </not>
            <not>
              <equal>
                <clip pos="1" side="tl" part="a_nbr"/>
                <lit v=""/>
              </equal>
            </not>
            </and>
          </test>
          <let>
            <var n="nombre"/>
            <clip pos="1" side="tl" part="a_nbr"/>
          </let>
        </when>
        <otherwise>
          <choose>
            <when>
              <test>
                <and>
                <not>
                  <equal>
                    <clip pos="1" side="sl" part="a_nbr"/>
                    <lit-tag v="sp"/>
                  </equal>
                </not>
                <not>
                  <equal>
                    <clip pos="1" side="sl" part="a_nbr"/>
                    <lit v=""/>
                  </equal>
                </not>
                </and>
              </test>
              <let>
                <var n="nombre"/>
                <clip pos="1" side="sl" part="a_nbr"/>
              </let>
            </when>
            <otherwise>
              <choose>
                <when>
                  <test>
                    <and>
                    <not>
                      <equal>
                        <clip pos="2" side="tl" part="a_nbr"/>
                        <lit-tag v="sp"/>
                      </equal>
                    </not>
                    <not>
                      <equal>
                        <clip pos="2" side="tl" part="a_nbr"/>
                        <lit-tag v="ND"/>
                      </equal>
                    </not>
                    <not>
                      <equal>
                        <clip pos="2" side="tl" part="a_nbr"/>
                        <lit v=""/>
                      </equal>
                    </not>
                    </and>
                  </test>
                  <let>
                    <var n="nombre"/>
                    <clip pos="2" side="tl" part="a_nbr"/>
                  </let>
                </when>
                <otherwise>
                  <let>
                    <var n="nombre"/>
                    <lit-tag v="sg"/>
                  </let>
                </otherwise>
              </choose>
            </otherwise>
          </choose>
        </otherwise>
      </choose>
      <!-- Si el gènere del chunk no és masculí o femení, cal adaptar-lo -->
      <choose>
        <when>
          <test>
            <or>
              <equal>
                <var n="genere"/>
                <lit-tag v="f"/>
              </equal>
              <equal>
                <var n="genere"/>
                <lit-tag v="fn"/>
              </equal>
            </or>
          </test>
          <let>
            <var n="genere"/>
            <lit-tag v="f"/>
          </let>
        </when>
        <otherwise>
          <let>
            <var n="genere"/>
            <lit-tag v="m"/>
          </let>
        </otherwise>
      </choose>
      <!-- Propaga els valors als elements -->
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="1" side="tl" part="a_gen_mf"/>
              <lit v=""/>
            </equal>
          </test>
          <let>
            <clip pos="1" side="tl" part="a_gen"/>
            <var n="genere"/>
          </let>
        </when>
      </choose>
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="1" side="tl" part="a_nbr_sp"/>
              <lit v=""/>
            </equal>
          </test>
          <let>
            <clip pos="1" side="tl" part="a_nbr"/>
            <var n="nombre"/>
          </let>
        </when>
      </choose>
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="2" side="tl" part="a_gen_mf"/>
              <lit v=""/>
            </equal>
          </test>
          <let>
            <clip pos="2" side="tl" part="a_gen"/>
            <var n="genere"/>
          </let>
        </when>
      </choose>
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="2" side="tl" part="a_nbr_sp"/>
              <lit v=""/>
            </equal>
          </test>
          <let>
            <clip pos="2" side="tl" part="a_nbr"/>
            <var n="nombre"/>
          </let>
        </when>
      </choose>
      <!-- Propaga els valors a la variable definitiva -->
      <choose>
        <when>
          <test>
            <equal>
              <var n="genere1"/>
              <lit v=""/>
            </equal>
          </test>
          <let>
            <var n="genere1"/>
            <var n="genere"/>
          </let>
        </when>
        <otherwise>
          <choose>
            <when>
              <test>
                <equal>
                  <var n="genere2"/>
                  <lit v=""/>
                </equal>
              </test>
              <let>
                <var n="genere2"/>
                <var n="genere"/>
              </let>
            </when>
            <otherwise>
              <let>
                <var n="genere3"/>
                <var n="genere"/>
              </let>
            </otherwise>
          </choose>
        </otherwise>
      </choose>
      <choose>
        <when>
          <test>
            <equal>
              <var n="nombre1"/>
              <lit v=""/>
            </equal>
          </test>
          <let>
            <var n="nombre1"/>
            <var n="nombre"/>
          </let>
        </when>
        <otherwise>
          <choose>
            <when>
              <test>
                <equal>
                  <var n="nombre2"/>
                  <lit v=""/>
                </equal>
              </test>
              <let>
                <var n="nombre2"/>
                <var n="nombre"/>
              </let>
            </when>
            <otherwise>
              <let>
                <var n="nombre3"/>
                <var n="nombre"/>
              </let>
            </otherwise>
          </choose>
        </otherwise>
      </choose>
    </def-macro>

    <def-macro n="f_concord3_i" npar="3" comment="Realitza la concordança de tres elements interns i desa els valors a les variables internes">
      <!-- Gènere -->
      <choose>
        <when>
          <test>
            <and>
              <not>
                <equal>
                  <clip pos="1" side="tl" part="a_gen"/>
                  <lit-tag v="mf"/>
                </equal>
              </not>
              <not>
                <equal>
                  <clip pos="1" side="tl" part="a_gen"/>
                  <lit-tag v="GD"/>
                </equal>
              </not>
            </and>
          </test>
          <let>
            <var n="genere"/>
            <clip pos="1" side="tl" part="a_gen"/>
          </let>
        </when>
        <otherwise>
          <choose>
            <when>
              <test>
                <not>
                  <equal>
                    <clip pos="1" side="sl" part="a_gen"/>
                    <lit-tag v="mf"/>
                  </equal>
                </not>
              </test>
              <let>
                <var n="genere"/>
                <clip pos="1" side="sl" part="a_gen"/>
              </let>
            </when>
            <otherwise>
              <choose>
                <when>
                  <test>
                    <and>
                      <not>
                        <equal>
                          <clip pos="2" side="tl" part="a_gen"/>
                          <lit-tag v="mf"/>
                        </equal>
                      </not>
                      <not>
                        <equal>
                          <clip pos="1" side="tl" part="a_gen"/>
                          <lit-tag v="GD"/>
                        </equal>
                      </not>
                    </and>
                  </test>
                  <let>
                    <var n="genere"/>
                    <clip pos="2" side="tl" part="a_gen"/>
                  </let>
                </when>
                <otherwise>
                  <choose>
                    <when>
                      <test>
                        <and>
                          <not>
                            <equal>
                              <clip pos="3" side="tl" part="a_gen"/>
                              <lit-tag v="mf"/>
                            </equal>
                          </not>
                          <not>
                            <equal>
                              <clip pos="1" side="tl" part="a_gen"/>
                              <lit-tag v="GD"/>
                            </equal>
                          </not>
                        </and>
                      </test>
                      <let>
                        <var n="genere"/>
                        <clip pos="3" side="tl" part="a_gen"/>
                      </let>
                    </when>
                    <otherwise>
                      <let>
                        <var n="genere"/>
                        <lit-tag v="m"/>
                      </let>
                    </otherwise>
                  </choose>
                </otherwise>
              </choose>
            </otherwise>
          </choose>
        </otherwise>
      </choose>
      <!-- Nombre -->
      <choose>
        <when>
          <test>
            <and>
            <not>
              <equal>
                <clip pos="1" side="tl" part="a_nbr"/>
                <lit-tag v="sp"/>
              </equal>
            </not>
            <not>
              <equal>
                <clip pos="1" side="tl" part="a_nbr"/>
                <lit-tag v="ND"/>
              </equal>
            </not>
            <not>
              <equal>
                <clip pos="1" side="tl" part="a_nbr"/>
                <lit v=""/>
              </equal>
            </not>
            </and>
          </test>
          <let>
            <var n="nombre"/>
            <clip pos="1" side="tl" part="a_nbr"/>
          </let>
        </when>
        <otherwise>
          <choose>
            <when>
              <test>
                <and>
                <not>
                  <equal>
                    <clip pos="1" side="sl" part="a_nbr"/>
                    <lit-tag v="sp"/>
                  </equal>
                </not>
                <not>
                  <equal>
                    <clip pos="1" side="sl" part="a_nbr"/>
                    <lit v=""/>
                  </equal>
                </not>
                </and>
              </test>
              <let>
                <var n="nombre"/>
                <clip pos="1" side="sl" part="a_nbr"/>
              </let>
            </when>
            <otherwise>
              <choose>
                <when>
                  <test>
                    <and>
                    <not>
                      <equal>
                        <clip pos="2" side="tl" part="a_nbr"/>
                        <lit-tag v="sp"/>
                      </equal>
                    </not>
                    <not>
                      <equal>
                        <clip pos="2" side="tl" part="a_nbr"/>
                        <lit-tag v="ND"/>
                      </equal>
                    </not>
                    <not>
                      <equal>
                        <clip pos="2" side="tl" part="a_nbr"/>
                        <lit v=""/>
                      </equal>
                    </not>
                    </and>
                  </test>
                  <let>
                    <var n="nombre"/>
                    <clip pos="2" side="tl" part="a_nbr"/>
                  </let>
                </when>
                <otherwise>
                  <choose>
                    <when>
                      <test>
                        <and>
                        <not>
                          <equal>
                            <clip pos="3" side="tl" part="a_nbr"/>
                            <lit-tag v="sp"/>
                          </equal>
                        </not>
                        <not>
                          <equal>
                            <clip pos="3" side="tl" part="a_nbr"/>
                            <lit-tag v="ND"/>
                          </equal>
                        </not>
                        <not>
                          <equal>
                            <clip pos="3" side="tl" part="a_nbr"/>
                            <lit v=""/>
                          </equal>
                        </not>
                        </and>
                      </test>
                      <let>
                        <var n="nombre"/>
                        <clip pos="3" side="tl" part="a_nbr"/>
                      </let>
                    </when>
                    <otherwise>
                      <let>
                        <var n="nombre"/>
                        <lit-tag v="sg"/>
                      </let>
                    </otherwise>
                  </choose>
                </otherwise>
              </choose>
            </otherwise>
          </choose>
        </otherwise>
      </choose>
      <!-- Si el gènere del chunk no és masculí o femení, cal adaptar-lo -->
      <choose>
        <when>
          <test>
            <or>
              <equal>
                <var n="genere"/>
                <lit-tag v="f"/>
              </equal>
              <equal>
                <var n="genere"/>
                <lit-tag v="fn"/>
              </equal>
            </or>
          </test>
          <let>
            <var n="genere"/>
            <lit-tag v="f"/>
          </let>
        </when>
        <otherwise>
          <let>
            <var n="genere"/>
            <lit-tag v="m"/>
          </let>
        </otherwise>
      </choose>
      <!-- Propaga els valors als elements -->
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="1" side="tl" part="a_gen_mf"/>
              <lit v=""/>
            </equal>
          </test>
          <let>
            <clip pos="1" side="tl" part="a_gen"/>
            <var n="genere"/>
          </let>
        </when>
      </choose>
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="1" side="tl" part="a_nbr_sp"/>
              <lit v=""/>
            </equal>
          </test>
          <let>
            <clip pos="1" side="tl" part="a_nbr"/>
            <var n="nombre"/>
          </let>
        </when>
      </choose>
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="2" side="tl" part="a_gen_mf"/>
              <lit v=""/>
            </equal>
          </test>
          <let>
            <clip pos="2" side="tl" part="a_gen"/>
            <var n="genere"/>
          </let>
        </when>
      </choose>
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="2" side="tl" part="a_nbr_sp"/>
              <lit v=""/>
            </equal>
          </test>
          <let>
            <clip pos="2" side="tl" part="a_nbr"/>
            <var n="nombre"/>
          </let>
        </when>
      </choose>
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="3" side="tl" part="a_gen_mf"/>
              <lit v=""/>
            </equal>
          </test>
          <let>
            <clip pos="3" side="tl" part="a_gen"/>
            <var n="genere"/>
          </let>
        </when>
      </choose>
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="3" side="tl" part="a_nbr_sp"/>
              <lit v=""/>
            </equal>
          </test>
          <let>
            <clip pos="3" side="tl" part="a_nbr"/>
            <var n="nombre"/>
          </let>
        </when>
      </choose>
      <!-- Propaga els valors a la variable definitiva -->
      <choose>
        <when>
          <test>
            <equal>
              <var n="genere1"/>
              <lit v=""/>
            </equal>
          </test>
          <let>
            <var n="genere1"/>
            <var n="genere"/>
          </let>
        </when>
        <otherwise>
          <choose>
            <when>
              <test>
                <equal>
                  <var n="genere2"/>
                  <lit v=""/>
                </equal>
              </test>
              <let>
                <var n="genere2"/>
                <var n="genere"/>
              </let>
            </when>
            <otherwise>
              <let>
                <var n="genere3"/>
                <var n="genere"/>
              </let>
            </otherwise>
          </choose>
        </otherwise>
      </choose>
      <choose>
        <when>
          <test>
            <equal>
              <var n="nombre1"/>
              <lit v=""/>
            </equal>
          </test>
          <let>
            <var n="nombre1"/>
            <var n="nombre"/>
          </let>
        </when>
        <otherwise>
          <choose>
            <when>
              <test>
                <equal>
                  <var n="nombre2"/>
                  <lit v=""/>
                </equal>
              </test>
              <let>
                <var n="nombre2"/>
                <var n="nombre"/>
              </let>
            </when>
            <otherwise>
              <let>
                <var n="nombre3"/>
                <var n="nombre"/>
              </let>
            </otherwise>
          </choose>
        </otherwise>
      </choose>
    </def-macro>

    <def-macro n="f_concord4_i" npar="4" comment="Realitza la concordança de quatre elements interns i desa els valors a les variables internes">
      <!-- Gènere -->
      <choose>
        <when>
          <test>
            <and>
              <not>
                <equal>
                  <clip pos="1" side="tl" part="a_gen"/>
                  <lit-tag v="mf"/>
                </equal>
              </not>
              <not>
                <equal>
                  <clip pos="1" side="tl" part="a_gen"/>
                  <lit-tag v="GD"/>
                </equal>
              </not>
            </and>
          </test>
          <let>
            <var n="genere"/>
            <clip pos="1" side="tl" part="a_gen"/>
          </let>
        </when>
        <otherwise>
          <choose>
            <when>
              <test>
                <not>
                  <equal>
                    <clip pos="1" side="sl" part="a_gen"/>
                    <lit-tag v="mf"/>
                  </equal>
                </not>
              </test>
              <let>
                <var n="genere"/>
                <clip pos="1" side="sl" part="a_gen"/>
              </let>
            </when>
            <otherwise>
              <choose>
                <when>
                  <test>
                    <and>
                      <not>
                        <equal>
                          <clip pos="2" side="tl" part="a_gen"/>
                          <lit-tag v="mf"/>
                        </equal>
                      </not>
                      <not>
                        <equal>
                          <clip pos="1" side="tl" part="a_gen"/>
                          <lit-tag v="GD"/>
                        </equal>
                      </not>
                    </and>
                  </test>
                  <let>
                    <var n="genere"/>
                    <clip pos="2" side="tl" part="a_gen"/>
                  </let>
                </when>
                <otherwise>
                  <choose>
                    <when>
                      <test>
                        <and>
                          <not>
                            <equal>
                              <clip pos="3" side="tl" part="a_gen"/>
                              <lit-tag v="mf"/>
                            </equal>
                          </not>
                          <not>
                            <equal>
                              <clip pos="1" side="tl" part="a_gen"/>
                              <lit-tag v="GD"/>
                            </equal>
                          </not>
                        </and>
                      </test>
                      <let>
                        <var n="genere"/>
                        <clip pos="3" side="tl" part="a_gen"/>
                      </let>
                    </when>
                    <otherwise>
                     <choose>
                        <when>
                          <test>
                            <and>
                              <not>
                                <equal>
                                  <clip pos="4" side="tl" part="a_gen"/>
                                  <lit-tag v="mf"/>
                                </equal>
                              </not>
                              <not>
                                <equal>
                                  <clip pos="1" side="tl" part="a_gen"/>
                                  <lit-tag v="GD"/>
                                </equal>
                              </not>
                            </and>
                          </test>
                          <let>
                            <var n="genere"/>
                            <clip pos="4" side="tl" part="a_gen"/>
                          </let>
                        </when>
                        <otherwise>
                          <let>
                            <var n="genere"/>
                            <lit-tag v="m"/>
                          </let>
                        </otherwise>
                      </choose>
                    </otherwise>
                  </choose>
                </otherwise>
              </choose>
            </otherwise>
          </choose>
        </otherwise>
      </choose>
      <!-- Nombre -->
      <choose>
        <when>
          <test>
            <and>
            <not>
              <equal>
                <clip pos="1" side="tl" part="a_nbr"/>
                <lit-tag v="sp"/>
              </equal>
            </not>
            <not>
              <equal>
                <clip pos="1" side="tl" part="a_nbr"/>
                <lit-tag v="ND"/>
              </equal>
            </not>
            <not>
              <equal>
                <clip pos="1" side="tl" part="a_nbr"/>
                <lit v=""/>
              </equal>
            </not>
            </and>
          </test>
          <let>
            <var n="nombre"/>
            <clip pos="1" side="tl" part="a_nbr"/>
          </let>
        </when>
        <otherwise>
          <choose>
            <when>
              <test>
                <and>
                <not>
                  <equal>
                    <clip pos="1" side="sl" part="a_nbr"/>
                    <lit-tag v="sp"/>
                  </equal>
                </not>
                <not>
                  <equal>
                    <clip pos="1" side="sl" part="a_nbr"/>
                    <lit v=""/>
                  </equal>
                </not>
                </and>
              </test>
              <let>
                <var n="nombre"/>
                <clip pos="1" side="sl" part="a_nbr"/>
              </let>
            </when>
            <otherwise>
              <choose>
                <when>
                  <test>
                    <and>
                    <not>
                      <equal>
                        <clip pos="2" side="tl" part="a_nbr"/>
                        <lit-tag v="sp"/>
                      </equal>
                    </not>
                    <not>
                      <equal>
                        <clip pos="2" side="tl" part="a_nbr"/>
                        <lit-tag v="ND"/>
                      </equal>
                    </not>
                    <not>
                      <equal>
                        <clip pos="2" side="tl" part="a_nbr"/>
                        <lit v=""/>
                      </equal>
                    </not>
                    </and>
                  </test>
                  <let>
                    <var n="nombre"/>
                    <clip pos="2" side="tl" part="a_nbr"/>
                  </let>
                </when>
                <otherwise>
                  <choose>
                    <when>
                      <test>
                        <and>
                        <not>
                          <equal>
                            <clip pos="3" side="tl" part="a_nbr"/>
                            <lit-tag v="sp"/>
                          </equal>
                        </not>
                        <not>
                          <equal>
                            <clip pos="3" side="tl" part="a_nbr"/>
                            <lit-tag v="ND"/>
                          </equal>
                        </not>
                        <not>
                          <equal>
                            <clip pos="3" side="tl" part="a_nbr"/>
                            <lit v=""/>
                          </equal>
                        </not>
                        </and>
                      </test>
                      <let>
                        <var n="nombre"/>
                        <clip pos="3" side="tl" part="a_nbr"/>
                      </let>
                    </when>
                    <otherwise>
                     <choose>
                        <when>
                          <test>
                            <and>
                            <not>
                              <equal>
                                <clip pos="4" side="tl" part="a_nbr"/>
                                <lit-tag v="sp"/>
                              </equal>
                            </not>
                            <not>
                              <equal>
                                <clip pos="4" side="tl" part="a_nbr"/>
                                <lit-tag v="ND"/>
                              </equal>
                            </not>
                            <not>
                              <equal>
                                <clip pos="4" side="tl" part="a_nbr"/>
                                <lit v=""/>
                              </equal>
                            </not>
                            </and>
                          </test>
                          <let>
                            <var n="nombre"/>
                            <clip pos="4" side="tl" part="a_nbr"/>
                          </let>
                        </when>
                        <otherwise>
                          <let>
                            <var n="nombre"/>
                            <lit-tag v="sg"/>
                          </let>
                        </otherwise>
                      </choose>
                    </otherwise>
                  </choose>
                </otherwise>
              </choose>
            </otherwise>
          </choose>
        </otherwise>
      </choose>
      <!-- Si el gènere del chunk no és masculí o femení, cal adaptar-lo -->
      <choose>
        <when>
          <test>
            <or>
              <equal>
                <var n="genere"/>
                <lit-tag v="f"/>
              </equal>
              <equal>
                <var n="genere"/>
                <lit-tag v="fn"/>
              </equal>
            </or>
          </test>
          <let>
            <var n="genere"/>
            <lit-tag v="f"/>
          </let>
        </when>
        <otherwise>
          <let>
            <var n="genere"/>
            <lit-tag v="m"/>
          </let>
        </otherwise>
      </choose>
      <!-- Propaga els valors als elements -->
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="1" side="tl" part="a_gen_mf"/>
              <lit v=""/>
            </equal>
          </test>
          <let>
            <clip pos="1" side="tl" part="a_gen"/>
            <var n="genere"/>
          </let>
        </when>
      </choose>
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="1" side="tl" part="a_nbr_sp"/>
              <lit v=""/>
            </equal>
          </test>
          <let>
            <clip pos="1" side="tl" part="a_nbr"/>
            <var n="nombre"/>
          </let>
        </when>
      </choose>
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="2" side="tl" part="a_gen_mf"/>
              <lit v=""/>
            </equal>
          </test>
          <let>
            <clip pos="2" side="tl" part="a_gen"/>
            <var n="genere"/>
          </let>
        </when>
      </choose>
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="2" side="tl" part="a_nbr_sp"/>
              <lit v=""/>
            </equal>
          </test>
          <let>
            <clip pos="2" side="tl" part="a_nbr"/>
            <var n="nombre"/>
          </let>
        </when>
      </choose>
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="3" side="tl" part="a_gen_mf"/>
              <lit v=""/>
            </equal>
          </test>
          <let>
            <clip pos="3" side="tl" part="a_gen"/>
            <var n="genere"/>
          </let>
        </when>
      </choose>
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="3" side="tl" part="a_nbr_sp"/>
              <lit v=""/>
            </equal>
          </test>
          <let>
            <clip pos="3" side="tl" part="a_nbr"/>
            <var n="nombre"/>
          </let>
        </when>
      </choose>
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="4" side="tl" part="a_gen_mf"/>
              <lit v=""/>
            </equal>
          </test>
          <let>
            <clip pos="4" side="tl" part="a_gen"/>
            <var n="genere"/>
          </let>
        </when>
      </choose>
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="4" side="tl" part="a_nbr_sp"/>
              <lit v=""/>
            </equal>
          </test>
          <let>
            <clip pos="4" side="tl" part="a_nbr"/>
            <var n="nombre"/>
          </let>
        </when>
      </choose>
      <!-- Propaga els valors a la variable definitiva -->
      <choose>
        <when>
          <test>
            <equal>
              <var n="genere1"/>
              <lit v=""/>
            </equal>
          </test>
          <let>
            <var n="genere1"/>
            <var n="genere"/>
          </let>
        </when>
        <otherwise>
          <choose>
            <when>
              <test>
                <equal>
                  <var n="genere2"/>
                  <lit v=""/>
                </equal>
              </test>
              <let>
                <var n="genere2"/>
                <var n="genere"/>
              </let>
            </when>
            <otherwise>
              <let>
                <var n="genere3"/>
                <var n="genere"/>
              </let>
            </otherwise>
          </choose>
        </otherwise>
      </choose>
      <choose>
        <when>
          <test>
            <equal>
              <var n="nombre1"/>
              <lit v=""/>
            </equal>
          </test>
          <let>
            <var n="nombre1"/>
            <var n="nombre"/>
          </let>
        </when>
        <otherwise>
          <choose>
            <when>
              <test>
                <equal>
                  <var n="nombre2"/>
                  <lit v=""/>
                </equal>
              </test>
              <let>
                <var n="nombre2"/>
                <var n="nombre"/>
              </let>
            </when>
            <otherwise>
              <let>
                <var n="nombre3"/>
                <var n="nombre"/>
              </let>
            </otherwise>
          </choose>
        </otherwise>
      </choose>
    </def-macro>

    <def-macro n="f_concord5_i" npar="5" comment="Realitza la concordança de cinc elements interns i desa els valors a les variables internes">
      <!-- Gènere -->
      <choose>
        <when>
          <test>
            <and>
              <not>
                <equal>
                  <clip pos="1" side="tl" part="a_gen"/>
                  <lit-tag v="mf"/>
                </equal>
              </not>
              <not>
                <equal>
                  <clip pos="1" side="tl" part="a_gen"/>
                  <lit-tag v="GD"/>
                </equal>
              </not>
            </and>
          </test>
          <let>
            <var n="genere"/>
            <clip pos="1" side="tl" part="a_gen"/>
          </let>
        </when>
        <otherwise>
          <choose>
            <when>
              <test>
                <not>
                  <equal>
                    <clip pos="1" side="sl" part="a_gen"/>
                    <lit-tag v="mf"/>
                  </equal>
                </not>
              </test>
              <let>
                <var n="genere"/>
                <clip pos="1" side="sl" part="a_gen"/>
              </let>
            </when>
            <otherwise>
              <choose>
                <when>
                  <test>
                    <and>
                      <not>
                        <equal>
                          <clip pos="2" side="tl" part="a_gen"/>
                          <lit-tag v="mf"/>
                        </equal>
                      </not>
                      <not>
                        <equal>
                          <clip pos="1" side="tl" part="a_gen"/>
                          <lit-tag v="GD"/>
                        </equal>
                      </not>
                    </and>
                  </test>
                  <let>
                    <var n="genere"/>
                    <clip pos="2" side="tl" part="a_gen"/>
                  </let>
                </when>
                <otherwise>
                  <choose>
                    <when>
                      <test>
                        <and>
                          <not>
                            <equal>
                              <clip pos="3" side="tl" part="a_gen"/>
                              <lit-tag v="mf"/>
                            </equal>
                          </not>
                          <not>
                            <equal>
                              <clip pos="1" side="tl" part="a_gen"/>
                              <lit-tag v="GD"/>
                            </equal>
                          </not>
                        </and>
                      </test>
                      <let>
                        <var n="genere"/>
                        <clip pos="3" side="tl" part="a_gen"/>
                      </let>
                    </when>
                    <otherwise>
                     <choose>
                        <when>
                          <test>
                            <and>
                              <not>
                                <equal>
                                  <clip pos="4" side="tl" part="a_gen"/>
                                  <lit-tag v="mf"/>
                                </equal>
                              </not>
                              <not>
                                <equal>
                                  <clip pos="1" side="tl" part="a_gen"/>
                                  <lit-tag v="GD"/>
                                </equal>
                              </not>
                            </and>
                          </test>
                          <let>
                            <var n="genere"/>
                            <clip pos="4" side="tl" part="a_gen"/>
                          </let>
                        </when>
                        <otherwise>
                         <choose>
                            <when>
                              <test>
                                <and>
                                  <not>
                                    <equal>
                                      <clip pos="5" side="tl" part="a_gen"/>
                                      <lit-tag v="mf"/>
                                    </equal>
                                  </not>
                                  <not>
                                    <equal>
                                      <clip pos="1" side="tl" part="a_gen"/>
                                      <lit-tag v="GD"/>
                                    </equal>
                                  </not>
                                </and>
                              </test>
                              <let>
                                <var n="genere"/>
                                <clip pos="5" side="tl" part="a_gen"/>
                              </let>
                            </when>
                            <otherwise>
                              <let>
                                <var n="genere"/>
                                <lit-tag v="m"/>
                              </let>
                            </otherwise>
                          </choose>
                        </otherwise>
                      </choose>
                    </otherwise>
                  </choose>
                </otherwise>
              </choose>
            </otherwise>
          </choose>
        </otherwise>
      </choose>
      <!-- Nombre -->
      <choose>
        <when>
          <test>
            <and>
            <not>
              <equal>
                <clip pos="1" side="tl" part="a_nbr"/>
                <lit-tag v="sp"/>
              </equal>
            </not>
            <not>
              <equal>
                <clip pos="1" side="tl" part="a_nbr"/>
                <lit-tag v="ND"/>
              </equal>
            </not>
            <not>
              <equal>
                <clip pos="1" side="tl" part="a_nbr"/>
                <lit v=""/>
              </equal>
            </not>
            </and>
          </test>
          <let>
            <var n="nombre"/>
            <clip pos="1" side="tl" part="a_nbr"/>
          </let>
        </when>
        <otherwise>
          <choose>
            <when>
              <test>
                <and>
                <not>
                  <equal>
                    <clip pos="1" side="sl" part="a_nbr"/>
                    <lit-tag v="sp"/>
                  </equal>
                </not>
                <not>
                  <equal>
                    <clip pos="1" side="sl" part="a_nbr"/>
                    <lit v=""/>
                  </equal>
                </not>
                </and>
              </test>
              <let>
                <var n="nombre"/>
                <clip pos="1" side="sl" part="a_nbr"/>
              </let>
            </when>
            <otherwise>
              <choose>
                <when>
                  <test>
                    <and>
                    <not>
                      <equal>
                        <clip pos="2" side="tl" part="a_nbr"/>
                        <lit-tag v="sp"/>
                      </equal>
                    </not>
                    <not>
                      <equal>
                        <clip pos="2" side="tl" part="a_nbr"/>
                        <lit-tag v="ND"/>
                      </equal>
                    </not>
                    <not>
                      <equal>
                        <clip pos="2" side="tl" part="a_nbr"/>
                        <lit v=""/>
                      </equal>
                    </not>
                    </and>
                  </test>
                  <let>
                    <var n="nombre"/>
                    <clip pos="2" side="tl" part="a_nbr"/>
                  </let>
                </when>
                <otherwise>
                  <choose>
                    <when>
                      <test>
                        <and>
                        <not>
                          <equal>
                            <clip pos="3" side="tl" part="a_nbr"/>
                            <lit-tag v="sp"/>
                          </equal>
                        </not>
                        <not>
                          <equal>
                            <clip pos="3" side="tl" part="a_nbr"/>
                            <lit-tag v="ND"/>
                          </equal>
                        </not>
                        <not>
                          <equal>
                            <clip pos="3" side="tl" part="a_nbr"/>
                            <lit v=""/>
                          </equal>
                        </not>
                        </and>
                      </test>
                      <let>
                        <var n="nombre"/>
                        <clip pos="3" side="tl" part="a_nbr"/>
                      </let>
                    </when>
                    <otherwise>
                     <choose>
                        <when>
                          <test>
                            <and>
                            <not>
                              <equal>
                                <clip pos="4" side="tl" part="a_nbr"/>
                                <lit-tag v="sp"/>
                              </equal>
                            </not>
                            <not>
                              <equal>
                                <clip pos="4" side="tl" part="a_nbr"/>
                                <lit-tag v="ND"/>
                              </equal>
                            </not>
                            <not>
                              <equal>
                                <clip pos="4" side="tl" part="a_nbr"/>
                                <lit v=""/>
                              </equal>
                            </not>
                            </and>
                          </test>
                          <let>
                            <var n="nombre"/>
                            <clip pos="4" side="tl" part="a_nbr"/>
                          </let>
                        </when>
                        <otherwise>
                         <choose>
                            <when>
                              <test>
                                <and>
                                <not>
                                  <equal>
                                    <clip pos="5" side="tl" part="a_nbr"/>
                                    <lit-tag v="sp"/>
                                  </equal>
                                </not>
                                <not>
                                  <equal>
                                    <clip pos="5" side="tl" part="a_nbr"/>
                                    <lit-tag v="ND"/>
                                  </equal>
                                </not>
                                <not>
                                  <equal>
                                    <clip pos="5" side="tl" part="a_nbr"/>
                                    <lit v=""/>
                                  </equal>
                                </not>
                                </and>
                              </test>
                              <let>
                                <var n="nombre"/>
                                <clip pos="5" side="tl" part="a_nbr"/>
                              </let>
                            </when>
                            <otherwise>
                              <let>
                                <var n="nombre"/>
                                <lit-tag v="sg"/>
                              </let>
                            </otherwise>
                          </choose>
                        </otherwise>
                      </choose>
                    </otherwise>
                  </choose>
                </otherwise>
              </choose>
            </otherwise>
          </choose>
        </otherwise>
      </choose>
      <!-- Si el gènere del chunk no és masculí o femení, cal adaptar-lo -->
      <choose>
        <when>
          <test>
            <or>
              <equal>
                <var n="genere"/>
                <lit-tag v="f"/>
              </equal>
              <equal>
                <var n="genere"/>
                <lit-tag v="fn"/>
              </equal>
            </or>
          </test>
          <let>
            <var n="genere"/>
            <lit-tag v="f"/>
          </let>
        </when>
        <otherwise>
          <let>
            <var n="genere"/>
            <lit-tag v="m"/>
          </let>
        </otherwise>
      </choose>
      <!-- Propaga els valors als elements -->
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="1" side="tl" part="a_gen_mf"/>
              <lit v=""/>
            </equal>
          </test>
          <let>
            <clip pos="1" side="tl" part="a_gen"/>
            <var n="genere"/>
          </let>
        </when>
      </choose>
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="1" side="tl" part="a_nbr_sp"/>
              <lit v=""/>
            </equal>
          </test>
          <let>
            <clip pos="1" side="tl" part="a_nbr"/>
            <var n="nombre"/>
          </let>
        </when>
      </choose>
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="2" side="tl" part="a_gen_mf"/>
              <lit v=""/>
            </equal>
          </test>
          <let>
            <clip pos="2" side="tl" part="a_gen"/>
            <var n="genere"/>
          </let>
        </when>
      </choose>
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="2" side="tl" part="a_nbr_sp"/>
              <lit v=""/>
            </equal>
          </test>
          <let>
            <clip pos="2" side="tl" part="a_nbr"/>
            <var n="nombre"/>
          </let>
        </when>
      </choose>
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="3" side="tl" part="a_gen_mf"/>
              <lit v=""/>
            </equal>
          </test>
          <let>
            <clip pos="3" side="tl" part="a_gen"/>
            <var n="genere"/>
          </let>
        </when>
      </choose>
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="3" side="tl" part="a_nbr_sp"/>
              <lit v=""/>
            </equal>
          </test>
          <let>
            <clip pos="3" side="tl" part="a_nbr"/>
            <var n="nombre"/>
          </let>
        </when>
      </choose>
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="4" side="tl" part="a_gen_mf"/>
              <lit v=""/>
            </equal>
          </test>
          <let>
            <clip pos="4" side="tl" part="a_gen"/>
            <var n="genere"/>
          </let>
        </when>
      </choose>
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="4" side="tl" part="a_nbr_sp"/>
              <lit v=""/>
            </equal>
          </test>
          <let>
            <clip pos="4" side="tl" part="a_nbr"/>
            <var n="nombre"/>
          </let>
        </when>
      </choose>
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="5" side="tl" part="a_gen_mf"/>
              <lit v=""/>
            </equal>
          </test>
          <let>
            <clip pos="5" side="tl" part="a_gen"/>
            <var n="genere"/>
          </let>
        </when>
      </choose>
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="5" side="tl" part="a_nbr_sp"/>
              <lit v=""/>
            </equal>
          </test>
          <let>
            <clip pos="5" side="tl" part="a_nbr"/>
            <var n="nombre"/>
          </let>
        </when>
      </choose>
      <!-- Propaga els valors a la variable definitiva -->
      <choose>
        <when>
          <test>
            <equal>
              <var n="genere1"/>
              <lit v=""/>
            </equal>
          </test>
          <let>
            <var n="genere1"/>
            <var n="genere"/>
          </let>
        </when>
        <otherwise>
          <choose>
            <when>
              <test>
                <equal>
                  <var n="genere2"/>
                  <lit v=""/>
                </equal>
              </test>
              <let>
                <var n="genere2"/>
                <var n="genere"/>
              </let>
            </when>
            <otherwise>
              <let>
                <var n="genere3"/>
                <var n="genere"/>
              </let>
            </otherwise>
          </choose>
        </otherwise>
      </choose>
      <choose>
        <when>
          <test>
            <equal>
              <var n="nombre1"/>
              <lit v=""/>
            </equal>
          </test>
          <let>
            <var n="nombre1"/>
            <var n="nombre"/>
          </let>
        </when>
        <otherwise>
          <choose>
            <when>
              <test>
                <equal>
                  <var n="nombre2"/>
                  <lit v=""/>
                </equal>
              </test>
              <let>
                <var n="nombre2"/>
                <var n="nombre"/>
              </let>
            </when>
            <otherwise>
              <let>
                <var n="nombre3"/>
                <var n="nombre"/>
              </let>
            </otherwise>
          </choose>
        </otherwise>
      </choose>
    </def-macro>


    <def-macro n="n_gen_nbr" npar="0" comment="Neteja les variables de gènere i nombre">
      <let>
        <var n="genere1"/>
        <lit v=""/>
      </let>
      <let>
        <var n="nombre1"/>
        <lit v=""/>
      </let>
      <let>
        <var n="genere2"/>
        <lit v=""/>
      </let>
      <let>
        <var n="nombre2"/>
        <lit v=""/>
      </let>
      <let>
        <var n="genere3"/>
        <lit v=""/>
      </let>
      <let>
        <var n="nombre3"/>
        <lit v=""/>
      </let>
    </def-macro>


<!-- MACROS ANTIGUES -->

    <def-macro n="f_bcond" npar="2">
<!--Per mirar si el blanc conté o no format -->
      <choose>
        <when>
          <test>
            <not>
              <equal>
                <b pos="1"/>
                <lit v=" "/>
              </equal>
            </not>
          </test>
          <out><chunk name="x"><tags><tag><lit-tag v="SX"/></tag></tags>
            <b pos="1"/>
          </chunk></out>
        </when>
      </choose>
    </def-macro>
    <def-macro n="f_outverb2" npar="2">
<!--Comprueba si hay pronombres que se traducen por nada de catalán a espațol según el diccionario ("hi" y "en") y envía el verbo con o sin pronombres de acuerdo con esta comprobación. Esta función es para el caso de verbo + 1 enclítico. Función necesaria para el correcto colocamiento de la cola en multipalabras con flexión intercalada. -->
      <choose>
        <when>
          <test>
            <not>
              <equal>
                <clip pos="2" side="tl" part="lem"/>
                <lit v=""/>
              </equal>
            </not>
          </test>
          <out><chunk name="x"><tags><tag><lit-tag v="SX"/></tag></tags>
            <mlu>
              <lu>
                <clip pos="1" side="tl" part="lemh"/>
                <clip pos="1" side="tl" part="a_verb"/>
                <clip pos="1" side="tl" part="a_temps"/>
                <clip pos="1" side="tl" part="a_pers"/>
                <clip pos="1" side="tl" part="a_nbr"/>
              </lu>
              <lu>
                <clip pos="2" side="tl" part="lem"/>
                <clip pos="2" side="tl" part="a_prnenc"/>
                <clip pos="2" side="tl" part="a_pers"/>
                <clip pos="2" side="tl" part="gen"/>
                <clip pos="2" side="tl" part="a_nbr"/>
                <clip pos="1" side="tl" part="lemq"/>
              </lu>
            </mlu>
          </chunk></out>
        </when>
        <otherwise>
          <out><chunk name="x"><tags><tag><lit-tag v="SX"/></tag></tags>
            <lu>
              <clip pos="1" side="tl" part="lemh"/>
              <clip pos="1" side="tl" part="a_verb"/>
              <clip pos="1" side="tl" part="a_temps"/>
              <clip pos="1" side="tl" part="a_pers"/>
              <clip pos="1" side="tl" part="a_nbr"/>
              <clip pos="1" side="tl" part="lemq"/>
            </lu>
          </chunk></out>
        </otherwise>
      </choose>
    </def-macro>
    <def-macro n="f_outverb3" npar="3">
<!--Comprueba si hay pronombres que se traducen por nada de catalán a espaňol según el diccionario ("hi" y "en") y envía el verbo con o sin pronombres de acuerdo con esta comprobación. Esta función es para el caso de verbo + 2 enclíticos.-->
      <choose>
        <when>
          <test>
            <not>
              <equal>
                <clip pos="2" side="tl" part="lem"/>
                <lit v=""/>
              </equal>
            </not>
          </test>
          <choose>
            <when>
              <test>
                <not>
                  <equal>
                    <clip pos="3" side="tl" part="lem"/>
                    <lit v=""/>
                  </equal>
                </not>
              </test>
              <out><chunk name="x"><tags><tag><lit-tag v="SX"/></tag></tags>
                <mlu>
                  <lu>
                    <clip pos="1" side="tl" part="lemh"/>
                    <clip pos="1" side="tl" part="a_verb"/>
                    <clip pos="1" side="tl" part="a_temps"/>
                    <clip pos="1" side="tl" part="a_pers"/>
                    <clip pos="1" side="tl" part="a_nbr"/>
                  </lu>
                  <lu>
                    <clip pos="2" side="tl" part="lem"/>
                    <clip pos="2" side="tl" part="a_prnenc"/>
                    <clip pos="2" side="tl" part="a_pers"/>
                    <clip pos="2" side="tl" part="gen"/>
                    <clip pos="2" side="tl" part="a_nbr"/>
                  </lu>
                  <lu>
                    <clip pos="3" side="tl" part="lem"/>
                    <clip pos="3" side="tl" part="a_prnenc"/>
                    <clip pos="3" side="tl" part="a_pers"/>
                    <clip pos="3" side="tl" part="gen"/>
                    <clip pos="3" side="tl" part="a_nbr"/>
                    <clip pos="1" side="tl" part="lemq"/>
                  </lu>
                </mlu>
              </chunk></out>
            </when>
            <otherwise>
              <out><chunk name="x"><tags><tag><lit-tag v="SX"/></tag></tags>
                <mlu>
                  <lu>
                    <clip pos="1" side="tl" part="lemh"/>
                    <clip pos="1" side="tl" part="a_verb"/>
                    <clip pos="1" side="tl" part="a_temps"/>
                    <clip pos="1" side="tl" part="a_pers"/>
                    <clip pos="1" side="tl" part="a_nbr"/>
                  </lu>
                  <lu>
                    <clip pos="2" side="tl" part="lem"/>
                    <clip pos="2" side="tl" part="a_prnenc"/>
                    <clip pos="2" side="tl" part="a_pers"/>
                    <clip pos="2" side="tl" part="gen"/>
                    <clip pos="2" side="tl" part="a_nbr"/>
                    <clip pos="1" side="tl" part="lemq"/>
                  </lu>
                </mlu>
              </chunk></out>
            </otherwise>
          </choose>
        </when>
        <otherwise>
          <out><chunk name="x"><tags><tag><lit-tag v="SX"/></tag></tags>
            <lu>
              <clip pos="1" side="tl" part="lemh"/>
              <clip pos="1" side="tl" part="a_verb"/>
              <clip pos="1" side="tl" part="a_temps"/>
              <clip pos="1" side="tl" part="a_pers"/>
              <clip pos="1" side="tl" part="a_nbr"/>
              <clip pos="1" side="tl" part="lemq"/>
            </lu>
          </chunk></out>
        </otherwise>
      </choose>
    </def-macro>
    <def-macro n="prn_verb" npar="1">
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="1" side="tl" part="a_pers"/>
              <lit-tag v="p1"/>
            </equal>
          </test>
          <choose>
            <when>
              <test>
                <equal>
                  <clip pos="1" side="tl" part="a_nbr"/>
                  <lit-tag v="sg"/>
                </equal>
              </test>
              <out><chunk name="x"><tags><tag><lit-tag v="SX"/></tag></tags>
                <lu>
                  <get-case-from pos="1">
                    <lit v="em"/>
                  </get-case-from>
                  <lit-tag v="prn.pro.p1.mf.sg"/>
                </lu>
              </chunk></out>
            </when>
            <otherwise>
              <out><chunk name="x"><tags><tag><lit-tag v="SX"/></tag></tags>
                <lu>
                  <get-case-from pos="1">
                    <lit v="ens"/>
                  </get-case-from>
                  <lit-tag v="prn.pro.p1.mf.pl"/>
                </lu>
              </chunk></out>
            </otherwise>
          </choose>
        </when>
        <otherwise>
          <choose>
            <when>
              <test>
                <equal>
                  <clip pos="1" side="tl" part="a_pers"/>
                  <lit-tag v="p2"/>
                </equal>
              </test>
              <choose>
                <when>
                  <test>
                    <equal>
                      <clip pos="1" side="tl" part="a_nbr"/>
                      <lit-tag v="sg"/>
                    </equal>
                  </test>
                  <out><chunk name="x"><tags><tag><lit-tag v="SX"/></tag></tags>
                    <lu>
                      <get-case-from pos="1">
                        <lit v="et"/>
                      </get-case-from>
                      <lit-tag v="prn.pro.p2.mf.sg"/>
                    </lu>
                  </chunk></out>
                </when>
                <otherwise>
                  <out><chunk name="x"><tags><tag><lit-tag v="SX"/></tag></tags>
                    <lu>
                      <get-case-from pos="1">
                        <lit v="us"/>
                      </get-case-from>
                      <lit-tag v="prn.pro.p2.mf.pl"/>
                    </lu>
                  </chunk></out>
                </otherwise>
              </choose>
            </when>
            <otherwise>
              <out><chunk name="x"><tags><tag><lit-tag v="SX"/></tag></tags>
                <lu>
                  <get-case-from pos="1">
                    <lit v="es"/>
                  </get-case-from>
                  <lit-tag v="prn.pro.ref.p3.mf.sp"/>
                </lu>
              </chunk></out>
            </otherwise>
          </choose>
        </otherwise>
      </choose>
    </def-macro>
    <def-macro n="prn_verbp" npar="1">
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="1" side="tl" part="a_pers"/>
              <lit-tag v="p1"/>
            </equal>
          </test>
          <choose>
            <when>
              <test>
                <equal>
                  <clip pos="1" side="tl" part="a_nbr"/>
                  <lit-tag v="sg"/>
                </equal>
              </test>
              <out><chunk name="x"><tags><tag><lit-tag v="SX"/></tag></tags>
                <lu>
                  <get-case-from pos="1">
                    <lit v="em"/>
                  </get-case-from>
                  <lit-tag v="prn.enc.p1.mf.sg"/>
                </lu>
              </chunk></out>
            </when>
            <otherwise>
              <out><chunk name="x"><tags><tag><lit-tag v="SX"/></tag></tags>
                <lu>
                  <get-case-from pos="1">
                    <lit v="ens"/>
                  </get-case-from>
                  <lit-tag v="prn.enc.p1.mf.pl"/>
                </lu>
              </chunk></out>
            </otherwise>
          </choose>
        </when>
        <otherwise>
          <choose>
            <when>
              <test>
                <equal>
                  <clip pos="1" side="tl" part="a_pers"/>
                  <lit-tag v="p2"/>
                </equal>
              </test>
              <choose>
                <when>
                  <test>
                    <equal>
                      <clip pos="1" side="tl" part="a_nbr"/>
                      <lit-tag v="sg"/>
                    </equal>
                  </test>
                  <out><chunk name="x"><tags><tag><lit-tag v="SX"/></tag></tags>
                    <lu>
                      <get-case-from pos="1">
                        <lit v="et"/>
                      </get-case-from>
                      <lit-tag v="prn.enc.p2.mf.sg"/>
                    </lu>
                  </chunk></out>
                </when>
                <otherwise>
                  <out><chunk name="x"><tags><tag><lit-tag v="SX"/></tag></tags>
                    <lu>
                      <get-case-from pos="1">
                        <lit v="us"/>
                      </get-case-from>
                      <lit-tag v="prn.enc.p2.mf.pl"/>
                    </lu>
                  </chunk></out>
                </otherwise>
              </choose>
            </when>
            <otherwise>
              <out><chunk name="x"><tags><tag><lit-tag v="SX"/></tag></tags>
                <lu>
                  <get-case-from pos="1">
                    <lit v="es"/>
                  </get-case-from>
                  <lit-tag v="prn.enc.ref.p3.mf.sp"/>
                </lu>
              </chunk></out>
            </otherwise>
          </choose>
        </otherwise>
      </choose>
    </def-macro>
    <def-macro n="prn_verbenc" npar="2">
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="1" side="tl" part="a_temps"/>
              <lit-tag v="pper"/>
            </equal>
          </test>
          <call-macro n="prn_verb">
            <with-param pos="1"/>
          </call-macro>
          <out><chunk name="x"><tags><tag><lit-tag v="SX"/></tag></tags>
            <b pos="1"/>
            <lu>
              <get-case-from pos="1">
                <lit v="haver"/>
              </get-case-from>
              <lit-tag v="vbhaver.ifi"/>
              <lit-tag v="p3"/>
              <clip pos="2" side="tl" part="a_nbr"/>
            </lu>
            <b/>
            <lu>
              <get-case-from pos="2">
                <clip pos="1" side="tl" part="lemh"/>
              </get-case-from>
              <clip pos="1" side="tl" part="a_verb"/>
              <lit-tag v="pp.m.sg"/>
            </lu>
          </chunk></out>
        </when>
        <otherwise>
          <choose>
            <when>
              <test>
                <or>
                  <equal>
                    <clip pos="1" side="tl" part="a_temps"/>
                    <lit-tag v="inf"/>
                  </equal>
                  <equal>
                    <clip pos="1" side="tl" part="a_temps"/>
                    <lit-tag v="ger"/>
                  </equal>
                </or>
              </test>
              <out><chunk name="x"><tags><tag><lit-tag v="SX"/></tag></tags>
                <lu>
                  <clip pos="1" side="tl" part="whole"/>
                </lu>
              </chunk></out>
            </when>
            <otherwise>
              <choose>
                <when>
                  <test>
                    <not>
                      <equal>
                        <clip pos="2" side="tl" part="a_nbr"/>
                        <lit-tag v="pl"/>
                      </equal>
                    </not>
                  </test>
                  <let>
                    <clip pos="2" side="tl" part="a_nbr"/>
                    <lit-tag v="sg"/>
                  </let>
                </when>
              </choose>
              <choose>
                <when>
                  <test>
                    <equal>
                      <clip pos="1" side="tl" part="a_pers"/>
                      <lit-tag v="p1"/>
                    </equal>
                  </test>
                  <choose>
                    <when>
                      <test>
                        <equal>
                          <clip pos="1" side="tl" part="a_nbr"/>
                          <lit-tag v="sg"/>
                        </equal>
                      </test>
                      <out><chunk name="x"><tags><tag><lit-tag v="SX"/></tag></tags>
                        <mlu>
                          <lu>
                            <clip pos="1" side="tl" part="lemh"/>
                            <clip pos="1" side="tl" part="a_verb"/>
                            <clip pos="1" side="tl" part="a_temps"/>
                            <lit-tag v="p3"/>
                            <clip pos="2" side="tl" part="a_nbr"/>
                          </lu>
                          <lu>
                            <lit v="em"/>
                            <lit-tag v="prn.enc.p1.mf.sg"/>
                          </lu>
                        </mlu>
                      </chunk></out>
                    </when>
                    <otherwise>
                      <out><chunk name="x"><tags><tag><lit-tag v="SX"/></tag></tags>
                        <mlu>
                          <lu>
                            <clip pos="1" side="tl" part="lemh"/>
                            <clip pos="1" side="tl" part="a_verb"/>
                            <clip pos="1" side="tl" part="a_temps"/>
                            <lit-tag v="p3"/>
                            <clip pos="2" side="tl" part="a_nbr"/>
                          </lu>
                          <lu>
                            <lit v="ens"/>
                            <lit-tag v="prn.enc.p1.mf.pl"/>
                          </lu>
                        </mlu>
                      </chunk></out>
                    </otherwise>
                  </choose>
                </when>
                <otherwise>
                  <choose>
                    <when>
                      <test>
                        <equal>
                          <clip pos="1" side="tl" part="a_pers"/>
                          <lit-tag v="p2"/>
                        </equal>
                      </test>
                      <choose>
                        <when>
                          <test>
                            <equal>
                              <clip pos="1" side="tl" part="a_nbr"/>
                              <lit-tag v="sg"/>
                            </equal>
                          </test>
                          <out><chunk name="x"><tags><tag><lit-tag v="SX"/></tag></tags>
                            <mlu>
                              <lu>
                                <clip pos="1" side="tl" part="lemh"/>
                                <clip pos="1" side="tl" part="a_verb"/>
                                <clip pos="1" side="tl" part="a_temps"/>
                                <lit-tag v="p3"/>
                                <clip pos="2" side="tl" part="a_nbr"/>
                              </lu>
                              <lu>
                                <lit v="et"/>
                                <lit-tag v="prn.enc.p2.mf.sg"/>
                              </lu>
                            </mlu>
                          </chunk></out>
                        </when>
                        <otherwise>
                          <out><chunk name="x"><tags><tag><lit-tag v="SX"/></tag></tags>
                            <mlu>
                              <lu>
                                <clip pos="1" side="tl" part="lemh"/>
                                <clip pos="1" side="tl" part="a_verb"/>
                                <clip pos="1" side="tl" part="a_temps"/>
                                <lit-tag v="p3"/>
                                <clip pos="2" side="tl" part="a_nbr"/>
                              </lu>
                              <lu>
                                <lit v="us"/>
                                <lit-tag v="prn.enc.p2.mf.pl"/>
                              </lu>
                            </mlu>
                          </chunk></out>
                        </otherwise>
                      </choose>
                    </when>
                    <otherwise>
                      <out><chunk name="x"><tags><tag><lit-tag v="SX"/></tag></tags>
                        <mlu>
                          <lu>
                            <clip pos="1" side="tl" part="lemh"/>
                            <clip pos="1" side="tl" part="a_verb"/>
                            <clip pos="1" side="tl" part="a_temps"/>
                            <lit-tag v="p3"/>
                            <clip pos="2" side="tl" part="a_nbr"/>
                          </lu>
                          <lu>
                            <lit v="le"/>
                            <lit-tag v="prn.enc.p3.mf"/>
                            <clip pos="1" side="tl" part="a_nbr"/>
                          </lu>
                        </mlu>
                      </chunk></out>
                    </otherwise>
                  </choose>
                </otherwise>
              </choose>
            </otherwise>
          </choose>
        </otherwise>
      </choose>
    </def-macro>
    <def-macro n="f_modgen" npar="1"><!--modifica el gènere de la llengua origen quan no existeix equivalent en la llengua meta-->
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="1" side="sl" part="gen"/>
              <lit-tag v="mfn"/>
            </equal>
          </test>
          <let>
            <clip pos="1" side="sl" part="gen"/>
            <lit-tag v="mf"/>
          </let>
          <let>
            <var n="genere"/>
            <lit-tag v="mf"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="1" side="sl" part="gen"/>
              <lit-tag v="fn"/>
            </equal>
          </test>
          <let>
            <clip pos="1" side="sl" part="gen"/>
            <lit-tag v="f"/>
          </let>
          <let>
            <var n="genere"/>
            <lit-tag v="f"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="1" side="sl" part="gen"/>
              <lit-tag v="mn"/>
            </equal>
          </test>
          <let>
            <clip pos="1" side="sl" part="gen"/>
            <lit-tag v="m"/>
          </let>
          <let>
            <var n="genere"/>
            <lit-tag v="m"/>
          </let>
        </when>
      </choose>
      <choose>
        <when>
          <test>
            <equal>
              <clip pos="1" side="tl" part="gen"/>
              <lit-tag v="mfn"/>
            </equal>
          </test>
          <let>
            <clip pos="1" side="tl" part="gen"/>
            <lit-tag v="mf"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="1" side="tl" part="gen"/>
              <lit-tag v="fn"/>
            </equal>
          </test>
          <let>
            <clip pos="1" side="tl" part="gen"/>
            <lit-tag v="f"/>
          </let>
        </when>
        <when>
          <test>
            <equal>
              <clip pos="1" side="tl" part="gen"/>
              <lit-tag v="mn"/>
            </equal>
          </test>
          <let>
            <clip pos="1" side="tl" part="gen"/>
            <lit-tag v="m"/>
          </let>
        </when>
      </choose>
    </def-macro>
    <def-macro n="f_lexicAdj" npar="1">
      <choose>
        <when>
          <test>
            <and>
              <equal caseless="yes">
                <clip pos="1" side="tl" part="lem"/>
                <lit v="bueno"/>
              </equal>
              <equal>
                <clip pos="1" side="tl" part="gen"/>
                <lit-tag v="m"/>
              </equal>
              <equal>
                <clip pos="1" side="tl" part="a_nbr"/>
                <lit-tag v="sg"/>
              </equal>
            </and>
          </test>
          <let>
            <clip pos="1" side="tl" part="lem"/>
            <get-case-from pos="1">
              <lit v="buen"/>
            </get-case-from>
          </let>
        </when>
        <when>
          <test>
            <and>
              <equal caseless="yes">
                <clip pos="1" side="tl" part="lem"/>
                <lit v="grande"/>
              </equal>
              <equal>
                <clip pos="1" side="tl" part="gen"/>
                <lit-tag v="mf"/>
              </equal>
              <equal>
                <clip pos="1" side="tl" part="a_nbr"/>
                <lit-tag v="sg"/>
              </equal>
            </and>
          </test>
          <let>
            <clip pos="1" side="tl" part="lem"/>
            <get-case-from pos="1">
              <lit v="gran"/>
            </get-case-from>
          </let>
        </when>
        <when>
          <test>
            <and>
              <equal caseless="yes">
                <clip pos="1" side="tl" part="lem"/>
                <lit v="primero"/>
              </equal>
              <equal>
                <clip pos="1" side="tl" part="gen"/>
                <lit-tag v="m"/>
              </equal>
              <equal>
                <clip pos="1" side="tl" part="a_nbr"/>
                <lit-tag v="sg"/>
              </equal>
            </and>
          </test>
          <let>
            <clip pos="1" side="tl" part="lem"/>
            <get-case-from pos="1">
              <lit v="primer"/>
            </get-case-from>
          </let>
        </when>
        <when>
          <test>
            <and>
              <equal caseless="yes">
                <clip pos="1" side="tl" part="lem"/>
                <lit v="tercero"/>
              </equal>
              <equal>
                <clip pos="1" side="tl" part="gen"/>
                <lit-tag v="m"/>
              </equal>
              <equal>
                <clip pos="1" side="tl" part="a_nbr"/>
                <lit-tag v="sg"/>
              </equal>
            </and>
          </test>
          <let>
            <clip pos="1" side="tl" part="lem"/>
            <get-case-from pos="1">
              <lit v="tercer"/>
            </get-case-from>
          </let>
        </when>
      </choose>
    </def-macro>

  </section-def-macros>

  <section-rules>

<!-- Regles de SN -->

    <rule comment="NOM: casă → casa">
      <pattern>
        <pattern-item n="nom"/>
      </pattern>
      <action>
        <call-macro n="f_concord1">
          <with-param pos="1"/>
        </call-macro>
        <!-- Nominatiu definit -->
        <choose>
          <when>
            <test>
              <and>
                <equal>
                  <clip pos="1" side="sl" part="a_def"/>
                  <lit-tag v="def"/>
                </equal>
                <equal>
                  <clip pos="1" side="sl" part="a_cas"/>
                  <lit-tag v="nom"/>
                </equal>
              </and>
            </test>
              <call-macro n="mod_maj">
                <with-param pos="1"/>
              </call-macro>
              <out>
                <chunk name="det_nom">
                <tags>
                  <tag><lit-tag v="SN"/></tag>
                  <tag><var n="genere_chunk"/></tag>
                  <tag><var n="nombre_chunk"/></tag>
                  <tag><clip pos="1" side="sl" part="a_cas"/></tag>
                 <tag><clip pos="1" side="sl" part="a_def"/></tag>
                </tags>
                <lu>
                <get-case-from pos="1">
                  <lit v="el"/>
                </get-case-from>
                  <lit-tag v="det.def"/>
                  <lit-tag v="2"/>
                  <lit-tag v="3"/>
                </lu>
                <b/>
                <lu>
                  <clip pos="1" side="tl" part="lemh"/>
                  <clip pos="1" side="tl" part="a_nom"/>
                  <clip pos="1" side="tl" part="a_gen_sense_mf" link-to="2"/>
                  <clip pos="1" side="tl" part="a_gen_mf"/>
                  <clip pos="1" side="tl" part="a_nbr_sense_sp" link-to="3"/>
                  <clip pos="1" side="tl" part="a_nbr_sp"/>
                  <clip pos="1" side="tl" part="lemq"/>
                </lu>
              </chunk>
            </out>
          </when>
        <!-- Datiu indefinit -->
          <when>
            <test>
              <and>
                <equal>
                  <clip pos="1" side="sl" part="a_def"/>
                  <lit-tag v="ind"/>
                </equal>
                <equal>
                  <clip pos="1" side="sl" part="a_cas"/>
                  <lit-tag v="dg"/>
                </equal>
              </and>
            </test>
              <call-macro n="mod_maj">
                <with-param pos="1"/>
              </call-macro>
              <out>
                <chunk name="prep_nom">
                <tags>
                  <tag><lit-tag v="SP"/></tag>
                  <tag><var n="genere_chunk"/></tag>
                  <tag><var n="nombre_chunk"/></tag>
                  <tag><clip pos="1" side="sl" part="a_cas"/></tag>
                 <tag><clip pos="1" side="sl" part="a_def"/></tag>
                </tags>
                <lu>
                <get-case-from pos="1">
                  <lit v="a"/>
                </get-case-from>
                  <lit-tag v="pr"/>
                </lu>
                <b/>
                <lu>
                  <clip pos="1" side="tl" part="lemh"/>
                  <clip pos="1" side="tl" part="a_nom"/>
                  <clip pos="1" side="tl" part="a_gen_sense_mf" link-to="2"/>
                  <clip pos="1" side="tl" part="a_gen_mf"/>
                  <clip pos="1" side="tl" part="a_nbr_sense_sp" link-to="3"/>
                  <clip pos="1" side="tl" part="a_nbr_sp"/>
                  <clip pos="1" side="tl" part="lemq"/>
                </lu>
              </chunk>
            </out>
          </when>
        <!-- Datiu definit -->
          <when>
            <test>
              <and>
                <equal>
                  <clip pos="1" side="sl" part="a_def"/>
                  <lit-tag v="def"/>
                </equal>
                <equal>
                  <clip pos="1" side="sl" part="a_cas"/>
                  <lit-tag v="dg"/>
                </equal>
              </and>
            </test>
              <call-macro n="mod_maj">
                <with-param pos="1"/>
              </call-macro>
              <out>
                <chunk name="prep_det_nom">
                <tags>
                  <tag><lit-tag v="SP"/></tag>
                  <tag><var n="genere_chunk"/></tag>
                  <tag><var n="nombre_chunk"/></tag>
                  <tag><clip pos="1" side="sl" part="a_cas"/></tag>
                 <tag><clip pos="1" side="sl" part="a_def"/></tag>
                </tags>
                <lu>
                <get-case-from pos="1">
                  <lit v="a"/>
                </get-case-from>
                  <lit-tag v="pr"/>
                </lu>
                <b/>
                <lu>
                  <lit v="el"/>
                  <lit-tag v="det.def"/>
                  <lit-tag v="2"/>
                  <lit-tag v="3"/>
                </lu>
                <b/>
                <lu>
                  <clip pos="1" side="tl" part="lemh"/>
                  <clip pos="1" side="tl" part="a_nom"/>
                  <clip pos="1" side="tl" part="a_gen_sense_mf" link-to="2"/>
                  <clip pos="1" side="tl" part="a_gen_mf"/>
                  <clip pos="1" side="tl" part="a_nbr_sense_sp" link-to="3"/>
                  <clip pos="1" side="tl" part="a_nbr_sp"/>
                  <clip pos="1" side="tl" part="lemq"/>
                </lu>
              </chunk>
            </out>
          </when>
        <!-- Nominatiu indefinit -->
          <otherwise>
              <out>
                <chunk name="nom">
                <tags>
                  <tag><lit-tag v="SN"/></tag>
                  <tag><var n="genere_chunk"/></tag>
                  <tag><var n="nombre_chunk"/></tag>
                  <tag><clip pos="1" side="sl" part="a_cas"/></tag>
                 <tag><clip pos="1" side="sl" part="a_def"/></tag>
                </tags>
                <lu>
                  <clip pos="1" side="tl" part="lemh"/>
                  <clip pos="1" side="tl" part="a_nom"/>
                  <clip pos="1" side="tl" part="a_gen_sense_mf" link-to="2"/>
                  <clip pos="1" side="tl" part="a_gen_mf"/>
                  <clip pos="1" side="tl" part="a_nbr_sense_sp" link-to="3"/>
                  <clip pos="1" side="tl" part="a_nbr_sp"/>
                  <clip pos="1" side="tl" part="lemq"/>
                </lu>
              </chunk>
            </out>
          </otherwise>
        </choose>
        <call-macro n="n_gen_nbr"/>
      </action>
    </rule>

    <rule comment="NUM + NOM: 3 case → 3 cases">
      <pattern>
        <pattern-item n="num"/>
        <pattern-item n="nom"/>
      </pattern>
      <action>
        <call-macro n="f_concord2">
          <with-param pos="2"/>
          <with-param pos="1"/>
        </call-macro>
          <out>
            <chunk name="num_nom">
            <tags>
              <tag><lit-tag v="SN"/></tag>
              <tag><var n="genere_chunk"/></tag>
              <tag><var n="nombre_chunk"/></tag>
              <tag><lit-tag v="nom"/></tag>
              <tag><lit-tag v="ind"/></tag>
            </tags>
            <lu>
              <clip pos="1" side="tl" part="lemh"/>
              <clip pos="1" side="tl" part="a_num"/>
              <clip pos="1" side="tl" part="a_gen_sense_mf" link-to="2"/>
              <clip pos="1" side="tl" part="a_gen_mf"/>
              <clip pos="1" side="tl" part="a_nbr_sense_sp" link-to="3"/>
              <clip pos="1" side="tl" part="a_nbr_sp"/>
              <clip pos="1" side="tl" part="lemq"/>
            </lu>
            <b pos="1"/>
            <lu>
              <clip pos="2" side="tl" part="lemh"/>
              <clip pos="2" side="tl" part="a_nom"/>
              <clip pos="2" side="tl" part="a_gen_sense_mf" link-to="2"/>
              <clip pos="2" side="tl" part="a_gen_mf"/>
              <clip pos="2" side="tl" part="a_nbr_sense_sp" link-to="3"/>
              <clip pos="2" side="tl" part="a_nbr_sp"/>
              <clip pos="2" side="tl" part="lemq"/>
            </lu>
          </chunk>
        </out>
        <call-macro n="n_gen_nbr"/>
      </action>
    </rule>

    <rule comment="NUM + de + NOM: 20 de case → 20 cases">
      <pattern>
        <pattern-item n="num"/>
        <pattern-item n="prepde"/>
        <pattern-item n="nom"/>
      </pattern>
      <action>
        <call-macro n="f_concord2">
          <with-param pos="3"/>
          <with-param pos="1"/>
        </call-macro>
          <out>
            <chunk name="num_nom">
            <tags>
              <tag><lit-tag v="SN"/></tag>
              <tag><var n="genere_chunk"/></tag>
              <tag><var n="nombre_chunk"/></tag>
              <tag><lit-tag v="nom"/></tag>
              <tag><lit-tag v="ind"/></tag>
            </tags>
            <lu>
              <clip pos="1" side="tl" part="lemh"/>
              <clip pos="1" side="tl" part="a_num"/>
              <clip pos="1" side="tl" part="a_gen_sense_mf" link-to="2"/>
              <clip pos="1" side="tl" part="a_gen_mf"/>
              <clip pos="1" side="tl" part="a_nbr_sense_sp" link-to="3"/>
              <clip pos="1" side="tl" part="a_nbr_sp"/>
              <clip pos="1" side="tl" part="lemq"/>
            </lu>
            <b pos="1"/>
            <lu>
              <clip pos="3" side="tl" part="lemh"/>
              <clip pos="3" side="tl" part="a_nom"/>
              <clip pos="3" side="tl" part="a_gen_sense_mf" link-to="2"/>
              <clip pos="3" side="tl" part="a_gen_mf"/>
              <clip pos="3" side="tl" part="a_nbr_sense_sp" link-to="3"/>
              <clip pos="3" side="tl" part="a_nbr_sp"/>
              <clip pos="3" side="tl" part="lemq"/>
            </lu>
          </chunk>
        </out>
        <call-macro n="n_gen_nbr"/>
      </action>
    </rule>

    <rule comment="NOM + ADJECTIU">
      <pattern>
        <pattern-item n="nom"/>
        <pattern-item n="adjnorm"/>
      </pattern>
      <action>
        <call-macro n="f_concord2">
          <with-param pos="1"/>
          <with-param pos="2"/>
        </call-macro>
        <!-- Nominatiu definit -->
        <choose>
          <when>
            <test>
              <and>
                <equal>
                  <clip pos="1" side="sl" part="a_def"/>
                  <lit-tag v="def"/>
                </equal>
                <equal>
                  <clip pos="1" side="sl" part="a_cas"/>
                  <lit-tag v="nom"/>
                </equal>
              </and>
            </test>
              <call-macro n="mod_maj">
                <with-param pos="1"/>
              </call-macro>
              <out>
                <chunk name="det_nom_adj">
                <tags>
                  <tag><lit-tag v="SN"/></tag>
                  <tag><var n="genere_chunk"/></tag>
                  <tag><var n="nombre_chunk"/></tag>
                  <tag><clip pos="1" side="sl" part="a_cas"/></tag>
                 <tag><clip pos="1" side="sl" part="a_def"/></tag>
                </tags>
                <lu>
                <get-case-from pos="1">
                  <lit v="el"/>
                </get-case-from>
                  <lit-tag v="det.def"/>
                  <lit-tag v="2"/>
                  <lit-tag v="3"/>
                </lu>
                <b/>
                <lu>
                  <clip pos="1" side="tl" part="lemh"/>
                  <clip pos="1" side="tl" part="a_nom"/>
                  <clip pos="1" side="tl" part="a_gen_sense_mf" link-to="2"/>
                  <clip pos="1" side="tl" part="a_gen_mf"/>
                  <clip pos="1" side="tl" part="a_nbr_sense_sp" link-to="3"/>
                  <clip pos="1" side="tl" part="a_nbr_sp"/>
                  <clip pos="1" side="tl" part="lemq"/>
                </lu>
                <b pos="1"/>
                <lu>
                  <clip pos="2" side="tl" part="lemh"/>
                  <clip pos="2" side="tl" part="a_adj"/>
                  <clip pos="2" side="tl" part="a_gen_sense_mf" link-to="2"/>
                  <clip pos="2" side="tl" part="a_gen_mf"/>
                  <clip pos="2" side="tl" part="a_nbr_sense_sp" link-to="3"/>
                  <clip pos="2" side="tl" part="a_nbr_sp"/>
                  <clip pos="2" side="tl" part="lemq"/>
                </lu>
              </chunk>
            </out>
          </when>
        <!-- Datiu indefinit -->
          <when>
            <test>
              <and>
                <equal>
                  <clip pos="1" side="sl" part="a_def"/>
                  <lit-tag v="ind"/>
                </equal>
                <equal>
                  <clip pos="1" side="sl" part="a_cas"/>
                  <lit-tag v="dg"/>
                </equal>
              </and>
            </test>
              <call-macro n="mod_maj">
                <with-param pos="1"/>
              </call-macro>
              <out>
                <chunk name="prep_nom_adj">
                <tags>
                  <tag><lit-tag v="SP"/></tag>
                  <tag><var n="genere_chunk"/></tag>
                  <tag><var n="nombre_chunk"/></tag>
                  <tag><clip pos="1" side="sl" part="a_cas"/></tag>
                 <tag><clip pos="1" side="sl" part="a_def"/></tag>
                </tags>
                <lu>
                <get-case-from pos="1">
                  <lit v="a"/>
                </get-case-from>
                  <lit-tag v="pr"/>
                </lu>
                <b/>
                <lu>
                  <clip pos="1" side="tl" part="lemh"/>
                  <clip pos="1" side="tl" part="a_nom"/>
                  <clip pos="1" side="tl" part="a_gen_sense_mf" link-to="2"/>
                  <clip pos="1" side="tl" part="a_gen_mf"/>
                  <clip pos="1" side="tl" part="a_nbr_sense_sp" link-to="3"/>
                  <clip pos="1" side="tl" part="a_nbr_sp"/>
                  <clip pos="1" side="tl" part="lemq"/>
                </lu>
                <b pos="1"/>
                <lu>
                  <clip pos="2" side="tl" part="lemh"/>
                  <clip pos="2" side="tl" part="a_adj"/>
                  <clip pos="2" side="tl" part="a_gen_sense_mf" link-to="2"/>
                  <clip pos="2" side="tl" part="a_gen_mf"/>
                  <clip pos="2" side="tl" part="a_nbr_sense_sp" link-to="3"/>
                  <clip pos="2" side="tl" part="a_nbr_sp"/>
                  <clip pos="2" side="tl" part="lemq"/>
                </lu>
              </chunk>
            </out>
          </when>
        <!-- Datiu definit -->
          <when>
            <test>
              <and>
                <equal>
                  <clip pos="1" side="sl" part="a_def"/>
                  <lit-tag v="def"/>
                </equal>
                <equal>
                  <clip pos="1" side="sl" part="a_cas"/>
                  <lit-tag v="dg"/>
                </equal>
              </and>
            </test>
              <call-macro n="mod_maj">
                <with-param pos="1"/>
              </call-macro>
              <out>
                <chunk name="prep_det_nom_adj">
                <tags>
                  <tag><lit-tag v="SP"/></tag>
                  <tag><var n="genere_chunk"/></tag>
                  <tag><var n="nombre_chunk"/></tag>
                  <tag><clip pos="1" side="sl" part="a_cas"/></tag>
                 <tag><clip pos="1" side="sl" part="a_def"/></tag>
                </tags>
                <lu>
                <get-case-from pos="1">
                  <lit v="a"/>
                </get-case-from>
                  <lit-tag v="pr"/>
                </lu>
                <b/>
                <lu>
                  <lit v="el"/>
                  <lit-tag v="det.def"/>
                  <lit-tag v="2"/>
                  <lit-tag v="3"/>
                </lu>
                <b/>
                <lu>
                  <clip pos="1" side="tl" part="lemh"/>
                  <clip pos="1" side="tl" part="a_nom"/>
                  <clip pos="1" side="tl" part="a_gen_sense_mf" link-to="2"/>
                  <clip pos="1" side="tl" part="a_gen_mf"/>
                  <clip pos="1" side="tl" part="a_nbr_sense_sp" link-to="3"/>
                  <clip pos="1" side="tl" part="a_nbr_sp"/>
                  <clip pos="1" side="tl" part="lemq"/>
                </lu>
                <b pos="1"/>
                <lu>
                  <clip pos="2" side="tl" part="lemh"/>
                  <clip pos="2" side="tl" part="a_adj"/>
                  <clip pos="2" side="tl" part="a_gen_sense_mf" link-to="2"/>
                  <clip pos="2" side="tl" part="a_gen_mf"/>
                  <clip pos="2" side="tl" part="a_nbr_sense_sp" link-to="3"/>
                  <clip pos="2" side="tl" part="a_nbr_sp"/>
                  <clip pos="2" side="tl" part="lemq"/>
                </lu>
              </chunk>
            </out>
          </when>
        <!-- Nominatiu indefinit -->
          <otherwise>
              <out>
                <chunk name="nom_adj">
                <tags>
                  <tag><lit-tag v="SN"/></tag>
                  <tag><var n="genere_chunk"/></tag>
                  <tag><var n="nombre_chunk"/></tag>
                  <tag><clip pos="1" side="sl" part="a_cas"/></tag>
                 <tag><clip pos="1" side="sl" part="a_def"/></tag>
                </tags>
                <lu>
                  <clip pos="1" side="tl" part="lemh"/>
                  <clip pos="1" side="tl" part="a_nom"/>
                  <clip pos="1" side="tl" part="a_gen_sense_mf" link-to="2"/>
                  <clip pos="1" side="tl" part="a_gen_mf"/>
                  <clip pos="1" side="tl" part="a_nbr_sense_sp" link-to="3"/>
                  <clip pos="1" side="tl" part="a_nbr_sp"/>
                  <clip pos="1" side="tl" part="lemq"/>
                </lu>
                <b pos="1"/>
                <lu>
                  <clip pos="2" side="tl" part="lemh"/>
                  <clip pos="2" side="tl" part="a_adj"/>
                  <clip pos="2" side="tl" part="a_gen_sense_mf" link-to="2"/>
                  <clip pos="2" side="tl" part="a_gen_mf"/>
                  <clip pos="2" side="tl" part="a_nbr_sense_sp" link-to="3"/>
                  <clip pos="2" side="tl" part="a_nbr_sp"/>
                  <clip pos="2" side="tl" part="lemq"/>
                </lu>
              </chunk>
            </out>
          </otherwise>
        </choose>
        <call-macro n="n_gen_nbr"/>
      </action>
    </rule>

    <rule comment="NOM + ADJECTIU POSSESSIU">
      <pattern>
        <pattern-item n="nom"/>
        <pattern-item n="adjpos"/>
      </pattern>
      <action>
        <call-macro n="f_concord2">
          <with-param pos="1"/>
          <with-param pos="2"/>
        </call-macro>
        <!-- Nominatiu definit -->
        <choose>
          <when>
            <test>
              <and>
                <equal>
                  <clip pos="1" side="sl" part="a_def"/>
                  <lit-tag v="def"/>
                </equal>
                <equal>
                  <clip pos="1" side="sl" part="a_cas"/>
                  <lit-tag v="nom"/>
                </equal>
              </and>
            </test>
              <call-macro n="mod_maj">
                <with-param pos="1"/>
              </call-macro>
              <out>
                <chunk name="det_adj_nom">
                <tags>
                  <tag><lit-tag v="SN"/></tag>
                  <tag><var n="genere_chunk"/></tag>
                  <tag><var n="nombre_chunk"/></tag>
                  <tag><clip pos="1" side="sl" part="a_cas"/></tag>
                 <tag><clip pos="1" side="sl" part="a_def"/></tag>
                </tags>
                <lu>
                <get-case-from pos="1">
                  <lit v="el"/>
                </get-case-from>
                  <lit-tag v="det.def"/>
                  <lit-tag v="2"/>
                  <lit-tag v="3"/>
                </lu>
                <b/>
                <lu>
                  <clip pos="2" side="tl" part="lemh"/>
                  <clip pos="2" side="tl" part="a_adj"/>
                  <clip pos="2" side="tl" part="a_gen_sense_mf" link-to="2"/>
                  <clip pos="2" side="tl" part="a_gen_mf"/>
                  <clip pos="2" side="tl" part="a_nbr_sense_sp" link-to="3"/>
                  <clip pos="2" side="tl" part="a_nbr_sp"/>
                  <clip pos="2" side="tl" part="lemq"/>
                </lu>
                <b pos="1"/>
                <lu>
                  <clip pos="1" side="tl" part="lemh"/>
                  <clip pos="1" side="tl" part="a_nom"/>
                  <clip pos="1" side="tl" part="a_gen_sense_mf" link-to="2"/>
                  <clip pos="1" side="tl" part="a_gen_mf"/>
                  <clip pos="1" side="tl" part="a_nbr_sense_sp" link-to="3"/>
                  <clip pos="1" side="tl" part="a_nbr_sp"/>
                  <clip pos="1" side="tl" part="lemq"/>
                </lu>
              </chunk>
            </out>
          </when>
        <!-- Datiu indefinit -->
          <when>
            <test>
              <and>
                <equal>
                  <clip pos="1" side="sl" part="a_def"/>
                  <lit-tag v="ind"/>
                </equal>
                <equal>
                  <clip pos="1" side="sl" part="a_cas"/>
                  <lit-tag v="dg"/>
                </equal>
              </and>
            </test>
              <call-macro n="mod_maj">
                <with-param pos="1"/>
              </call-macro>
              <out>
                <chunk name="prep_adj_nom">
                <tags>
                  <tag><lit-tag v="SP"/></tag>
                  <tag><var n="genere_chunk"/></tag>
                  <tag><var n="nombre_chunk"/></tag>
                  <tag><clip pos="1" side="sl" part="a_cas"/></tag>
                 <tag><clip pos="1" side="sl" part="a_def"/></tag>
                </tags>
                <lu>
                <get-case-from pos="1">
                  <lit v="a"/>
                </get-case-from>
                  <lit-tag v="pr"/>
                </lu>
                <b/>
                <lu>
                  <clip pos="2" side="tl" part="lemh"/>
                  <clip pos="2" side="tl" part="a_adj"/>
                  <clip pos="2" side="tl" part="a_gen_sense_mf" link-to="2"/>
                  <clip pos="2" side="tl" part="a_gen_mf"/>
                  <clip pos="2" side="tl" part="a_nbr_sense_sp" link-to="3"/>
                  <clip pos="2" side="tl" part="a_nbr_sp"/>
                  <clip pos="2" side="tl" part="lemq"/>
                </lu>
                <b pos="1"/>
                <lu>
                  <clip pos="1" side="tl" part="lemh"/>
                  <clip pos="1" side="tl" part="a_nom"/>
                  <clip pos="1" side="tl" part="a_gen_sense_mf" link-to="2"/>
                  <clip pos="1" side="tl" part="a_gen_mf"/>
                  <clip pos="1" side="tl" part="a_nbr_sense_sp" link-to="3"/>
                  <clip pos="1" side="tl" part="a_nbr_sp"/>
                  <clip pos="1" side="tl" part="lemq"/>
                </lu>
              </chunk>
            </out>
          </when>
        <!-- Datiu definit -->
          <when>
            <test>
              <and>
                <equal>
                  <clip pos="1" side="sl" part="a_def"/>
                  <lit-tag v="def"/>
                </equal>
                <equal>
                  <clip pos="1" side="sl" part="a_cas"/>
                  <lit-tag v="dg"/>
                </equal>
              </and>
            </test>
              <call-macro n="mod_maj">
                <with-param pos="1"/>
              </call-macro>
              <out>
                <chunk name="prep_det_adj_nom">
                <tags>
                  <tag><lit-tag v="SP"/></tag>
                  <tag><var n="genere_chunk"/></tag>
                  <tag><var n="nombre_chunk"/></tag>
                  <tag><clip pos="1" side="sl" part="a_cas"/></tag>
                 <tag><clip pos="1" side="sl" part="a_def"/></tag>
                </tags>
                <lu>
                <get-case-from pos="1">
                  <lit v="a"/>
                </get-case-from>
                  <lit-tag v="pr"/>
                </lu>
                <b/>
                <lu>
                  <lit v="el"/>
                  <lit-tag v="det.def"/>
                  <lit-tag v="2"/>
                  <lit-tag v="3"/>
                </lu>
                <b/>
                <lu>
                  <clip pos="2" side="tl" part="lemh"/>
                  <clip pos="2" side="tl" part="a_adj"/>
                  <clip pos="2" side="tl" part="a_gen_sense_mf" link-to="2"/>
                  <clip pos="2" side="tl" part="a_gen_mf"/>
                  <clip pos="2" side="tl" part="a_nbr_sense_sp" link-to="3"/>
                  <clip pos="2" side="tl" part="a_nbr_sp"/>
                  <clip pos="2" side="tl" part="lemq"/>
                </lu>
                <b pos="1"/>
                <lu>
                  <clip pos="1" side="tl" part="lemh"/>
                  <clip pos="1" side="tl" part="a_nom"/>
                  <clip pos="1" side="tl" part="a_gen_sense_mf" link-to="2"/>
                  <clip pos="1" side="tl" part="a_gen_mf"/>
                  <clip pos="1" side="tl" part="a_nbr_sense_sp" link-to="3"/>
                  <clip pos="1" side="tl" part="a_nbr_sp"/>
                  <clip pos="1" side="tl" part="lemq"/>
                </lu>
              </chunk>
            </out>
          </when>
        <!-- Nominatiu indefinit -->
          <otherwise>
              <out>
                <chunk name="adj_nom">
                <tags>
                  <tag><lit-tag v="SN"/></tag>
                  <tag><var n="genere_chunk"/></tag>
                  <tag><var n="nombre_chunk"/></tag>
                  <tag><clip pos="1" side="sl" part="a_cas"/></tag>
                 <tag><clip pos="1" side="sl" part="a_def"/></tag>
                </tags>
                <lu>
                  <clip pos="2" side="tl" part="lemh"/>
                  <clip pos="2" side="tl" part="a_adj"/>
                  <clip pos="2" side="tl" part="a_gen_sense_mf" link-to="2"/>
                  <clip pos="2" side="tl" part="a_gen_mf"/>
                  <clip pos="2" side="tl" part="a_nbr_sense_sp" link-to="3"/>
                  <clip pos="2" side="tl" part="a_nbr_sp"/>
                  <clip pos="2" side="tl" part="lemq"/>
                </lu>
                <b pos="1"/>
                <lu>
                  <clip pos="1" side="tl" part="lemh"/>
                  <clip pos="1" side="tl" part="a_nom"/>
                  <clip pos="1" side="tl" part="a_gen_sense_mf" link-to="2"/>
                  <clip pos="1" side="tl" part="a_gen_mf"/>
                  <clip pos="1" side="tl" part="a_nbr_sense_sp" link-to="3"/>
                  <clip pos="1" side="tl" part="a_nbr_sp"/>
                  <clip pos="1" side="tl" part="lemq"/>
                </lu>
              </chunk>
            </out>
          </otherwise>
        </choose>
        <call-macro n="n_gen_nbr"/>
      </action>
    </rule>

    <rule comment="NUM + NOM + ADJECTIU">
      <pattern>
        <pattern-item n="num"/>
        <pattern-item n="nom"/>
        <pattern-item n="adjnorm"/>
      </pattern>
      <action>
        <call-macro n="f_concord3">
          <with-param pos="2"/>
          <with-param pos="3"/>
          <with-param pos="1"/>
        </call-macro>
          <out>
            <chunk name="num_nom_adj">
            <tags>
              <tag><lit-tag v="SN"/></tag>
              <tag><var n="genere_chunk"/></tag>
              <tag><var n="nombre_chunk"/></tag>
              <tag><lit-tag v="nom"/></tag>
              <tag><lit-tag v="ind"/></tag>
            </tags>
            <lu>
              <clip pos="1" side="tl" part="lemh"/>
              <clip pos="1" side="tl" part="a_num"/>
              <clip pos="1" side="tl" part="a_gen_sense_mf" link-to="2"/>
              <clip pos="1" side="tl" part="a_gen_mf"/>
              <clip pos="1" side="tl" part="a_nbr_sense_sp" link-to="3"/>
              <clip pos="1" side="tl" part="a_nbr_sp"/>
              <clip pos="1" side="tl" part="lemq"/>
            </lu>
            <b pos="1"/>
            <lu>
              <clip pos="2" side="tl" part="lemh"/>
              <clip pos="2" side="tl" part="a_nom"/>
              <clip pos="2" side="tl" part="a_gen_sense_mf" link-to="2"/>
              <clip pos="2" side="tl" part="a_gen_mf"/>
              <clip pos="2" side="tl" part="a_nbr_sense_sp" link-to="3"/>
              <clip pos="2" side="tl" part="a_nbr_sp"/>
              <clip pos="2" side="tl" part="lemq"/>
            </lu>
            <b pos="2"/>
            <lu>
              <clip pos="3" side="tl" part="lemh"/>
              <clip pos="3" side="tl" part="a_adj"/>
              <clip pos="3" side="tl" part="a_gen_sense_mf" link-to="2"/>
              <clip pos="3" side="tl" part="a_gen_mf"/>
              <clip pos="3" side="tl" part="a_nbr_sense_sp" link-to="3"/>
              <clip pos="3" side="tl" part="a_nbr_sp"/>
              <clip pos="3" side="tl" part="lemq"/>
            </lu>
          </chunk>
        </out>
        <call-macro n="n_gen_nbr"/>
      </action>
    </rule>

    <rule comment="NUM + de + NOM + ADJECTIU">
      <pattern>
        <pattern-item n="num"/>
        <pattern-item n="prepde"/>
        <pattern-item n="nom"/>
        <pattern-item n="adjnorm"/>
      </pattern>
      <action>
        <call-macro n="f_concord3">
          <with-param pos="3"/>
          <with-param pos="4"/>
          <with-param pos="1"/>
        </call-macro>
          <out>
            <chunk name="num_nom_adj">
            <tags>
              <tag><lit-tag v="SN"/></tag>
              <tag><var n="genere_chunk"/></tag>
              <tag><var n="nombre_chunk"/></tag>
              <tag><lit-tag v="nom"/></tag>
              <tag><lit-tag v="ind"/></tag>
            </tags>
            <lu>
              <clip pos="1" side="tl" part="lemh"/>
              <clip pos="1" side="tl" part="a_num"/>
              <clip pos="1" side="tl" part="a_gen_sense_mf" link-to="2"/>
              <clip pos="1" side="tl" part="a_gen_mf"/>
              <clip pos="1" side="tl" part="a_nbr_sense_sp" link-to="3"/>
              <clip pos="1" side="tl" part="a_nbr_sp"/>
              <clip pos="1" side="tl" part="lemq"/>
            </lu>
            <b pos="1"/>
            <lu>
              <clip pos="3" side="tl" part="lemh"/>
              <clip pos="3" side="tl" part="a_nom"/>
              <clip pos="3" side="tl" part="a_gen_sense_mf" link-to="2"/>
              <clip pos="3" side="tl" part="a_gen_mf"/>
              <clip pos="3" side="tl" part="a_nbr_sense_sp" link-to="3"/>
              <clip pos="3" side="tl" part="a_nbr_sp"/>
              <clip pos="3" side="tl" part="lemq"/>
            </lu>
            <b pos="3"/>
            <lu>
              <clip pos="4" side="tl" part="lemh"/>
              <clip pos="4" side="tl" part="a_adj"/>
              <clip pos="4" side="tl" part="a_gen_sense_mf" link-to="2"/>
              <clip pos="4" side="tl" part="a_gen_mf"/>
              <clip pos="4" side="tl" part="a_nbr_sense_sp" link-to="3"/>
              <clip pos="4" side="tl" part="a_nbr_sp"/>
              <clip pos="4" side="tl" part="lemq"/>
            </lu>
          </chunk>
        </out>
        <call-macro n="n_gen_nbr"/>
      </action>
    </rule>


    <rule comment="NOM + ADJECTIU + ADJECTIU">
      <pattern>
        <pattern-item n="nom"/>
        <pattern-item n="adjnorm"/>
        <pattern-item n="adjnorm"/>
      </pattern>
      <action>
        <call-macro n="f_concord3">
          <with-param pos="1"/>
          <with-param pos="2"/>
          <with-param pos="3"/>
        </call-macro>
        <!-- Nominatiu definit -->
        <choose>
          <when>
            <test>
              <and>
                <equal>
                  <clip pos="1" side="sl" part="a_def"/>
                  <lit-tag v="def"/>
                </equal>
                <equal>
                  <clip pos="1" side="sl" part="a_cas"/>
                  <lit-tag v="nom"/>
                </equal>
              </and>
            </test>
              <call-macro n="mod_maj">
                <with-param pos="1"/>
              </call-macro>
              <out>
                <chunk name="det_nom_adj_adj">
                <tags>
                  <tag><lit-tag v="SN"/></tag>
                  <tag><var n="genere_chunk"/></tag>
                  <tag><var n="nombre_chunk"/></tag>
                  <tag><clip pos="1" side="sl" part="a_cas"/></tag>
                 <tag><clip pos="1" side="sl" part="a_def"/></tag>
                </tags>
                <lu>
                <get-case-from pos="1">
                  <lit v="el"/>
                </get-case-from>
                  <lit-tag v="det.def"/>
                  <lit-tag v="2"/>
                  <lit-tag v="3"/>
                </lu>
                <b/>
                <lu>
                  <clip pos="1" side="tl" part="lemh"/>
                  <clip pos="1" side="tl" part="a_nom"/>
                  <clip pos="1" side="tl" part="a_gen_sense_mf" link-to="2"/>
                  <clip pos="1" side="tl" part="a_gen_mf"/>
                  <clip pos="1" side="tl" part="a_nbr_sense_sp" link-to="3"/>
                  <clip pos="1" side="tl" part="a_nbr_sp"/>
                  <clip pos="1" side="tl" part="lemq"/>
                </lu>
                <b pos="1"/>
                <lu>
                  <clip pos="2" side="tl" part="lemh"/>
                  <clip pos="2" side="tl" part="a_adj"/>
                  <clip pos="2" side="tl" part="a_gen_sense_mf" link-to="2"/>
                  <clip pos="2" side="tl" part="a_gen_mf"/>
                  <clip pos="2" side="tl" part="a_nbr_sense_sp" link-to="3"/>
                  <clip pos="2" side="tl" part="a_nbr_sp"/>
                  <clip pos="2" side="tl" part="lemq"/>
                </lu>
                <b pos="2"/>
                <lu>
                  <clip pos="3" side="tl" part="lemh"/>
                  <clip pos="3" side="tl" part="a_adj"/>
                  <clip pos="3" side="tl" part="a_gen_sense_mf" link-to="2"/>
                  <clip pos="3" side="tl" part="a_gen_mf"/>
                  <clip pos="3" side="tl" part="a_nbr_sense_sp" link-to="3"/>
                  <clip pos="3" side="tl" part="a_nbr_sp"/>
                  <clip pos="3" side="tl" part="lemq"/>
                </lu>
              </chunk>
            </out>
          </when>
        <!-- Datiu indefinit -->
          <when>
            <test>
              <and>
                <equal>
                  <clip pos="1" side="sl" part="a_def"/>
                  <lit-tag v="ind"/>
                </equal>
                <equal>
                  <clip pos="1" side="sl" part="a_cas"/>
                  <lit-tag v="dg"/>
                </equal>
              </and>
            </test>
              <call-macro n="mod_maj">
                <with-param pos="1"/>
              </call-macro>
              <out>
                <chunk name="prep_nom_adj_adj">
                <tags>
                  <tag><lit-tag v="SP"/></tag>
                  <tag><var n="genere_chunk"/></tag>
                  <tag><var n="nombre_chunk"/></tag>
                  <tag><clip pos="1" side="sl" part="a_cas"/></tag>
                 <tag><clip pos="1" side="sl" part="a_def"/></tag>
                </tags>
                <lu>
                <get-case-from pos="1">
                  <lit v="a"/>
                </get-case-from>
                  <lit-tag v="pr"/>
                </lu>
                <b/>
                <lu>
                  <clip pos="1" side="tl" part="lemh"/>
                  <clip pos="1" side="tl" part="a_nom"/>
                  <clip pos="1" side="tl" part="a_gen_sense_mf" link-to="2"/>
                  <clip pos="1" side="tl" part="a_gen_mf"/>
                  <clip pos="1" side="tl" part="a_nbr_sense_sp" link-to="3"/>
                  <clip pos="1" side="tl" part="a_nbr_sp"/>
                  <clip pos="1" side="tl" part="lemq"/>
                </lu>
                <b pos="1"/>
                <lu>
                  <clip pos="2" side="tl" part="lemh"/>
                  <clip pos="2" side="tl" part="a_adj"/>
                  <clip pos="2" side="tl" part="a_gen_sense_mf" link-to="2"/>
                  <clip pos="2" side="tl" part="a_gen_mf"/>
                  <clip pos="2" side="tl" part="a_nbr_sense_sp" link-to="3"/>
                  <clip pos="2" side="tl" part="a_nbr_sp"/>
                  <clip pos="2" side="tl" part="lemq"/>
                </lu>
                <b pos="2"/>
                <lu>
                  <clip pos="3" side="tl" part="lemh"/>
                  <clip pos="3" side="tl" part="a_adj"/>
                  <clip pos="3" side="tl" part="a_gen_sense_mf" link-to="2"/>
                  <clip pos="3" side="tl" part="a_gen_mf"/>
                  <clip pos="3" side="tl" part="a_nbr_sense_sp" link-to="3"/>
                  <clip pos="3" side="tl" part="a_nbr_sp"/>
                  <clip pos="3" side="tl" part="lemq"/>
                </lu>
              </chunk>
            </out>
          </when>
        <!-- Datiu definit -->
          <when>
            <test>
              <and>
                <equal>
                  <clip pos="1" side="sl" part="a_def"/>
                  <lit-tag v="def"/>
                </equal>
                <equal>
                  <clip pos="1" side="sl" part="a_cas"/>
                  <lit-tag v="dg"/>
                </equal>
              </and>
            </test>
              <call-macro n="mod_maj">
                <with-param pos="1"/>
              </call-macro>
              <out>
                <chunk name="prep_det_nom_adj_adj">
                <tags>
                  <tag><lit-tag v="SP"/></tag>
                  <tag><var n="genere_chunk"/></tag>
                  <tag><var n="nombre_chunk"/></tag>
                  <tag><clip pos="1" side="sl" part="a_cas"/></tag>
                 <tag><clip pos="1" side="sl" part="a_def"/></tag>
                </tags>
                <lu>
                <get-case-from pos="1">
                  <lit v="a"/>
                </get-case-from>
                  <lit-tag v="pr"/>
                </lu>
                <b/>
                <lu>
                  <lit v="el"/>
                  <lit-tag v="det.def"/>
                  <lit-tag v="2"/>
                  <lit-tag v="3"/>
                </lu>
                <b/>
                <lu>
                  <clip pos="1" side="tl" part="lemh"/>
                  <clip pos="1" side="tl" part="a_nom"/>
                  <clip pos="1" side="tl" part="a_gen_sense_mf" link-to="2"/>
                  <clip pos="1" side="tl" part="a_gen_mf"/>
                  <clip pos="1" side="tl" part="a_nbr_sense_sp" link-to="3"/>
                  <clip pos="1" side="tl" part="a_nbr_sp"/>
                  <clip pos="1" side="tl" part="lemq"/>
                </lu>
                <b pos="1"/>
                <lu>
                  <clip pos="2" side="tl" part="lemh"/>
                  <clip pos="2" side="tl" part="a_adj"/>
                  <clip pos="2" side="tl" part="a_gen_sense_mf" link-to="2"/>
                  <clip pos="2" side="tl" part="a_gen_mf"/>
                  <clip pos="2" side="tl" part="a_nbr_sense_sp" link-to="3"/>
                  <clip pos="2" side="tl" part="a_nbr_sp"/>
                  <clip pos="2" side="tl" part="lemq"/>
                </lu>
                <b pos="2"/>
                <lu>
                  <clip pos="3" side="tl" part="lemh"/>
                  <clip pos="3" side="tl" part="a_adj"/>
                  <clip pos="3" side="tl" part="a_gen_sense_mf" link-to="2"/>
                  <clip pos="3" side="tl" part="a_gen_mf"/>
                  <clip pos="3" side="tl" part="a_nbr_sense_sp" link-to="3"/>
                  <clip pos="3" side="tl" part="a_nbr_sp"/>
                  <clip pos="3" side="tl" part="lemq"/>
                </lu>
              </chunk>
            </out>
          </when>
        <!-- Nominatiu indefinit -->
          <otherwise>
              <out>
                <chunk name="nom_adj_adj">
                <tags>
                  <tag><lit-tag v="SN"/></tag>
                  <tag><var n="genere_chunk"/></tag>
                  <tag><var n="nombre_chunk"/></tag>
                  <tag><clip pos="1" side="sl" part="a_cas"/></tag>
                 <tag><clip pos="1" side="sl" part="a_def"/></tag>
                </tags>
                <lu>
                  <clip pos="1" side="tl" part="lemh"/>
                  <clip pos="1" side="tl" part="a_nom"/>
                  <clip pos="1" side="tl" part="a_gen_sense_mf" link-to="2"/>
                  <clip pos="1" side="tl" part="a_gen_mf"/>
                  <clip pos="1" side="tl" part="a_nbr_sense_sp" link-to="3"/>
                  <clip pos="1" side="tl" part="a_nbr_sp"/>
                  <clip pos="1" side="tl" part="lemq"/>
                </lu>
                <b pos="1"/>
                <lu>
                  <clip pos="2" side="tl" part="lemh"/>
                  <clip pos="2" side="tl" part="a_adj"/>
                  <clip pos="2" side="tl" part="a_gen_sense_mf" link-to="2"/>
                  <clip pos="2" side="tl" part="a_gen_mf"/>
                  <clip pos="2" side="tl" part="a_nbr_sense_sp" link-to="3"/>
                  <clip pos="2" side="tl" part="a_nbr_sp"/>
                  <clip pos="2" side="tl" part="lemq"/>
                </lu>
                <b pos="2"/>
                <lu>
                  <clip pos="3" side="tl" part="lemh"/>
                  <clip pos="3" side="tl" part="a_adj"/>
                  <clip pos="3" side="tl" part="a_gen_sense_mf" link-to="2"/>
                  <clip pos="3" side="tl" part="a_gen_mf"/>
                  <clip pos="3" side="tl" part="a_nbr_sense_sp" link-to="3"/>
                  <clip pos="3" side="tl" part="a_nbr_sp"/>
                  <clip pos="3" side="tl" part="lemq"/>
                </lu>
              </chunk>
            </out>
          </otherwise>
        </choose>
        <call-macro n="n_gen_nbr"/>
      </action>
    </rule>


    <rule comment="ADJECTIU + NOM">
      <pattern>
        <pattern-item n="adj"/>
        <pattern-item n="nom"/>
      </pattern>
      <action>
        <call-macro n="f_concord2">
          <with-param pos="2"/>
          <with-param pos="1"/>
        </call-macro>
        <!-- Nominatiu definit -->
        <choose>
          <when>
            <test>
              <and>
                <equal>
                  <clip pos="1" side="sl" part="a_def"/>
                  <lit-tag v="def"/>
                </equal>
                <equal>
                  <clip pos="1" side="sl" part="a_cas"/>
                  <lit-tag v="nom"/>
                </equal>
              </and>
            </test>
              <call-macro n="mod_maj">
                <with-param pos="1"/>
              </call-macro>
              <out>
                <chunk name="det_adj_nom">
                <tags>
                  <tag><lit-tag v="SN"/></tag>
                  <tag><var n="genere_chunk"/></tag>
                  <tag><var n="nombre_chunk"/></tag>
                  <tag><clip pos="1" side="sl" part="a_cas"/></tag>
                  <tag><clip pos="1" side="sl" part="a_def"/></tag>
                </tags>
                <lu>
                <get-case-from pos="1">
                  <lit v="el"/>
                </get-case-from>
                  <lit-tag v="det.def"/>
                  <lit-tag v="2"/>
                  <lit-tag v="3"/>
                </lu>
                <b/>
                <lu>
                  <clip pos="1" side="tl" part="lemh"/>
                  <clip pos="1" side="tl" part="a_adj"/>
                  <clip pos="1" side="tl" part="a_gen_sense_mf" link-to="2"/>
                  <clip pos="1" side="tl" part="a_gen_mf"/>
                  <clip pos="1" side="tl" part="a_nbr_sense_sp" link-to="3"/>
                  <clip pos="1" side="tl" part="a_nbr_sp"/>
                  <clip pos="1" side="tl" part="lemq"/>
                </lu>
                <b pos="1"/>
                <lu>
                  <clip pos="2" side="tl" part="lemh"/>
                  <clip pos="2" side="tl" part="a_nom"/>
                  <clip pos="2" side="tl" part="a_gen_sense_mf" link-to="2"/>
                  <clip pos="2" side="tl" part="a_gen_mf"/>
                  <clip pos="2" side="tl" part="a_nbr_sense_sp" link-to="3"/>
                  <clip pos="2" side="tl" part="a_nbr_sp"/>
                  <clip pos="2" side="tl" part="lemq"/>
                </lu>
              </chunk>
            </out>
          </when>
        <!-- Datiu indefinit -->
          <when>
            <test>
              <and>
                <equal>
                  <clip pos="1" side="sl" part="a_def"/>
                  <lit-tag v="ind"/>
                </equal>
                <equal>
                  <clip pos="1" side="sl" part="a_cas"/>
                  <lit-tag v="dg"/>
                </equal>
              </and>
            </test>
              <call-macro n="mod_maj">
                <with-param pos="1"/>
              </call-macro>
              <out>
                <chunk name="prep_adj_nom">
                <tags>
                  <tag><lit-tag v="SP"/></tag>
                  <tag><var n="genere_chunk"/></tag>
                  <tag><var n="nombre_chunk"/></tag>
                  <tag><clip pos="1" side="sl" part="a_cas"/></tag>
                  <tag><clip pos="1" side="sl" part="a_def"/></tag>
                </tags>
                <lu>
                <get-case-from pos="1">
                  <lit v="a"/>
                </get-case-from>
                  <lit-tag v="pr"/>
                </lu>
                <b/>
                <lu>
                  <clip pos="1" side="tl" part="lemh"/>
                  <clip pos="1" side="tl" part="a_adj"/>
                  <clip pos="1" side="tl" part="a_gen_sense_mf" link-to="2"/>
                  <clip pos="1" side="tl" part="a_gen_mf"/>
                  <clip pos="1" side="tl" part="a_nbr_sense_sp" link-to="3"/>
                  <clip pos="1" side="tl" part="a_nbr_sp"/>
                  <clip pos="1" side="tl" part="lemq"/>
                </lu>
                <b pos="1"/>
                <lu>
                  <clip pos="2" side="tl" part="lemh"/>
                  <clip pos="2" side="tl" part="a_nom"/>
                  <clip pos="2" side="tl" part="a_gen_sense_mf" link-to="2"/>
                  <clip pos="2" side="tl" part="a_gen_mf"/>
                  <clip pos="2" side="tl" part="a_nbr_sense_sp" link-to="3"/>
                  <clip pos="2" side="tl" part="a_nbr_sp"/>
                  <clip pos="2" side="tl" part="lemq"/>
                </lu>
              </chunk>
            </out>
          </when>
        <!-- Datiu definit -->
          <when>
            <test>
              <and>
                <equal>
                  <clip pos="1" side="sl" part="a_def"/>
                  <lit-tag v="def"/>
                </equal>
                <equal>
                  <clip pos="1" side="sl" part="a_cas"/>
                  <lit-tag v="dg"/>
                </equal>
              </and>
            </test>
              <call-macro n="mod_maj">
                <with-param pos="1"/>
              </call-macro>
              <out>
                <chunk name="prep_det_adj_nom">
                <tags>
                  <tag><lit-tag v="SP"/></tag>
                  <tag><var n="genere_chunk"/></tag>
                  <tag><var n="nombre_chunk"/></tag>
                  <tag><clip pos="1" side="sl" part="a_cas"/></tag>
                  <tag><clip pos="1" side="sl" part="a_def"/></tag>
                </tags>
                <lu>
                <get-case-from pos="1">
                  <lit v="a"/>
                </get-case-from>
                  <lit-tag v="pr"/>
                </lu>
                <b/>
                <lu>
                  <lit v="el"/>
                  <lit-tag v="det.def"/>
                  <lit-tag v="2"/>
                  <lit-tag v="3"/>
                </lu>
                <b/>
                <lu>
                  <clip pos="1" side="tl" part="lemh"/>
                  <clip pos="1" side="tl" part="a_adj"/>
                  <clip pos="1" side="tl" part="a_gen_sense_mf" link-to="2"/>
                  <clip pos="1" side="tl" part="a_gen_mf"/>
                  <clip pos="1" side="tl" part="a_nbr_sense_sp" link-to="3"/>
                  <clip pos="1" side="tl" part="a_nbr_sp"/>
                  <clip pos="1" side="tl" part="lemq"/>
                </lu>
                <b pos="1"/>
                <lu>
                  <clip pos="2" side="tl" part="lemh"/>
                  <clip pos="2" side="tl" part="a_nom"/>
                  <clip pos="2" side="tl" part="a_gen_sense_mf" link-to="2"/>
                  <clip pos="2" side="tl" part="a_gen_mf"/>
                  <clip pos="2" side="tl" part="a_nbr_sense_sp" link-to="3"/>
                  <clip pos="2" side="tl" part="a_nbr_sp"/>
                  <clip pos="2" side="tl" part="lemq"/>
                </lu>
              </chunk>
            </out>
          </when>
        <!-- Nominatiu indefinit -->
          <otherwise>
              <out>
                <chunk name="adj_nom">
                <tags>
                  <tag><lit-tag v="SN"/></tag>
                  <tag><var n="genere_chunk"/></tag>
                  <tag><var n="nombre_chunk"/></tag>
                  <tag><clip pos="1" side="sl" part="a_cas"/></tag>
                  <tag><clip pos="1" side="sl" part="a_def"/></tag>
                </tags>
                <lu>
                  <clip pos="1" side="tl" part="lemh"/>
                  <clip pos="1" side="tl" part="a_adj"/>
                  <clip pos="1" side="tl" part="a_gen_sense_mf" link-to="2"/>
                  <clip pos="1" side="tl" part="a_gen_mf"/>
                  <clip pos="1" side="tl" part="a_nbr_sense_sp" link-to="3"/>
                  <clip pos="1" side="tl" part="a_nbr_sp"/>
                  <clip pos="1" side="tl" part="lemq"/>
                </lu>
                <b pos="1"/>
                <lu>
                  <clip pos="2" side="tl" part="lemh"/>
                  <clip pos="2" side="tl" part="a_nom"/>
                  <clip pos="2" side="tl" part="a_gen_sense_mf" link-to="2"/>
                  <clip pos="2" side="tl" part="a_gen_mf"/>
                  <clip pos="2" side="tl" part="a_nbr_sense_sp" link-to="3"/>
                  <clip pos="2" side="tl" part="a_nbr_sp"/>
                  <clip pos="2" side="tl" part="lemq"/>
                </lu>
              </chunk>
            </out>
          </otherwise>
        </choose>
        <call-macro n="n_gen_nbr"/>
      </action>
    </rule>


    <rule comment="DETERMINANT + NOM">
      <pattern>
        <pattern-item n="det"/>
        <pattern-item n="nom"/>
      </pattern>
      <action>
        <call-macro n="f_concord2">
          <with-param pos="2"/>
          <with-param pos="1"/>
        </call-macro>
        <choose>
        <!-- Datiu indefinit -->
          <when>
            <test>
              <and>
                <equal>
                  <clip pos="1" side="sl" part="a_def"/>
                  <lit-tag v="ind"/>
                </equal>
                <equal>
                  <clip pos="1" side="sl" part="a_cas"/>
                  <lit-tag v="dg"/>
                </equal>
              </and>
            </test>
              <call-macro n="mod_maj">
                <with-param pos="1"/>
              </call-macro>
              <out>
                <chunk name="prep_det_nom">
                <tags>
                  <tag><lit-tag v="SP"/></tag>
                  <tag><var n="genere_chunk"/></tag>
                  <tag><var n="nombre_chunk"/></tag>
                  <tag><clip pos="1" side="sl" part="a_cas"/></tag>
                  <tag><clip pos="1" side="sl" part="a_def"/></tag>
                </tags>
                <lu>
                <get-case-from pos="1">
                  <lit v="a"/>
                </get-case-from>
                  <lit-tag v="pr"/>
                </lu>
                <b/>
                <lu>
                  <clip pos="1" side="tl" part="lemh"/>
                  <clip pos="1" side="tl" part="a_det"/>
                  <clip pos="1" side="tl" part="a_gen_sense_mf" link-to="2"/>
                  <clip pos="1" side="tl" part="a_gen_mf"/>
                  <clip pos="1" side="tl" part="a_nbr_sense_sp" link-to="3"/>
                  <clip pos="1" side="tl" part="a_nbr_sp"/>
                  <clip pos="1" side="tl" part="lemq"/>
                </lu>
                <b pos="1"/>
                <lu>
                  <clip pos="2" side="tl" part="lemh"/>
                  <clip pos="2" side="tl" part="a_nom"/>
                  <clip pos="2" side="tl" part="a_gen_sense_mf" link-to="2"/>
                  <clip pos="2" side="tl" part="a_gen_mf"/>
                  <clip pos="2" side="tl" part="a_nbr_sense_sp" link-to="3"/>
                  <clip pos="2" side="tl" part="a_nbr_sp"/>
                  <clip pos="2" side="tl" part="lemq"/>
                </lu>
              </chunk>
            </out>
          </when>
        <!-- Nominatiu indefinit -->
          <otherwise>
              <out>
                <chunk name="det_nom">
                <tags>
                  <tag><lit-tag v="SN"/></tag>
                  <tag><var n="genere_chunk"/></tag>
                  <tag><var n="nombre_chunk"/></tag>
                  <tag><clip pos="1" side="sl" part="a_cas"/></tag>
                  <tag><clip pos="1" side="sl" part="a_def"/></tag>
                </tags>
                <lu>
                  <clip pos="1" side="tl" part="lemh"/>
                  <clip pos="1" side="tl" part="a_det"/>
                  <clip pos="1" side="tl" part="a_gen_sense_mf" link-to="2"/>
                  <clip pos="1" side="tl" part="a_gen_mf"/>
                  <clip pos="1" side="tl" part="a_nbr_sense_sp" link-to="3"/>
                  <clip pos="1" side="tl" part="a_nbr_sp"/>
                  <clip pos="1" side="tl" part="lemq"/>
                </lu>
                <b pos="1"/>
                <lu>
                  <clip pos="2" side="tl" part="lemh"/>
                  <clip pos="2" side="tl" part="a_nom"/>
                  <clip pos="2" side="tl" part="a_gen_sense_mf" link-to="2"/>
                  <clip pos="2" side="tl" part="a_gen_mf"/>
                  <clip pos="2" side="tl" part="a_nbr_sense_sp" link-to="3"/>
                  <clip pos="2" side="tl" part="a_nbr_sp"/>
                  <clip pos="2" side="tl" part="lemq"/>
                </lu>
              </chunk>
            </out>
          </otherwise>
        </choose>
        <call-macro n="n_gen_nbr"/>
      </action>
    </rule>

    <rule comment="tot + NOM">
      <pattern>
        <pattern-item n="predet"/>
        <pattern-item n="nom"/>
      </pattern>
      <action>
        <call-macro n="f_concord2">
          <with-param pos="2"/>
          <with-param pos="1"/>
        </call-macro>
        <choose>
        <!-- Datiu indefinit -->
          <when>
            <test>
              <equal>
                <clip pos="1" side="sl" part="a_cas"/>
                <lit-tag v="dg"/>
              </equal>
            </test>
              <call-macro n="mod_maj">
                <with-param pos="1"/>
              </call-macro>
              <out>
                <chunk name="prep_predet_det_nom">
                <tags>
                  <tag><lit-tag v="SP"/></tag>
                  <tag><var n="genere_chunk"/></tag>
                  <tag><var n="nombre_chunk"/></tag>
                  <tag><clip pos="1" side="sl" part="a_cas"/></tag>
                  <tag><clip pos="1" side="sl" part="a_def"/></tag>
                </tags>
                <lu>
                <get-case-from pos="1">
                  <lit v="a"/>
                </get-case-from>
                  <lit-tag v="pr"/>
                </lu>
                <b/>
                <lu>
                  <clip pos="1" side="tl" part="lemh"/>
                  <clip pos="1" side="tl" part="a_det"/>
                  <clip pos="1" side="tl" part="a_gen_sense_mf" link-to="2"/>
                  <clip pos="1" side="tl" part="a_gen_mf"/>
                  <clip pos="1" side="tl" part="a_nbr_sense_sp" link-to="3"/>
                  <clip pos="1" side="tl" part="a_nbr_sp"/>
                  <clip pos="1" side="tl" part="lemq"/>
                </lu>
                <b/>
                <lu>
                  <lit v="el"/>
                  <lit-tag v="det.def"/>
                  <lit-tag v="2"/>
                  <lit-tag v="3"/>
                </lu>
                <b pos="1"/>
                <lu>
                  <clip pos="2" side="tl" part="lemh"/>
                  <clip pos="2" side="tl" part="a_nom"/>
                  <clip pos="2" side="tl" part="a_gen_sense_mf" link-to="2"/>
                  <clip pos="2" side="tl" part="a_gen_mf"/>
                  <clip pos="2" side="tl" part="a_nbr_sense_sp" link-to="3"/>
                  <clip pos="2" side="tl" part="a_nbr_sp"/>
                  <clip pos="2" side="tl" part="lemq"/>
                </lu>
              </chunk>
            </out>
          </when>
        <!-- Nominatiu indefinit -->
          <otherwise>
              <out>
                <chunk name="predet_det_nom">
                <tags>
                  <tag><lit-tag v="SN"/></tag>
                  <tag><var n="genere_chunk"/></tag>
                  <tag><var n="nombre_chunk"/></tag>
                  <tag><clip pos="1" side="sl" part="a_cas"/></tag>
                  <tag><clip pos="1" side="sl" part="a_def"/></tag>
                </tags>
                <lu>
                  <clip pos="1" side="tl" part="lemh"/>
                  <clip pos="1" side="tl" part="a_det"/>
                  <clip pos="1" side="tl" part="a_gen_sense_mf" link-to="2"/>
                  <clip pos="1" side="tl" part="a_gen_mf"/>
                  <clip pos="1" side="tl" part="a_nbr_sense_sp" link-to="3"/>
                  <clip pos="1" side="tl" part="a_nbr_sp"/>
                  <clip pos="1" side="tl" part="lemq"/>
                </lu>
                <b/>
                <lu>
                  <lit v="el"/>
                  <lit-tag v="det.def"/>
                  <lit-tag v="2"/>
                  <lit-tag v="3"/>
                </lu>
                <b pos="1"/>
                <lu>
                  <clip pos="2" side="tl" part="lemh"/>
                  <clip pos="2" side="tl" part="a_nom"/>
                  <clip pos="2" side="tl" part="a_gen_sense_mf" link-to="2"/>
                  <clip pos="2" side="tl" part="a_gen_mf"/>
                  <clip pos="2" side="tl" part="a_nbr_sense_sp" link-to="3"/>
                  <clip pos="2" side="tl" part="a_nbr_sp"/>
                  <clip pos="2" side="tl" part="lemq"/>
                </lu>
              </chunk>
            </out>
          </otherwise>
        </choose>
        <call-macro n="n_gen_nbr"/>
      </action>
    </rule>


    <rule comment="NOM + NOM GENITIU + ADJECTIU POSSESSIU">
      <pattern>
        <pattern-item n="nom"/>
        <pattern-item n="nom_dgdef"/>
        <pattern-item n="adjpos"/>
      </pattern>
      <action>
        <call-macro n="f_concord1">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="f_concord2_i">
          <with-param pos="2"/>
          <with-param pos="3"/>
        </call-macro>
        <!-- Nominatiu definit -->
        <choose>
          <when>
            <test>
              <and>
                <equal>
                  <clip pos="1" side="sl" part="a_def"/>
                  <lit-tag v="def"/>
                </equal>
                <equal>
                  <clip pos="1" side="sl" part="a_cas"/>
                  <lit-tag v="nom"/>
                </equal>
              </and>
            </test>
              <call-macro n="mod_maj">
                <with-param pos="1"/>
              </call-macro>
              <out>
                <chunk name="det_nom_prep_det_adj_nom">
                <tags>
                  <tag><lit-tag v="SN"/></tag>
                  <tag><var n="genere_chunk"/></tag>
                  <tag><var n="nombre_chunk"/></tag>
                  <tag><clip pos="1" side="sl" part="a_cas"/></tag>
                 <tag><clip pos="1" side="sl" part="a_def"/></tag>
                </tags>
                <lu>
                  <get-case-from pos="1">
                  <lit v="el"/>
                  </get-case-from>
                  <lit-tag v="det.def"/>
                  <lit-tag v="2"/>
                  <lit-tag v="3"/>
                </lu>
                <b/>
                <lu>
                  <clip pos="1" side="tl" part="lemh"/>
                  <clip pos="1" side="tl" part="a_nom"/>
                  <clip pos="1" side="tl" part="a_gen_sense_mf" link-to="2"/>
                  <clip pos="1" side="tl" part="a_gen_mf"/>
                  <clip pos="1" side="tl" part="a_nbr_sense_sp" link-to="3"/>
                  <clip pos="1" side="tl" part="a_nbr_sp"/>
                  <clip pos="1" side="tl" part="lemq"/>
                </lu>
                <b/>
                <lu>
                  <lit v="de"/>
                  <lit-tag v="pr"/>
                </lu>
                <b/>
                <lu>
                  <lit v="el"/>
                  <lit-tag v="det.def"/>
                  <var n="genere1"/>
                  <var n="nombre1"/>
                </lu>
                <b pos="2"/>
                <lu>
                  <clip pos="3" side="tl" part="lemh"/>
                  <clip pos="3" side="tl" part="a_adj"/>
                  <clip pos="3" side="tl" part="a_gen"/>
                  <clip pos="3" side="tl" part="a_nbr"/>
                  <clip pos="3" side="tl" part="lemq"/>
                </lu>
                <b pos="1"/>
                <lu>
                  <clip pos="2" side="tl" part="lemh"/>
                  <clip pos="2" side="tl" part="a_nom"/>
                  <clip pos="2" side="tl" part="a_gen"/>
                  <clip pos="2" side="tl" part="a_nbr"/>
                  <clip pos="2" side="tl" part="lemq"/>
                </lu>
              </chunk>
            </out>
          </when>
        <!-- Datiu indefinit -->
          <when>
            <test>
              <and>
                <equal>
                  <clip pos="1" side="sl" part="a_def"/>
                  <lit-tag v="ind"/>
                </equal>
                <equal>
                  <clip pos="1" side="sl" part="a_cas"/>
                  <lit-tag v="dg"/>
                </equal>
              </and>
            </test>
              <call-macro n="mod_maj">
                <with-param pos="1"/>
              </call-macro>
              <out>
                <chunk name="prep_nom_prep_det_adj_nom">
                <tags>
                  <tag><lit-tag v="SP"/></tag>
                  <tag><var n="genere_chunk"/></tag>
                  <tag><var n="nombre_chunk"/></tag>
                  <tag><clip pos="1" side="sl" part="a_cas"/></tag>
                 <tag><clip pos="1" side="sl" part="a_def"/></tag>
                </tags>
                <lu>
                  <get-case-from pos="1">
                  <lit v="a"/>
                  </get-case-from>
                  <lit-tag v="pr"/>
                </lu>
                <b/>
                <lu>
                  <clip pos="1" side="tl" part="lemh"/>
                  <clip pos="1" side="tl" part="a_nom"/>
                  <clip pos="1" side="tl" part="a_gen_sense_mf" link-to="2"/>
                  <clip pos="1" side="tl" part="a_gen_mf"/>
                  <clip pos="1" side="tl" part="a_nbr_sense_sp" link-to="3"/>
                  <clip pos="1" side="tl" part="a_nbr_sp"/>
                  <clip pos="1" side="tl" part="lemq"/>
                </lu>
                <b/>
                <lu>
                  <lit v="de"/>
                  <lit-tag v="pr"/>
                </lu>
                <b/>
                <lu>
                  <lit v="el"/>
                  <lit-tag v="det.def"/>
                  <var n="genere1"/>
                  <var n="nombre1"/>
                </lu>
                <b pos="2"/>
                <lu>
                  <clip pos="3" side="tl" part="lemh"/>
                  <clip pos="3" side="tl" part="a_adj"/>
                  <clip pos="3" side="tl" part="a_gen"/>
                  <clip pos="3" side="tl" part="a_nbr"/>
                  <clip pos="3" side="tl" part="lemq"/>
                </lu>
                <b pos="1"/>
                <lu>
                  <clip pos="2" side="tl" part="lemh"/>
                  <clip pos="2" side="tl" part="a_nom"/>
                  <clip pos="2" side="tl" part="a_gen"/>
                  <clip pos="2" side="tl" part="a_nbr"/>
                  <clip pos="2" side="tl" part="lemq"/>
                </lu>
              </chunk>
            </out>
          </when>
        <!-- Datiu definit -->
          <when>
            <test>
              <and>
                <equal>
                  <clip pos="1" side="sl" part="a_def"/>
                  <lit-tag v="def"/>
                </equal>
                <equal>
                  <clip pos="1" side="sl" part="a_cas"/>
                  <lit-tag v="dg"/>
                </equal>
              </and>
            </test>
              <call-macro n="mod_maj">
                <with-param pos="1"/>
              </call-macro>
              <out>
                <chunk name="prep_det_nom_prep_det_adj_nom">
                <tags>
                  <tag><lit-tag v="SP"/></tag>
                  <tag><var n="genere_chunk"/></tag>
                  <tag><var n="nombre_chunk"/></tag>
                  <tag><clip pos="1" side="sl" part="a_cas"/></tag>
                 <tag><clip pos="1" side="sl" part="a_def"/></tag>
                </tags>
                <lu>
                  <get-case-from pos="1">
                  <lit v="a"/>
                  </get-case-from>
                  <lit-tag v="pr"/>
                </lu>
                <b/>
                <lu>
                  <lit v="el"/>
                  <lit-tag v="det.def"/>
                  <lit-tag v="2"/>
                  <lit-tag v="3"/>
                </lu>
                <b/>
                <lu>
                  <clip pos="1" side="tl" part="lemh"/>
                  <clip pos="1" side="tl" part="a_nom"/>
                  <clip pos="1" side="tl" part="a_gen_sense_mf" link-to="2"/>
                  <clip pos="1" side="tl" part="a_gen_mf"/>
                  <clip pos="1" side="tl" part="a_nbr_sense_sp" link-to="3"/>
                  <clip pos="1" side="tl" part="a_nbr_sp"/>
                  <clip pos="1" side="tl" part="lemq"/>
                </lu>
                <b/>
                <lu>
                  <lit v="de"/>
                  <lit-tag v="pr"/>
                </lu>
                <b/>
                <lu>
                  <lit v="el"/>
                  <lit-tag v="det.def"/>
                  <var n="genere1"/>
                  <var n="nombre1"/>
                </lu>
                <b pos="2"/>
                <lu>
                  <clip pos="3" side="tl" part="lemh"/>
                  <clip pos="3" side="tl" part="a_adj"/>
                  <clip pos="3" side="tl" part="a_gen"/>
                  <clip pos="3" side="tl" part="a_nbr"/>
                  <clip pos="3" side="tl" part="lemq"/>
                </lu>
                <b pos="1"/>
                <lu>
                  <clip pos="2" side="tl" part="lemh"/>
                  <clip pos="2" side="tl" part="a_nom"/>
                  <clip pos="2" side="tl" part="a_gen"/>
                  <clip pos="2" side="tl" part="a_nbr"/>
                  <clip pos="2" side="tl" part="lemq"/>
                </lu>
              </chunk>
            </out>
          </when>
        <!-- Nominatiu indefinit -->
          <otherwise>
              <out>
                <chunk name="nom_prep_det_adj_nom">
                <tags>
                  <tag><lit-tag v="SN"/></tag>
                  <tag><var n="genere_chunk"/></tag>
                  <tag><var n="nombre_chunk"/></tag>
                  <tag><clip pos="1" side="sl" part="a_cas"/></tag>
                 <tag><clip pos="1" side="sl" part="a_def"/></tag>
                </tags>
                <lu>
                  <clip pos="1" side="tl" part="lemh"/>
                  <clip pos="1" side="tl" part="a_nom"/>
                  <clip pos="1" side="tl" part="a_gen_sense_mf" link-to="2"/>
                  <clip pos="1" side="tl" part="a_gen_mf"/>
                  <clip pos="1" side="tl" part="a_nbr_sense_sp" link-to="3"/>
                  <clip pos="1" side="tl" part="a_nbr_sp"/>
                  <clip pos="1" side="tl" part="lemq"/>
                </lu>
                <b/>
                <lu>
                  <lit v="de"/>
                  <lit-tag v="pr"/>
                </lu>
                <b/>
                <lu>
                  <lit v="el"/>
                  <lit-tag v="det.def"/>
                  <var n="genere1"/>
                  <var n="nombre1"/>
                </lu>
                <b pos="2"/>
                <lu>
                  <clip pos="3" side="tl" part="lemh"/>
                  <clip pos="3" side="tl" part="a_adj"/>
                  <clip pos="3" side="tl" part="a_gen"/>
                  <clip pos="3" side="tl" part="a_nbr"/>
                  <clip pos="3" side="tl" part="lemq"/>
                </lu>
                <b pos="1"/>
                <lu>
                  <clip pos="2" side="tl" part="lemh"/>
                  <clip pos="2" side="tl" part="a_nom"/>
                  <clip pos="2" side="tl" part="a_gen"/>
                  <clip pos="2" side="tl" part="a_nbr"/>
                  <clip pos="2" side="tl" part="lemq"/>
                </lu>
              </chunk>
            </out>
          </otherwise>
        </choose>
        <call-macro n="n_gen_nbr"/>
      </action>
    </rule>


    <rule comment="NOM + NOM PROPI GENITIU">
      <pattern>
        <pattern-item n="nom"/>
        <pattern-item n="np_dg"/>
      </pattern>
      <action>
        <call-macro n="f_concord1">
          <with-param pos="1"/>
        </call-macro>
        <!-- Nominatiu definit -->
        <choose>
          <when>
            <test>
              <and>
                <equal>
                  <clip pos="1" side="sl" part="a_def"/>
                  <lit-tag v="def"/>
                </equal>
                <equal>
                  <clip pos="1" side="sl" part="a_cas"/>
                  <lit-tag v="nom"/>
                </equal>
              </and>
            </test>
              <call-macro n="mod_maj">
                <with-param pos="1"/>
              </call-macro>
              <out>
                <chunk name="det_nom_prep_np">
                <tags>
                  <tag><lit-tag v="SN"/></tag>
                  <tag><var n="genere_chunk"/></tag>
                  <tag><var n="nombre_chunk"/></tag>
                  <tag><clip pos="1" side="sl" part="a_cas"/></tag>
                 <tag><clip pos="1" side="sl" part="a_def"/></tag>
                </tags>
                <lu>
                <get-case-from pos="1">
                  <lit v="el"/>
                </get-case-from>
                  <lit-tag v="det.def"/>
                  <lit-tag v="2"/>
                  <lit-tag v="3"/>
                </lu>
                <b/>
                <lu>
                  <clip pos="1" side="tl" part="lemh"/>
                  <clip pos="1" side="tl" part="a_nom"/>
                  <clip pos="1" side="tl" part="a_gen_sense_mf" link-to="2"/>
                  <clip pos="1" side="tl" part="a_gen_mf"/>
                  <clip pos="1" side="tl" part="a_nbr_sense_sp" link-to="3"/>
                  <clip pos="1" side="tl" part="a_nbr_sp"/>
                  <clip pos="1" side="tl" part="lemq"/>
                </lu>
                <b pos="1"/>
                <lu>
                  <lit v="de"/>
                  <lit-tag v="pr"/>
                </lu>
                <b/>
                <lu>
                  <clip pos="2" side="tl" part="lemh"/>
                  <clip pos="2" side="tl" part="a_np"/>
                  <clip pos="2" side="tl" part="a_gen"/>
                  <clip pos="2" side="tl" part="a_nbr"/>
                  <clip pos="2" side="tl" part="lemq"/>
                </lu>
              </chunk>
            </out>
          </when>
        <!-- Datiu indefinit -->
          <when>
            <test>
              <and>
                <equal>
                  <clip pos="1" side="sl" part="a_def"/>
                  <lit-tag v="ind"/>
                </equal>
                <equal>
                  <clip pos="1" side="sl" part="a_cas"/>
                  <lit-tag v="dg"/>
                </equal>
              </and>
            </test>
              <call-macro n="mod_maj">
                <with-param pos="1"/>
              </call-macro>
              <out>
                <chunk name="prep_nom_prep_np">
                <tags>
                  <tag><lit-tag v="SP"/></tag>
                  <tag><var n="genere_chunk"/></tag>
                  <tag><var n="nombre_chunk"/></tag>
                  <tag><clip pos="1" side="sl" part="a_cas"/></tag>
                 <tag><clip pos="1" side="sl" part="a_def"/></tag>
                </tags>
                <lu>
                <get-case-from pos="1">
                  <lit v="a"/>
                </get-case-from>
                  <lit-tag v="pr"/>
                </lu>
                <b/>
                <lu>
                  <clip pos="1" side="tl" part="lemh"/>
                  <clip pos="1" side="tl" part="a_nom"/>
                  <clip pos="1" side="tl" part="a_gen_sense_mf" link-to="2"/>
                  <clip pos="1" side="tl" part="a_gen_mf"/>
                  <clip pos="1" side="tl" part="a_nbr_sense_sp" link-to="3"/>
                  <clip pos="1" side="tl" part="a_nbr_sp"/>
                  <clip pos="1" side="tl" part="lemq"/>
                </lu>
                <b pos="1"/>
                <lu>
                  <lit v="de"/>
                  <lit-tag v="pr"/>
                </lu>
                <b/>
                <lu>
                  <clip pos="2" side="tl" part="lemh"/>
                  <clip pos="2" side="tl" part="a_np"/>
                  <clip pos="2" side="tl" part="a_gen"/>
                  <clip pos="2" side="tl" part="a_nbr"/>
                  <clip pos="2" side="tl" part="lemq"/>
                </lu>
              </chunk>
            </out>
          </when>
        <!-- Datiu definit -->
          <when>
            <test>
              <and>
                <equal>
                  <clip pos="1" side="sl" part="a_def"/>
                  <lit-tag v="def"/>
                </equal>
                <equal>
                  <clip pos="1" side="sl" part="a_cas"/>
                  <lit-tag v="dg"/>
                </equal>
              </and>
            </test>
              <call-macro n="mod_maj">
                <with-param pos="1"/>
              </call-macro>
              <out>
                <chunk name="prep_det_nom_prep_np">
                <tags>
                  <tag><lit-tag v="SP"/></tag>
                  <tag><var n="genere_chunk"/></tag>
                  <tag><var n="nombre_chunk"/></tag>
                  <tag><clip pos="1" side="sl" part="a_cas"/></tag>
                 <tag><clip pos="1" side="sl" part="a_def"/></tag>
                </tags>
                <lu>
                <get-case-from pos="1">
                  <lit v="a"/>
                </get-case-from>
                  <lit-tag v="pr"/>
                </lu>
                <b/>
                <lu>
                  <lit v="el"/>
                  <lit-tag v="det.def"/>
                  <lit-tag v="2"/>
                  <lit-tag v="3"/>
                </lu>
                <b/>
                <lu>
                  <clip pos="1" side="tl" part="lemh"/>
                  <clip pos="1" side="tl" part="a_nom"/>
                  <clip pos="1" side="tl" part="a_gen_sense_mf" link-to="2"/>
                  <clip pos="1" side="tl" part="a_gen_mf"/>
                  <clip pos="1" side="tl" part="a_nbr_sense_sp" link-to="3"/>
                  <clip pos="1" side="tl" part="a_nbr_sp"/>
                  <clip pos="1" side="tl" part="lemq"/>
                </lu>
                <b pos="1"/>
                <lu>
                  <lit v="de"/>
                  <lit-tag v="pr"/>
                </lu>
                <b/>
                <lu>
                  <clip pos="2" side="tl" part="lemh"/>
                  <clip pos="2" side="tl" part="a_np"/>
                  <clip pos="2" side="tl" part="a_gen"/>
                  <clip pos="2" side="tl" part="a_nbr"/>
                  <clip pos="2" side="tl" part="lemq"/>
                </lu>
              </chunk>
            </out>
          </when>
        <!-- Nominatiu indefinit -->
          <otherwise>
              <out>
                <chunk name="nom_prep_np">
                <tags>
                  <tag><lit-tag v="SN"/></tag>
                  <tag><var n="genere_chunk"/></tag>
                  <tag><var n="nombre_chunk"/></tag>
                  <tag><clip pos="1" side="sl" part="a_cas"/></tag>
                 <tag><clip pos="1" side="sl" part="a_def"/></tag>
                </tags>
                <lu>
                  <clip pos="1" side="tl" part="lemh"/>
                  <clip pos="1" side="tl" part="a_nom"/>
                  <clip pos="1" side="tl" part="a_gen_sense_mf" link-to="2"/>
                  <clip pos="1" side="tl" part="a_gen_mf"/>
                  <clip pos="1" side="tl" part="a_nbr_sense_sp" link-to="3"/>
                  <clip pos="1" side="tl" part="a_nbr_sp"/>
                  <clip pos="1" side="tl" part="lemq"/>
                </lu>
                <b pos="1"/>
                <lu>
                  <lit v="de"/>
                  <lit-tag v="pr"/>
                </lu>
                <b/>
                <lu>
                  <clip pos="2" side="tl" part="lemh"/>
                  <clip pos="2" side="tl" part="a_np"/>
                  <clip pos="2" side="tl" part="a_gen"/>
                  <clip pos="2" side="tl" part="a_nbr"/>
                  <clip pos="2" side="tl" part="lemq"/>
                </lu>
              </chunk>
            </out>
          </otherwise>
        </choose>
        <call-macro n="n_gen_nbr"/>
      </action>
    </rule>

    <rule comment="NOM + lui + NOM PROPI">
      <pattern>
        <pattern-item n="nom"/>
        <pattern-item n="adj_lui"/>
        <pattern-item n="np"/>
      </pattern>
      <action>
        <call-macro n="f_concord1">
          <with-param pos="1"/>
        </call-macro>
        <!-- Nominatiu definit -->
        <choose>
          <when>
            <test>
              <and>
                <equal>
                  <clip pos="1" side="sl" part="a_def"/>
                  <lit-tag v="def"/>
                </equal>
                <equal>
                  <clip pos="1" side="sl" part="a_cas"/>
                  <lit-tag v="nom"/>
                </equal>
              </and>
            </test>
              <call-macro n="mod_maj">
                <with-param pos="1"/>
              </call-macro>
              <out>
                <chunk name="det_nom_prep_np">
                <tags>
                  <tag><lit-tag v="SN"/></tag>
                  <tag><var n="genere_chunk"/></tag>
                  <tag><var n="nombre_chunk"/></tag>
                  <tag><clip pos="1" side="sl" part="a_cas"/></tag>
                 <tag><clip pos="1" side="sl" part="a_def"/></tag>
                </tags>
                <lu>
                <get-case-from pos="1">
                  <lit v="el"/>
                </get-case-from>
                  <lit-tag v="det.def"/>
                  <lit-tag v="2"/>
                  <lit-tag v="3"/>
                </lu>
                <b/>
                <lu>
                  <clip pos="1" side="tl" part="lemh"/>
                  <clip pos="1" side="tl" part="a_nom"/>
                  <clip pos="1" side="tl" part="a_gen_sense_mf" link-to="2"/>
                  <clip pos="1" side="tl" part="a_gen_mf"/>
                  <clip pos="1" side="tl" part="a_nbr_sense_sp" link-to="3"/>
                  <clip pos="1" side="tl" part="a_nbr_sp"/>
                  <clip pos="1" side="tl" part="lemq"/>
                </lu>
                <b pos="1"/>
                <lu>
                  <lit v="de"/>
                  <lit-tag v="pr"/>
                </lu>
                <b pos="2"/>
                <lu>
                  <clip pos="3" side="tl" part="lemh"/>
                  <clip pos="3" side="tl" part="a_np"/>
                  <clip pos="3" side="tl" part="a_gen"/>
                  <clip pos="3" side="tl" part="a_nbr"/>
                  <clip pos="3" side="tl" part="lemq"/>
                </lu>
              </chunk>
            </out>
          </when>
        <!-- Datiu indefinit -->
          <when>
            <test>
              <and>
                <equal>
                  <clip pos="1" side="sl" part="a_def"/>
                  <lit-tag v="ind"/>
                </equal>
                <equal>
                  <clip pos="1" side="sl" part="a_cas"/>
                  <lit-tag v="dg"/>
                </equal>
              </and>
            </test>
              <call-macro n="mod_maj">
                <with-param pos="1"/>
              </call-macro>
              <out>
                <chunk name="prep_nom_prep_np">
                <tags>
                  <tag><lit-tag v="SP"/></tag>
                  <tag><var n="genere_chunk"/></tag>
                  <tag><var n="nombre_chunk"/></tag>
                  <tag><clip pos="1" side="sl" part="a_cas"/></tag>
                 <tag><clip pos="1" side="sl" part="a_def"/></tag>
                </tags>
                <lu>
                <get-case-from pos="1">
                  <lit v="a"/>
                </get-case-from>
                  <lit-tag v="pr"/>
                </lu>
                <b/>
                <lu>
                  <clip pos="1" side="tl" part="lemh"/>
                  <clip pos="1" side="tl" part="a_nom"/>
                  <clip pos="1" side="tl" part="a_gen_sense_mf" link-to="2"/>
                  <clip pos="1" side="tl" part="a_gen_mf"/>
                  <clip pos="1" side="tl" part="a_nbr_sense_sp" link-to="3"/>
                  <clip pos="1" side="tl" part="a_nbr_sp"/>
                  <clip pos="1" side="tl" part="lemq"/>
                </lu>
                <b pos="1"/>
                <lu>
                  <lit v="de"/>
                  <lit-tag v="pr"/>
                </lu>
                <b pos="2"/>
                <lu>
                  <clip pos="3" side="tl" part="lemh"/>
                  <clip pos="3" side="tl" part="a_np"/>
                  <clip pos="3" side="tl" part="a_gen"/>
                  <clip pos="3" side="tl" part="a_nbr"/>
                  <clip pos="3" side="tl" part="lemq"/>
                </lu>
              </chunk>
            </out>
          </when>
        <!-- Datiu definit -->
          <when>
            <test>
              <and>
                <equal>
                  <clip pos="1" side="sl" part="a_def"/>
                  <lit-tag v="def"/>
                </equal>
                <equal>
                  <clip pos="1" side="sl" part="a_cas"/>
                  <lit-tag v="dg"/>
                </equal>
              </and>
            </test>
              <call-macro n="mod_maj">
                <with-param pos="1"/>
              </call-macro>
              <out>
                <chunk name="prep_det_nom_prep_np">
                <tags>
                  <tag><lit-tag v="SP"/></tag>
                  <tag><var n="genere_chunk"/></tag>
                  <tag><var n="nombre_chunk"/></tag>
                  <tag><clip pos="1" side="sl" part="a_cas"/></tag>
                 <tag><clip pos="1" side="sl" part="a_def"/></tag>
                </tags>
                <lu>
                <get-case-from pos="1">
                  <lit v="a"/>
                </get-case-from>
                  <lit-tag v="pr"/>
                </lu>
                <b/>
                <lu>
                  <lit v="el"/>
                  <lit-tag v="det.def"/>
                  <lit-tag v="2"/>
                  <lit-tag v="3"/>
                </lu>
                <b/>
                <lu>
                  <clip pos="1" side="tl" part="lemh"/>
                  <clip pos="1" side="tl" part="a_nom"/>
                  <clip pos="1" side="tl" part="a_gen_sense_mf" link-to="2"/>
                  <clip pos="1" side="tl" part="a_gen_mf"/>
                  <clip pos="1" side="tl" part="a_nbr_sense_sp" link-to="3"/>
                  <clip pos="1" side="tl" part="a_nbr_sp"/>
                  <clip pos="1" side="tl" part="lemq"/>
                </lu>
                <b pos="1"/>
                <lu>
                  <lit v="de"/>
                  <lit-tag v="pr"/>
                </lu>
                <b pos="2"/>
                <lu>
                  <clip pos="3" side="tl" part="lemh"/>
                  <clip pos="3" side="tl" part="a_np"/>
                  <clip pos="3" side="tl" part="a_gen"/>
                  <clip pos="3" side="tl" part="a_nbr"/>
                  <clip pos="3" side="tl" part="lemq"/>
                </lu>
              </chunk>
            </out>
          </when>
        <!-- Nominatiu indefinit -->
          <otherwise>
              <out>
                <chunk name="nom_prep_np">
                <tags>
                  <tag><lit-tag v="SN"/></tag>
                  <tag><var n="genere_chunk"/></tag>
                  <tag><var n="nombre_chunk"/></tag>
                  <tag><clip pos="1" side="sl" part="a_cas"/></tag>
                 <tag><clip pos="1" side="sl" part="a_def"/></tag>
                </tags>
                <lu>
                  <clip pos="1" side="tl" part="lemh"/>
                  <clip pos="1" side="tl" part="a_nom"/>
                  <clip pos="1" side="tl" part="a_gen_sense_mf" link-to="2"/>
                  <clip pos="1" side="tl" part="a_gen_mf"/>
                  <clip pos="1" side="tl" part="a_nbr_sense_sp" link-to="3"/>
                  <clip pos="1" side="tl" part="a_nbr_sp"/>
                  <clip pos="1" side="tl" part="lemq"/>
                </lu>
                <b pos="1"/>
                <lu>
                  <lit v="de"/>
                  <lit-tag v="pr"/>
                </lu>
                <b pos="2"/>
                <lu>
                  <clip pos="3" side="tl" part="lemh"/>
                  <clip pos="3" side="tl" part="a_np"/>
                  <clip pos="3" side="tl" part="a_gen"/>
                  <clip pos="3" side="tl" part="a_nbr"/>
                  <clip pos="3" side="tl" part="lemq"/>
                </lu>
              </chunk>
            </out>
          </otherwise>
        </choose>
        <call-macro n="n_gen_nbr"/>
      </action>
    </rule>

    <rule comment="NOM + ADJECTIU + al + NOM PROPI GENITIU">
      <pattern>
        <pattern-item n="nom"/>
        <pattern-item n="adjnorm"/>
        <pattern-item n="det_al"/>
        <pattern-item n="np_dg"/>
      </pattern>
      <action>
        <call-macro n="f_concord2">
          <with-param pos="1"/>
          <with-param pos="2"/>
        </call-macro>
        <!-- Nominatiu definit -->
        <choose>
          <when>
            <test>
              <and>
                <equal>
                  <clip pos="1" side="sl" part="a_def"/>
                  <lit-tag v="def"/>
                </equal>
                <equal>
                  <clip pos="1" side="sl" part="a_cas"/>
                  <lit-tag v="nom"/>
                </equal>
              </and>
            </test>
              <call-macro n="mod_maj">
                <with-param pos="1"/>
              </call-macro>
              <out>
                <chunk name="det_nom_prep_np">
                <tags>
                  <tag><lit-tag v="SN"/></tag>
                  <tag><var n="genere_chunk"/></tag>
                  <tag><var n="nombre_chunk"/></tag>
                  <tag><clip pos="1" side="sl" part="a_cas"/></tag>
                 <tag><clip pos="1" side="sl" part="a_def"/></tag>
                </tags>
                <lu>
                <get-case-from pos="1">
                  <lit v="el"/>
                </get-case-from>
                  <lit-tag v="det.def"/>
                  <lit-tag v="2"/>
                  <lit-tag v="3"/>
                </lu>
                <b/>
                <lu>
                  <clip pos="1" side="tl" part="lemh"/>
                  <clip pos="1" side="tl" part="a_nom"/>
                  <clip pos="1" side="tl" part="a_gen_sense_mf" link-to="2"/>
                  <clip pos="1" side="tl" part="a_gen_mf"/>
                  <clip pos="1" side="tl" part="a_nbr_sense_sp" link-to="3"/>
                  <clip pos="1" side="tl" part="a_nbr_sp"/>
                  <clip pos="1" side="tl" part="lemq"/>
                </lu>
                <b pos="1"/>
                <lu>
                  <clip pos="2" side="tl" part="lemh"/>
                  <clip pos="2" side="tl" part="a_adj"/>
                  <clip pos="2" side="tl" part="a_gen_sense_mf" link-to="2"/>
                  <clip pos="2" side="tl" part="a_gen_mf"/>
                  <clip pos="2" side="tl" part="a_nbr_sense_sp" link-to="3"/>
                  <clip pos="2" side="tl" part="a_nbr_sp"/>
                  <clip pos="2" side="tl" part="lemq"/>
                </lu>
                <b pos="2"/>
                <lu>
                  <lit v="de"/>
                  <lit-tag v="pr"/>
                </lu>
                <b pos="3"/>
                <lu>
                  <clip pos="4" side="tl" part="lemh"/>
                  <clip pos="4" side="tl" part="a_np"/>
                  <clip pos="4" side="tl" part="a_gen"/>
                  <clip pos="4" side="tl" part="a_nbr"/>
                  <clip pos="4" side="tl" part="lemq"/>
                </lu>
              </chunk>
            </out>
          </when>
        <!-- Datiu indefinit -->
          <when>
            <test>
              <and>
                <equal>
                  <clip pos="1" side="sl" part="a_def"/>
                  <lit-tag v="ind"/>
                </equal>
                <equal>
                  <clip pos="1" side="sl" part="a_cas"/>
                  <lit-tag v="dg"/>
                </equal>
              </and>
            </test>
              <call-macro n="mod_maj">
                <with-param pos="1"/>
              </call-macro>
              <out>
                <chunk name="prep_nom_prep_np">
                <tags>
                  <tag><lit-tag v="SP"/></tag>
                  <tag><var n="genere_chunk"/></tag>
                  <tag><var n="nombre_chunk"/></tag>
                  <tag><clip pos="1" side="sl" part="a_cas"/></tag>
                 <tag><clip pos="1" side="sl" part="a_def"/></tag>
                </tags>
                <lu>
                <get-case-from pos="1">
                  <lit v="a"/>
                </get-case-from>
                  <lit-tag v="pr"/>
                </lu>
                <b/>
                <lu>
                  <clip pos="1" side="tl" part="lemh"/>
                  <clip pos="1" side="tl" part="a_nom"/>
                  <clip pos="1" side="tl" part="a_gen_sense_mf" link-to="2"/>
                  <clip pos="1" side="tl" part="a_gen_mf"/>
                  <clip pos="1" side="tl" part="a_nbr_sense_sp" link-to="3"/>
                  <clip pos="1" side="tl" part="a_nbr_sp"/>
                  <clip pos="1" side="tl" part="lemq"/>
                </lu>
                <b pos="1"/>
                <lu>
                  <clip pos="2" side="tl" part="lemh"/>
                  <clip pos="2" side="tl" part="a_adj"/>
                  <clip pos="2" side="tl" part="a_gen_sense_mf" link-to="2"/>
                  <clip pos="2" side="tl" part="a_gen_mf"/>
                  <clip pos="2" side="tl" part="a_nbr_sense_sp" link-to="3"/>
                  <clip pos="2" side="tl" part="a_nbr_sp"/>
                  <clip pos="2" side="tl" part="lemq"/>
                </lu>
                <b pos="2"/>
                <lu>
                  <lit v="de"/>
                  <lit-tag v="pr"/>
                </lu>
                <b pos="3"/>
                <lu>
                  <clip pos="4" side="tl" part="lemh"/>
                  <clip pos="4" side="tl" part="a_np"/>
                  <clip pos="4" side="tl" part="a_gen"/>
                  <clip pos="4" side="tl" part="a_nbr"/>
                  <clip pos="4" side="tl" part="lemq"/>
                </lu>
              </chunk>
            </out>
          </when>
        <!-- Datiu definit -->
          <when>
            <test>
              <and>
                <equal>
                  <clip pos="1" side="sl" part="a_def"/>
                  <lit-tag v="def"/>
                </equal>
                <equal>
                  <clip pos="1" side="sl" part="a_cas"/>
                  <lit-tag v="dg"/>
                </equal>
              </and>
            </test>
              <call-macro n="mod_maj">
                <with-param pos="1"/>
              </call-macro>
              <out>
                <chunk name="prep_det_nom_prep_np">
                <tags>
                  <tag><lit-tag v="SP"/></tag>
                  <tag><var n="genere_chunk"/></tag>
                  <tag><var n="nombre_chunk"/></tag>
                  <tag><clip pos="1" side="sl" part="a_cas"/></tag>
                 <tag><clip pos="1" side="sl" part="a_def"/></tag>
                </tags>
                <lu>
                <get-case-from pos="1">
                  <lit v="a"/>
                </get-case-from>
                  <lit-tag v="pr"/>
                </lu>
                <b/>
                <lu>
                  <lit v="el"/>
                  <lit-tag v="det.def"/>
                  <lit-tag v="2"/>
                  <lit-tag v="3"/>
                </lu>
                <b/>
                <lu>
                  <clip pos="1" side="tl" part="lemh"/>
                  <clip pos="1" side="tl" part="a_nom"/>
                  <clip pos="1" side="tl" part="a_gen_sense_mf" link-to="2"/>
                  <clip pos="1" side="tl" part="a_gen_mf"/>
                  <clip pos="1" side="tl" part="a_nbr_sense_sp" link-to="3"/>
                  <clip pos="1" side="tl" part="a_nbr_sp"/>
                  <clip pos="1" side="tl" part="lemq"/>
                </lu>
                <b pos="1"/>
                <lu>
                  <clip pos="2" side="tl" part="lemh"/>
                  <clip pos="2" side="tl" part="a_adj"/>
                  <clip pos="2" side="tl" part="a_gen_sense_mf" link-to="2"/>
                  <clip pos="2" side="tl" part="a_gen_mf"/>
                  <clip pos="2" side="tl" part="a_nbr_sense_sp" link-to="3"/>
                  <clip pos="2" side="tl" part="a_nbr_sp"/>
                  <clip pos="2" side="tl" part="lemq"/>
                </lu>
                <b pos="2"/>
                <lu>
                  <lit v="de"/>
                  <lit-tag v="pr"/>
                </lu>
                <b pos="3"/>
                <lu>
                  <clip pos="4" side="tl" part="lemh"/>
                  <clip pos="4" side="tl" part="a_np"/>
                  <clip pos="4" side="tl" part="a_gen"/>
                  <clip pos="4" side="tl" part="a_nbr"/>
                  <clip pos="4" side="tl" part="lemq"/>
                </lu>
              </chunk>
            </out>
          </when>
        <!-- Nominatiu indefinit -->
          <otherwise>
              <out>
                <chunk name="nom_prep_np">
                <tags>
                  <tag><lit-tag v="SN"/></tag>
                  <tag><var n="genere_chunk"/></tag>
                  <tag><var n="nombre_chunk"/></tag>
                  <tag><clip pos="1" side="sl" part="a_cas"/></tag>
                 <tag><clip pos="1" side="sl" part="a_def"/></tag>
                </tags>
                <lu>
                  <clip pos="1" side="tl" part="lemh"/>
                  <clip pos="1" side="tl" part="a_nom"/>
                  <clip pos="1" side="tl" part="a_gen_sense_mf" link-to="2"/>
                  <clip pos="1" side="tl" part="a_gen_mf"/>
                  <clip pos="1" side="tl" part="a_nbr_sense_sp" link-to="3"/>
                  <clip pos="1" side="tl" part="a_nbr_sp"/>
                  <clip pos="1" side="tl" part="lemq"/>
                </lu>
                <b pos="1"/>
                <lu>
                  <clip pos="2" side="tl" part="lemh"/>
                  <clip pos="2" side="tl" part="a_adj"/>
                  <clip pos="2" side="tl" part="a_gen_sense_mf" link-to="2"/>
                  <clip pos="2" side="tl" part="a_gen_mf"/>
                  <clip pos="2" side="tl" part="a_nbr_sense_sp" link-to="3"/>
                  <clip pos="2" side="tl" part="a_nbr_sp"/>
                  <clip pos="2" side="tl" part="lemq"/>
                </lu>
                <b pos="2"/>
                <lu>
                  <lit v="de"/>
                  <lit-tag v="pr"/>
                </lu>
                <b pos="3"/>
                <lu>
                  <clip pos="4" side="tl" part="lemh"/>
                  <clip pos="4" side="tl" part="a_np"/>
                  <clip pos="4" side="tl" part="a_gen"/>
                  <clip pos="4" side="tl" part="a_nbr"/>
                  <clip pos="4" side="tl" part="lemq"/>
                </lu>
              </chunk>
            </out>
          </otherwise>
        </choose>
        <call-macro n="n_gen_nbr"/>
      </action>
    </rule>

    <rule comment="NOM + ADJECTIU + al + lui + NOM PROPI">
      <pattern>
        <pattern-item n="nom"/>
        <pattern-item n="adjnorm"/>
        <pattern-item n="det_al"/>
        <pattern-item n="adj_lui"/>
        <pattern-item n="np"/>
      </pattern>
      <action>
        <call-macro n="f_concord2">
          <with-param pos="1"/>
          <with-param pos="2"/>
        </call-macro>
        <!-- Nominatiu definit -->
        <choose>
          <when>
            <test>
              <and>
                <equal>
                  <clip pos="1" side="sl" part="a_def"/>
                  <lit-tag v="def"/>
                </equal>
                <equal>
                  <clip pos="1" side="sl" part="a_cas"/>
                  <lit-tag v="nom"/>
                </equal>
              </and>
            </test>
              <call-macro n="mod_maj">
                <with-param pos="1"/>
              </call-macro>
              <out>
                <chunk name="det_nom_prep_np">
                <tags>
                  <tag><lit-tag v="SN"/></tag>
                  <tag><var n="genere_chunk"/></tag>
                  <tag><var n="nombre_chunk"/></tag>
                  <tag><clip pos="1" side="sl" part="a_cas"/></tag>
                 <tag><clip pos="1" side="sl" part="a_def"/></tag>
                </tags>
                <lu>
                <get-case-from pos="1">
                  <lit v="el"/>
                </get-case-from>
                  <lit-tag v="det.def"/>
                  <lit-tag v="2"/>
                  <lit-tag v="3"/>
                </lu>
                <b/>
                <lu>
                  <clip pos="1" side="tl" part="lemh"/>
                  <clip pos="1" side="tl" part="a_nom"/>
                  <clip pos="1" side="tl" part="a_gen_sense_mf" link-to="2"/>
                  <clip pos="1" side="tl" part="a_gen_mf"/>
                  <clip pos="1" side="tl" part="a_nbr_sense_sp" link-to="3"/>
                  <clip pos="1" side="tl" part="a_nbr_sp"/>
                  <clip pos="1" side="tl" part="lemq"/>
                </lu>
                <b pos="1"/>
                <lu>
                  <clip pos="2" side="tl" part="lemh"/>
                  <clip pos="2" side="tl" part="a_adj"/>
                  <clip pos="2" side="tl" part="a_gen_sense_mf" link-to="2"/>
                  <clip pos="2" side="tl" part="a_gen_mf"/>
                  <clip pos="2" side="tl" part="a_nbr_sense_sp" link-to="3"/>
                  <clip pos="2" side="tl" part="a_nbr_sp"/>
                  <clip pos="2" side="tl" part="lemq"/>
                </lu>
                <b pos="2"/>
                <lu>
                  <lit v="de"/>
                  <lit-tag v="pr"/>
                </lu>
                <b pos="4"/>
                <lu>
                  <clip pos="5" side="tl" part="lemh"/>
                  <clip pos="5" side="tl" part="a_np"/>
                  <clip pos="5" side="tl" part="a_gen"/>
                  <clip pos="5" side="tl" part="a_nbr"/>
                  <clip pos="5" side="tl" part="lemq"/>
                </lu>
              </chunk>
            </out>
          </when>
        <!-- Datiu indefinit -->
          <when>
            <test>
              <and>
                <equal>
                  <clip pos="1" side="sl" part="a_def"/>
                  <lit-tag v="ind"/>
                </equal>
                <equal>
                  <clip pos="1" side="sl" part="a_cas"/>
                  <lit-tag v="dg"/>
                </equal>
              </and>
            </test>
              <call-macro n="mod_maj">
                <with-param pos="1"/>
              </call-macro>
              <out>
                <chunk name="prep_nom_prep_np">
                <tags>
                  <tag><lit-tag v="SP"/></tag>
                  <tag><var n="genere_chunk"/></tag>
                  <tag><var n="nombre_chunk"/></tag>
                  <tag><clip pos="1" side="sl" part="a_cas"/></tag>
                 <tag><clip pos="1" side="sl" part="a_def"/></tag>
                </tags>
                <lu>
                <get-case-from pos="1">
                  <lit v="a"/>
                </get-case-from>
                  <lit-tag v="pr"/>
                </lu>
                <b/>
                <lu>
                  <clip pos="1" side="tl" part="lemh"/>
                  <clip pos="1" side="tl" part="a_nom"/>
                  <clip pos="1" side="tl" part="a_gen_sense_mf" link-to="2"/>
                  <clip pos="1" side="tl" part="a_gen_mf"/>
                  <clip pos="1" side="tl" part="a_nbr_sense_sp" link-to="3"/>
                  <clip pos="1" side="tl" part="a_nbr_sp"/>
                  <clip pos="1" side="tl" part="lemq"/>
                </lu>
                <b pos="1"/>
                <lu>
                  <clip pos="2" side="tl" part="lemh"/>
                  <clip pos="2" side="tl" part="a_adj"/>
                  <clip pos="2" side="tl" part="a_gen_sense_mf" link-to="2"/>
                  <clip pos="2" side="tl" part="a_gen_mf"/>
                  <clip pos="2" side="tl" part="a_nbr_sense_sp" link-to="3"/>
                  <clip pos="2" side="tl" part="a_nbr_sp"/>
                  <clip pos="2" side="tl" part="lemq"/>
                </lu>
                <b pos="2"/>
                <lu>
                  <lit v="de"/>
                  <lit-tag v="pr"/>
                </lu>
                <b pos="4"/>
                <lu>
                  <clip pos="5" side="tl" part="lemh"/>
                  <clip pos="5" side="tl" part="a_np"/>
                  <clip pos="5" side="tl" part="a_gen"/>
                  <clip pos="5" side="tl" part="a_nbr"/>
                  <clip pos="5" side="tl" part="lemq"/>
                </lu>
              </chunk>
            </out>
          </when>
        <!-- Datiu definit -->
          <when>
            <test>
              <and>
                <equal>
                  <clip pos="1" side="sl" part="a_def"/>
                  <lit-tag v="def"/>
                </equal>
                <equal>
                  <clip pos="1" side="sl" part="a_cas"/>
                  <lit-tag v="dg"/>
                </equal>
              </and>
            </test>
              <call-macro n="mod_maj">
                <with-param pos="1"/>
              </call-macro>
              <out>
                <chunk name="prep_det_nom_prep_np">
                <tags>
                  <tag><lit-tag v="SP"/></tag>
                  <tag><var n="genere_chunk"/></tag>
                  <tag><var n="nombre_chunk"/></tag>
                  <tag><clip pos="1" side="sl" part="a_cas"/></tag>
                 <tag><clip pos="1" side="sl" part="a_def"/></tag>
                </tags>
                <lu>
                <get-case-from pos="1">
                  <lit v="a"/>
                </get-case-from>
                  <lit-tag v="pr"/>
                </lu>
                <b/>
                <lu>
                  <lit v="el"/>
                  <lit-tag v="det.def"/>
                  <lit-tag v="2"/>
                  <lit-tag v="3"/>
                </lu>
                <b/>
                <lu>
                  <clip pos="1" side="tl" part="lemh"/>
                  <clip pos="1" side="tl" part="a_nom"/>
                  <clip pos="1" side="tl" part="a_gen_sense_mf" link-to="2"/>
                  <clip pos="1" side="tl" part="a_gen_mf"/>
                  <clip pos="1" side="tl" part="a_nbr_sense_sp" link-to="3"/>
                  <clip pos="1" side="tl" part="a_nbr_sp"/>
                  <clip pos="1" side="tl" part="lemq"/>
                </lu>
                <b pos="1"/>
                <lu>
                  <clip pos="2" side="tl" part="lemh"/>
                  <clip pos="2" side="tl" part="a_adj"/>
                  <clip pos="2" side="tl" part="a_gen_sense_mf" link-to="2"/>
                  <clip pos="2" side="tl" part="a_gen_mf"/>
                  <clip pos="2" side="tl" part="a_nbr_sense_sp" link-to="3"/>
                  <clip pos="2" side="tl" part="a_nbr_sp"/>
                  <clip pos="2" side="tl" part="lemq"/>
                </lu>
                <b pos="2"/>
                <lu>
                  <lit v="de"/>
                  <lit-tag v="pr"/>
                </lu>
                <b pos="4"/>
                <lu>
                  <clip pos="5" side="tl" part="lemh"/>
                  <clip pos="5" side="tl" part="a_np"/>
                  <clip pos="5" side="tl" part="a_gen"/>
                  <clip pos="5" side="tl" part="a_nbr"/>
                  <clip pos="5" side="tl" part="lemq"/>
                </lu>
              </chunk>
            </out>
          </when>
        <!-- Nominatiu indefinit -->
          <otherwise>
              <out>
                <chunk name="nom_prep_np">
                <tags>
                  <tag><lit-tag v="SN"/></tag>
                  <tag><var n="genere_chunk"/></tag>
                  <tag><var n="nombre_chunk"/></tag>
                  <tag><clip pos="1" side="sl" part="a_cas"/></tag>
                 <tag><clip pos="1" side="sl" part="a_def"/></tag>
                </tags>
                <lu>
                  <clip pos="1" side="tl" part="lemh"/>
                  <clip pos="1" side="tl" part="a_nom"/>
                  <clip pos="1" side="tl" part="a_gen_sense_mf" link-to="2"/>
                  <clip pos="1" side="tl" part="a_gen_mf"/>
                  <clip pos="1" side="tl" part="a_nbr_sense_sp" link-to="3"/>
                  <clip pos="1" side="tl" part="a_nbr_sp"/>
                  <clip pos="1" side="tl" part="lemq"/>
                </lu>
                <b pos="1"/>
                <lu>
                  <clip pos="2" side="tl" part="lemh"/>
                  <clip pos="2" side="tl" part="a_adj"/>
                  <clip pos="2" side="tl" part="a_gen_sense_mf" link-to="2"/>
                  <clip pos="2" side="tl" part="a_gen_mf"/>
                  <clip pos="2" side="tl" part="a_nbr_sense_sp" link-to="3"/>
                  <clip pos="2" side="tl" part="a_nbr_sp"/>
                  <clip pos="2" side="tl" part="lemq"/>
                </lu>
                <b pos="2"/>
                <lu>
                  <lit v="de"/>
                  <lit-tag v="pr"/>
                </lu>
                <b pos="4"/>
                <lu>
                  <clip pos="5" side="tl" part="lemh"/>
                  <clip pos="5" side="tl" part="a_np"/>
                  <clip pos="5" side="tl" part="a_gen"/>
                  <clip pos="5" side="tl" part="a_nbr"/>
                  <clip pos="5" side="tl" part="lemq"/>
                </lu>
              </chunk>
            </out>
          </otherwise>
        </choose>
        <call-macro n="n_gen_nbr"/>
      </action>
    </rule>


    <rule comment="cel + NUMERAL + NOM">
      <pattern>
        <pattern-item n="det_cel"/>
        <pattern-item n="num"/>
        <pattern-item n="nom"/>
      </pattern>
      <action>
        <call-macro n="f_concord3">
          <with-param pos="3"/>
          <with-param pos="2"/>
          <with-param pos="1"/>
        </call-macro>
        <choose>
          <when>
            <test>
              <equal>
                <clip pos="1" side="sl" part="a_case"/>
                <lit-tag v="dg"/>
              </equal>
            </test>
              <call-macro n="mod_maj">
                <with-param pos="1"/>
              </call-macro>
              <out>
                <chunk name="prep_det_num_nom">
                <tags>
                  <tag><lit-tag v="SP"/></tag>
                  <tag><var n="genere_chunk"/></tag>
                  <tag><var n="nombre_chunk"/></tag>
                  <tag><clip pos="1" side="sl" part="a_cas"/></tag>
                  <tag><clip pos="1" side="sl" part="a_def"/></tag>
                </tags>
                <lu>
                <get-case-from pos="1">
                  <lit v="a"/>
                </get-case-from>
                  <lit-tag v="pr"/>
                </lu>
                <b/>
                <lu>
                  <clip pos="1" side="tl" part="lemh"/>
                  <clip pos="1" side="tl" part="a_det"/>
                  <clip pos="1" side="tl" part="a_gen_sense_mf" link-to="2"/>
                  <clip pos="1" side="tl" part="a_gen_mf"/>
                  <clip pos="1" side="tl" part="a_nbr_sense_sp" link-to="3"/>
                  <clip pos="1" side="tl" part="a_nbr_sp"/>
                  <clip pos="1" side="tl" part="lemq"/>
                </lu>
                <b pos="1"/>
                <lu>
                  <clip pos="2" side="tl" part="lemh"/>
                  <clip pos="2" side="tl" part="a_num"/>
                  <clip pos="2" side="tl" part="a_gen_sense_mf" link-to="2"/>
                  <clip pos="2" side="tl" part="a_gen_mf"/>
                  <clip pos="2" side="tl" part="a_nbr_sense_sp" link-to="3"/>
                  <clip pos="2" side="tl" part="a_nbr_sp"/>
                  <clip pos="2" side="tl" part="lemq"/>
                </lu>
                <b pos="2"/>
                <lu>
                  <clip pos="3" side="tl" part="lemh"/>
                  <clip pos="3" side="tl" part="a_nom"/>
                  <clip pos="3" side="tl" part="a_gen_sense_mf" link-to="2"/>
                  <clip pos="3" side="tl" part="a_gen_mf"/>
                  <clip pos="3" side="tl" part="a_nbr_sense_sp" link-to="3"/>
                  <clip pos="3" side="tl" part="a_nbr_sp"/>
                  <clip pos="3" side="tl" part="lemq"/>
                </lu>
              </chunk>
            </out>
          </when>
          <otherwise>
            <out>
            <chunk name="det_num_nom">
            <tags>
              <tag><lit-tag v="SN"/></tag>
              <tag><var n="genere_chunk"/></tag>
              <tag><var n="nombre_chunk"/></tag>
              <tag><clip pos="1" side="sl" part="a_cas"/></tag>
              <tag><clip pos="1" side="sl" part="a_def"/></tag>
            </tags>
            <lu>
              <clip pos="1" side="tl" part="lemh"/>
              <clip pos="1" side="tl" part="a_det"/>
              <clip pos="1" side="tl" part="a_gen_sense_mf" link-to="2"/>
              <clip pos="1" side="tl" part="a_gen_mf"/>
              <clip pos="1" side="tl" part="a_nbr_sense_sp" link-to="3"/>
              <clip pos="1" side="tl" part="a_nbr_sp"/>
              <clip pos="1" side="tl" part="lemq"/>
            </lu>
            <b pos="1"/>
            <lu>
              <clip pos="2" side="tl" part="lemh"/>
              <clip pos="2" side="tl" part="a_num"/>
              <clip pos="2" side="tl" part="a_gen_sense_mf" link-to="2"/>
              <clip pos="2" side="tl" part="a_gen_mf"/>
              <clip pos="2" side="tl" part="a_nbr_sense_sp" link-to="3"/>
              <clip pos="2" side="tl" part="a_nbr_sp"/>
              <clip pos="2" side="tl" part="lemq"/>
            </lu>
            <b pos="2"/>
            <lu>
              <clip pos="3" side="tl" part="lemh"/>
              <clip pos="3" side="tl" part="a_nom"/>
              <clip pos="3" side="tl" part="a_gen_sense_mf" link-to="2"/>
              <clip pos="3" side="tl" part="a_gen_mf"/>
              <clip pos="3" side="tl" part="a_nbr_sense_sp" link-to="3"/>
              <clip pos="3" side="tl" part="a_nbr_sp"/>
              <clip pos="3" side="tl" part="lemq"/>
            </lu>
          </chunk>
          </out>
          </otherwise>
        </choose>
        <call-macro n="n_gen_nbr"/>
      </action>
    </rule>


    <rule comment="cel + mai + ADJECTIU + NOM">
      <pattern>
        <pattern-item n="det_cel"/>
        <pattern-item n="adv_mai"/>
        <pattern-item n="adjnorm"/>
        <pattern-item n="nom"/>
      </pattern>
      <action>
        <call-macro n="f_concord3">
          <with-param pos="4"/>
          <with-param pos="3"/>
          <with-param pos="1"/>
        </call-macro>
        <choose>
          <when>
            <test>
              <equal>
                <clip pos="1" side="sl" part="a_case"/>
                <lit-tag v="dg"/>
              </equal>
            </test>
              <call-macro n="mod_maj">
                <with-param pos="1"/>
              </call-macro>
              <out>
                <chunk name="prep_det_nom_adv_adj">
                <tags>
                  <tag><lit-tag v="SP"/></tag>
                  <tag><var n="genere_chunk"/></tag>
                  <tag><var n="nombre_chunk"/></tag>
                  <tag><clip pos="1" side="sl" part="a_cas"/></tag>
                  <tag><clip pos="1" side="sl" part="a_def"/></tag>
                </tags>
                <lu>
                <get-case-from pos="1">
                  <lit v="a"/>
                </get-case-from>
                  <lit-tag v="pr"/>
                </lu>
                <b/>
                <lu>
                  <clip pos="1" side="tl" part="lemh"/>
                  <clip pos="1" side="tl" part="a_det"/>
                  <clip pos="1" side="tl" part="a_gen_sense_mf" link-to="2"/>
                  <clip pos="1" side="tl" part="a_gen_mf"/>
                  <clip pos="1" side="tl" part="a_nbr_sense_sp" link-to="3"/>
                  <clip pos="1" side="tl" part="a_nbr_sp"/>
                  <clip pos="1" side="tl" part="lemq"/>
                </lu>
                <b pos="3"/>
                <lu>
                  <clip pos="4" side="tl" part="lemh"/>
                  <clip pos="4" side="tl" part="a_nom"/>
                  <clip pos="4" side="tl" part="a_gen_sense_mf" link-to="2"/>
                  <clip pos="4" side="tl" part="a_gen_mf"/>
                  <clip pos="4" side="tl" part="a_nbr_sense_sp" link-to="3"/>
                  <clip pos="4" side="tl" part="a_nbr_sp"/>
                  <clip pos="4" side="tl" part="lemq"/>
                </lu>
                <b pos="1"/>
                <lu>
                  <clip pos="2" side="tl" part="lemh"/>
                  <clip pos="2" side="tl" part="a_adv"/>
                  <clip pos="2" side="tl" part="lemq"/>
                </lu>
                <b pos="2"/>
                <lu>
                  <clip pos="3" side="tl" part="lemh"/>
                  <clip pos="3" side="tl" part="a_adj"/>
                  <clip pos="3" side="tl" part="a_gen_sense_mf" link-to="2"/>
                  <clip pos="3" side="tl" part="a_gen_mf"/>
                  <clip pos="3" side="tl" part="a_nbr_sense_sp" link-to="3"/>
                  <clip pos="3" side="tl" part="a_nbr_sp"/>
                  <clip pos="3" side="tl" part="lemq"/>
                </lu>
              </chunk>
            </out>
          </when>
          <otherwise>
            <out>
              <chunk name="det_nom_adv_adj">
              <tags>
                <tag><lit-tag v="SN"/></tag>
                <tag><var n="genere_chunk"/></tag>
                <tag><var n="nombre_chunk"/></tag>
                <tag><clip pos="1" side="sl" part="a_cas"/></tag>
                <tag><clip pos="1" side="sl" part="a_def"/></tag>
              </tags>
                <lu>
                  <clip pos="1" side="tl" part="lemh"/>
                  <clip pos="1" side="tl" part="a_det"/>
                  <clip pos="1" side="tl" part="a_gen_sense_mf" link-to="2"/>
                  <clip pos="1" side="tl" part="a_gen_mf"/>
                  <clip pos="1" side="tl" part="a_nbr_sense_sp" link-to="3"/>
                  <clip pos="1" side="tl" part="a_nbr_sp"/>
                  <clip pos="1" side="tl" part="lemq"/>
                </lu>
                <b pos="3"/>
                <lu>
                  <clip pos="4" side="tl" part="lemh"/>
                  <clip pos="4" side="tl" part="a_nom"/>
                  <clip pos="4" side="tl" part="a_gen_sense_mf" link-to="2"/>
                  <clip pos="4" side="tl" part="a_gen_mf"/>
                  <clip pos="4" side="tl" part="a_nbr_sense_sp" link-to="3"/>
                  <clip pos="4" side="tl" part="a_nbr_sp"/>
                  <clip pos="4" side="tl" part="lemq"/>
                </lu>
                <b pos="1"/>
                <lu>
                  <clip pos="2" side="tl" part="lemh"/>
                  <clip pos="2" side="tl" part="a_adv"/>
                  <clip pos="2" side="tl" part="lemq"/>
                </lu>
                <b pos="2"/>
                <lu>
                  <clip pos="3" side="tl" part="lemh"/>
                  <clip pos="3" side="tl" part="a_adj"/>
                  <clip pos="3" side="tl" part="a_gen_sense_mf" link-to="2"/>
                  <clip pos="3" side="tl" part="a_gen_mf"/>
                  <clip pos="3" side="tl" part="a_nbr_sense_sp" link-to="3"/>
                  <clip pos="3" side="tl" part="a_nbr_sp"/>
                  <clip pos="3" side="tl" part="lemq"/>
                </lu>
              </chunk>
            </out>
          </otherwise>
        </choose>
        <call-macro n="n_gen_nbr"/>
      </action>
    </rule>

    <rule comment="cel + mai + ADJECTIU + NOM + ADJECTIU">
      <pattern>
        <pattern-item n="det_cel"/>
        <pattern-item n="adv_mai"/>
        <pattern-item n="adjnorm"/>
        <pattern-item n="nom"/>
        <pattern-item n="adjnorm"/>
      </pattern>
      <action>
        <call-macro n="f_concord4">
          <with-param pos="4"/>
          <with-param pos="5"/>
          <with-param pos="2"/>
          <with-param pos="1"/>
        </call-macro>
        <choose>
          <when>
            <test>
              <equal>
                <clip pos="1" side="sl" part="a_case"/>
                <lit-tag v="dg"/>
              </equal>
            </test>
              <call-macro n="mod_maj">
                <with-param pos="1"/>
              </call-macro>
              <out>
                <chunk name="prep_det_nom_adj_adv_adj">
                <tags>
                  <tag><lit-tag v="SP"/></tag>
                  <tag><var n="genere_chunk"/></tag>
                  <tag><var n="nombre_chunk"/></tag>
                  <tag><clip pos="1" side="sl" part="a_cas"/></tag>
                  <tag><clip pos="1" side="sl" part="a_def"/></tag>
                </tags>
                <lu>
                <get-case-from pos="1">
                  <lit v="a"/>
                </get-case-from>
                  <lit-tag v="pr"/>
                </lu>
                <b/>
                <lu>
                  <clip pos="1" side="tl" part="lemh"/>
                  <clip pos="1" side="tl" part="a_det"/>
                  <clip pos="1" side="tl" part="a_gen_sense_mf" link-to="2"/>
                  <clip pos="1" side="tl" part="a_gen_mf"/>
                  <clip pos="1" side="tl" part="a_nbr_sense_sp" link-to="3"/>
                  <clip pos="1" side="tl" part="a_nbr_sp"/>
                  <clip pos="1" side="tl" part="lemq"/>
                </lu>
                <b pos="3"/>
                <lu>
                  <clip pos="4" side="tl" part="lemh"/>
                  <clip pos="4" side="tl" part="a_nom"/>
                  <clip pos="4" side="tl" part="a_gen_sense_mf" link-to="2"/>
                  <clip pos="4" side="tl" part="a_gen_mf"/>
                  <clip pos="4" side="tl" part="a_nbr_sense_sp" link-to="3"/>
                  <clip pos="4" side="tl" part="a_nbr_sp"/>
                  <clip pos="4" side="tl" part="lemq"/>
                </lu>
                <b pos="4"/>
                <lu>
                  <clip pos="5" side="tl" part="lemh"/>
                  <clip pos="5" side="tl" part="a_adj"/>
                  <clip pos="5" side="tl" part="a_gen_sense_mf" link-to="2"/>
                  <clip pos="5" side="tl" part="a_gen_mf"/>
                  <clip pos="5" side="tl" part="a_nbr_sense_sp" link-to="3"/>
                  <clip pos="5" side="tl" part="a_nbr_sp"/>
                  <clip pos="5" side="tl" part="lemq"/>
                </lu>
                <b pos="1"/>
                <lu>
                  <clip pos="2" side="tl" part="lemh"/>
                  <clip pos="2" side="tl" part="a_adv"/>
                  <clip pos="2" side="tl" part="lemq"/>
                </lu>
                <b pos="2"/>
                <lu>
                  <clip pos="3" side="tl" part="lemh"/>
                  <clip pos="3" side="tl" part="a_adj"/>
                  <clip pos="3" side="tl" part="a_gen_sense_mf" link-to="2"/>
                  <clip pos="3" side="tl" part="a_gen_mf"/>
                  <clip pos="3" side="tl" part="a_nbr_sense_sp" link-to="3"/>
                  <clip pos="3" side="tl" part="a_nbr_sp"/>
                  <clip pos="3" side="tl" part="lemq"/>
                </lu>
              </chunk>
            </out>
          </when>
          <otherwise>
            <out>
              <chunk name="det_nom_adj_adv_adj">
              <tags>
                <tag><lit-tag v="SN"/></tag>
                <tag><var n="genere_chunk"/></tag>
                <tag><var n="nombre_chunk"/></tag>
                <tag><clip pos="1" side="sl" part="a_cas"/></tag>
                <tag><clip pos="1" side="sl" part="a_def"/></tag>
              </tags>
                <lu>
                  <clip pos="1" side="tl" part="lemh"/>
                  <clip pos="1" side="tl" part="a_det"/>
                  <clip pos="1" side="tl" part="a_gen_sense_mf" link-to="2"/>
                  <clip pos="1" side="tl" part="a_gen_mf"/>
                  <clip pos="1" side="tl" part="a_nbr_sense_sp" link-to="3"/>
                  <clip pos="1" side="tl" part="a_nbr_sp"/>
                  <clip pos="1" side="tl" part="lemq"/>
                </lu>
                <b pos="3"/>
                <lu>
                  <clip pos="4" side="tl" part="lemh"/>
                  <clip pos="4" side="tl" part="a_nom"/>
                  <clip pos="4" side="tl" part="a_gen_sense_mf" link-to="2"/>
                  <clip pos="4" side="tl" part="a_gen_mf"/>
                  <clip pos="4" side="tl" part="a_nbr_sense_sp" link-to="3"/>
                  <clip pos="4" side="tl" part="a_nbr_sp"/>
                  <clip pos="4" side="tl" part="lemq"/>
                </lu>
                <b pos="4"/>
                <lu>
                  <clip pos="5" side="tl" part="lemh"/>
                  <clip pos="5" side="tl" part="a_adj"/>
                  <clip pos="5" side="tl" part="a_gen_sense_mf" link-to="2"/>
                  <clip pos="5" side="tl" part="a_gen_mf"/>
                  <clip pos="5" side="tl" part="a_nbr_sense_sp" link-to="3"/>
                  <clip pos="5" side="tl" part="a_nbr_sp"/>
                  <clip pos="5" side="tl" part="lemq"/>
                </lu>
                <b pos="1"/>
                <lu>
                  <clip pos="2" side="tl" part="lemh"/>
                  <clip pos="2" side="tl" part="a_adv"/>
                  <clip pos="2" side="tl" part="lemq"/>
                </lu>
                <b pos="2"/>
                <lu>
                  <clip pos="3" side="tl" part="lemh"/>
                  <clip pos="3" side="tl" part="a_adj"/>
                  <clip pos="3" side="tl" part="a_gen_sense_mf" link-to="2"/>
                  <clip pos="3" side="tl" part="a_gen_mf"/>
                  <clip pos="3" side="tl" part="a_nbr_sense_sp" link-to="3"/>
                  <clip pos="3" side="tl" part="a_nbr_sp"/>
                  <clip pos="3" side="tl" part="lemq"/>
                </lu>
              </chunk>
            </out>
          </otherwise>
        </choose>
        <call-macro n="n_gen_nbr"/>
      </action>
    </rule>

    <rule comment="cel + mai + ADJECTIU + NOM + ADJECTIU + ADJECTIU">
      <pattern>
        <pattern-item n="det_cel"/>
        <pattern-item n="adv_mai"/>
        <pattern-item n="adjnorm"/>
        <pattern-item n="nom"/>
        <pattern-item n="adjnorm"/>
        <pattern-item n="adjnorm"/>
      </pattern>
      <action>
        <call-macro n="f_concord5">
          <with-param pos="4"/>
          <with-param pos="5"/>
          <with-param pos="6"/>
          <with-param pos="2"/>
          <with-param pos="1"/>
        </call-macro>
        <choose>
          <when>
            <test>
              <equal>
                <clip pos="1" side="sl" part="a_case"/>
                <lit-tag v="dg"/>
              </equal>
            </test>
              <call-macro n="mod_maj">
                <with-param pos="1"/>
              </call-macro>
              <out>
                <chunk name="prep_det_nom_adj_adj_adv_adj">
                <tags>
                  <tag><lit-tag v="SP"/></tag>
                  <tag><var n="genere_chunk"/></tag>
                  <tag><var n="nombre_chunk"/></tag>
                  <tag><clip pos="1" side="sl" part="a_cas"/></tag>
                  <tag><clip pos="1" side="sl" part="a_def"/></tag>
                </tags>
                <lu>
                <get-case-from pos="1">
                  <lit v="a"/>
                </get-case-from>
                  <lit-tag v="pr"/>
                </lu>
                <b/>
                <lu>
                  <clip pos="1" side="tl" part="lemh"/>
                  <clip pos="1" side="tl" part="a_det"/>
                  <clip pos="1" side="tl" part="a_gen_sense_mf" link-to="2"/>
                  <clip pos="1" side="tl" part="a_gen_mf"/>
                  <clip pos="1" side="tl" part="a_nbr_sense_sp" link-to="3"/>
                  <clip pos="1" side="tl" part="a_nbr_sp"/>
                  <clip pos="1" side="tl" part="lemq"/>
                </lu>
                <b pos="3"/>
                <lu>
                  <clip pos="4" side="tl" part="lemh"/>
                  <clip pos="4" side="tl" part="a_nom"/>
                  <clip pos="4" side="tl" part="a_gen_sense_mf" link-to="2"/>
                  <clip pos="4" side="tl" part="a_gen_mf"/>
                  <clip pos="4" side="tl" part="a_nbr_sense_sp" link-to="3"/>
                  <clip pos="4" side="tl" part="a_nbr_sp"/>
                  <clip pos="4" side="tl" part="lemq"/>
                </lu>
                <b pos="4"/>
                <lu>
                  <clip pos="5" side="tl" part="lemh"/>
                  <clip pos="5" side="tl" part="a_adj"/>
                  <clip pos="5" side="tl" part="a_gen_sense_mf" link-to="2"/>
                  <clip pos="5" side="tl" part="a_gen_mf"/>
                  <clip pos="5" side="tl" part="a_nbr_sense_sp" link-to="3"/>
                  <clip pos="5" side="tl" part="a_nbr_sp"/>
                  <clip pos="5" side="tl" part="lemq"/>
                </lu>
                <b pos="5"/>
                <lu>
                  <clip pos="6" side="tl" part="lemh"/>
                  <clip pos="6" side="tl" part="a_adj"/>
                  <clip pos="6" side="tl" part="a_gen_sense_mf" link-to="2"/>
                  <clip pos="6" side="tl" part="a_gen_mf"/>
                  <clip pos="6" side="tl" part="a_nbr_sense_sp" link-to="3"/>
                  <clip pos="6" side="tl" part="a_nbr_sp"/>
                  <clip pos="6" side="tl" part="lemq"/>
                </lu>
                <b pos="1"/>
                <lu>
                  <clip pos="2" side="tl" part="lemh"/>
                  <clip pos="2" side="tl" part="a_adv"/>
                  <clip pos="2" side="tl" part="lemq"/>
                </lu>
                <b pos="2"/>
                <lu>
                  <clip pos="3" side="tl" part="lemh"/>
                  <clip pos="3" side="tl" part="a_adj"/>
                  <clip pos="3" side="tl" part="a_gen_sense_mf" link-to="2"/>
                  <clip pos="3" side="tl" part="a_gen_mf"/>
                  <clip pos="3" side="tl" part="a_nbr_sense_sp" link-to="3"/>
                  <clip pos="3" side="tl" part="a_nbr_sp"/>
                  <clip pos="3" side="tl" part="lemq"/>
                </lu>
              </chunk>
            </out>
          </when>
          <otherwise>
            <out>
              <chunk name="det_nom_adj_adj_adv_adj">
              <tags>
                <tag><lit-tag v="SN"/></tag>
                <tag><var n="genere_chunk"/></tag>
                <tag><var n="nombre_chunk"/></tag>
                <tag><clip pos="1" side="sl" part="a_cas"/></tag>
                <tag><clip pos="1" side="sl" part="a_def"/></tag>
              </tags>
                <lu>
                  <clip pos="1" side="tl" part="lemh"/>
                  <clip pos="1" side="tl" part="a_det"/>
                  <clip pos="1" side="tl" part="a_gen_sense_mf" link-to="2"/>
                  <clip pos="1" side="tl" part="a_gen_mf"/>
                  <clip pos="1" side="tl" part="a_nbr_sense_sp" link-to="3"/>
                  <clip pos="1" side="tl" part="a_nbr_sp"/>
                  <clip pos="1" side="tl" part="lemq"/>
                </lu>
                <b pos="3"/>
                <lu>
                  <clip pos="4" side="tl" part="lemh"/>
                  <clip pos="4" side="tl" part="a_nom"/>
                  <clip pos="4" side="tl" part="a_gen_sense_mf" link-to="2"/>
                  <clip pos="4" side="tl" part="a_gen_mf"/>
                  <clip pos="4" side="tl" part="a_nbr_sense_sp" link-to="3"/>
                  <clip pos="4" side="tl" part="a_nbr_sp"/>
                  <clip pos="4" side="tl" part="lemq"/>
                </lu>
                <b pos="4"/>
                <lu>
                  <clip pos="5" side="tl" part="lemh"/>
                  <clip pos="5" side="tl" part="a_adj"/>
                  <clip pos="5" side="tl" part="a_gen_sense_mf" link-to="2"/>
                  <clip pos="5" side="tl" part="a_gen_mf"/>
                  <clip pos="5" side="tl" part="a_nbr_sense_sp" link-to="3"/>
                  <clip pos="5" side="tl" part="a_nbr_sp"/>
                  <clip pos="5" side="tl" part="lemq"/>
                </lu>
                <b pos="5"/>
                <lu>
                  <clip pos="6" side="tl" part="lemh"/>
                  <clip pos="6" side="tl" part="a_adj"/>
                  <clip pos="6" side="tl" part="a_gen_sense_mf" link-to="2"/>
                  <clip pos="6" side="tl" part="a_gen_mf"/>
                  <clip pos="6" side="tl" part="a_nbr_sense_sp" link-to="3"/>
                  <clip pos="6" side="tl" part="a_nbr_sp"/>
                  <clip pos="6" side="tl" part="lemq"/>
                </lu>
                <b pos="1"/>
                <lu>
                  <clip pos="2" side="tl" part="lemh"/>
                  <clip pos="2" side="tl" part="a_adv"/>
                  <clip pos="2" side="tl" part="lemq"/>
                </lu>
                <b pos="2"/>
                <lu>
                  <clip pos="3" side="tl" part="lemh"/>
                  <clip pos="3" side="tl" part="a_adj"/>
                  <clip pos="3" side="tl" part="a_gen_sense_mf" link-to="2"/>
                  <clip pos="3" side="tl" part="a_gen_mf"/>
                  <clip pos="3" side="tl" part="a_nbr_sense_sp" link-to="3"/>
                  <clip pos="3" side="tl" part="a_nbr_sp"/>
                  <clip pos="3" side="tl" part="lemq"/>
                </lu>
              </chunk>
            </out>
          </otherwise>
        </choose>
        <call-macro n="n_gen_nbr"/>
      </action>
    </rule>


    <rule comment="NOM PROPI">
      <pattern>
        <pattern-item n="np"/>
      </pattern>
      <action>
        <call-macro n="f_concord1">
          <with-param pos="1"/>
        </call-macro>
        <choose>
        <!-- Datiu indefinit -->
          <when>
            <test>
                <equal>
                  <clip pos="1" side="sl" part="a_cas"/>
                  <lit-tag v="dg"/>
                </equal>
            </test>
              <out>
                <chunk name="prep_np">
                <tags>
                  <tag><lit-tag v="SP"/></tag>
                  <tag><var n="genere_chunk"/></tag>
                  <tag><var n="nombre_chunk"/></tag>
                  <tag><clip pos="1" side="sl" part="a_cas"/></tag>
                  <tag><clip pos="1" side="sl" part="a_def"/></tag>
                </tags>
                <lu>
                  <lit v="a"/>
                  <lit-tag v="pr"/>
                </lu>
                <b/>
                <lu>
                  <clip pos="1" side="tl" part="lemh"/>
                  <clip pos="1" side="tl" part="a_np"/>
                  <clip pos="1" side="tl" part="a_gen_sense_mf" link-to="2"/>
                  <clip pos="1" side="tl" part="a_gen_mf"/>
                  <clip pos="1" side="tl" part="a_nbr_sense_sp" link-to="3"/>
                  <clip pos="1" side="tl" part="a_nbr_sp"/>
                  <clip pos="1" side="tl" part="lemq"/>
                </lu>
              </chunk>
            </out>
          </when>
        <!-- Nominatiu indefinit -->
          <otherwise>
              <out>
                <chunk name="np">
                <tags>
                  <tag><lit-tag v="SN"/></tag>
                  <tag><var n="genere_chunk"/></tag>
                  <tag><var n="nombre_chunk"/></tag>
                  <tag><clip pos="1" side="sl" part="a_cas"/></tag>
                  <tag><clip pos="1" side="sl" part="a_def"/></tag>
                </tags>
                <lu>
                  <clip pos="1" side="tl" part="lemh"/>
                  <clip pos="1" side="tl" part="a_np"/>
                  <clip pos="1" side="tl" part="a_gen_sense_mf" link-to="2"/>
                  <clip pos="1" side="tl" part="a_gen_mf"/>
                  <clip pos="1" side="tl" part="a_nbr_sense_sp" link-to="3"/>
                  <clip pos="1" side="tl" part="a_nbr_sp"/>
                  <clip pos="1" side="tl" part="lemq"/>
                </lu>
              </chunk>
            </out>
          </otherwise>
        </choose>
        <call-macro n="n_gen_nbr"/>
      </action>
    </rule>


    <rule comment="NUMERAL">
      <pattern>
        <pattern-item n="num"/>
      </pattern>
      <action>
        <call-macro n="f_concord1">
          <with-param pos="1"/>
        </call-macro>
        <choose><!-- Les xifres que no estan escrites no tenen nombre i cal afegir-lo -->
          <when>
            <test>
              <equal>
                <var n="nombre1"/>
                <lit v=""/>
              </equal>
            </test>
            <choose>
              <when>
                <test>
                  <equal caseless="yes">
                    <clip pos="1" side="tl" part="lem"/>
                    <lit v="1"/>
                  </equal>
                </test>
                <let>
                  <var n="nombre_chunk"/>
                  <lit-tag v="sg"/>
                </let>
              </when>
              <otherwise>
                <let>
                  <var n="nombre_chunk"/>
                  <lit-tag v="pl"/>
                </let>
              </otherwise>
            </choose>
          </when>
        </choose>
        <out>
          <chunk name="num">
          <tags>
            <tag><lit-tag v="SN"/></tag>
            <tag><var n="genere_chunk"/></tag>
            <tag><var n="nombre_chunk"/></tag>
            <tag><lit-tag v="nom"/></tag>
            <tag><lit-tag v="ind"/></tag>
          </tags>
          <lu>
            <clip pos="1" side="tl" part="lemh"/>
            <clip pos="1" side="tl" part="a_num"/>
            <clip pos="1" side="tl" part="a_gen_sense_mf" link-to="2"/>
            <clip pos="1" side="tl" part="a_gen_mf"/>
            <clip pos="1" side="tl" part="a_nbr_sense_sp" link-to="3"/>
            <clip pos="1" side="tl" part="a_nbr_sp"/>
            <clip pos="1" side="tl" part="lemq"/>
          </lu>
          </chunk>
        </out>
        <call-macro n="n_gen_nbr"/>
      </action>
    </rule>


    <rule comment="PRONOM">
      <pattern>
        <pattern-item n="prn_tnitg"/>
      </pattern>
      <action>
        <call-macro n="f_concord1">
          <with-param pos="1"/>
        </call-macro>
        <choose>
          <!-- Si el pronom no té persona, no posem l'etiqueta de persona -->
          <when>
            <test>
              <equal>
                <clip pos="1" side="tl" part="a_pers"/>
                <lit v=""/>
              </equal>
            </test>
            <out>
              <chunk name="prntn">
                <tags>
                  <tag><lit-tag v="SN"/></tag>
                  <tag><var n="genere_chunk"/></tag>
                  <tag><var n="nombre_chunk"/></tag>
                  <tag><clip pos="1" side="sl" part="a_cas"/></tag>
                  <tag><lit-tag v="def"/></tag>
                </tags>
                <lu>
                  <clip pos="1" side="tl" part="lemh"/>
                  <clip pos="1" side="tl" part="a_prn"/>
                  <clip pos="1" side="tl" part="a_gen_sense_mf" link-to="2"/>
                  <clip pos="1" side="tl" part="a_gen_mf"/>
                  <clip pos="1" side="tl" part="a_nbr_sense_sp" link-to="3"/>
                  <clip pos="1" side="tl" part="a_nbr_sp"/>
                  <clip pos="1" side="tl" part="lemq"/>
                </lu>
              </chunk>
            </out>
          </when>
          <!-- Si el pronom té persona, posem l'etiqueta corresponent al chunk -->
          <otherwise>
            <out>
              <chunk name="prntn">
                <tags>
                  <tag><lit-tag v="SN"/></tag>
                  <tag><clip pos="1" side="tl" part="a_pers"/></tag>
                  <tag><var n="genere_chunk"/></tag>
                  <tag><var n="nombre_chunk"/></tag>
                  <tag><clip pos="1" side="sl" part="a_cas"/></tag>
                  <tag><lit-tag v="def"/></tag>
                </tags>
                <lu>
                  <clip pos="1" side="tl" part="lemh"/>
                  <clip pos="1" side="tl" part="a_prn"/>
                  <clip pos="1" side="tl" part="a_pers" link-to="2"/>
                  <clip pos="1" side="tl" part="a_gen_sense_mf" link-to="3"/>
                  <clip pos="1" side="tl" part="a_gen_mf"/>
                  <clip pos="1" side="tl" part="a_nbr_sense_sp" link-to="4"/>
                  <clip pos="1" side="tl" part="a_nbr_sp"/>
                  <clip pos="1" side="tl" part="lemq"/>
                </lu>
              </chunk>
            </out>
          </otherwise>
        </choose>
        <call-macro n="n_gen_nbr"/>
      </action>
    </rule>


    <rule comment="CLÍTIC">
      <pattern>
        <pattern-item n="prnpro"/>
      </pattern>
      <action>
        <call-macro n="f_concord1">
          <with-param pos="1"/>
        </call-macro>
        <out>
          <chunk name="prnpro">
            <tags>
              <tag><lit-tag v="prnpro"/></tag>
              <tag><clip pos="1" side="tl" part="a_pers"/></tag>
              <tag><var n="genere_chunk"/></tag>
              <tag><var n="nombre_chunk"/></tag>
              <tag><clip pos="1" side="sl" part="a_cas"/></tag>
              <tag><lit-tag v="def"/></tag>
            </tags>
            <lu>
              <clip pos="1" side="tl" part="lemh"/>
              <clip pos="1" side="tl" part="a_prn"/>
              <clip pos="1" side="tl" part="a_pers" link-to="2"/>
              <clip pos="1" side="tl" part="a_gen_sense_mf" link-to="3"/>
              <clip pos="1" side="tl" part="a_gen_mf"/>
              <clip pos="1" side="tl" part="a_nbr_sense_sp" link-to="4"/>
              <clip pos="1" side="tl" part="a_nbr_sp"/>
              <clip pos="1" side="tl" part="lemq"/>
            </lu>
          </chunk>
        </out>
        <call-macro n="n_gen_nbr"/>
      </action>
    </rule>


    <rule comment="al + NOM GENITIU">
      <pattern>
        <pattern-item n="det_al"/>
        <pattern-item n="nom_dg"/>
      </pattern>
      <action>
        <call-macro n="f_concord1">
          <with-param pos="2"/>
        </call-macro>
        <choose>
        <!-- Datiu indefinit -->
          <when>
            <test>
              <equal>
                <clip pos="2" side="sl" part="a_def"/>
                <lit-tag v="ind"/>
              </equal>
            </test>
              <out>
                <chunk name="prep_nom">
                <tags>
                  <tag><lit-tag v="SP"/></tag>
                  <tag><var n="genere_chunk"/></tag>
                  <tag><var n="nombre_chunk"/></tag>
                  <tag><clip pos="2" side="sl" part="a_cas"/></tag>
                 <tag><clip pos="2" side="sl" part="a_def"/></tag>
                </tags>
                <lu>
                  <get-case-from pos="1">
                  <lit v="de"/>
                  </get-case-from>
                  <lit-tag v="pr"/>
                </lu>
                <b pos="1"/>
                <lu>
                  <clip pos="2" side="tl" part="lemh"/>
                  <clip pos="2" side="tl" part="a_nom"/>
                  <clip pos="2" side="tl" part="a_gen_sense_mf" link-to="2"/>
                  <clip pos="2" side="tl" part="a_gen_mf"/>
                  <clip pos="2" side="tl" part="a_nbr_sense_sp" link-to="3"/>
                  <clip pos="2" side="tl" part="a_nbr_sp"/>
                  <clip pos="2" side="tl" part="lemq"/>
                </lu>
              </chunk>
            </out>
          </when>
        <!-- Datiu definit -->
          <otherwise>
              <call-macro n="mod_maj">
                <with-param pos="2"/>
              </call-macro>
              <out>
                <chunk name="prep_det_nom">
                <tags>
                  <tag><lit-tag v="SP"/></tag>
                  <tag><var n="genere_chunk"/></tag>
                  <tag><var n="nombre_chunk"/></tag>
                  <tag><clip pos="2" side="sl" part="a_cas"/></tag>
                 <tag><clip pos="2" side="sl" part="a_def"/></tag>
                </tags>
                <lu>
                  <get-case-from pos="1">
                  <lit v="de"/>
                  </get-case-from>
                  <lit-tag v="pr"/>
                </lu>
                <b pos="1"/>
                <lu>
                  <lit v="el"/>
                  <lit-tag v="det.def"/>
                  <lit-tag v="2"/>
                  <lit-tag v="3"/>
                </lu>
                <b/>
                <lu>
                  <clip pos="2" side="tl" part="lemh"/>
                  <clip pos="2" side="tl" part="a_nom"/>
                  <clip pos="2" side="tl" part="a_gen_sense_mf" link-to="2"/>
                  <clip pos="2" side="tl" part="a_gen_mf"/>
                  <clip pos="2" side="tl" part="a_nbr_sense_sp" link-to="3"/>
                  <clip pos="2" side="tl" part="a_nbr_sp"/>
                  <clip pos="2" side="tl" part="lemq"/>
                </lu>
              </chunk>
            </out>
          </otherwise>
        </choose>
        <call-macro n="n_gen_nbr"/>
      </action>
    </rule>

    <rule comment="al + NOM GENITIU + ADJECTIU">
      <pattern>
        <pattern-item n="det_al"/>
        <pattern-item n="nom_dg"/>
        <pattern-item n="adjnorm"/>
      </pattern>
      <action>
        <call-macro n="f_concord2">
          <with-param pos="2"/>
          <with-param pos="3"/>
        </call-macro>
        <choose>
        <!-- Datiu indefinit -->
          <when>
            <test>
              <equal>
                <clip pos="2" side="sl" part="a_def"/>
                <lit-tag v="ind"/>
              </equal>
            </test>
              <out>
                <chunk name="prep_nom">
                <tags>
                  <tag><lit-tag v="SP"/></tag>
                  <tag><var n="genere_chunk"/></tag>
                  <tag><var n="nombre_chunk"/></tag>
                  <tag><clip pos="2" side="sl" part="a_cas"/></tag>
                 <tag><clip pos="2" side="sl" part="a_def"/></tag>
                </tags>
                <lu>
                  <get-case-from pos="1">
                  <lit v="de"/>
                  </get-case-from>
                  <lit-tag v="pr"/>
                </lu>
                <b pos="1"/>
                <lu>
                  <clip pos="2" side="tl" part="lemh"/>
                  <clip pos="2" side="tl" part="a_nom"/>
                  <clip pos="2" side="tl" part="a_gen_sense_mf" link-to="2"/>
                  <clip pos="2" side="tl" part="a_gen_mf"/>
                  <clip pos="2" side="tl" part="a_nbr_sense_sp" link-to="3"/>
                  <clip pos="2" side="tl" part="a_nbr_sp"/>
                  <clip pos="2" side="tl" part="lemq"/>
                </lu>
                <b pos="2"/>
                <lu>
                  <clip pos="3" side="tl" part="lemh"/>
                  <clip pos="3" side="tl" part="a_adj"/>
                  <clip pos="3" side="tl" part="a_gen_sense_mf" link-to="2"/>
                  <clip pos="3" side="tl" part="a_gen_mf"/>
                  <clip pos="3" side="tl" part="a_nbr_sense_sp" link-to="3"/>
                  <clip pos="3" side="tl" part="a_nbr_sp"/>
                  <clip pos="3" side="tl" part="lemq"/>
                </lu>
              </chunk>
            </out>
          </when>
        <!-- Datiu definit -->
          <otherwise>
              <call-macro n="mod_maj">
                <with-param pos="2"/>
              </call-macro>
              <out>
                <chunk name="prep_det_nom">
                <tags>
                  <tag><lit-tag v="SP"/></tag>
                  <tag><var n="genere_chunk"/></tag>
                  <tag><var n="nombre_chunk"/></tag>
                  <tag><clip pos="2" side="sl" part="a_cas"/></tag>
                 <tag><clip pos="2" side="sl" part="a_def"/></tag>
                </tags>
                <lu>
                  <get-case-from pos="1">
                  <lit v="de"/>
                  </get-case-from>
                  <lit-tag v="pr"/>
                </lu>
                <b pos="1"/>
                <lu>
                  <lit v="el"/>
                  <lit-tag v="det.def"/>
                  <lit-tag v="2"/>
                  <lit-tag v="3"/>
                </lu>
                <b/>
                <lu>
                  <clip pos="2" side="tl" part="lemh"/>
                  <clip pos="2" side="tl" part="a_nom"/>
                  <clip pos="2" side="tl" part="a_gen_sense_mf" link-to="2"/>
                  <clip pos="2" side="tl" part="a_gen_mf"/>
                  <clip pos="2" side="tl" part="a_nbr_sense_sp" link-to="3"/>
                  <clip pos="2" side="tl" part="a_nbr_sp"/>
                  <clip pos="2" side="tl" part="lemq"/>
                </lu>
                <b pos="2"/>
                <lu>
                  <clip pos="3" side="tl" part="lemh"/>
                  <clip pos="3" side="tl" part="a_adj"/>
                  <clip pos="3" side="tl" part="a_gen_sense_mf" link-to="2"/>
                  <clip pos="3" side="tl" part="a_gen_mf"/>
                  <clip pos="3" side="tl" part="a_nbr_sense_sp" link-to="3"/>
                  <clip pos="3" side="tl" part="a_nbr_sp"/>
                  <clip pos="3" side="tl" part="lemq"/>
                </lu>
              </chunk>
            </out>
          </otherwise>
        </choose>
        <call-macro n="n_gen_nbr"/>
      </action>
    </rule>

    <rule comment="al + NOM GENITIU + ADJECTIU + ADJECTIU">
      <pattern>
        <pattern-item n="det_al"/>
        <pattern-item n="nom_dg"/>
        <pattern-item n="adjnorm"/>
        <pattern-item n="adjnorm"/>
      </pattern>
      <action>
        <call-macro n="f_concord3">
          <with-param pos="2"/>
          <with-param pos="3"/>
          <with-param pos="4"/>
        </call-macro>
        <choose>
        <!-- Datiu indefinit -->
          <when>
            <test>
              <equal>
                <clip pos="2" side="sl" part="a_def"/>
                <lit-tag v="ind"/>
              </equal>
            </test>
              <out>
                <chunk name="prep_nom">
                <tags>
                  <tag><lit-tag v="SP"/></tag>
                  <tag><var n="genere_chunk"/></tag>
                  <tag><var n="nombre_chunk"/></tag>
                  <tag><clip pos="2" side="sl" part="a_cas"/></tag>
                 <tag><clip pos="2" side="sl" part="a_def"/></tag>
                </tags>
                <lu>
                  <get-case-from pos="1">
                  <lit v="de"/>
                  </get-case-from>
                  <lit-tag v="pr"/>
                </lu>
                <b pos="1"/>
                <lu>
                  <clip pos="2" side="tl" part="lemh"/>
                  <clip pos="2" side="tl" part="a_nom"/>
                  <clip pos="2" side="tl" part="a_gen_sense_mf" link-to="2"/>
                  <clip pos="2" side="tl" part="a_gen_mf"/>
                  <clip pos="2" side="tl" part="a_nbr_sense_sp" link-to="3"/>
                  <clip pos="2" side="tl" part="a_nbr_sp"/>
                  <clip pos="2" side="tl" part="lemq"/>
                </lu>
                <b pos="2"/>
                <lu>
                  <clip pos="3" side="tl" part="lemh"/>
                  <clip pos="3" side="tl" part="a_adj"/>
                  <clip pos="3" side="tl" part="a_gen_sense_mf" link-to="2"/>
                  <clip pos="3" side="tl" part="a_gen_mf"/>
                  <clip pos="3" side="tl" part="a_nbr_sense_sp" link-to="3"/>
                  <clip pos="3" side="tl" part="a_nbr_sp"/>
                  <clip pos="3" side="tl" part="lemq"/>
                </lu>
                <b pos="3"/>
                <lu>
                  <clip pos="4" side="tl" part="lemh"/>
                  <clip pos="4" side="tl" part="a_adj"/>
                  <clip pos="4" side="tl" part="a_gen_sense_mf" link-to="2"/>
                  <clip pos="4" side="tl" part="a_gen_mf"/>
                  <clip pos="4" side="tl" part="a_nbr_sense_sp" link-to="3"/>
                  <clip pos="4" side="tl" part="a_nbr_sp"/>
                  <clip pos="4" side="tl" part="lemq"/>
                </lu>
              </chunk>
            </out>
          </when>
        <!-- Datiu definit -->
          <otherwise>
              <call-macro n="mod_maj">
                <with-param pos="2"/>
              </call-macro>
              <out>
                <chunk name="prep_det_nom">
                <tags>
                  <tag><lit-tag v="SP"/></tag>
                  <tag><var n="genere_chunk"/></tag>
                  <tag><var n="nombre_chunk"/></tag>
                  <tag><clip pos="2" side="sl" part="a_cas"/></tag>
                 <tag><clip pos="2" side="sl" part="a_def"/></tag>
                </tags>
                <lu>
                  <get-case-from pos="1">
                  <lit v="de"/>
                  </get-case-from>
                  <lit-tag v="pr"/>
                </lu>
                <b pos="1"/>
                <lu>
                  <lit v="el"/>
                  <lit-tag v="det.def"/>
                  <lit-tag v="2"/>
                  <lit-tag v="3"/>
                </lu>
                <b/>
                <lu>
                  <clip pos="2" side="tl" part="lemh"/>
                  <clip pos="2" side="tl" part="a_nom"/>
                  <clip pos="2" side="tl" part="a_gen_sense_mf" link-to="2"/>
                  <clip pos="2" side="tl" part="a_gen_mf"/>
                  <clip pos="2" side="tl" part="a_nbr_sense_sp" link-to="3"/>
                  <clip pos="2" side="tl" part="a_nbr_sp"/>
                  <clip pos="2" side="tl" part="lemq"/>
                </lu>
                <b pos="2"/>
                <lu>
                  <clip pos="3" side="tl" part="lemh"/>
                  <clip pos="3" side="tl" part="a_adj"/>
                  <clip pos="3" side="tl" part="a_gen_sense_mf" link-to="2"/>
                  <clip pos="3" side="tl" part="a_gen_mf"/>
                  <clip pos="3" side="tl" part="a_nbr_sense_sp" link-to="3"/>
                  <clip pos="3" side="tl" part="a_nbr_sp"/>
                  <clip pos="3" side="tl" part="lemq"/>
                </lu>
                <b pos="3"/>
                <lu>
                  <clip pos="4" side="tl" part="lemh"/>
                  <clip pos="4" side="tl" part="a_adj"/>
                  <clip pos="4" side="tl" part="a_gen_sense_mf" link-to="2"/>
                  <clip pos="4" side="tl" part="a_gen_mf"/>
                  <clip pos="4" side="tl" part="a_nbr_sense_sp" link-to="3"/>
                  <clip pos="4" side="tl" part="a_nbr_sp"/>
                  <clip pos="4" side="tl" part="lemq"/>
                </lu>
              </chunk>
            </out>
          </otherwise>
        </choose>
        <call-macro n="n_gen_nbr"/>
      </action>
    </rule>



<!-- Regles de SPrep -->

    <rule comment="PREP GENITIU + NOM GENITIU">
      <pattern>
        <pattern-item n="prep_gen"/>
        <pattern-item n="nom_dg"/>
      </pattern>
      <action>
        <call-macro n="f_concord1">
          <with-param pos="2"/>
        </call-macro>
        <choose>
        <!-- Datiu indefinit -->
          <when>
            <test>
              <equal>
                <clip pos="2" side="sl" part="a_def"/>
                <lit-tag v="ind"/>
              </equal>
            </test>
            <out>
              <chunk name="prep_nom">
                <tags>
                  <tag><lit-tag v="SPrep"/></tag>
                  <tag><var n="genere_chunk"/></tag>
                  <tag><var n="nombre_chunk"/></tag>
                  <tag><clip pos="2" side="sl" part="a_cas"/></tag>
                 <tag><clip pos="2" side="sl" part="a_def"/></tag>
                </tags>
                <lu>
                  <clip pos="1" side="tl" part="lem"/>
                  <clip pos="1" side="tl" part="a_prep"/>
                </lu>
                <b pos="1"/>
                <lu>
                  <clip pos="2" side="tl" part="lemh"/>
                  <clip pos="2" side="tl" part="a_nom"/>
                  <clip pos="2" side="tl" part="a_gen_sense_mf" link-to="2"/>
                  <clip pos="2" side="tl" part="a_gen_mf"/>
                  <clip pos="2" side="tl" part="a_nbr_sense_sp" link-to="3"/>
                  <clip pos="2" side="tl" part="a_nbr_sp"/>
                  <clip pos="2" side="tl" part="lemq"/>
                </lu>
              </chunk>
            </out>
          </when>
        <!-- Datiu definit -->
          <otherwise>
            <call-macro n="mod_maj">
              <with-param pos="2"/>
            </call-macro>
            <out>
                <chunk name="prep_det_nom">
                <tags>
                  <tag><lit-tag v="SPrep"/></tag>
                  <tag><var n="genere_chunk"/></tag>
                  <tag><var n="nombre_chunk"/></tag>
                  <tag><clip pos="2" side="sl" part="a_cas"/></tag>
                 <tag><clip pos="2" side="sl" part="a_def"/></tag>
                </tags>
                <lu>
                  <clip pos="1" side="tl" part="lem"/>
                  <clip pos="1" side="tl" part="a_prep"/>
                </lu>
                <b pos="1"/>
                <lu>
                  <lit v="el"/>
                  <lit-tag v="det.def"/>
                  <lit-tag v="2"/>
                  <lit-tag v="3"/>
                </lu>
                <b/>
                <lu>
                  <clip pos="2" side="tl" part="lemh"/>
                  <clip pos="2" side="tl" part="a_nom"/>
                  <clip pos="2" side="tl" part="a_gen_sense_mf" link-to="2"/>
                  <clip pos="2" side="tl" part="a_gen_mf"/>
                  <clip pos="2" side="tl" part="a_nbr_sense_sp" link-to="3"/>
                  <clip pos="2" side="tl" part="a_nbr_sp"/>
                  <clip pos="2" side="tl" part="lemq"/>
                </lu>
              </chunk>
            </out>
          </otherwise>
        </choose>
        <call-macro n="n_gen_nbr"/>
      </action>
    </rule>

    <rule comment="PREP GENITIU + NOM GENITIU + ADJECTIU">
      <pattern>
        <pattern-item n="prep_gen"/>
        <pattern-item n="nom_dg"/>
        <pattern-item n="adjnorm"/>
      </pattern>
      <action>
        <call-macro n="f_concord2">
          <with-param pos="2"/>
          <with-param pos="3"/>
        </call-macro>
        <choose>
        <!-- Datiu indefinit -->
          <when>
            <test>
              <equal>
                <clip pos="2" side="sl" part="a_def"/>
                <lit-tag v="ind"/>
              </equal>
            </test>
            <out>
              <chunk name="prep_nom">
                <tags>
                  <tag><lit-tag v="SPrep"/></tag>
                  <tag><var n="genere_chunk"/></tag>
                  <tag><var n="nombre_chunk"/></tag>
                  <tag><clip pos="2" side="sl" part="a_cas"/></tag>
                 <tag><clip pos="2" side="sl" part="a_def"/></tag>
                </tags>
                <lu>
                  <clip pos="1" side="tl" part="lem"/>
                  <clip pos="1" side="tl" part="a_prep"/>
                </lu>
                <b pos="1"/>
                <lu>
                  <clip pos="2" side="tl" part="lemh"/>
                  <clip pos="2" side="tl" part="a_nom"/>
                  <clip pos="2" side="tl" part="a_gen_sense_mf" link-to="2"/>
                  <clip pos="2" side="tl" part="a_gen_mf"/>
                  <clip pos="2" side="tl" part="a_nbr_sense_sp" link-to="3"/>
                  <clip pos="2" side="tl" part="a_nbr_sp"/>
                  <clip pos="2" side="tl" part="lemq"/>
                </lu>
                <b pos="2"/>
                <lu>
                  <clip pos="3" side="tl" part="lemh"/>
                  <clip pos="3" side="tl" part="a_adj"/>
                  <clip pos="3" side="tl" part="a_gen_sense_mf" link-to="2"/>
                  <clip pos="3" side="tl" part="a_gen_mf"/>
                  <clip pos="3" side="tl" part="a_nbr_sense_sp" link-to="3"/>
                  <clip pos="3" side="tl" part="a_nbr_sp"/>
                  <clip pos="3" side="tl" part="lemq"/>
                </lu>
              </chunk>
            </out>
          </when>
        <!-- Datiu definit -->
          <otherwise>
            <call-macro n="mod_maj">
              <with-param pos="2"/>
            </call-macro>
            <out>
              <chunk name="prep_det_nom">
                <tags>
                  <tag><lit-tag v="SPrep"/></tag>
                  <tag><var n="genere_chunk"/></tag>
                  <tag><var n="nombre_chunk"/></tag>
                  <tag><clip pos="2" side="sl" part="a_cas"/></tag>
                 <tag><clip pos="2" side="sl" part="a_def"/></tag>
                </tags>
                <lu>
                  <clip pos="1" side="tl" part="lem"/>
                  <clip pos="1" side="tl" part="a_prep"/>
                </lu>
                <b pos="1"/>
                <lu>
                  <lit v="el"/>
                  <lit-tag v="det.def"/>
                  <lit-tag v="2"/>
                  <lit-tag v="3"/>
                </lu>
                <b/>
                <lu>
                  <clip pos="2" side="tl" part="lemh"/>
                  <clip pos="2" side="tl" part="a_nom"/>
                  <clip pos="2" side="tl" part="a_gen_sense_mf" link-to="2"/>
                  <clip pos="2" side="tl" part="a_gen_mf"/>
                  <clip pos="2" side="tl" part="a_nbr_sense_sp" link-to="3"/>
                  <clip pos="2" side="tl" part="a_nbr_sp"/>
                  <clip pos="2" side="tl" part="lemq"/>
                </lu>
                <b pos="2"/>
                <lu>
                  <clip pos="3" side="tl" part="lemh"/>
                  <clip pos="3" side="tl" part="a_adj"/>
                  <clip pos="3" side="tl" part="a_gen_sense_mf" link-to="2"/>
                  <clip pos="3" side="tl" part="a_gen_mf"/>
                  <clip pos="3" side="tl" part="a_nbr_sense_sp" link-to="3"/>
                  <clip pos="3" side="tl" part="a_nbr_sp"/>
                  <clip pos="3" side="tl" part="lemq"/>
                </lu>
              </chunk>
            </out>
          </otherwise>
        </choose>
        <call-macro n="n_gen_nbr"/>
      </action>
    </rule>

    <rule comment="PREP GENITIU + NOM GENITIU + ADJECTIU + ADJECTIU">
      <pattern>
        <pattern-item n="prep_gen"/>
        <pattern-item n="nom_dg"/>
        <pattern-item n="adjnorm"/>
        <pattern-item n="adjnorm"/>
      </pattern>
      <action>
        <call-macro n="f_concord3">
          <with-param pos="2"/>
          <with-param pos="3"/>
          <with-param pos="4"/>
        </call-macro>
        <choose>
        <!-- Datiu indefinit -->
          <when>
            <test>
              <equal>
                <clip pos="2" side="sl" part="a_def"/>
                <lit-tag v="ind"/>
              </equal>
            </test>
            <out>
              <chunk name="prep_nom">
                <tags>
                  <tag><lit-tag v="SPrep"/></tag>
                  <tag><var n="genere_chunk"/></tag>
                  <tag><var n="nombre_chunk"/></tag>
                  <tag><clip pos="2" side="sl" part="a_cas"/></tag>
                 <tag><clip pos="2" side="sl" part="a_def"/></tag>
                </tags>
                <lu>
                  <clip pos="1" side="tl" part="lem"/>
                  <clip pos="1" side="tl" part="a_prep"/>
                </lu>
                <b pos="1"/>
                <lu>
                  <clip pos="2" side="tl" part="lemh"/>
                  <clip pos="2" side="tl" part="a_nom"/>
                  <clip pos="2" side="tl" part="a_gen_sense_mf" link-to="2"/>
                  <clip pos="2" side="tl" part="a_gen_mf"/>
                  <clip pos="2" side="tl" part="a_nbr_sense_sp" link-to="3"/>
                  <clip pos="2" side="tl" part="a_nbr_sp"/>
                  <clip pos="2" side="tl" part="lemq"/>
                </lu>
                <b pos="2"/>
                <lu>
                  <clip pos="3" side="tl" part="lemh"/>
                  <clip pos="3" side="tl" part="a_adj"/>
                  <clip pos="3" side="tl" part="a_gen_sense_mf" link-to="2"/>
                  <clip pos="3" side="tl" part="a_gen_mf"/>
                  <clip pos="3" side="tl" part="a_nbr_sense_sp" link-to="3"/>
                  <clip pos="3" side="tl" part="a_nbr_sp"/>
                  <clip pos="3" side="tl" part="lemq"/>
                </lu>
                <b pos="3"/>
                <lu>
                  <clip pos="4" side="tl" part="lemh"/>
                  <clip pos="4" side="tl" part="a_adj"/>
                  <clip pos="4" side="tl" part="a_gen_sense_mf" link-to="2"/>
                  <clip pos="4" side="tl" part="a_gen_mf"/>
                  <clip pos="4" side="tl" part="a_nbr_sense_sp" link-to="3"/>
                  <clip pos="4" side="tl" part="a_nbr_sp"/>
                  <clip pos="4" side="tl" part="lemq"/>
                </lu>
              </chunk>
            </out>
          </when>
        <!-- Datiu definit -->
          <otherwise>
            <call-macro n="mod_maj">
              <with-param pos="2"/>
            </call-macro>
            <out>
              <chunk name="prep_det_nom">
                <tags>
                  <tag><lit-tag v="SPrep"/></tag>
                  <tag><var n="genere_chunk"/></tag>
                  <tag><var n="nombre_chunk"/></tag>
                  <tag><clip pos="2" side="sl" part="a_cas"/></tag>
                 <tag><clip pos="2" side="sl" part="a_def"/></tag>
                </tags>
                <lu>
                  <clip pos="1" side="tl" part="lem"/>
                  <clip pos="1" side="tl" part="a_prep"/>
                </lu>
                <b pos="1"/>
                <lu>
                  <lit v="el"/>
                  <lit-tag v="det.def"/>
                  <lit-tag v="2"/>
                  <lit-tag v="3"/>
                </lu>
                <b/>
                <lu>
                  <clip pos="2" side="tl" part="lemh"/>
                  <clip pos="2" side="tl" part="a_nom"/>
                  <clip pos="2" side="tl" part="a_gen_sense_mf" link-to="2"/>
                  <clip pos="2" side="tl" part="a_gen_mf"/>
                  <clip pos="2" side="tl" part="a_nbr_sense_sp" link-to="3"/>
                  <clip pos="2" side="tl" part="a_nbr_sp"/>
                  <clip pos="2" side="tl" part="lemq"/>
                </lu>
                <b pos="2"/>
                <lu>
                  <clip pos="3" side="tl" part="lemh"/>
                  <clip pos="3" side="tl" part="a_adj"/>
                  <clip pos="3" side="tl" part="a_gen_sense_mf" link-to="2"/>
                  <clip pos="3" side="tl" part="a_gen_mf"/>
                  <clip pos="3" side="tl" part="a_nbr_sense_sp" link-to="3"/>
                  <clip pos="3" side="tl" part="a_nbr_sp"/>
                  <clip pos="3" side="tl" part="lemq"/>
                </lu>
                <b pos="3"/>
                <lu>
                  <clip pos="4" side="tl" part="lemh"/>
                  <clip pos="4" side="tl" part="a_adj"/>
                  <clip pos="4" side="tl" part="a_gen_sense_mf" link-to="2"/>
                  <clip pos="4" side="tl" part="a_gen_mf"/>
                  <clip pos="4" side="tl" part="a_nbr_sense_sp" link-to="3"/>
                  <clip pos="4" side="tl" part="a_nbr_sp"/>
                  <clip pos="4" side="tl" part="lemq"/>
                </lu>
              </chunk>
            </out>
          </otherwise>
        </choose>
        <call-macro n="n_gen_nbr"/>
      </action>
    </rule>


    <rule comment="PREP + PRONOM">
      <pattern>
        <pattern-item n="prep"/>
        <pattern-item n="prntn"/>
      </pattern>
      <action>
        <call-macro n="f_concord1">
          <with-param pos="2"/>
        </call-macro>
        <choose>
          <!-- Si el pronom no té persona, no posem l'etiqueta de persona -->
          <when>
            <test>
              <equal>
                <clip pos="2" side="tl" part="a_pers"/>
                <lit v=""/>
              </equal>
            </test>
            <out>
              <chunk name="prep_prntn">
                <tags>
                  <tag><lit-tag v="SPrep"/></tag>
                  <tag><var n="genere_chunk"/></tag>
                  <tag><var n="nombre_chunk"/></tag>
                  <tag><clip pos="2" side="sl" part="a_cas"/></tag>
                  <tag><lit-tag v="def"/></tag>
                </tags>
                <lu>
                  <clip pos="1" side="tl" part="lem"/>
                  <clip pos="1" side="tl" part="a_prep"/>
                </lu>
                <b pos="1"/>
                <lu>
                  <clip pos="2" side="tl" part="lemh"/>
                  <clip pos="2" side="tl" part="a_prn"/>
                  <clip pos="2" side="tl" part="a_gen_sense_mf" link-to="2"/>
                  <clip pos="2" side="tl" part="a_gen_mf"/>
                  <clip pos="2" side="tl" part="a_nbr_sense_sp" link-to="3"/>
                  <clip pos="2" side="tl" part="a_nbr_sp"/>
                  <clip pos="2" side="tl" part="lemq"/>
                </lu>
              </chunk>
            </out>
          </when>
          <!-- Si el pronom té persona, posem l'etiqueta corresponent al chunk -->
          <otherwise>
            <out>
              <chunk name="prep_prntn">
                <tags>
                  <tag><lit-tag v="SPrep"/></tag>
                  <tag><clip pos="2" side="tl" part="a_pers"/></tag>
                  <tag><var n="genere_chunk"/></tag>
                  <tag><var n="nombre_chunk"/></tag>
                  <tag><clip pos="2" side="sl" part="a_cas"/></tag>
                  <tag><lit-tag v="def"/></tag>
                </tags>
                <lu>
                  <clip pos="1" side="tl" part="lem"/>
                  <clip pos="1" side="tl" part="a_prep"/>
                </lu>
                <b pos="1"/>
                <lu>
                  <clip pos="2" side="tl" part="lemh"/>
                  <clip pos="2" side="tl" part="a_prn"/>
                  <clip pos="2" side="tl" part="a_pers" link-to="2"/>
                  <clip pos="2" side="tl" part="a_gen_sense_mf" link-to="3"/>
                  <clip pos="2" side="tl" part="a_gen_mf"/>
                  <clip pos="2" side="tl" part="a_nbr_sense_sp" link-to="4"/>
                  <clip pos="2" side="tl" part="a_nbr_sp"/>
                  <clip pos="2" side="tl" part="lemq"/>
                </lu>
              </chunk>
            </out>
          </otherwise>
        </choose>
        <call-macro n="n_gen_nbr"/>
      </action>
    </rule>



<!-- Regles de SAdj -->

    <rule comment="ADJ">
      <pattern>
        <pattern-item n="adj"/>
      </pattern>
      <action>
        <call-macro n="f_concord1">
          <with-param pos="1"/>
        </call-macro>
        <!-- Nominatiu definit -->
        <choose>
          <when>
            <test>
              <and>
                <equal>
                  <clip pos="1" side="sl" part="a_def"/>
                  <lit-tag v="def"/>
                </equal>
                <equal>
                  <clip pos="1" side="sl" part="a_cas"/>
                  <lit-tag v="nom"/>
                </equal>
              </and>
            </test>
              <call-macro n="mod_maj">
                <with-param pos="1"/>
              </call-macro>
              <out>
                <chunk name="det_adj">
                <tags>
                  <tag><lit-tag v="SN"/></tag>
                  <tag><var n="genere_chunk"/></tag>
                  <tag><var n="nombre_chunk"/></tag>
                  <tag><clip pos="1" side="sl" part="a_cas"/></tag>
                  <tag><clip pos="1" side="sl" part="a_def"/></tag>
                </tags>
                <lu>
                <get-case-from pos="1">
                  <lit v="el"/>
                </get-case-from>
                  <lit-tag v="det.def"/>
                  <lit-tag v="2"/>
                  <lit-tag v="3"/>
                </lu>
                <b/>
                <lu>
                  <clip pos="1" side="tl" part="lemh"/>
                  <clip pos="1" side="tl" part="a_adj"/>
                  <clip pos="1" side="tl" part="a_gen_sense_mf" link-to="2"/>
                  <clip pos="1" side="tl" part="a_gen_mf"/>
                  <clip pos="1" side="tl" part="a_nbr_sense_sp" link-to="3"/>
                  <clip pos="1" side="tl" part="a_nbr_sp"/>
                  <clip pos="1" side="tl" part="lemq"/>
                </lu>
              </chunk>
            </out>
          </when>
        <!-- Datiu indefinit -->
          <when>
            <test>
              <and>
                <equal>
                  <clip pos="1" side="sl" part="a_def"/>
                  <lit-tag v="ind"/>
                </equal>
                <equal>
                  <clip pos="1" side="sl" part="a_cas"/>
                  <lit-tag v="dg"/>
                </equal>
              </and>
            </test>
              <call-macro n="mod_maj">
                <with-param pos="1"/>
              </call-macro>
              <out>
                <chunk name="prep_adj">
                <tags>
                  <tag><lit-tag v="SP"/></tag>
                  <tag><var n="genere_chunk"/></tag>
                  <tag><var n="nombre_chunk"/></tag>
                  <tag><clip pos="1" side="sl" part="a_cas"/></tag>
                  <tag><clip pos="1" side="sl" part="a_def"/></tag>
                </tags>
                <lu>
                <get-case-from pos="1">
                  <lit v="a"/>
                </get-case-from>
                  <lit-tag v="pr"/>
                </lu>
                <b/>
                <lu>
                  <clip pos="1" side="tl" part="lemh"/>
                  <clip pos="1" side="tl" part="a_adj"/>
                  <clip pos="1" side="tl" part="a_gen_sense_mf" link-to="2"/>
                  <clip pos="1" side="tl" part="a_gen_mf"/>
                  <clip pos="1" side="tl" part="a_nbr_sense_sp" link-to="3"/>
                  <clip pos="1" side="tl" part="a_nbr_sp"/>
                  <clip pos="1" side="tl" part="lemq"/>
                </lu>
              </chunk>
            </out>
          </when>
        <!-- Datiu definit -->
          <when>
            <test>
              <and>
                <equal>
                  <clip pos="1" side="sl" part="a_def"/>
                  <lit-tag v="def"/>
                </equal>
                <equal>
                  <clip pos="1" side="sl" part="a_cas"/>
                  <lit-tag v="dg"/>
                </equal>
              </and>
            </test>
              <call-macro n="mod_maj">
                <with-param pos="1"/>
              </call-macro>
              <out>
                <chunk name="prep_det_adj">
                <tags>
                  <tag><lit-tag v="SP"/></tag>
                  <tag><var n="genere_chunk"/></tag>
                  <tag><var n="nombre_chunk"/></tag>
                  <tag><clip pos="1" side="sl" part="a_cas"/></tag>
                  <tag><clip pos="1" side="sl" part="a_def"/></tag>
                </tags>
                <lu>
                <get-case-from pos="1">
                  <lit v="a"/>
                </get-case-from>
                  <lit-tag v="pr"/>
                </lu>
                <b/>
                <lu>
                  <lit v="el"/>
                  <lit-tag v="det.def"/>
                  <lit-tag v="2"/>
                  <lit-tag v="3"/>
                </lu>
                <b/>
                <lu>
                  <clip pos="1" side="tl" part="lemh"/>
                  <clip pos="1" side="tl" part="a_adj"/>
                  <clip pos="1" side="tl" part="a_gen_sense_mf" link-to="2"/>
                  <clip pos="1" side="tl" part="a_gen_mf"/>
                  <clip pos="1" side="tl" part="a_nbr_sense_sp" link-to="3"/>
                  <clip pos="1" side="tl" part="a_nbr_sp"/>
                  <clip pos="1" side="tl" part="lemq"/>
                </lu>
              </chunk>
            </out>
          </when>
        <!-- Nominatiu indefinit -->
          <otherwise>
              <out>
                <chunk name="adj">
                <tags>
                  <tag><lit-tag v="SAdj"/></tag>
                  <tag><var n="genere_chunk"/></tag>
                  <tag><var n="nombre_chunk"/></tag>
                  <tag><clip pos="1" side="sl" part="a_cas"/></tag>
                  <tag><clip pos="1" side="sl" part="a_def"/></tag>
                </tags>
                <lu>
                  <clip pos="1" side="tl" part="lemh"/>
                  <clip pos="1" side="tl" part="a_adj"/>
                  <clip pos="1" side="tl" part="a_gen_sense_mf" link-to="2"/>
                  <clip pos="1" side="tl" part="a_gen_mf"/>
                  <clip pos="1" side="tl" part="a_nbr_sense_sp" link-to="3"/>
                  <clip pos="1" side="tl" part="a_nbr_sp"/>
                  <clip pos="1" side="tl" part="lemq"/>
                </lu>
              </chunk>
            </out>
          </otherwise>
        </choose>
        <call-macro n="n_gen_nbr"/>
      </action>
    </rule>

    <rule comment="REGLA: PP">
      <pattern>
        <pattern-item n="pp"/>
      </pattern>
      <action>
        <out>
          <chunk name="pp">
            <tags>
              <tag><lit-tag v="SAdj"/></tag>
              <tag><lit-tag v="GD"/></tag>
              <tag><lit-tag v="ND"/></tag>
              <tag><lit-tag v="nom"/></tag>
              <tag><lit-tag v="ind"/></tag>
            </tags>
            <lu>
              <clip pos="1" side="tl" part="lemh"/>
              <clip pos="1" side="tl" part="a_verb"/>
              <clip pos="1" side="tl" part="a_temps"/>
              <lit-tag v="2"/>
              <lit-tag v="3"/>
              <clip pos="1" side="tl" part="lemq"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>

    <rule comment="REGLA: PP + ENC (per si no ho reconeix cap altra regla)">
      <pattern>
        <pattern-item n="pp"/>
        <pattern-item n="prnenc"/>
      </pattern>
      <action>
        <out>
          <chunk name="pp">
            <tags>
              <tag><lit-tag v="SAdj"/></tag>
              <tag><lit-tag v="GD"/></tag>
              <tag><lit-tag v="ND"/></tag>
              <tag><lit-tag v="nom"/></tag>
              <tag><lit-tag v="ind"/></tag>
            </tags>
            <lu>
              <clip pos="1" side="tl" part="lemh"/>
              <clip pos="1" side="tl" part="a_verb"/>
              <clip pos="1" side="tl" part="a_temps"/>
              <lit-tag v="2"/>
              <lit-tag v="3"/>
              <clip pos="1" side="tl" part="lemq"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>



<!-- Regles de SAdv -->

    <rule comment="PREP + NUMERAL (any)">
      <pattern>
        <pattern-item n="prepnum"/>
        <pattern-item n="num_xifra"/>
      </pattern>
      <action>
        <choose>
          <when>
            <test>
              <equal caseless="yes">
                <clip pos="1" side="sl" part="lem"/>
                <lit v="în"/>
              </equal>
            </test>
            <out>
              <chunk name="artdef_num">
              <tags>
                <tag><lit-tag v="SAdv"/></tag>
              </tags>
              <lu>
                <get-case-from pos="1">
                  <lit v="el"/>
                </get-case-from>
                <lit-tag v="det.def"/>
                <lit-tag v="m"/>
                <lit-tag v="sg"/>
              </lu>
              <b pos="1"/>
              <lu>
                <clip pos="2" side="tl" part="lemh"/>
                <clip pos="2" side="tl" part="a_num"/>
                <clip pos="2" side="tl" part="lemq"/>
              </lu>
              </chunk>
            </out>
          </when>
          <otherwise>
            <out>
              <chunk name="prep_num">
              <tags>
                <tag><lit-tag v="SAdv"/></tag>
              </tags>
              <lu>
                <clip pos="1" side="tl" part="lemh"/>
                <clip pos="1" side="tl" part="a_prep"/>
                <clip pos="1" side="tl" part="lemq"/>
              </lu>
              <b pos="1"/>
              <lu>
                <clip pos="2" side="tl" part="lemh"/>
                <clip pos="2" side="tl" part="a_num"/>
                <clip pos="2" side="tl" part="lemq"/>
              </lu>
              </chunk>
            </out>
          </otherwise>
        </choose>
      </action>
    </rule>

    <rule comment="PREP + NOM (any) + NUMERAL (any)">
      <pattern>
        <pattern-item n="prepnum"/>
        <pattern-item n="nom_any"/>
        <pattern-item n="num_xifra"/>
      </pattern>
      <action>
        <choose>
          <when>
            <test>
              <equal caseless="yes">
                <clip pos="1" side="sl" part="lem"/>
                <lit v="în"/>
              </equal>
            </test>
            <out>
              <chunk name="artdef_nom_num">
              <tags>
                <tag><lit-tag v="SAdv"/></tag>
              </tags>
              <lu>
                <get-case-from pos="1">
                  <lit v="el"/>
                </get-case-from>
                <lit-tag v="det.def"/>
                <lit-tag v="m"/>
                <lit-tag v="sg"/>
              </lu>
              <b pos="1"/>
              <lu>
                <clip pos="2" side="tl" part="lemh"/>
                <clip pos="2" side="tl" part="a_nom"/>
                <clip pos="2" side="tl" part="a_gen"/>
                <clip pos="2" side="tl" part="a_nbr"/>
                <clip pos="2" side="tl" part="lemq"/>
              </lu>
              <b pos="2"/>
              <lu>
                <clip pos="3" side="tl" part="lemh"/>
                <clip pos="3" side="tl" part="a_num"/>
                <clip pos="3" side="tl" part="lemq"/>
              </lu>
              </chunk>
            </out>
          </when>
          <otherwise>
            <out>
              <chunk name="prep_artdef_nom_num">
              <tags>
                <tag><lit-tag v="SAdv"/></tag>
              </tags>
              <lu>
                <clip pos="1" side="tl" part="lemh"/>
                <clip pos="1" side="tl" part="a_prep"/>
                <clip pos="1" side="tl" part="lemq"/>
              </lu>
              <lu>
                <get-case-from pos="1">
                  <lit v="el"/>
                </get-case-from>
                <lit-tag v="det.def"/>
                <lit-tag v="m"/>
                <lit-tag v="sg"/>
              </lu>
              <b pos="1"/>
              <lu>
                <clip pos="2" side="tl" part="lemh"/>
                <clip pos="2" side="tl" part="a_nom"/>
                <clip pos="2" side="tl" part="a_gen"/>
                <clip pos="2" side="tl" part="a_nbr"/>
                <clip pos="2" side="tl" part="lemq"/>
              </lu>
              <b pos="2"/>
              <lu>
                <clip pos="3" side="tl" part="lemh"/>
                <clip pos="3" side="tl" part="a_num"/>
                <clip pos="3" side="tl" part="lemq"/>
              </lu>
              </chunk>
            </out>
          </otherwise>
        </choose>
      </action>
    </rule>

    <rule comment="PREP + NUMERAL (dia) + NOM (mes) + NUMERAL (any)">
      <pattern>
        <pattern-item n="prep"/>
        <pattern-item n="num_xifra"/>
        <pattern-item n="mesos"/>
        <pattern-item n="num_xifra"/>
      </pattern>
      <action>
        <choose>
          <when>
            <test>
              <equal caseless="yes">
                <clip pos="1" side="sl" part="lem"/>
                <lit v="în"/>
              </equal>
            </test>
            <out>
              <chunk name="artdef_num">
              <tags>
                <tag><lit-tag v="SAdv"/></tag>
              </tags>
              <lu>
                <get-case-from pos="1">
                  <lit v="el"/>
                </get-case-from>
                <lit-tag v="det.def"/>
                <lit-tag v="m"/>
                <lit-tag v="sg"/>
              </lu>
              <b pos="1"/>
              <lu>
                <clip pos="2" side="tl" part="lemh"/>
                <clip pos="2" side="tl" part="a_num"/>
                <clip pos="2" side="tl" part="lemq"/>
              </lu>
              <b/>
              <lu>
                <lit v="de"/>
                <lit-tag v="pr"/>
              </lu>
              <b pos="2"/>
              <lu>
                <clip pos="3" side="tl" part="lemh"/>
                <clip pos="3" side="tl" part="a_nom"/>
                <clip pos="3" side="tl" part="a_gen"/>
                <clip pos="3" side="tl" part="a_nbr"/>
                <clip pos="3" side="tl" part="lemq"/>
              </lu>
              <b/>
              <lu>
                <lit v="de"/>
                <lit-tag v="pr"/>
              </lu>
              <b pos="3"/>
              <lu>
                <clip pos="4" side="tl" part="lemh"/>
                <clip pos="4" side="tl" part="a_num"/>
                <clip pos="4" side="tl" part="lemq"/>
              </lu>
              </chunk>
            </out>
          </when>
          <otherwise>
            <out>
              <chunk name="prep_num">
              <tags>
                <tag><lit-tag v="SAdv"/></tag>
              </tags>
              <lu>
                <clip pos="1" side="tl" part="lemh"/>
                <clip pos="1" side="tl" part="a_prep"/>
                <clip pos="1" side="tl" part="lemq"/>
              </lu>
              <b/>
              <lu>
                <get-case-from pos="1">
                  <lit v="el"/>
                </get-case-from>
                <lit-tag v="det.def"/>
                <lit-tag v="m"/>
                <lit-tag v="sg"/>
              </lu>
              <b pos="1"/>
              <lu>
                <clip pos="2" side="tl" part="lemh"/>
                <clip pos="2" side="tl" part="a_num"/>
                <clip pos="2" side="tl" part="lemq"/>
              </lu>
              <b/>
              <lu>
                <lit v="de"/>
                <lit-tag v="pr"/>
              </lu>
              <b pos="2"/>
              <lu>
                <clip pos="3" side="tl" part="lemh"/>
                <clip pos="3" side="tl" part="a_nom"/>
                <clip pos="3" side="tl" part="a_gen"/>
                <clip pos="3" side="tl" part="a_nbr"/>
                <clip pos="3" side="tl" part="lemq"/>
              </lu>
              <b/>
              <lu>
                <lit v="de"/>
                <lit-tag v="pr"/>
              </lu>
              <b pos="3"/>
              <lu>
                <clip pos="4" side="tl" part="lemh"/>
                <clip pos="4" side="tl" part="a_num"/>
                <clip pos="4" side="tl" part="lemq"/>
              </lu>
              </chunk>
            </out>
          </otherwise>
        </choose>
      </action>
    </rule>



<!-- Regles de SV -->

    <rule comment="REGLA: VERB CONJUGAT">
      <pattern>
        <pattern-item n="vbcnj"/>
      </pattern>
      <action>
        <call-macro n="conj_verb1">
          <with-param pos="1"/>
        </call-macro>
        <out>
          <chunk name="vbcnj">
            <tags>
              <tag><lit-tag v="SV"/></tag>
              <tag><clip pos="1" side="tl" part="a_verb"/></tag>
              <tag><var n="temps"/></tag>
              <tag><var n="persona"/></tag>
              <tag><var n="nombre"/></tag>
            </tags>
            <lu>
              <var n="auxiliar_lema"/>
              <var n="auxiliar"/>
              <var n="verb"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>

    <rule comment="REGLA: NU + VERB CONJUGAT">
      <pattern>
        <pattern-item n="advnu"/>
        <pattern-item n="vbcnj"/>
      </pattern>
      <action>
        <call-macro n="conj_verb1">
          <with-param pos="2"/>
        </call-macro>
        <out>
          <chunk name="nu_vbcnj">
            <tags>
              <tag><lit-tag v="SV"/></tag>
              <tag><clip pos="2" side="tl" part="a_verb"/></tag>
              <tag><var n="temps"/></tag>
              <tag><var n="persona"/></tag>
              <tag><var n="nombre"/></tag>
            </tags>
            <lu>
              <clip pos="1" side="tl" part="whole"/>
            </lu>
            <b pos="1"/>
            <lu>
              <var n="auxiliar_lema"/>
              <var n="auxiliar"/>
              <var n="verb"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>

    <rule comment="REGLA: CLÍTIC + VERB CONJUGAT">
      <pattern>
        <pattern-item n="prnproref"/>
        <pattern-item n="vbcnj"/>
      </pattern>
      <action>
        <call-macro n="conj_verb1">
          <with-param pos="2"/>
        </call-macro>
        <out>
          <chunk name="pro_vbcnj">
            <tags>
              <tag><lit-tag v="SV"/></tag>
              <tag><clip pos="2" side="tl" part="a_verb"/></tag>
              <tag><var n="temps"/></tag>
              <tag><var n="persona"/></tag>
              <tag><var n="nombre"/></tag>
            </tags>
            <lu>
              <clip pos="1" side="tl" part="lem"/>
              <clip pos="1" side="tl" part="a_prn"/>
              <clip pos="1" side="tl" part="a_pers"/>
              <clip pos="1" side="tl" part="a_gen"/>
              <clip pos="1" side="tl" part="a_nbr"/>
            </lu>
            <b pos="1"/>
            <lu>
              <var n="auxiliar_lema"/>
              <var n="auxiliar"/>
              <var n="verb"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>

    <rule comment="REGLA: NU + CLÍTIC + VERB CONJUGAT">
      <pattern>
        <pattern-item n="advnu"/>
        <pattern-item n="prnproref"/>
        <pattern-item n="vbcnj"/>
      </pattern>
      <action>
        <call-macro n="conj_verb1">
          <with-param pos="3"/>
        </call-macro>
        <out>
          <chunk name="nu_pro_vbcnj">
            <tags>
              <tag><lit-tag v="SV"/></tag>
              <tag><clip pos="3" side="tl" part="a_verb"/></tag>
              <tag><var n="temps"/></tag>
              <tag><var n="persona"/></tag>
              <tag><var n="nombre"/></tag>
            </tags>
            <lu>
              <clip pos="1" side="tl" part="whole"/>
            </lu>
            <b pos="1"/>
            <lu>
              <clip pos="2" side="tl" part="lem"/>
              <clip pos="2" side="tl" part="a_prn"/>
              <clip pos="2" side="tl" part="a_pers"/>
              <clip pos="2" side="tl" part="a_gen"/>
              <clip pos="2" side="tl" part="a_nbr"/>
            </lu>
            <b pos="2"/>
            <lu>
              <var n="auxiliar_lema"/>
              <var n="auxiliar"/>
              <var n="verb"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>

    <rule comment="REGLA: VERB CONJUGAT DOBLE">
      <pattern>
        <pattern-item n="vbcnj_doble1"/>
        <pattern-item n="vbcnj_doble2"/>
      </pattern>
      <action>
        <call-macro n="conj_verb2">
          <with-param pos="1"/>
          <with-param pos="2"/>
        </call-macro>
        <out>
          <chunk name="vbcnj">
            <tags>
              <tag><lit-tag v="SV"/></tag>
              <tag><clip pos="2" side="tl" part="a_verb"/></tag>
              <tag><var n="temps"/></tag>
              <tag><var n="persona"/></tag>
              <tag><var n="nombre"/></tag>
            </tags>
            <lu>
              <var n="auxiliar_lema"/>
              <var n="auxiliar"/>
              <var n="verb"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>

    <rule comment="REGLA: NU + VERB CONJUGAT DOBLE">
      <pattern>
        <pattern-item n="advnu"/>
        <pattern-item n="vbcnj_doble1"/>
        <pattern-item n="vbcnj_doble2"/>
      </pattern>
      <action>
        <call-macro n="conj_verb2">
          <with-param pos="2"/>
          <with-param pos="3"/>
        </call-macro>
        <out>
          <chunk name="nu_vbcnj">
            <tags>
              <tag><lit-tag v="SV"/></tag>
              <tag><clip pos="3" side="tl" part="a_verb"/></tag>
              <tag><var n="temps"/></tag>
              <tag><var n="persona"/></tag>
              <tag><var n="nombre"/></tag>
            </tags>
            <lu>
              <clip pos="1" side="tl" part="whole"/>
            </lu>
            <b pos="1"/>
            <lu>
              <var n="auxiliar_lema"/>
              <var n="auxiliar"/>
              <var n="verb"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>

    <rule comment="REGLA: VERB CONJUGAT DOBLE + CLÍTIC (-o)">
      <pattern>
        <pattern-item n="vbcnj_doble1"/>
        <pattern-item n="vbcnj_doble2"/>
        <pattern-item n="prnenc"/>
      </pattern>
      <action>
        <call-macro n="conj_verb2">
          <with-param pos="1"/>
          <with-param pos="2"/>
        </call-macro>
        <out>
          <chunk name="pro_vbcnj">
            <tags>
              <tag><lit-tag v="SV"/></tag>
              <tag><clip pos="2" side="tl" part="a_verb"/></tag>
              <tag><var n="temps"/></tag>
              <tag><var n="persona"/></tag>
              <tag><var n="nombre"/></tag>
            </tags>
            <lu>
            <get-case-from pos="1">
              <clip pos="3" side="tl" part="lem"/>
            </get-case-from>
              <lit-tag v="prn.pro"/>
              <clip pos="3" side="tl" part="a_pers"/>
              <clip pos="3" side="tl" part="gen"/>
              <clip pos="3" side="tl" part="a_nbr"/>
            </lu>
            <b/>
            <lu>
              <var n="auxiliar_lema"/>
              <var n="auxiliar"/>
              <var n="verb"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>

    <rule comment="REGLA: NU + VERB CONJUGAT DOBLE + CLÍTIC (-o)">
      <pattern>
        <pattern-item n="advnu"/>
        <pattern-item n="vbcnj_doble1"/>
        <pattern-item n="vbcnj_doble2"/>
        <pattern-item n="prnenc"/>
      </pattern>
      <action>
        <call-macro n="conj_verb2">
          <with-param pos="2"/>
          <with-param pos="3"/>
        </call-macro>
        <out>
          <chunk name="nu_pro_vbcnj">
            <tags>
              <tag><lit-tag v="SV"/></tag>
              <tag><clip pos="3" side="tl" part="a_verb"/></tag>
              <tag><var n="temps"/></tag>
              <tag><var n="persona"/></tag>
              <tag><var n="nombre"/></tag>
            </tags>
            <lu>
              <clip pos="1" side="tl" part="whole"/>
            </lu>
            <b pos="1"/>
            <lu>
            <get-case-from pos="1">
              <clip pos="4" side="tl" part="lem"/>
            </get-case-from>
              <lit-tag v="prn.pro"/>
              <clip pos="4" side="tl" part="a_pers"/>
              <clip pos="4" side="tl" part="gen"/>
              <clip pos="4" side="tl" part="a_nbr"/>
            </lu>
            <b/>
            <lu>
              <var n="auxiliar_lema"/>
              <var n="auxiliar"/>
              <var n="verb"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>

    <rule comment="REGLA: VERB CONJUGAT TRIPLE">
      <pattern>
        <pattern-item n="vbcnj_triple1"/>
        <pattern-item n="vbcnj_triple2"/>
        <pattern-item n="vbcnj_triple3"/>
      </pattern>
      <action>
        <call-macro n="conj_verb3">
          <with-param pos="1"/>
          <with-param pos="2"/>
          <with-param pos="3"/>
        </call-macro>
        <out>
          <chunk name="vbcnj">
            <tags>
              <tag><lit-tag v="SV"/></tag>
              <tag><clip pos="3" side="tl" part="a_verb"/></tag>
              <tag><var n="temps"/></tag>
              <tag><var n="persona"/></tag>
              <tag><var n="nombre"/></tag>
            </tags>
            <lu>
              <var n="auxiliar_lema"/>
              <var n="auxiliar"/>
              <var n="verb"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>

    <rule comment="REGLA: NU + VERB CONJUGAT TRIPLE">
      <pattern>
        <pattern-item n="advnu"/>
        <pattern-item n="vbcnj_triple1"/>
        <pattern-item n="vbcnj_triple2"/>
        <pattern-item n="vbcnj_triple3"/>
      </pattern>
      <action>
        <call-macro n="conj_verb3">
          <with-param pos="2"/>
          <with-param pos="3"/>
          <with-param pos="4"/>
        </call-macro>
        <out>
          <chunk name="nu_vbcnj">
            <tags>
              <tag><lit-tag v="SV"/></tag>
              <tag><clip pos="4" side="tl" part="a_verb"/></tag>
              <tag><var n="temps"/></tag>
              <tag><var n="persona"/></tag>
              <tag><var n="nombre"/></tag>
            </tags>
            <lu>
              <clip pos="1" side="tl" part="whole"/>
            </lu>
            <b pos="1"/>
            <lu>
              <var n="auxiliar_lema"/>
              <var n="auxiliar"/>
              <var n="verb"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>

    <rule comment="REGLA: INF">
      <pattern>
        <pattern-item n="inf"/>
      </pattern>
      <action>
        <out>
          <chunk name="inf">
            <tags>
              <tag><lit-tag v="SV"/></tag>
              <tag><clip pos="1" side="tl" part="a_verb"/></tag>
              <tag><clip pos="1" side="tl" part="a_temps"/></tag>
            </tags>
            <lu>   
              <clip pos="1" side="tl" part="lemh"/> 
              <clip pos="1" side="tl" part="a_verb"/>
              <lit-tag v="3"/>
              <clip pos="1" side="tl" part="lemq"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>

    <rule comment="REGLA: GER">
      <pattern>
        <pattern-item n="ger"/>
      </pattern>
      <action>
        <out>
          <chunk name="ger">
            <tags>
              <tag><lit-tag v="SV"/></tag>
              <tag><clip pos="1" side="tl" part="a_verb"/></tag>
              <tag><clip pos="1" side="tl" part="a_temps"/></tag>
            </tags>
            <lu>   
              <clip pos="1" side="tl" part="lemh"/> 
              <clip pos="1" side="tl" part="a_verb"/>
              <lit-tag v="3"/>
              <clip pos="1" side="tl" part="lemq"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>



<!-- Altres regles -->

    <rule comment="REGLA: CNJCOO">
      <pattern>
        <pattern-item n="cnjcoo"/>
      </pattern>
      <action>
        <choose>
          <when>
            <test>
              <or>
                <equal>
                  <clip pos="1" side="sl" part="lem"/>
                  <lit v="și"/>
                </equal>
                <equal>
                  <clip pos="1" side="sl" part="lem"/>
                  <lit v="sau"/>
                </equal>
              </or>
            </test>
            <out>
              <chunk name="cnjșisau">
                <tags>
                  <tag><lit-tag v="cnjcoo"/></tag>
                </tags>
                <lu>
                  <clip pos="1" side="tl" part="whole"/>
                </lu>
              </chunk>
            </out>
          </when>
          <otherwise>
            <out>
              <chunk name="cnjcoo">
                <tags>
                  <tag><lit-tag v="cnjcoo"/></tag>
                </tags>
                <lu>
                  <clip pos="1" side="tl" part="whole"/>
                </lu>
              </chunk>
            </out>
          </otherwise>
        </choose>
      </action>
    </rule>

    <rule comment="Reinicialitza les variables">
      <pattern>
        <pattern-item n="sent"/>
      </pattern>
      <action>
        <out>
          <chunk name="punt">
            <tags>
              <tag><lit-tag v="sent"/></tag>
            </tags>
            <lu>
              <clip pos="1" side="tl" part="whole"/>
            </lu>
          </chunk>
        </out>
        <call-macro n="n_gen_nbr"/>
      </action>
    </rule>






<!-- REGLES ANTIGUES -->


<!--  REGLA 81: PREP NOM NOM ADJ POS per a traduir "pentru cartea prietenei mele" com a "para el libro de mi amiga"
    <rule>
      <pattern>
        <pattern-item n="prep"/>
        <pattern-item n="nom"/>
        <pattern-item n="nom"/>
        <pattern-item n="adjpos"/>
      </pattern>
      <action>
        <call-macro n="f_modgen">
        <with-param pos="2"/>
      </call-macro>
        <call-macro n="f_modgen">
        <with-param pos="3"/>
      </call-macro>
        <call-macro n="f_modgen">
        <with-param pos="4"/>
      </call-macro>
         <call-macro n="f_concord1">
          <with-param pos="2"/>
        </call-macro>
        <call-macro n="f_concord2">
         <with-param pos="3"/>
         <with-param pos="4"/>
       </call-macro>
        <choose>
          <when>
            <test>
              <and>
                <equal>
                  <clip pos="2" side="sl" part="a_case"/>
                  <lit-tag v="nom"/>
                </equal>
                <equal>
                  <clip pos="2" side="sl" part="a_def"/>
                  <lit-tag v="def"/>
                </equal>
                <equal>
                  <clip pos="3" side="sl" part="a_case"/>
                  <lit-tag v="dg"/>
                </equal>
                <equal>
                  <clip pos="3" side="sl" part="a_def"/>
                  <lit-tag v="def"/>
                </equal>
              </and>
            </test>

            <call-macro n="mod_maj">
               <with-param pos="1"/>
            </call-macro>
            <out><chunk name="x"><tags><tag><lit-tag v="SX"/></tag></tags>
              <lu>
              <get-case-from pos="1">
                <clip pos="1" side="tl" part="lem"/>
               </get-case-from>
                <clip pos="1" side="tl" part="a_prep"/>
              </lu>
              <b/>
               <lu>
                <lit v="el"/>
                <lit-tag v="det.def"/>
                <clip pos="2" side="tl" part="gen"/>
                <clip pos="2" side="tl" part="a_nbr"/>
              </lu>
              <b/>
              <lu>
                <clip pos="2" side="tl" part="lem"/>
                <clip pos="2" side="tl" part="a_nom"/>
                <clip pos="2" side="tl" part="gen"/>
                <clip pos="2" side="tl" part="a_nbr"/>
              </lu>
              <b/>
              <lu>
                <lit v="de"/>
                <lit-tag v="pr"/>
              </lu>
              <b/>
               <lu>
                <lit v="el"/>
                <lit-tag v="det.def"/>
                <clip pos="3" side="tl" part="gen"/>
                <clip pos="3" side="tl" part="a_nbr"/>
              </lu>
               <b/>
              <lu>
                <clip pos="3" side="tl" part="lem"/>
                <clip pos="3" side="tl" part="a_adj"/>
                <clip pos="3" side="tl" part="gen"/>
                <clip pos="3" side="tl" part="a_nbr"/>
              </lu>
                <b/>
                <lu>
                <clip pos="4" side="tl" part="lem"/>
                <clip pos="4" side="tl" part="a_nom"/>
                <clip pos="4" side="tl" part="gen"/>
                <clip pos="4" side="tl" part="a_nbr"/>
              </lu>
            </chunk></out>
          </when>
          <otherwise>
            <out><chunk name="x"><tags><tag><lit-tag v="SX"/></tag></tags>
              <lu>
                <clip pos="1" side="tl" part="lem"/>
                <clip pos="1" side="tl" part="a_prep"/>
              </lu>
              <b/>
              <lu>
                <clip pos="2" side="tl" part="lem"/>
                <clip pos="2" side="tl" part="a_nom"/>
                <clip pos="2" side="tl" part="gen"/>
                <clip pos="2" side="tl" part="a_nbr"/>
              </lu>
              <b/>
              <lu>
                <lit v="el"/>
                <lit-tag v="det.def"/>
                <clip pos="3" side="tl" part="gen"/>
                <clip pos="3" side="tl" part="a_nbr"/>
              </lu>
               <b/>
              <lu>
                <clip pos="3" side="tl" part="lem"/>
                <clip pos="3" side="tl" part="a_adj"/>
                <clip pos="3" side="tl" part="gen"/>
                <clip pos="3" side="tl" part="a_nbr"/>
              </lu>
                <b/>
              <lu>
                <clip pos="4" side="tl" part="lem"/>
                <clip pos="4" side="tl" part="a_nom"/>
                <clip pos="4" side="tl" part="gen"/>
                <clip pos="4" side="tl" part="a_nbr"/>
              </lu>
            </chunk></out>
          </otherwise>
        </choose>
      </action>
    </rule> -->



<rule> <!-- REGLA 75 DELIA ADVNU + VB + ADVDECÂT + NOM: NO + VB + MÁS + QUE + NOMDEF-->
  <pattern>
      <pattern-item n="advnu"/>
      <pattern-item n="vbcnj"/>
      <pattern-item n="advdecât"/>
      <pattern-item n="nom"/>
    </pattern>
    <action>
      <call-macro n="f_modgen">
        <with-param pos="4"/>
      </call-macro>
      <choose>
          <when>
            <test>
                 <equal>
                  <clip pos="4" side="sl" part="a_def"/>
                  <lit-tag v="ind"/>
                </equal>
            </test>
          <out><chunk name="x"><tags><tag><lit-tag v="SX"/></tag></tags>
          <lu>
            <clip pos="1" side="tl" part="lem"/>
            <clip pos="1" side="tl" part="a_adv"/>
          </lu>
          <b/>
          <lu>
            <clip pos="2" side="tl" part="lemh"/>
            <clip pos="2" side="tl" part="a_verb"/>
            <clip pos="2" side="tl" part="a_temps"/>
            <clip pos="2" side="tl" part="gen"/>
            <clip pos="2" side="tl" part="a_pers"/>
            <clip pos="2" side="tl" part="a_nbr"/>
            <clip pos="2" side="tl" part="lemq"/>
          </lu>
          <b/>
          <lu>
            <lit v="més"/>
            <lit-tag v="adv"/>
          </lu>
          <b/>
          <lu>
            <lit v="que"/>
            <lit-tag v="adv"/>
          </lu>
          <b/>
          <lu>
          <clip pos="4" side="tl" part="lem"/>
                <clip pos="4" side="tl" part="a_det"/>
                <clip pos="4" side="tl" part="gen"/>
               <clip pos="4" side="tl" part="a_nbr"/>
          </lu>
          <b/>
          <lu>
                <clip pos="4" side="tl" part="lem"/>
                <clip pos="4" side="tl" part="a_nom"/>
                <clip pos="4" side="tl" part="gen"/>
                <clip pos="4" side="tl" part="a_nbr"/>
          </lu>
        </chunk></out>
        </when>
        <otherwise>
        <out><chunk name="x"><tags><tag><lit-tag v="SX"/></tag></tags>
          <lu>
            <clip pos="1" side="tl" part="lem"/>
            <clip pos="1" side="tl" part="a_adv"/>
          </lu>
          <b pos="1"/>
          <lu>
            <clip pos="2" side="tl" part="lem"/>
            <clip pos="2" side="tl" part="a_verb"/>
            <clip pos="2" side="tl" part="a_temps"/>
            <clip pos="2" side="tl" part="gen"/>
            <clip pos="2" side="tl" part="a_pers"/>
            <clip pos="2" side="tl" part="a_nbr"/>
          </lu>
          <b/>
          <lu>
            <lit v="més"/>
            <lit-tag v="adv"/>
          </lu>
          <b/>
          <lu>
            <lit v="que"/>
            <lit-tag v="adv"/>
          </lu>
          <b/>
          <lu>
                <clip pos="4" side="tl" part="lem"/>
                <clip pos="4" side="tl" part="a_nom"/>
                <clip pos="4" side="tl" part="gen"/>
                <clip pos="4" side="tl" part="a_nbr"/>
          </lu>
        </chunk></out>
      </otherwise>
     </choose>
    </action>
</rule>

<rule> <!-- REGLA 75BIS DELIA ADVNU + VB + ADVDECÂT + NOM: NO + VB + MÁS + QUE + NOM INDEF-->
  <pattern>
      <pattern-item n="advnu"/>
      <pattern-item n="vbcnj"/>
      <pattern-item n="advdecât"/>
        <pattern-item n="detind"/>
      <pattern-item n="nom"/>
    </pattern>
    <action>
      <call-macro n="f_modgen">
        <with-param pos="4"/>
      </call-macro>
      <choose>
          <when>
            <test>
                 <equal>
                  <clip pos="5" side="sl" part="a_def"/>
                  <lit-tag v="ind"/>
                </equal>
            </test>
          <out><chunk name="x"><tags><tag><lit-tag v="SX"/></tag></tags>
          <lu>
            <clip pos="1" side="tl" part="lem"/>
            <clip pos="1" side="tl" part="a_adv"/>
          </lu>
          <b/>
          <lu>
            <clip pos="2" side="tl" part="lemh"/>
            <clip pos="2" side="tl" part="a_verb"/>
            <clip pos="2" side="tl" part="a_temps"/>
            <clip pos="2" side="tl" part="gen"/>
            <clip pos="2" side="tl" part="a_pers"/>
            <clip pos="2" side="tl" part="a_nbr"/>
            <clip pos="2" side="tl" part="lemq"/>
          </lu>
          <b/>
          <lu>
            <lit v="més"/>
            <lit-tag v="adv"/>
          </lu>
          <b/>
          <lu>
            <lit v="que"/>
            <lit-tag v="adv"/>
          </lu>
          <b/>
          <lu>
          <clip pos="4" side="tl" part="lem"/>
                <clip pos="4" side="tl" part="a_det"/>
                <clip pos="4" side="tl" part="gen"/>
               <clip pos="4" side="tl" part="a_nbr"/>
          </lu>
          <b/>
          <lu>
                <clip pos="5" side="tl" part="lem"/>
                <clip pos="5" side="tl" part="a_nom"/>
                <clip pos="5" side="tl" part="gen"/>
                <clip pos="5" side="tl" part="a_nbr"/>
          </lu>
        </chunk></out>
        </when>
        <otherwise>
        <out><chunk name="x"><tags><tag><lit-tag v="SX"/></tag></tags>
          <lu>
            <clip pos="1" side="tl" part="lem"/>
            <clip pos="1" side="tl" part="a_adv"/>
          </lu>
          <b pos="1"/>
          <lu>
            <clip pos="2" side="tl" part="lem"/>
            <clip pos="2" side="tl" part="a_verb"/>
            <clip pos="2" side="tl" part="a_temps"/>
            <clip pos="2" side="tl" part="gen"/>
            <clip pos="2" side="tl" part="a_pers"/>
            <clip pos="2" side="tl" part="a_nbr"/>
          </lu>
          <b/>
          <lu>
            <lit v="més"/>
            <lit-tag v="adv"/>
          </lu>
          <b/>
          <lu>
            <lit v="que"/>
            <lit-tag v="adv"/>
          </lu>
          <b/>
          <lu>
                <clip pos="5" side="tl" part="lem"/>
                <clip pos="5" side="tl" part="a_nom"/>
                <clip pos="5" side="tl" part="gen"/>
                <clip pos="5" side="tl" part="a_nbr"/>
          </lu>
        </chunk></out>
      </otherwise>
     </choose>
    </action>
</rule>


<!--REGLA 1: NUMERAL NOM, o sigui la fecha 2 aprilie = 2 d'abril -->
    <rule>
      <pattern>
        <pattern-item n="num"/>
        <pattern-item n="mesos"/>
      </pattern>
      <action>
      <call-macro n="f_modgen">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="f_concord1_i">
          <with-param pos="1"/>
        </call-macro>
            <out><chunk name="x"><tags><tag><lit-tag v="SX"/></tag></tags>
             <lu>
               <get-case-from pos="1">
                 <clip pos="1" side="tl" part="whole"/>
                </get-case-from>
              </lu>
              <b/>
              <lu>
               <lit v="de"/>
               <lit-tag v="pr"/>
              </lu>
              <b/>
              <lu>
                <clip pos="2" side="tl" part="lem"/>
                <clip pos="2" side="tl" part="a_nom"/>
                <clip pos="2" side="tl" part="gen"/>
                <clip pos="2" side="tl" part="a_nbr"/>
              </lu>
            </chunk></out>
        <call-macro n="n_gen_nbr"/>
      </action>
    </rule>


<rule>
<!-- REGLA 2: VEU PASSIVA ADAPTADA: Nom + VbFI + adj = Nom + ser + part -->
<!-- Per a traduir  "Prăjitura e(ste) făcută din făină" com a "el pastíss és fet de farina" -->
      <pattern>
        <pattern-item n="nom"/>
        <pattern-item n="verbfi"/>
        <pattern-item n="adj"/>
      </pattern>
      <action>
       <call-macro n="f_modgen">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="f_modgen">
          <with-param pos="3"/>
        </call-macro>
        <call-macro n="f_concord2_i">
          <with-param pos="1"/>
          <with-param pos="3"/>
        </call-macro>
        <out><chunk name="x"><tags><tag><lit-tag v="SX"/></tag></tags>
          <lu>
                <get-case-from pos="1">
                <lit v="el"/>
                </get-case-from>
                <lit-tag v="det.def"/>
                <clip pos="1" side="tl" part="gen"/>
                <clip pos="1" side="tl" part="a_nbr"/>
           </lu>
           <b/>
           <lu>
              <clip pos="1" side="tl" part="lem"/>
              <clip pos="1" side="tl" part="a_nom"/>
              <clip pos="1" side="tl" part="gen"/>
              <clip pos="1" side="tl" part="a_nbr"/>
            </lu>
           <b/>
          <lu>
              <lit v="ser"/>
                <clip pos="2" side="tl" part="a_verb"/>
                <clip pos="2" side="tl" part="a_temps"/>
                <clip pos="2" side="tl" part="gen"/>
                <clip pos="2" side="tl" part="a_pers"/>
                <clip pos="2" side="tl" part="a_nbr"/>
          </lu>
          <b/>
          <lu>
            <clip pos="3" side="tl" part="lem"/>
            <clip pos="3" side="tl" part="a_adj"/>
            <clip pos="3" side="tl" part="gen"/>
            <clip pos="3" side="tl" part="a_nbr"/>
          </lu>
        </chunk></out>
        <call-macro n="n_gen_nbr"/>
      </action>
    </rule>

 <rule>
<!-- REGLA 3: VEU PASSIVA SENZILLA: Nom + VbFI + participi = Nom + ser + part -->
<!-- Per a traduir  "Prăjitura e(ste) făcută din făină" com a "el pastíss és fet de farina" -->
      <pattern>
        <pattern-item n="nom"/>
        <pattern-item n="verbfi"/>
        <pattern-item n="pp"/>
      </pattern>
      <action>
       <call-macro n="f_modgen">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="f_modgen">
          <with-param pos="3"/>
        </call-macro>
        <call-macro n="f_concord2_i">
          <with-param pos="1"/>
          <with-param pos="3"/>
        </call-macro>
        <call-macro n="mod_maj">
               <with-param pos="1"/>
            </call-macro>
        <out><chunk name="x"><tags><tag><lit-tag v="SX"/></tag></tags>
          <lu>
               <get-case-from pos="1">
                <lit v="el"/>
                </get-case-from>
                <lit-tag v="det.def"/>
                <clip pos="1" side="tl" part="gen"/>
                <clip pos="1" side="tl" part="a_nbr"/>
           </lu>
           <b/>
           <lu>
              <clip pos="1" side="tl" part="lem"/>
              <clip pos="1" side="tl" part="a_nom"/>
              <clip pos="1" side="tl" part="gen"/>
              <clip pos="1" side="tl" part="a_nbr"/>
            </lu>
           <b/>
           <lu>
              <lit v="ser"/>
                <clip pos="2" side="tl" part="a_verb"/>
                <clip pos="2" side="tl" part="a_temps"/>
                <clip pos="2" side="tl" part="gen"/>
                <clip pos="2" side="tl" part="a_pers"/>
                <clip pos="2" side="tl" part="a_nbr"/>
          </lu>
          <b/>
          <lu>
            <clip pos="3" side="tl" part="lem"/>
            <clip pos="3" side="tl" part="a_verb"/>
            <lit-tag v="pp"/>
            <clip pos="3" side="tl" part="gen"/>
            <clip pos="3" side="tl" part="a_nbr"/>
          </lu>
        </chunk></out>
        <call-macro n="n_gen_nbr"/>
      </action>
    </rule>


<rule>
<!-- REGLA 11 DELIA: NOM (def)+ DETA + Rel Cărui + Nom /cartea a cărei copertă = el llibre la portada del qual-->
      <pattern>
        <pattern-item n="nom"/>
        <pattern-item n="det_al"/>
        <pattern-item n="relcărui"/>
        <pattern-item n="nom"/>
      </pattern>
      <action>
        <call-macro n="f_modgen">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="f_modgen">
          <with-param pos="2"/>
        </call-macro>
         <call-macro n="f_modgen">
          <with-param pos="3"/>
        </call-macro>
        <call-macro n="f_modgen">
          <with-param pos="4"/>
        </call-macro>
          <choose>
              <when>
                <test>
                  <equal>
                    <clip pos="1" side="tl" part="gen"/>
                    <lit-tag v="mf"/>
                  </equal>
                </test>
               <out><chunk name="x"><tags><tag><lit-tag v="SX"/></tag></tags>
                  <lu>
                    <lit v="el"/>
                    <lit-tag v="det.def"/>
                    <clip pos="1" side="tl" part="gen"/>
                    <clip pos="1" side="tl" part="a_nbr"/>
                  </lu>
                 <b/>
                  <lu>
                    <clip pos="1" side="tl" part="lem"/>
                    <clip pos="1" side="tl" part="a_nom"/>
                    <clip pos="1" side="tl" part="gen"/>
                    <clip pos="1" side="tl" part="a_nbr"/>
                  </lu>
                  <b/>
           <lu>
                    <lit v="el"/>
                    <lit-tag v="det.def"/>
                    <clip pos="4" side="tl" part="gen"/>
                    <clip pos="4" side="tl" part="a_nbr"/>
                  </lu>
                 <b/>
              <lu>
                    <clip pos="4" side="tl" part="lem"/>
                    <clip pos="4" side="tl" part="a_nom"/>
                    <clip pos="4" side="tl" part="gen"/>
                    <clip pos="4" side="tl" part="a_nbr"/>
                  </lu>
                  <b/>
                 <lu>
                      <lit v="de"/>
                     <lit-tag v="pr"/>
                   </lu>
                   <b/>
                 <lu>
                    <lit v="el"/>
                    <lit-tag v="det.def"/>
                    <clip pos="1" side="tl" part="gen"/>
                    <clip pos="1" side="tl" part="a_nbr"/>
                  </lu>
                   <b/>
                     <lu>
                    <lit v="qual"/>
                    <lit-tag v="rel.aa"/>
                    <clip pos="1" side="tl" part="gen"/>
                    <clip pos="1" side="tl" part="a_nbr"/>
                  </lu>
                  <b/>
                  </chunk></out>
              </when>
              <otherwise>
               <out><chunk name="x"><tags><tag><lit-tag v="SX"/></tag></tags>
                   <lu>
                    <lit v="el"/>
                    <lit-tag v="det.def"/>
                    <clip pos="1" side="tl" part="gen"/>
                    <clip pos="1" side="tl" part="a_nbr"/>
                  </lu>
                 <b/>
                  <lu>
                    <clip pos="1" side="tl" part="lem"/>
                    <clip pos="1" side="tl" part="a_nom"/>
                    <clip pos="1" side="tl" part="gen"/>
                    <clip pos="1" side="tl" part="a_nbr"/>
                  </lu>
                  <b/>
                 <lu>
                    <lit v="el"/>
                    <lit-tag v="det.def"/>
                    <clip pos="4" side="tl" part="gen"/>
                    <clip pos="4" side="tl" part="a_nbr"/>
                  </lu>
                 <b/>
                  <lu>
                    <clip pos="4" side="tl" part="lem"/>
                    <clip pos="4" side="tl" part="a_nom"/>
                    <clip pos="4" side="tl" part="gen"/>
                    <clip pos="4" side="tl" part="a_nbr"/>
                  </lu>
                  <b/>
              <lu>
               <lit v="de"/>
               <lit-tag v="pr"/>
                   </lu>
               <b/>
                <lu>
                    <lit v="el"/>
                    <lit-tag v="det.def"/>
                    <clip pos="1" side="tl" part="gen"/>
                    <clip pos="1" side="tl" part="a_nbr"/>
                  </lu>
        <b/>
                     <lu>
                    <lit v="qual"/>
                    <lit-tag v="rel.aa"/>
                    <clip pos="1" side="tl" part="gen"/>
                    <clip pos="1" side="tl" part="a_nbr"/>
                  </lu>
                  <b/>
                  </chunk></out>
              </otherwise>
            </choose>
         </action>
    </rule>

<rule>
<!--REGLA COPY: prep "în" + nptop = a + nptop: în România -> a Romania -->
      <pattern>
        <pattern-item n="prep_în"/>
        <pattern-item n="nptop"/>
      </pattern>
      <action>
        <out><chunk name="x"><tags><tag><lit-tag v="SX"/></tag></tags>
          <lu>
            <get-case-from pos="1">
              <lit v="a"/>
            </get-case-from>
            <lit-tag v="pr"/>
          </lu>
          <b pos="1"/>
          <lu>
            <clip pos="2" side="tl" part="lem"/>
            <clip pos="2" side="tl" part="a_nptop"/>
          </lu>
        </chunk></out>
      </action>
    </rule>




<rule>
<!-- REGLA 23: PREP + NOM + ADJECTIU_POSESSIU-->
      <pattern>
        <pattern-item n="prep"/>
        <pattern-item n="nom"/>
        <pattern-item n="adjpos"/>
      </pattern>
       <action>
        <call-macro n="f_modgen">
          <with-param pos="2"/>
        </call-macro>
        <call-macro n="f_modgen">
          <with-param pos="3"/>
        </call-macro>
        <call-macro n="f_concord2_i">
          <with-param pos="2"/>
          <with-param pos="3"/>
        </call-macro>
        <call-macro n="mod_maj">
          <with-param pos="1"/>
        </call-macro>
           <choose>
          <when>
            <test>
                <and>
               <equal>
                  <clip pos="2" side="sl" part="a_case"/>
                  <lit-tag v="nom"/>
                </equal>
                <equal>
                  <clip pos="2" side="sl" part="a_def"/>
                  <lit-tag v="def"/>
                </equal>
                </and>
             </test>
             <out><chunk name="x"><tags><tag><lit-tag v="SX"/></tag></tags>
                  <lu>
                  <get-case-from pos="1">
                    <clip pos="1" side="tl" part="lem"/>
                    </get-case-from>
                    <clip pos="1" side="tl" part="a_prep"/>
                  </lu>
                  <b/>
                  <lu>
                   <lit v="el"/>
                    <lit-tag v="det.def"/>
                    <var n="genere1"/>
                    <var n="nombre1"/>
                  </lu>
                  <b pos="1"/>
                  <lu>
                    <clip pos="3" side="tl" part="lem"/>
                    <clip pos="3" side="tl" part="a_adj"/>
                    <clip pos="3" side="tl" part="gen"/>
                    <clip pos="3" side="tl" part="a_nbr"/><!-- correcció de la elecció del desambiguador-->
                  </lu>
                  <b pos="2"/>
                  <lu>
                    <clip pos="2" side="tl" part="lem"/>
                    <clip pos="2" side="tl" part="a_nom"/>
                    <clip pos="2" side="tl" part="gen"/>
                    <clip pos="2" side="tl" part="a_nbr"/>
                  </lu>
             </chunk></out>
           </when>
           <otherwise>
            <out><chunk name="x"><tags><tag><lit-tag v="SX"/></tag></tags>
              <lu>
                  <get-case-from pos="1">
                    <clip pos="1" side="tl" part="lem"/>
                    </get-case-from>
                    <clip pos="1" side="tl" part="a_prep"/>
                  </lu>
                  <b/>
                  <lu>
                   <lit v="de"/>
                    <lit-tag v="pr"/>
                  </lu>
                  <b/>
               <lu>
                   <lit v="el"/>
                    <lit-tag v="det.def"/>
                    <var n="genere1"/>
                    <var n="nombre1"/>
                  </lu>
                  <b/>
                  <lu>
                    <clip pos="3" side="tl" part="lem"/>
                    <clip pos="3" side="tl" part="a_adj"/>
                    <clip pos="3" side="tl" part="gen"/>
                    <clip pos="3" side="tl" part="a_nbr"/>
                  </lu>
                  <b/>
                  <lu>
                    <clip pos="2" side="tl" part="lem"/>
                    <clip pos="2" side="tl" part="a_nom"/>
                    <clip pos="2" side="tl" part="gen"/>
                    <clip pos="2" side="tl" part="a_nbr"/>
                  </lu>
             </chunk></out>
          </otherwise>
        </choose>
        <call-macro n="n_gen_nbr"/>
       </action>
    </rule>

<!-- REGLA 22 DATIU: VERB + NOM + DETpos = VERB + A + DETpos + NOM spun vecinului meu = dic al meu veí-->
    <rule>
      <pattern>
        <pattern-item n="vbcnj"/>
        <pattern-item n="nom"/>
        <pattern-item n="adjpos"/>
      </pattern>
      <action>
        <call-macro n="f_modgen">
        <with-param pos="2"/>
      </call-macro>
        <call-macro n="f_modgen">
        <with-param pos="3"/>
      </call-macro>
       <call-macro n="f_concord2_i">
         <with-param pos="2"/>
         <with-param pos="3"/>
       </call-macro>
       <choose>
          <when>
            <test>
                <and>
               <equal>
                  <clip pos="2" side="sl" part="a_case"/>
                  <lit-tag v="dg"/>
                </equal>
                <equal>
                  <clip pos="2" side="sl" part="a_def"/>
                  <lit-tag v="def"/>
                </equal>
                </and>
             </test>

            <out><chunk name="x"><tags><tag><lit-tag v="SX"/></tag></tags>
              <lu>
                <clip pos="1" side="tl" part="lemh"/>
                <clip pos="1" side="tl" part="a_verb"/>
                <clip pos="1" side="tl" part="a_temps"/>
                <clip pos="1" side="tl" part="a_pers"/>
                <clip pos="1" side="tl" part="gen"/>
                <clip pos="1" side="tl" part="a_nbr"/>
                <clip pos="1" side="tl" part="lemq"/>
              </lu>
              <b/>
              <lu>
                <lit v="a"/>
                <lit-tag v="pr"/>
              </lu>
              <b/>
              <lu>
                   <lit v="el"/>
                    <lit-tag v="det.def"/>
                    <var n="genere1"/>
                    <var n="nombre1"/>
                  </lu>
                  <b/>
                  <lu>
                    <clip pos="3" side="tl" part="lem"/>
                    <clip pos="3" side="tl" part="a_adj"/>
                    <clip pos="3" side="tl" part="gen"/>
                    <clip pos="3" side="tl" part="a_nbr"/>
                  </lu>
                  <b/>
                  <lu>
                    <clip pos="2" side="tl" part="lem"/>
                    <clip pos="2" side="tl" part="a_nom"/>
                    <clip pos="2" side="tl" part="gen"/>
                    <clip pos="2" side="tl" part="a_nbr"/>
                  </lu>
             </chunk></out>
           </when>
          <otherwise>
            <out><chunk name="x"><tags><tag><lit-tag v="SX"/></tag></tags>
              <lu>
                <clip pos="1" side="tl" part="lemh"/>
                <clip pos="1" side="tl" part="a_verb"/>
                <clip pos="1" side="tl" part="a_temps"/>
                <clip pos="1" side="tl" part="a_pers"/>
                <clip pos="1" side="tl" part="gen"/>
                <clip pos="1" side="tl" part="a_nbr"/>
                <clip pos="1" side="tl" part="lemq"/>
              </lu>
              <b/>
              <lu>
                   <lit v="el"/>
                    <lit-tag v="det.def"/>
                    <var n="genere1"/>
                    <var n="nombre1"/>
                  </lu>
                  <b/>
                  <lu>
                    <clip pos="3" side="tl" part="lem"/>
                    <clip pos="3" side="tl" part="a_adj"/>
                    <clip pos="3" side="tl" part="gen"/>
                    <clip pos="3" side="tl" part="a_nbr"/>
                  </lu>
                  <b/>
                  <lu>
                    <clip pos="2" side="tl" part="lem"/>
                    <clip pos="2" side="tl" part="a_nom"/>
                    <clip pos="2" side="tl" part="gen"/>
                    <clip pos="2" side="tl" part="a_nbr"/>
                  </lu>
            </chunk></out>
          </otherwise>
        </choose>
        <call-macro n="n_gen_nbr"/>
      </action>
    </rule>


<rule> <!--REGLA 69 VBTREBUI+ SÄ + VERB : HAVER + DE + INF -->
  <pattern>
      <pattern-item n="verbtrebui"/>
      <pattern-item n="conjsub"/>
      <pattern-item n="vbcnj"/>
    </pattern>
    <action>
     <call-macro n="f_modgen">
          <with-param pos="1"/>
        </call-macro>
    <choose>
        <when>
          <test>
            <equal>
              <clip pos="1" side="tl" part="a_temps"/>
              <lit-tag v="ger"/>
            </equal>
          </test>
          <out><chunk name="x"><tags><tag><lit-tag v="SX"/></tag></tags>
           <lu>
            <clip pos="1" side="tl" part="lemh"/>
            <clip pos="1" side="tl" part="a_verb"/>
            <clip pos="1" side="tl" part="a_temps"/>
          </lu>
           <b pos="1"/>
          <lu>
            <clip pos="3" side="tl" part="lemh"/>
            <clip pos="3" side="tl" part="a_verb"/>
            <lit-tag v="inf"/>
            <clip pos="3" side="tl" part="lemq"/>
          </lu>
        </chunk></out>
        </when>
        <otherwise>
        <out><chunk name="x"><tags><tag><lit-tag v="SX"/></tag></tags>
          <lu>
            <clip pos="1" side="tl" part="lemh"/>
            <clip pos="1" side="tl" part="a_verb"/>
            <clip pos="1" side="tl" part="a_temps"/>
            <clip pos="3" side="tl" part="a_pers"/>
            <clip pos="3" side="tl" part="gen"/>
            <clip pos="3" side="tl" part="a_nbr"/>
            <clip pos="1" side="tl" part="lemq"/>
          </lu>
          <b pos="1"/>
          <lu>
            <clip pos="3" side="tl" part="lemh"/>
            <clip pos="3" side="tl" part="a_verb"/>
            <lit-tag v="inf"/>
            <clip pos="3" side="tl" part="lemq"/>
          </lu>
        </chunk></out>
       </otherwise>
      </choose>
    </action>
</rule>

<!-- <rule> REGLA 69 VBTREBUI+ SÄ + VERB : HAVER + DE + INF
  <pattern>
      <pattern-item n="verbtrebui"/>
      <pattern-item n="conjsub"/>
      <pattern-item n="vbcnj"/>
    </pattern>
    <action>
     <call-macro n="f_modgen">
          <with-param pos="1"/>
        </call-macro>
    <choose>
        <when>
          <test>
            <equal>
              <clip pos="1" side="tl" part="a_temps"/>
              <lit-tag v="ger"/>
            </equal>
          </test>
          <out><chunk name="x"><tags><tag><lit-tag v="SX"/></tag></tags>
          <lu>
            <clip pos="1" side="tl" part="lemh"/>
            <clip pos="1" side="tl" part="a_verb"/>
            <clip pos="1" side="sl" part="a_temps"/>
            <clip pos="3" side="sl" part="a_pers"/>
            <clip pos="3" side="sl" part="gen"/>
            <clip pos="3" side="sl" part="a_nbr"/>
            <clip pos="1" side="tl" part="lemq"/>
          </lu>
           <b pos="1"/>
            <lu>
            <lit v="de"/>
            <lit-tag v="pr"/>
          </lu>
          <b pos="2"/>
          <lu>
            <clip pos="3" side="tl" part="lemh"/>
            <clip pos="3" side="tl" part="a_verb"/>
            <lit-tag v="inf"/>
            <clip pos="3" side="tl" part="lemq"/>
          </lu>
        </chunk></out>
        </when>
        <otherwise>
        <out><chunk name="x"><tags><tag><lit-tag v="SX"/></tag></tags>
          <lu>
            <clip pos="1" side="tl" part="lemh"/>
            <clip pos="1" side="tl" part="a_verb"/>
            <clip pos="1" side="tl" part="a_temps"/>
            <clip pos="3" side="tl" part="a_pers"/>
            <clip pos="1" side="tl" part="gen"/>
            <clip pos="3" side="tl" part="a_nbr"/>
            <clip pos="1" side="tl" part="lemq"/>
          </lu>
          <b pos="1"/>
            <lu>
            <lit v="de"/>
            <lit-tag v="pr"/>
          </lu>
          <b pos="2"/>
          <lu>
            <clip pos="3" side="tl" part="lemh"/>
            <clip pos="3" side="tl" part="a_verb"/>
            <lit-tag v="inf"/>
            <clip pos="3" side="tl" part="lemq"/>
          </lu>
        </chunk></out>
       </otherwise>
      </choose>
    </action>
</rule> -->


<!--REGLA 12: NUMERAL NOM NUMERAL, o sigui la fecha 2 aprilie 2007 = 2 de abril de 2007 -->
    <rule>
      <pattern>
        <pattern-item n="num"/>
        <pattern-item n="mesos"/>
        <pattern-item n="num"/>
      </pattern>
      <action>
      <call-macro n="f_modgen">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="f_concord1_i">
          <with-param pos="1"/>
        </call-macro>
         <call-macro n="f_modgen">
          <with-param pos="3"/>
        </call-macro>
        <call-macro n="f_concord1_i">
          <with-param pos="3"/>
        </call-macro>
            <out><chunk name="x"><tags><tag><lit-tag v="SX"/></tag></tags>
             <lu>
               <get-case-from pos="1">
                 <clip pos="1" side="tl" part="whole"/>
                </get-case-from>
              </lu>
              <b/>
              <lu>
               <lit v="de"/>
               <lit-tag v="pr"/>
              </lu>
              <b/>
              <lu>
                <clip pos="2" side="tl" part="lem"/>
                <clip pos="2" side="tl" part="a_nom"/>
                <clip pos="2" side="tl" part="gen"/>
                <clip pos="2" side="tl" part="a_nbr"/>
              </lu>
              <b/>
              <lu>
               <lit v="de"/>
               <lit-tag v="pr"/>
              </lu>
              <b/>
              <lu>
                <clip pos="3" side="tl" part="whole"/>
              </lu>
              <b/>
            </chunk></out>
        <call-macro n="n_gen_nbr"/>
      </action>
    </rule>

   <rule>
<!-- REGLA 13 DELIA: PREP NOM ADJ1   împotriva schimbării climatice = contra el canvi climàtic-->
      <pattern>
        <pattern-item n="prep"/>
        <pattern-item n="nom"/>
        <pattern-item n="adj"/>
      </pattern>
      <action>
        <call-macro n="f_modgen">
          <with-param pos="3"/>
        </call-macro>
        <call-macro n="f_concord2_i">
          <with-param pos="2"/>
          <with-param pos="3"/>
          </call-macro>
            <call-macro n="mod_maj">
              <with-param pos="1"/>
            </call-macro>
            <choose>
              <when>
                <test>
                  <and>
                  <equal>
                    <clip pos="2" side="tl" part="a_case"/>
                    <lit-tag v="dg"/>
                  </equal>
                  <equal>
                    <clip pos="2" side="tl" part="gen"/>
                    <lit-tag v="mf"/>
                  </equal>
                 </and>
                </test>
               <out><chunk name="x"><tags><tag><lit-tag v="SX"/></tag></tags>
                  <lu>
                   <get-case-from pos="1">
                    <clip pos="1" side="tl" part="lem"/>
                    </get-case-from>
                    <clip pos="1" side="tl" part="a_prep"/>
                   </lu>
                  <b/>
                   <lu>
                    <lit v="el"/>
                    <lit-tag v="det.def"/>
                    <var n="genere1"/>
                    <var n="nombre1"/>
                  </lu>
                  <b/>
                  <lu>
                    <clip pos="2" side="tl" part="lem"/>
                    <clip pos="2" side="tl" part="a_nom"/>
                    <clip pos="2" side="tl" part="gen"/>
                    <clip pos="2" side="tl" part="a_nbr"/>
                  </lu>
                  <b/>
                  <lu>
                    <clip pos="3" side="tl" part="lem"/>
                    <clip pos="3" side="tl" part="a_adj"/>
                    <clip pos="3" side="tl" part="gen"/>
                    <clip pos="3" side="tl" part="a_nbr"/>
                  </lu>
                  <b/>
                </chunk></out>
              </when>
              <otherwise>
               <out><chunk name="x"><tags><tag><lit-tag v="SX"/></tag></tags>
                  <lu>
                   <get-case-from pos="1">
                    <clip pos="1" side="tl" part="lem"/>
                    </get-case-from>
                    <clip pos="1" side="tl" part="a_prep"/>
                   </lu>
                  <b/>
                   <lu>
                    <lit v="el"/>
                    <lit-tag v="det.def"/>
                    <var n="genere1"/>
                    <var n="nombre1"/>
                  </lu>
                  <b/>
                  <lu>
                    <clip pos="2" side="tl" part="lem"/>
                    <clip pos="2" side="tl" part="a_nom"/>
                    <clip pos="2" side="tl" part="gen"/>
                    <clip pos="2" side="tl" part="a_nbr"/>
                  </lu>
                  <b/>
                  <lu>
                    <clip pos="3" side="tl" part="lem"/>
                    <clip pos="3" side="tl" part="a_adj"/>
                    <clip pos="3" side="tl" part="gen"/>
                    <clip pos="3" side="tl" part="a_nbr"/>
                  </lu>
                </chunk></out>
              </otherwise>
            </choose>
        <call-macro n="n_gen_nbr"/>
         </action>
    </rule>

 <rule>
<!-- REGLA 14 DELIA: PREP NOM ADJ1   împotriva schimbării climatice globale= contra el canvi climàtic global-->
      <pattern>
        <pattern-item n="prep"/>
        <pattern-item n="nom"/>
        <pattern-item n="adj"/>
        <pattern-item n="adj"/>
      </pattern>
      <action>
        <call-macro n="f_modgen">
          <with-param pos="3"/>
        </call-macro>
        <call-macro n="f_modgen">
          <with-param pos="4"/>
        </call-macro>
        <call-macro n="f_concord3_i">
          <with-param pos="2"/>
          <with-param pos="3"/>
          <with-param pos="4"/>
          </call-macro>
            <call-macro n="mod_maj">
              <with-param pos="1"/>
            </call-macro>
            <choose>
              <when>
                <test>
                  <and>
                  <equal>
                    <clip pos="2" side="tl" part="a_case"/>
                    <lit-tag v="dg"/>
                  </equal>
                  <equal>
                    <clip pos="2" side="tl" part="gen"/>
                    <lit-tag v="mf"/>
                  </equal>
                 </and>
                </test>
               <out><chunk name="x"><tags><tag><lit-tag v="SX"/></tag></tags>
                  <lu>
                   <get-case-from pos="1">
                    <clip pos="1" side="tl" part="lem"/>
                    </get-case-from>
                    <clip pos="1" side="tl" part="a_prep"/>
                   </lu>
                  <b/>
                   <lu>
                    <lit v="el"/>
                    <lit-tag v="det.def"/>
                    <var n="genere1"/>
                    <var n="nombre1"/>
                  </lu>
                  <b/>
                  <lu>
                    <clip pos="2" side="tl" part="lem"/>
                    <clip pos="2" side="tl" part="a_nom"/>
                    <clip pos="2" side="tl" part="gen"/>
                    <clip pos="2" side="tl" part="a_nbr"/>
                  </lu>
                  <b/>
                  <lu>
                    <clip pos="3" side="tl" part="lem"/>
                    <clip pos="3" side="tl" part="a_adj"/>
                    <clip pos="3" side="tl" part="gen"/>
                    <clip pos="3" side="tl" part="a_nbr"/>
                  </lu>
                  <b/>
                  <lu>
                    <clip pos="4" side="tl" part="lem"/>
                    <clip pos="4" side="tl" part="a_adj"/>
                    <clip pos="4" side="tl" part="gen"/>
                    <clip pos="4" side="tl" part="a_nbr"/>
                  </lu>
                </chunk></out>
              </when>
              <otherwise>
               <out><chunk name="x"><tags><tag><lit-tag v="SX"/></tag></tags>
                  <lu>
                   <get-case-from pos="1">
                    <clip pos="1" side="tl" part="lem"/>
                    </get-case-from>
                    <clip pos="1" side="tl" part="a_prep"/>
                   </lu>
                  <b/>
                   <lu>
                    <lit v="el"/>
                    <lit-tag v="det.def"/>
                    <var n="genere1"/>
                    <var n="nombre1"/>
                  </lu>
                  <b/>
                  <lu>
                    <clip pos="2" side="tl" part="lem"/>
                    <clip pos="2" side="tl" part="a_nom"/>
                    <clip pos="2" side="tl" part="gen"/>
                    <clip pos="2" side="tl" part="a_nbr"/>
                  </lu>
                  <b/>
                  <lu>
                    <clip pos="3" side="tl" part="lem"/>
                    <clip pos="3" side="tl" part="a_adj"/>
                    <clip pos="3" side="tl" part="gen"/>
                    <clip pos="3" side="tl" part="a_nbr"/>
                  </lu>
                  <b/>
                  <lu>
                    <clip pos="4" side="tl" part="lem"/>
                    <clip pos="4" side="tl" part="a_adj"/>
                    <clip pos="4" side="tl" part="gen"/>
                    <clip pos="4" side="tl" part="a_nbr"/>
                  </lu>
                </chunk></out>
              </otherwise>
            </choose>
        <call-macro n="n_gen_nbr"/>
         </action>
    </rule>


<rule>
<!-- REGLA 15 DELIA: PREP NOM NOMDG ADJ1  + ADJ2  referitor la limitarea schimbărilor climatice globale = relatiu a la reducció dels canvis climàtics-->
      <pattern>
        <pattern-item n="prep"/>
        <pattern-item n="nom"/>
        <pattern-item n="nom"/>
        <pattern-item n="adj"/>
        <pattern-item n="adj"/>
      </pattern>
      <action>
        <call-macro n="f_modgen">
          <with-param pos="4"/>
        </call-macro>
        <call-macro n="f_modgen">
          <with-param pos="5"/>
        </call-macro>
        <call-macro n="f_concord1_i">
          <with-param pos="2"/>
        </call-macro>
        <call-macro n="f_concord3_i">
          <with-param pos="3"/>
          <with-param pos="4"/>
          <with-param pos="5"/>
          </call-macro>
            <call-macro n="mod_maj">
              <with-param pos="1"/>
            </call-macro>
            <choose>
              <when>
                <test>
                  <equal>
                    <clip pos="2" side="tl" part="gen"/>
                    <lit-tag v="mf"/>
                  </equal>
                </test>
               <out><chunk name="x"><tags><tag><lit-tag v="SX"/></tag></tags>
                  <lu>
                   <get-case-from pos="1">
                    <clip pos="1" side="tl" part="lem"/>
                    </get-case-from>
                    <clip pos="1" side="tl" part="a_prep"/>
                   </lu>
                  <b/>
                   <lu>
                    <lit v="el"/>
                    <lit-tag v="det.def"/>
                    <var n="genere1"/>
                    <var n="nombre1"/>
                  </lu>
                  <b/>
                  <lu>
                    <clip pos="2" side="tl" part="lem"/>
                    <clip pos="2" side="tl" part="a_nom"/>
                    <clip pos="2" side="tl" part="gen"/>
                    <clip pos="2" side="tl" part="a_nbr"/>
                  </lu>
                  <b/>
                  <lu>
                    <lit v="de"/>
                    <lit-tag v="pr"/>
                  </lu>
                  <b/>
                 <lu>
                    <lit v="el"/>
                    <lit-tag v="det.def"/>
                    <var n="genere2"/>
                    <var n="nombre2"/>
                  </lu>
                  <b/>
                 <lu>
                    <clip pos="3" side="tl" part="lem"/>
                    <clip pos="3" side="tl" part="a_nom"/>
                    <clip pos="3" side="tl" part="gen"/>
                    <clip pos="3" side="tl" part="a_nbr"/>
                  </lu>
                  <b/>
                  <lu>
                    <clip pos="4" side="tl" part="lem"/>
                    <clip pos="4" side="tl" part="a_adj"/>
                    <clip pos="4" side="tl" part="gen"/>
                    <clip pos="4" side="tl" part="a_nbr"/>
                  </lu>
                  <b/>
                  <lu>
                    <clip pos="5" side="tl" part="lem"/>
                    <clip pos="5" side="tl" part="a_adj"/>
                    <clip pos="5" side="tl" part="gen"/>
                    <clip pos="5" side="tl" part="a_nbr"/>
                  </lu>
                </chunk></out>
              </when>
              <otherwise>
               <out><chunk name="x"><tags><tag><lit-tag v="SX"/></tag></tags>
                  <lu>
                   <get-case-from pos="1">
                    <clip pos="1" side="tl" part="lem"/>
                    </get-case-from>
                    <clip pos="1" side="tl" part="a_prep"/>
                   </lu>
                  <b/>
                   <lu>
                    <lit v="el"/>
                    <lit-tag v="det.def"/>
                    <var n="genere1"/>
                    <var n="nombre1"/>
                  </lu>
                  <b/>
                  <lu>
                    <clip pos="2" side="tl" part="lem"/>
                    <clip pos="2" side="tl" part="a_nom"/>
                    <clip pos="2" side="tl" part="gen"/>
                    <clip pos="2" side="tl" part="a_nbr"/>
                  </lu>
                  <b/>
                  <lu>
                    <lit v="de"/>
                    <lit-tag v="pr"/>
                  </lu>
                  <b/>
                 <lu>
                    <lit v="el"/>
                    <lit-tag v="det.def"/>
                    <var n="genere2"/>
                    <var n="nombre2"/>
                  </lu>
                   <b/>
                 <lu>
                    <clip pos="3" side="tl" part="lem"/>
                    <clip pos="3" side="tl" part="a_nom"/>
                    <clip pos="3" side="tl" part="gen"/>
                    <clip pos="3" side="tl" part="a_nbr"/>
                  </lu>
                  <b/>
                  <lu>
                    <clip pos="4" side="tl" part="lem"/>
                    <clip pos="4" side="tl" part="a_adj"/>
                    <clip pos="4" side="tl" part="gen"/>
                    <clip pos="4" side="tl" part="a_nbr"/>
                  </lu>
                   <b/>
                  <lu>
                    <clip pos="5" side="tl" part="lem"/>
                    <clip pos="5" side="tl" part="a_adj"/>
                    <clip pos="5" side="tl" part="gen"/>
                    <clip pos="5" side="tl" part="a_nbr"/>
                  </lu>
                </chunk></out>
              </otherwise>
            </choose>
        <call-macro n="n_gen_nbr"/>
         </action>
    </rule>




    <!-- REGLA 16 : VERB + NOM + ADJ= VERB + NOM + ADJ vând mașina nouă = venc el cotxe nou / vând mașini vechi = venc cotxes vells-->
    <rule>
      <pattern>
        <pattern-item n="vbcnj"/>
        <pattern-item n="nom"/>
        <pattern-item n="adj"/>
      </pattern>
      <action>
        <call-macro n="f_modgen">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="f_modgen">
          <with-param pos="2"/>
        </call-macro>
        <call-macro n="f_modgen">
          <with-param pos="3"/>
        </call-macro>
        <call-macro n="f_concord2_i">
          <with-param pos="2"/>
          <with-param pos="3"/>
        </call-macro>
        <call-macro n="conj_verb1">
          <with-param pos="1"/>
        </call-macro>
        <choose>
          <when>
            <test>
              <and>
                <equal>
                  <clip pos="2" side="sl" part="a_case"/>
                  <lit-tag v="nom"/>
                </equal>
                <equal>
                  <clip pos="2" side="sl" part="a_def"/>
                  <lit-tag v="def"/>
                </equal>
              </and>
            </test>
            <out><chunk name="x"><tags><tag><lit-tag v="SX"/></tag><tag><clip pos="1" side="tl" part="a_verb"/></tag><tag><var n="temps"/></tag><tag><var n="persona"/></tag><tag><var n="nombre"/></tag></tags>
              <lu>
                <var n="auxiliar_lema"/>
                <var n="auxiliar"/>
                <var n="verb"/>
              </lu>
              <b/>
              <lu>
                <lit v="el"/>
                <lit-tag v="det.def"/>
                <var n="genere"/>
                <var n="nombre"/>
              </lu>
              <b pos="1"/>
              <lu>
                <clip pos="2" side="tl" part="lem"/>
                <clip pos="2" side="tl" part="a_nom"/>
                <clip pos="2" side="tl" part="gen"/>
                <clip pos="2" side="tl" part="a_nbr"/>
              </lu>
               <b pos="2"/>
               <lu>
                <clip pos="3" side="tl" part="lem"/>
                <clip pos="3" side="tl" part="a_adj"/>
                <clip pos="3" side="tl" part="gen"/>
                <clip pos="3" side="tl" part="a_nbr"/>
              </lu>
            </chunk></out>
           </when>
          <otherwise>
            <out><chunk name="x"><tags><tag><lit-tag v="SX"/></tag><tag><clip pos="1" side="tl" part="a_verb"/></tag><tag><var n="temps"/></tag><tag><var n="persona"/></tag><tag><var n="nombre"/></tag></tags>
              <lu>
                <var n="auxiliar_lema"/>
                <var n="auxiliar"/>
                <var n="verb"/>
              </lu>
              <b pos="1"/>
              <lu>
                <clip pos="2" side="tl" part="lem"/>
                <clip pos="2" side="tl" part="a_nom"/>
                <clip pos="2" side="tl" part="gen"/>
                <clip pos="2" side="tl" part="a_nbr"/>
              </lu>
              <b pos="2"/>
              <lu>
                <clip pos="3" side="tl" part="lem"/>
                <clip pos="3" side="tl" part="a_adj"/>
                <clip pos="3" side="tl" part="gen"/>
                <clip pos="3" side="tl" part="a_nbr"/>
              </lu>
            </chunk></out>
          </otherwise>
        </choose>
        <call-macro n="n_gen_nbr"/>
      </action>
    </rule>


  <rule>
<!-- REGLA 17 DELIA: VERB NOM (det)+ DETIND + NOMDG dau caietele acestui copil (ambiguu) = dono els quaderns a aquest noi / dono els quaderns d'aquest noi-->
      <pattern>
        <pattern-item n="vbcnj"/>
        <pattern-item n="nom"/>
        <pattern-item n="det"/>
        <pattern-item n="nom"/>
      </pattern>
      <action>
        <call-macro n="f_modgen">
        <with-param pos="1"/>
        </call-macro>
        <call-macro n="f_modgen">
        <with-param pos="3"/>
        </call-macro>
         <choose>
              <when>
                <test>
                  <and>
                  <equal>
                    <clip pos="2" side="sl" part="a_case"/>
                    <lit-tag v="nom"/>
                  </equal>
                  <equal>
                    <clip pos="2" side="sl" part="a_case"/>
                    <lit-tag v="def"/>
                  </equal>
                  <equal>
                    <clip pos="3" side="sl" part="a_case"/>
                    <lit-tag v="dg"/>
                  </equal>
                  <equal>
                    <clip pos="4" side="sl" part="a_case"/>
                    <lit-tag v="dg"/>
                  </equal>
                  <equal>
                    <clip pos="4" side="sl" part="a_case"/>
                    <lit-tag v="ind"/>
                  </equal>
                 </and>
                </test>
               <out><chunk name="x"><tags><tag><lit-tag v="SX"/></tag></tags>
                  <lu>
                   <get-case-from pos="1">
                    <clip pos="1" side="tl" part="lemh"/>
                   </get-case-from>
                   <clip pos="1" side="tl" part="a_verb"/>
                   <clip pos="1" side="tl" part="a_temps"/>
                   <clip pos="1" side="tl" part="a_pers"/>
                   <clip pos="1" side="tl" part="gen"/>
                   <clip pos="1" side="tl" part="a_nbr"/>
                   <clip pos="1" side="tl" part="lemq"/>
                   </lu>
                 <b/>
                 <lu>
                    <lit v="el"/>
                    <lit-tag v="det.def"/>
                    <clip pos="2" side="tl" part="gen"/>
                    <clip pos="2" side="tl" part="a_nbr"/>
                  </lu>
                  <b/>
                  <lu>
                    <clip pos="2" side="tl" part="lem"/>
                    <clip pos="2" side="tl" part="a_nom"/>
                    <clip pos="2" side="tl" part="gen"/>
                    <clip pos="2" side="tl" part="a_nbr"/>
                  </lu>
                  <b/>
                  <lu>
                    <lit v="de"/>
                    <lit-tag v="pr"/>
                  </lu>
                  <b/>
                  <lu>
                    <clip pos="3" side="tl" part="lem"/>
                    <clip pos="3" side="tl" part="a_det"/>
                    <clip pos="3" side="sl" part="gen"/>
                    <clip pos="3" side="tl" part="a_nbr"/>
                  </lu>
                  <b/>
                 <lu>
                    <clip pos="4" side="tl" part="lem"/>
                    <clip pos="4" side="tl" part="a_nom"/>
                    <clip pos="4" side="tl" part="gen"/>
                    <clip pos="4" side="tl" part="a_nbr"/>
                  </lu>
                </chunk></out>
              </when>

              <otherwise>
               <out><chunk name="x"><tags><tag><lit-tag v="SX"/></tag></tags>
                  <lu>
                   <get-case-from pos="1">
                    <clip pos="1" side="tl" part="lemh"/>
                   </get-case-from>
                   <clip pos="1" side="tl" part="a_verb"/>
                   <clip pos="1" side="tl" part="a_temps"/>
                   <clip pos="1" side="tl" part="a_pers"/>
                   <clip pos="1" side="tl" part="gen"/>
                   <clip pos="1" side="tl" part="a_nbr"/>
                   <clip pos="1" side="tl" part="lemq"/>
                   </lu>
                 <b/>
                   <lu>
                    <lit v="el"/>
                    <lit-tag v="det.def"/>
                    <clip pos="2" side="tl" part="gen"/>
                    <clip pos="2" side="tl" part="a_nbr"/>
                  </lu>
                  <b/>
                  <lu>
                    <clip pos="2" side="tl" part="lem"/>
                    <clip pos="2" side="tl" part="a_nom"/>
                    <clip pos="2" side="tl" part="gen"/>
                    <clip pos="2" side="tl" part="a_nbr"/>
                  </lu>
                   <b/>
               <lu>
                    <lit v="de"/>
                    <lit-tag v="pr"/>
                  </lu>
                  <b/>
                  <lu>
                    <clip pos="3" side="tl" part="lem"/>
                    <clip pos="3" side="tl" part="a_det"/>
                    <clip pos="4" side="tl" part="gen"/>
                    <clip pos="4" side="tl" part="a_nbr"/>
                  </lu>
                  <b/>
                  <lu>
                    <clip pos="4" side="tl" part="lem"/>
                    <clip pos="4" side="tl" part="a_nom"/>
                    <clip pos="4" side="tl" part="gen"/>
                    <clip pos="4" side="tl" part="a_nbr"/>
                  </lu>
                </chunk></out>
              </otherwise>
           </choose>
        <call-macro n="n_gen_nbr"/>
         </action>
    </rule>


     <!--REGLA 19 DELIA: PREP PE + NOM PROPI pe Ion = A Ion / a Joan-->
      <rule>
      <pattern>
        <pattern-item n="preppe"/>
        <pattern-item n="npant"/>
      </pattern>
       <action>
        <out><chunk name="x"><tags><tag><lit-tag v="SX"/></tag></tags>
           <lu>
             <get-case-from pos="1">
              <lit v="a"/>
             </get-case-from>
              <lit-tag v="pr"/>
           </lu>
           <b/>
           <lu>
              <clip pos="2" side="tl" part="lem"/>
              <clip pos="2" side="tl" part="a_npant"/>
              <clip pos="2" side="tl" part="gen"/>
              <clip pos="2" side="tl" part="a_nbr"/>
            </lu>
         </chunk></out>
      </action>
    </rule>



 <!--REGLA 24 DELIA: PREP PE + PRONOM - PREP A + PRON pe el = a ell-->
      <rule>
      <pattern>
        <pattern-item n="preppe"/>
        <pattern-item n="prn"/>
      </pattern>
       <action>
      <choose>
       <when>
         <test>
           <equal>
              <clip pos="1" side="sl" part="lem"/>
                <lit v="pe"/>
           </equal>
        </test>
        <out><chunk name="x"><tags><tag><lit-tag v="SX"/></tag></tags>
           <lu>
             <get-case-from pos="1">
              <lit v="a"/>
             </get-case-from>
              <lit-tag v="pr"/>
           </lu>
           <b/>
           <lu>
              <clip pos="2" side="tl" part="lem"/>
              <clip pos="2" side="tl" part="a_prn"/>
              <clip pos="2" side="tl" part="a_pers"/>
              <clip pos="2" side="tl" part="gen"/>
              <clip pos="2" side="tl" part="a_nbr"/>
            </lu>
         </chunk></out>
         </when>
         <otherwise>
             <out><chunk name="x"><tags><tag><lit-tag v="SX"/></tag></tags>
                <lu>
                  <get-case-from pos="1">
                    <clip pos="1" side="tl" part="lem"/>
                    </get-case-from>
                    <clip pos="1" side="tl" part="a_prep"/>
                  </lu>
                  <b/>
                  <lu>
                    <clip pos="2" side="tl" part="lem"/>
                    <clip pos="2" side="tl" part="a_prn"/>
                    <clip pos="2" side="tl" part="a_pers"/>
                    <clip pos="2" side="tl" part="gen"/>
                    <clip pos="2" side="tl" part="a_nbr"/>
                  </lu>
                </chunk></out>
            </otherwise>
          </choose>
      </action>
    </rule>

  <!--REGLA 25 DELIA: PREP PE + DET - PREP A + DET-->
      <rule>
      <pattern>
        <pattern-item n="preppe"/>
        <pattern-item n="det"/>
      </pattern>
       <action>
      <choose>
       <when>
         <test>
           <equal>
              <clip pos="1" side="sl" part="lem"/>
                <lit v="pe"/>
           </equal>
        </test>
        <out><chunk name="x"><tags><tag><lit-tag v="SX"/></tag></tags>
           <lu>
             <get-case-from pos="1">
              <lit v="a"/>
             </get-case-from>
              <lit-tag v="pr"/>
           </lu>
           <b/>
           <lu>
              <clip pos="2" side="tl" part="lem"/>
              <clip pos="2" side="tl" part="a_det"/>
              <clip pos="2" side="tl" part="gen"/>
              <clip pos="2" side="tl" part="a_nbr"/>
            </lu>
         </chunk></out>
         </when>
         <otherwise>
             <out><chunk name="x"><tags><tag><lit-tag v="SX"/></tag></tags>
                <lu>
                  <get-case-from pos="1">
                    <clip pos="1" side="tl" part="lem"/>
                    </get-case-from>
                    <clip pos="1" side="tl" part="a_prep"/>
                  </lu>
                  <b/>
                  <lu>
                    <clip pos="2" side="tl" part="lem"/>
                    <clip pos="2" side="tl" part="a_det"/>
                    <clip pos="2" side="tl" part="gen"/>
                    <clip pos="2" side="tl" part="a_nbr"/>
                  </lu>
                </chunk></out>
            </otherwise>
          </choose>
      </action>
    </rule>

<!--REGLA 26 DELIA: VERB + PREP + NOM DEFINIT NOMINATIU + NOM DG = VERB + PREP + ART + NOM + DE +NOM pune pe coperta cărții = pone en la portada del libro-->
      <rule>
      <pattern>
        <pattern-item n="vbcnj"/>
        <pattern-item n="prep"/>
        <pattern-item n="nom"/>
        <pattern-item n="nom"/>
      </pattern>
       <action>
       <call-macro n="f_modgen">
        <with-param pos="1"/>
      </call-macro>
       <call-macro n="f_concord1_i">
          <with-param pos="3"/>
        </call-macro>
        <call-macro n="f_concord1_i">
          <with-param pos="4"/>
        </call-macro>
        <call-macro n="conj_verb1">
          <with-param pos="1"/>
        </call-macro>
         <choose>
          <when>
            <test>
              <and>
                <equal>
                  <clip pos="3" side="sl" part="a_def"/>
                  <lit-tag v="def"/>
                </equal>
                <equal>
                  <clip pos="3" side="sl" part="a_case"/>
                  <lit-tag v="nom"/>
                </equal>
                <equal>
                  <clip pos="4" side="sl" part="a_def"/>
                  <lit-tag v="def"/>
                </equal>
                <equal>
                  <clip pos="4" side="sl" part="a_case"/>
                  <lit-tag v="dg"/>
                </equal>
              </and>
            </test>
           <out><chunk name="x"><tags><tag><lit-tag v="SX"/></tag><tag><clip pos="1" side="tl" part="a_verb"/></tag><tag><var n="temps"/></tag><tag><var n="persona"/></tag><tag><var n="nombre"/></tag></tags>
                 <lu>
                    <var n="auxiliar_lema"/>
                    <var n="auxiliar"/>
                    <var n="verb"/>
                 </lu>
                 <b/>
                 <lu>
                    <clip pos="2" side="tl" part="lem"/>
                    <clip pos="2" side="tl" part="a_prep"/>
                 </lu>
                  <b/>
                  <lu>
                    <lit v="el"/>
                    <lit-tag v="det.def"/>
                    <clip pos="3" side="tl" part="gen"/>
                    <clip pos="3" side="tl" part="a_nbr"/>
                  </lu>
                  <b/>
                  <lu>
                    <clip pos="3" side="tl" part="lem"/>
                    <clip pos="3" side="tl" part="a_nom"/>
                    <clip pos="3" side="tl" part="gen"/>
                    <clip pos="3" side="tl" part="a_nbr"/>
                  </lu>
                  <b/>
                  <lu>
                   <lit v="de"/>
                    <lit-tag v="pr"/>
                   </lu>
                  <b/>
                  <lu>
                   <lit v="el"/>
                    <lit-tag v="det.def"/>
                    <clip pos="4" side="tl" part="gen"/>
                    <clip pos="4" side="tl" part="a_nbr"/>
                  </lu>
                  <b/>
                  <lu>
                    <clip pos="4" side="tl" part="lem"/>
                    <clip pos="4" side="tl" part="a_nom"/>
                    <clip pos="4" side="tl" part="gen"/>
                    <clip pos="4" side="tl" part="a_nbr"/>
                  </lu>
                </chunk></out>
              </when>
                <otherwise>
                <out><chunk name="x"><tags><tag><lit-tag v="SX"/></tag><tag><clip pos="1" side="tl" part="a_verb"/></tag><tag><var n="temps"/></tag><tag><var n="persona"/></tag><tag><var n="nombre"/></tag></tags>
                 <lu>
                    <var n="auxiliar_lema"/>
                    <var n="auxiliar"/>
                    <var n="verb"/>
                 </lu>
                 <b/>
                 <lu>
                    <clip pos="2" side="tl" part="lem"/>
                    <clip pos="2" side="tl" part="a_prep"/>
                 </lu>
                  <b/>
                  <lu>
                    <clip pos="3" side="tl" part="lem"/>
                    <clip pos="3" side="tl" part="a_nom"/>
                    <clip pos="3" side="tl" part="gen"/>
                    <clip pos="3" side="tl" part="a_nbr"/>
                  </lu>
                  <b/>
                  <lu>
                   <lit v="el"/>
                    <lit-tag v="det.def"/>
                    <clip pos="4" side="tl" part="gen"/>
                    <clip pos="4" side="tl" part="a_nbr"/>
                  </lu>
                  <b/>
                  <lu>
                    <clip pos="4" side="tl" part="lem"/>
                    <clip pos="4" side="tl" part="a_nom"/>
                    <clip pos="4" side="tl" part="gen"/>
                    <clip pos="4" side="tl" part="a_nbr"/>
                  </lu>
                </chunk></out>
              </otherwise>
             </choose>
        <call-macro n="n_gen_nbr"/>
           </action>
    </rule>

   <!--REGLA 27 DELIA: PREP + NOM DEFINIT NOMINATIU + NOM DG = PREP + ART + NOM + DE +NOM pe coperta cărții = en la portada del libro-->
      <rule>
      <pattern>
        <pattern-item n="prep"/>
        <pattern-item n="nom"/>
        <pattern-item n="nom_dg"/>
      </pattern>
       <action>
       <call-macro n="f_concord1_i">
          <with-param pos="2"/>
        </call-macro>
        <call-macro n="f_concord1_i">
          <with-param pos="3"/>
        </call-macro>
           <out><chunk name="x"><tags><tag><lit-tag v="SX"/></tag></tags>
                <lu>
                  <get-case-from pos="1">
                    <clip pos="1" side="tl" part="lem"/>
                    </get-case-from>
                    <clip pos="1" side="tl" part="a_prep"/>
                  </lu>
                  <b/>
                  <lu>
                    <lit v="el"/>
                    <lit-tag v="det.def"/>
                    <var n="genere1"/>
                    <var n="nombre1"/>
                  </lu>
                  <b/>
                  <lu>
                    <clip pos="2" side="tl" part="lem"/>
                    <clip pos="2" side="tl" part="a_nom"/>
                    <clip pos="2" side="tl" part="gen"/>
                    <clip pos="2" side="tl" part="a_nbr"/>
                  </lu>
                  <b/>
                  <lu>
                   <lit v="de"/>
                    <lit-tag v="pr"/>
                   </lu>
                  <b/>
                  <lu>
                   <lit v="el"/>
                    <lit-tag v="det.def"/>
                    <var n="genere2"/>
                    <var n="nombre2"/>
                  </lu>
                  <b/>
                  <lu>
                    <clip pos="3" side="tl" part="lem"/>
                    <clip pos="3" side="tl" part="a_nom"/>
                    <clip pos="3" side="tl" part="gen"/>
                    <clip pos="3" side="tl" part="a_nbr"/>
                  </lu>
                </chunk></out>
        <call-macro n="n_gen_nbr"/>
           </action>
    </rule>

 <!--REGLA 28: PREP + NOM INDEFINIT = PREP + ART + NOM pe masă = sobre la taula-->
      <rule>
      <pattern>
        <pattern-item n="prep"/>
        <pattern-item n="nom"/>
      </pattern>
       <action>
       <call-macro n="f_concord1_i">
          <with-param pos="2"/>
        </call-macro>
        <choose>
             <when>
               <test>
                <not>
                 <or>
                  <equal>
                    <clip pos="1" side="sl" part="lem"/>
                    <lit v="de"/>
                  </equal>
                  <equal>
                    <clip pos="1" side="sl" part="lem"/>
                    <lit v="fără"/>
                  </equal>
                </or>
                </not>
             </test>
             <out><chunk name="x"><tags><tag><lit-tag v="SX"/></tag></tags>
                <lu>
                  <get-case-from pos="1">
                    <clip pos="1" side="tl" part="lem"/>
                    </get-case-from>
                    <clip pos="1" side="tl" part="a_prep"/>
                  </lu>
                  <b/>
                  <lu>
                    <lit v="el"/>
                    <lit-tag v="det.def"/>
                    <var n="genere"/>
                    <var n="nombre"/>
                  </lu>
                  <b/>
                  <lu>
                    <clip pos="2" side="tl" part="lemh"/>
                    <clip pos="2" side="tl" part="a_nom"/>
                    <clip pos="2" side="tl" part="gen"/>
                    <clip pos="2" side="tl" part="a_nbr"/>
                    <clip pos="2" side="tl" part="lemq"/>
                  </lu>
                </chunk></out>
           </when>
           <otherwise>
             <out><chunk name="x"><tags><tag><lit-tag v="SX"/></tag></tags>
                <lu>
                  <get-case-from pos="1">
                    <clip pos="1" side="tl" part="lem"/>
                    </get-case-from>
                    <clip pos="1" side="tl" part="a_prep"/>
                  </lu>
                  <b/>
                  <lu>
                    <clip pos="2" side="tl" part="lemh"/>
                    <clip pos="2" side="tl" part="a_nom"/>
                    <clip pos="2" side="tl" part="gen"/>
                    <clip pos="2" side="tl" part="a_nbr"/>
                    <clip pos="2" side="tl" part="lemq"/>
                  </lu>
                </chunk></out>
            </otherwise>
         </choose>
        <call-macro n="n_gen_nbr"/>
        </action>
    </rule>


<!--REGLA 31 DELIA: PREP + NOM DEFINIT/INDEFINIT + ADJ1 + ADJ2 + ADJ3= PREP + ART + NOM + ADJ1 + ADJ 2 + ADJ 3 în casa mică minunată ieftină  = en la casa pequeța maravillosa barata SI NO; NO FA CONCORDANȘA MÚLTIPLE-->
      <rule>
      <pattern>
        <pattern-item n="prep"/>
        <pattern-item n="nom"/>
        <pattern-item n="adj"/>
        <pattern-item n="adj"/>
        <pattern-item n="adj"/>
      </pattern>
       <action>
      <call-macro n="f_modgen">
        <with-param pos="3"/>
      </call-macro>
      <call-macro n="f_modgen">
        <with-param pos="4"/>
      </call-macro>
      <call-macro n="f_modgen">
        <with-param pos="5"/>
      </call-macro>
       <call-macro n="f_concord4_i">
          <with-param pos="2"/>
          <with-param pos="3"/>
          <with-param pos="4"/>
          <with-param pos="5"/>
        </call-macro>
         <choose>
          <when>
            <test>
              <and>
                <equal>
                  <clip pos="2" side="sl" part="a_def"/>
                  <lit-tag v="def"/>
                </equal>
                <equal>
                  <clip pos="2" side="sl" part="a_case"/>
                  <lit-tag v="nom"/>
                </equal>
                <equal>
                  <clip pos="3" side="sl" part="a_def"/>
                  <lit-tag v="def"/>
                </equal>
                <equal>
                  <clip pos="3" side="sl" part="a_case"/>
                  <lit-tag v="dg"/>
                </equal>
              </and>
            </test>
           <out><chunk name="x"><tags><tag><lit-tag v="SX"/></tag></tags>
                <lu>
                  <get-case-from pos="1">
                    <clip pos="1" side="tl" part="lem"/>
                    </get-case-from>
                    <clip pos="1" side="tl" part="a_prep"/>
                  </lu>
                  <b/>
                  <lu>
                    <lit v="el"/>
                    <lit-tag v="det.def"/>
                    <clip pos="2" side="tl" part="gen"/>
                    <clip pos="2" side="tl" part="a_nbr"/>
                  </lu>
                  <b/>
                  <lu>
                    <clip pos="2" side="tl" part="lem"/>
                    <clip pos="2" side="tl" part="a_nom"/>
                    <clip pos="2" side="tl" part="gen"/>
                    <clip pos="2" side="tl" part="a_nbr"/>
                  </lu>
                  <b/>
                  <lu>
                    <clip pos="3" side="tl" part="lem"/>
                    <clip pos="3" side="tl" part="a_adj"/>
                    <clip pos="3" side="tl" part="gen"/>
                    <clip pos="3" side="tl" part="a_nbr"/>
                  </lu>
                  <b/>
                  <lu>
                    <clip pos="4" side="tl" part="lem"/>
                    <clip pos="4" side="tl" part="a_adj"/>
                    <clip pos="4" side="tl" part="gen"/>
                    <clip pos="4" side="tl" part="a_nbr"/>
                  </lu>
                  <b/>
                  <lu>
                    <clip pos="5" side="tl" part="lem"/>
                    <clip pos="5" side="tl" part="a_adj"/>
                    <clip pos="5" side="tl" part="gen"/>
                    <clip pos="5" side="tl" part="a_nbr"/>
                  </lu>
                </chunk></out>
              </when>
             <otherwise>
                <out><chunk name="x"><tags><tag><lit-tag v="SX"/></tag></tags>
                <lu>
                  <get-case-from pos="1">
                    <clip pos="1" side="tl" part="lem"/>
                    </get-case-from>
                    <clip pos="1" side="tl" part="a_prep"/>
                  </lu>
                  <b/>
                  <lu>
                    <clip pos="2" side="tl" part="lem"/>
                    <clip pos="2" side="tl" part="a_nom"/>
                    <clip pos="2" side="tl" part="gen"/>
                    <clip pos="2" side="tl" part="a_nbr"/>
                  </lu>
                  <b/>
                  <lu>
                    <clip pos="3" side="tl" part="lem"/>
                    <clip pos="3" side="tl" part="a_adj"/>
                    <clip pos="3" side="tl" part="gen"/>
                    <clip pos="3" side="tl" part="a_nbr"/>
                  </lu>
                  <b/>
                  <lu>
                    <clip pos="4" side="tl" part="lem"/>
                    <clip pos="4" side="tl" part="a_adj"/>
                    <clip pos="4" side="tl" part="gen"/>
                    <clip pos="4" side="tl" part="a_nbr"/>
                  </lu>
                  <b/>
                  <lu>
                    <clip pos="5" side="tl" part="lem"/>
                    <clip pos="5" side="tl" part="a_adj"/>
                    <clip pos="5" side="tl" part="gen"/>
                    <clip pos="5" side="tl" part="a_nbr"/>
                  </lu>
                </chunk></out>
            </otherwise>
          </choose>
        <call-macro n="n_gen_nbr"/>
         </action>
    </rule>

        <!-- <rule>
    <!-*- REGLA 4: NOM PROPI ALTRES-*->
      <pattern>
        <pattern-item n="npal"/>
      </pattern>
      <action>
        <call-macro n="f_concord1">
          <with-param pos="1"/>
        </call-macro>
        <choose>
          <when>
            <test>
              <and>
                <equal>
                  <clip pos="1" side="sl" part="a_def"/>
                  <lit-tag v="def"/>
                </equal>
                <equal>
                  <clip pos="1" side="sl" part="a_case"/>
                  <lit-tag v="nom"/>
                </equal>
              </and>
            </test>
            <choose>
              <when>
                <test>
                  <equal>
                    <clip pos="1" side="tl" part="gen"/>
                    <lit-tag v="mf"/>
                  </equal>
                </test>
                <out><chunk name="x"><tags><tag><lit-tag v="SX"/></tag></tags>
                  <lu>
                  <get-case-from pos="1">
                    <lit v="el"/>
                   </get-case-from>
                    <lit-tag v="det.def"/>
                    <clip pos="1" side="sl" part="gen"/>
                    <clip pos="1" side="sl" part="a_nbr"/>
                  </lu>
                  <b/>
                  <lu>
                    <clip pos="1" side="tl" part="lem"/>
                    <clip pos="1" side="tl" part="a_npal"/>
                    <clip pos="1" side="tl" part="gen"/>
                    <clip pos="1" side="tl" part="a_nbr"/>
                  </lu>
                </chunk></out>
              </when>
              <otherwise>
              <out><chunk name="x"><tags><tag><lit-tag v="SX"/></tag></tags>
                  <lu>
                   <get-case-from pos="1">
                    <lit v="el"/>
                   </get-case-from>
                    <lit-tag v="det.def"/>
                    <clip pos="1" side="tl" part="gen"/>
                    <clip pos="1" side="sl" part="a_nbr"/>
                  </lu>
                  <b/>
                  <lu>
                    <clip pos="1" side="tl" part="lem"/>
                    <clip pos="1" side="tl" part="a_npal"/>
                    <clip pos="1" side="tl" part="gen"/>
                    <clip pos="1" side="tl" part="a_nbr"/>
                  </lu>
                </chunk></out>
              </otherwise>
            </choose>
          </when>
          <otherwise>
            <choose>
              <when>
                <test>
                  <and>
                  <equal>
                    <clip pos="1" side="sl" part="a_def"/>
                    <lit-tag v="ind"/>
                  </equal>
                  <equal>
                    <clip pos="1" side="sl" part="a_case"/>
                    <lit-tag v="nom"/>
                  </equal>
                </and>
                </test>
                <out><chunk name="x"><tags><tag><lit-tag v="SX"/></tag></tags>
                  <lu>
                    <clip pos="1" side="tl" part="lem"/>
                    <clip pos="1" side="tl" part="a_npal"/>
                    <clip pos="1" side="tl" part="gen"/>
                    <clip pos="1" side="tl" part="a_nbr"/>
                  </lu>
                </chunk></out>
              </when>
            </choose>
          </otherwise>
        </choose>
        <choose>
          <when>
            <test>
              <and>
                <equal>
                  <clip pos="1" side="sl" part="a_def"/>
                  <lit-tag v="def"/>
                </equal>
                <equal>
                  <clip pos="1" side="sl" part="a_case"/>
                  <lit-tag v="dg"/>
                </equal>
              </and>
            </test>
            <choose>
              <when>
                <test>
                  <equal>
                    <clip pos="1" side="tl" part="gen"/>
                    <lit-tag v="mf"/>
                  </equal>
                </test>
                <out><chunk name="x"><tags><tag><lit-tag v="SX"/></tag></tags>
                  <lu>
                  <get-case-from pos="1">
                    <lit v="de"/>
                  </get-case-from>
                    <lit-tag v="pr"/>
                  </lu>
                  <b/>
                  <lu>
                    <lit v="el"/>
                    <lit-tag v="det.def"/>
                    <clip pos="1" side="sl" part="gen"/>
                    <clip pos="1" side="sl" part="a_nbr"/>
                  </lu>
                  <b/>
                  <lu>
                    <clip pos="1" side="tl" part="lem"/>
                    <clip pos="1" side="tl" part="a_npal"/>
                    <clip pos="1" side="tl" part="gen"/>
                    <clip pos="1" side="tl" part="a_nbr"/>
                  </lu>
                </chunk></out>
              </when>
                <otherwise>
                <out><chunk name="x"><tags><tag><lit-tag v="SX"/></tag></tags>
                  <lu>
                  <get-case-from pos="1">
                    <lit v="de"/>
                  </get-case-from>
                    <lit-tag v="pr"/>
                  </lu>
                  <b/>
                  <lu>
                    <lit v="el"/>
                    <lit-tag v="det.def"/>
                    <clip pos="1" side="tl" part="gen"/>
                    <clip pos="1" side="sl" part="a_nbr"/>
                  </lu>
                  <b/>
                  <lu>
                    <clip pos="1" side="tl" part="lem"/>
                    <clip pos="1" side="tl" part="a_npal"/>
                    <clip pos="1" side="tl" part="gen"/>
                    <clip pos="1" side="tl" part="a_nbr"/>
                  </lu>
                </chunk></out>
              </otherwise>
            </choose>
          </when>
          <otherwise>
            <choose>
              <when>
                <test>
                  <and>
                  <equal>
                    <clip pos="1" side="sl" part="a_def"/>
                    <lit-tag v="ind"/>
                  </equal>
                  <equal>
                    <clip pos="1" side="sl" part="a_case"/>
                    <lit-tag v="dg"/>
                  </equal>
                </and>
                </test>
                <out><chunk name="x"><tags><tag><lit-tag v="SX"/></tag></tags>
                  <lu>
                    <clip pos="1" side="tl" part="lem"/>
                    <clip pos="1" side="tl" part="a_npal"/>
                    <clip pos="1" side="tl" part="gen"/>
                    <clip pos="1" side="tl" part="a_nbr"/>
                  </lu>
                </chunk></out>
              </when>
            </choose>
          </otherwise>
        </choose>
      </action>
    </rule> -->


     <rule>
 <!--    REGLA 32: DETERMINANT-->
      <pattern>
        <pattern-item n="det_predet"/>
      </pattern>
      <action>
       <call-macro n="f_modgen">
        <with-param pos="1"/>
       </call-macro>
       <call-macro n="f_concord1_i">
        <with-param pos="1"/>
        </call-macro>
            <choose>
             <when>
              <test>
               <equal>
                <clip pos="1" side="tl" part="a_case"/>
                <lit-tag v="dg"/>
               </equal>
             </test>
             <call-macro n="mod_maj">
               <with-param pos="1"/>
              </call-macro>
             <out><chunk name="x"><tags><tag><lit-tag v="SX"/></tag></tags>
              <lu>
               <get-case-from pos="1">
               <lit v="de"/>
               </get-case-from>
               <lit-tag v="pr"/>
              </lu>
              <b/>
              <lu>
                <clip pos="1" side="tl" part="lem"/>
                <clip pos="1" side="tl" part="a_det"/>
                <clip pos="1" side="tl" part="gen"/>
                <clip pos="1" side="tl" part="a_nbr"/>
              </lu>
             </chunk></out>
            </when>
           <otherwise>
            <choose>
             <when>
              <test>
               <equal>
                <clip pos="1" side="tl" part="a_case"/>
                <lit-tag v="nom"/>
               </equal>
             </test>
             <out><chunk name="x"><tags><tag><lit-tag v="SX"/></tag></tags>
              <lu>
                <clip pos="1" side="tl" part="lem"/>
                <clip pos="1" side="tl" part="a_det"/>
                <clip pos="1" side="tl" part="gen"/>
                <clip pos="1" side="tl" part="a_nbr"/>
              </lu>
             </chunk></out>
            </when>
           </choose>
         </otherwise>
         </choose>
        <call-macro n="n_gen_nbr"/>
       </action>
  </rule>


<rule>
<!-- REGLA 36: ADJECTIU TOT NOM = toți copiii = tots els xiquets -->
      <pattern>
        <pattern-item n="adjtot"/>
        <pattern-item n="nom"/>
      </pattern>
      <action>
        <call-macro n="f_modgen">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="f_concord2_i">
          <with-param pos="2"/>
          <with-param pos="1"/>
        </call-macro>
               <out><chunk name="x"><tags><tag><lit-tag v="SX"/></tag></tags>
                  <lu>
                    <clip pos="1" side="tl" part="lem"/>
                    <clip pos="1" side="tl" part="a_adj"/>
                    <clip pos="1" side="tl" part="gen"/>
                    <clip pos="1" side="tl" part="a_nbr"/>
                  </lu>
                  <b/>
                  <lu>
                   <get-case-from pos="1">
                    <lit v="el"/>
                   </get-case-from>
                    <lit-tag v="det.def"/>
                    <clip pos="2" side="tl" part="gen"/>
                    <clip pos="2" side="tl" part="a_nbr"/>
                  </lu>
                  <b/>
                  <lu>
                    <clip pos="2" side="tl" part="lem"/>
                    <clip pos="2" side="tl" part="a_nom"/>
                    <clip pos="2" side="tl" part="gen"/>
                    <clip pos="2" side="tl" part="a_nbr"/>
                  </lu>
                </chunk></out>
        <call-macro n="n_gen_nbr"/>
      </action>
    </rule>

<rule>
   <!--  REGLA 37 DELIA: VB + TUTUROR = VB + A TODOS, otherwise DE TODOS  ex. am spus tuturor = vaig dir a tots, a tot el món / casa tuturor = la casa de tot@s -->
      <pattern>
        <pattern-item n="vbcnj"/>
        <pattern-item n="dettuturor"/>
      </pattern>
      <action>
             <call-macro n="mod_maj">
               <with-param pos="1"/>
            </call-macro>
               <out><chunk name="x"><tags><tag><lit-tag v="SX"/></tag></tags>
                  <lu>
                <clip pos="1" side="tl" part="lemh"/>
                <clip pos="1" side="tl" part="a_verb"/>
                <clip pos="1" side="tl" part="a_temps"/>
                <clip pos="1" side="tl" part="a_pers"/>
                <clip pos="1" side="tl" part="gen"/>
                <clip pos="1" side="tl" part="a_nbr"/>
                <clip pos="1" side="tl" part="lemq"/>
               </lu>
                <b/>
                  <lu>
                   <lit v="a"/>
                   <lit-tag v="pr"/>
                  </lu>
                 <b/>
                  <lu>
                   <clip pos="2" side="tl" part="lem"/>
                    <clip pos="2" side="tl" part="a_det"/>
                    <clip pos="2" side="sl" part="gen"/>
                    <clip pos="2" side="tl" part="a_nbr"/>
                </lu>
                </chunk></out>
       </action>
    </rule>

<rule>
   <!--  REGLA 38 DELIA: NOM + TUTUROR = NOM + DE TODOS ex. casa tuturor = la casa de tot@s -->
      <pattern>
        <pattern-item n="nom"/>
        <pattern-item n="dettuturor"/>
      </pattern>
      <action>
             <call-macro n="mod_maj">
               <with-param pos="1"/>
            </call-macro>
               <out><chunk name="x"><tags><tag><lit-tag v="SX"/></tag></tags>
                  <lu>
                    <clip pos="1" side="tl" part="lem"/>
                    <clip pos="1" side="tl" part="a_nom"/>
                    <clip pos="1" side="tl" part="gen"/>
                    <clip pos="1" side="tl" part="a_nbr"/>
                  </lu>
                <b/>
                  <lu>
                   <lit v="de"/>
                   <lit-tag v="pr"/>
                  </lu>
                 <b/>
                  <lu>
                   <clip pos="2" side="tl" part="lem"/>
                    <clip pos="2" side="tl" part="a_det"/>
                    <clip pos="2" side="sl" part="gen"/>
                    <clip pos="2" side="tl" part="a_nbr"/>
                </lu>
                </chunk></out>
       </action>
    </rule>


    <rule>
<!-- REGLA 40: rel -->
      <pattern>
        <pattern-item n="relat"/>
      </pattern>
      <action>
        <call-macro n="f_concord1_i">
          <with-param pos="1"/>
        </call-macro>
        <out><chunk name="x"><tags><tag><lit-tag v="SX"/></tag></tags>
          <lu>
            <clip pos="1" side="tl" part="lem"/>
            <clip pos="1" side="tl" part="a_relat"/>
            <clip pos="1" side="tl" part="gen"/>
            <clip pos="1" side="tl" part="a_nbr"/>

          </lu>
        </chunk></out>
        <call-macro n="n_gen_nbr"/>
      </action>
    </rule>






<!--  REGLA 43: VERB NOM NOM per a traduir "am dat cartea fetei" com a "vaig donar el llibre a la noia"  -->
    <rule>
      <pattern>
        <pattern-item n="vbcnj"/>
        <pattern-item n="nom"/>
        <pattern-item n="nom"/>
      </pattern>
      <action>
         <call-macro n="f_concord1_i">
          <with-param pos="2"/>
        </call-macro>
         <call-macro n="f_concord1_i">
          <with-param pos="3"/>
        </call-macro>
        <choose>
          <when>
            <test>
              <and>
                <equal>
                  <clip pos="2" side="sl" part="a_case"/>
                  <lit-tag v="nom"/>
                </equal>
                <equal>
                  <clip pos="2" side="sl" part="a_def"/>
                  <lit-tag v="def"/>
                </equal>
                <equal>
                  <clip pos="3" side="sl" part="a_case"/>
                  <lit-tag v="dg"/>
                </equal>
                <equal>
                  <clip pos="3" side="sl" part="a_def"/>
                  <lit-tag v="def"/>
                </equal>
              </and>
            </test>
            <call-macro n="mod_maj">
               <with-param pos="1"/>
            </call-macro>
            <out><chunk name="x"><tags><tag><lit-tag v="SX"/></tag></tags>
              <lu>
              <get-case-from pos="1">
                <clip pos="1" side="tl" part="lemh"/>
              </get-case-from>
                <clip pos="1" side="tl" part="a_verb"/>
                <clip pos="1" side="tl" part="a_temps"/>
                <clip pos="1" side="tl" part="a_pers"/>
                <clip pos="1" side="tl" part="gen"/>
                <clip pos="1" side="tl" part="a_nbr"/>
                <clip pos="1" side="tl" part="lemq"/>
               </lu>
               <b/>
               <lu>
                <lit v="el"/>
                <lit-tag v="det.def"/>
                <clip pos="2" side="tl" part="gen"/>
                <clip pos="2" side="tl" part="a_nbr"/>
              </lu>
              <b/>
              <lu>
                <clip pos="2" side="tl" part="lemh"/>
                <clip pos="2" side="tl" part="a_nom"/>
                <clip pos="2" side="tl" part="gen"/>
                <clip pos="2" side="tl" part="a_nbr"/>
                <clip pos="2" side="tl" part="lemq"/>
              </lu>
              <b/>
              <lu>
                <lit v="de"/>
                <lit-tag v="pr"/>
              </lu>
              <b/>
              <lu>
                <lit v="el"/>
                <lit-tag v="det.def"/>
                <clip pos="3" side="tl" part="gen"/>
                <clip pos="3" side="tl" part="a_nbr"/>
              </lu>
              <b/>
              <lu>
                <clip pos="3" side="tl" part="lemh"/>
                <clip pos="3" side="tl" part="a_nom"/>
                <clip pos="3" side="tl" part="gen"/>
                <clip pos="3" side="tl" part="a_nbr"/>
                <clip pos="3" side="tl" part="lemq"/>
              </lu>
            </chunk></out>
          </when>
          <otherwise>
            <out><chunk name="x"><tags><tag><lit-tag v="SX"/></tag></tags>
              <lu>
                <clip pos="1" side="tl" part="lemh"/>
                <clip pos="1" side="tl" part="a_verb"/>
                <clip pos="1" side="tl" part="a_temps"/>
                <clip pos="1" side="tl" part="a_pers"/>
                <clip pos="1" side="tl" part="gen"/>
                <clip pos="1" side="tl" part="a_nbr"/>
                <clip pos="1" side="tl" part="lemq"/>
               </lu>
               <b/>
               <lu>
                <clip pos="2" side="tl" part="lemh"/>
                <clip pos="2" side="tl" part="a_nom"/>
                <clip pos="2" side="tl" part="gen"/>
                <clip pos="2" side="tl" part="a_nbr"/>
                <clip pos="2" side="tl" part="lemq"/>
              </lu>
              <b/>
              <lu>
                <clip pos="3" side="tl" part="lemh"/>
                <clip pos="3" side="tl" part="a_nom"/>
                <clip pos="3" side="tl" part="gen"/>
                <clip pos="3" side="tl" part="a_nbr"/>
                <clip pos="3" side="tl" part="lemq"/>
              </lu>
            </chunk></out>
          </otherwise>
        </choose>
        <call-macro n="n_gen_nbr"/>
      </action>
    </rule>


  <rule>
<!-- REGLA 45 DELIA: ADJECTIU NOM + DETA + NOMDG  frumoasa legendă a teatrului = la bella llegenda del teatre-->
      <pattern>
        <pattern-item n="adj"/>
        <pattern-item n="nom"/>
        <pattern-item n="det_al"/>
        <pattern-item n="nom"/>
      </pattern>
      <action>
        <call-macro n="f_modgen">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="f_concord2_i">
          <with-param pos="2"/>
          <with-param pos="1"/>
          </call-macro>
            <call-macro n="mod_maj">
              <with-param pos="1"/>
            </call-macro>
            <choose>
              <when>
                <test>
                  <equal>
                    <clip pos="2" side="tl" part="gen"/>
                    <lit-tag v="mf"/>
                  </equal>
                </test>
               <out><chunk name="x"><tags><tag><lit-tag v="SX"/></tag></tags>
                  <lu>
                   <get-case-from pos="1">
                    <lit v="el"/>
                   </get-case-from>
                    <lit-tag v="det.def"/>
                    <clip pos="2" side="sl" part="gen"/>
                    <clip pos="2" side="tl" part="a_nbr"/>
                  </lu>
                  <b/>
                  <lu>
                    <clip pos="1" side="tl" part="lem"/>
                    <clip pos="1" side="tl" part="a_adj"/>
                    <clip pos="1" side="tl" part="gen"/>
                    <clip pos="1" side="tl" part="a_nbr"/>
                  </lu>
                  <b pos="1"/>
                  <lu>
                    <clip pos="2" side="tl" part="lem"/>
                    <clip pos="2" side="tl" part="a_nom"/>
                    <clip pos="2" side="tl" part="gen"/>
                    <clip pos="2" side="tl" part="a_nbr"/>
                  </lu>
                  <b pos="2"/>
                  <lu>
                    <lit v="de"/>
                    <lit-tag v="pr"/>
                  </lu>
                  <b pos="3"/>
                 <lu>
                    <lit v="el"/>
                    <lit-tag v="det.def"/>
                    <clip pos="4" side="tl" part="gen"/>
                    <clip pos="4" side="tl" part="a_nbr"/>
                  </lu>
                  <b/>
                 <lu>
                    <clip pos="4" side="tl" part="lem"/>
                    <clip pos="4" side="tl" part="a_nom"/>
                    <clip pos="4" side="tl" part="gen"/>
                    <clip pos="4" side="tl" part="a_nbr"/>
                  </lu>
                </chunk></out>
              </when>
              <otherwise>
               <out><chunk name="x"><tags><tag><lit-tag v="SX"/></tag></tags>
                  <lu>
                   <get-case-from pos="1">
                    <lit v="el"/>
                   </get-case-from>
                    <lit-tag v="det.def"/>
                    <clip pos="2" side="tl" part="gen"/>
                    <clip pos="2" side="tl" part="a_nbr"/>
                  </lu>
                  <b/>
                  <lu>

                    <clip pos="1" side="tl" part="lem"/>

                    <clip pos="1" side="tl" part="a_adj"/>
                    <clip pos="1" side="tl" part="gen"/>
                    <clip pos="1" side="tl" part="a_nbr"/>
                  </lu>
                  <b pos="1"/>
                  <lu>
                    <clip pos="2" side="tl" part="lem"/>
                    <clip pos="2" side="tl" part="a_nom"/>
                    <clip pos="2" side="tl" part="gen"/>
                    <clip pos="2" side="tl" part="a_nbr"/>
                  </lu>
                   <b pos="2"/>
                  <lu>
                    <lit v="de"/>
                    <lit-tag v="pr"/>
                  </lu>
                  <b pos="3"/>
                 <lu>
                    <lit v="el"/>
                    <lit-tag v="det.def"/>
                    <clip pos="4" side="tl" part="gen"/>
                    <clip pos="4" side="tl" part="a_nbr"/>
                  </lu>
                   <b/>
                 <lu>
                    <clip pos="4" side="tl" part="lem"/>
                    <clip pos="4" side="tl" part="a_nom"/>
                    <clip pos="4" side="tl" part="gen"/>
                    <clip pos="4" side="tl" part="a_nbr"/>
                  </lu>
                </chunk></out>
              </otherwise>
            </choose>
        <call-macro n="n_gen_nbr"/>
         </action>
    </rule>

<rule>
<!-- REGLA 46 DELIA: NOM ADJECTIU  + DETA + NOMDG  legenda frumoasă a teatrului = la llegenda bella del teatre-->
      <pattern>
        <pattern-item n="nom"/>
        <pattern-item n="adj"/>
        <pattern-item n="det_al"/>
        <pattern-item n="nom"/>
      </pattern>
      <action>
        <call-macro n="f_modgen">
          <with-param pos="2"/>
        </call-macro>
        <call-macro n="f_concord2_i">
          <with-param pos="1"/>
          <with-param pos="2"/>
          </call-macro>
            <call-macro n="mod_maj">
              <with-param pos="1"/>
            </call-macro>
            <choose>
              <when>
                <test>
                  <equal>
                    <clip pos="1" side="tl" part="gen"/>
                    <lit-tag v="mf"/>
                  </equal>
                </test>
               <out><chunk name="x"><tags><tag><lit-tag v="SX"/></tag></tags>
                  <lu>
                   <get-case-from pos="1">
                    <lit v="el"/>
                   </get-case-from>
                    <lit-tag v="det.def"/>
                    <clip pos="1" side="sl" part="gen"/>
                    <clip pos="1" side="tl" part="a_nbr"/>
                  </lu>
                  <b/>
                  <lu>
                    <clip pos="1" side="tl" part="lem"/>
                    <clip pos="1" side="tl" part="a_nom"/>
                    <clip pos="1" side="tl" part="gen"/>
                    <clip pos="1" side="tl" part="a_nbr"/>
                  </lu>
                  <b/>
                  <lu>
                    <clip pos="2" side="tl" part="lem"/>
                    <clip pos="2" side="tl" part="a_adj"/>
                    <clip pos="2" side="tl" part="gen"/>
                    <clip pos="2" side="tl" part="a_nbr"/>
                  </lu>
                  <b/>
                  <lu>
                    <lit v="de"/>
                    <lit-tag v="pr"/>
                  </lu>
                  <b/>
                 <lu>
                    <lit v="el"/>
                    <lit-tag v="det.def"/>
                    <clip pos="4" side="sl" part="gen"/>
                    <clip pos="4" side="tl" part="a_nbr"/>
                  </lu>
                  <b/>
                 <lu>
                    <clip pos="4" side="tl" part="lem"/>
                    <clip pos="4" side="tl" part="a_nom"/>
                    <clip pos="4" side="tl" part="gen"/>
                    <clip pos="4" side="tl" part="a_nbr"/>
                  </lu>
                </chunk></out>
              </when>
              <otherwise>
               <out><chunk name="x"><tags><tag><lit-tag v="SX"/></tag></tags>
                  <lu>
                   <get-case-from pos="1">
                    <lit v="el"/>
                   </get-case-from>
                    <lit-tag v="det.def"/>
                    <clip pos="1" side="tl" part="gen"/>
                    <clip pos="1" side="tl" part="a_nbr"/>
                  </lu>
                  <b/>
                  <lu>
                    <clip pos="1" side="tl" part="lem"/>
                    <clip pos="1" side="tl" part="a_nom"/>
                    <clip pos="1" side="tl" part="gen"/>
                    <clip pos="1" side="tl" part="a_nbr"/>
                  </lu>
                  <b/>
                  <lu>
                    <clip pos="2" side="tl" part="lem"/>
                    <clip pos="2" side="tl" part="a_adj"/>
                    <clip pos="2" side="tl" part="gen"/>
                    <clip pos="2" side="tl" part="a_nbr"/>
                  </lu>
                   <b/>
                  <lu>
                    <lit v="de"/>
                    <lit-tag v="pr"/>
                  </lu>
                  <b/>
                 <lu>
                    <lit v="el"/>
                    <lit-tag v="det.def"/>
                    <clip pos="4" side="tl" part="gen"/>
                    <clip pos="4" side="tl" part="a_nbr"/>
                  </lu>
                   <b/>
                 <lu>
                    <clip pos="4" side="tl" part="lem"/>
                    <clip pos="4" side="tl" part="a_nom"/>
                    <clip pos="4" side="tl" part="gen"/>
                    <clip pos="4" side="tl" part="a_nbr"/>
                  </lu>
                </chunk></out>
              </otherwise>
            </choose>
        <call-macro n="n_gen_nbr"/>
         </action>
    </rule>


<rule>
<!-- REGLA 47 DELIA: PREP NOM ADJECTIU  + DETA + NOMPROPIODG  de politica externa a României = de la política externa de Rumanía-->
      <pattern>
        <pattern-item n="prep"/>
        <pattern-item n="nom"/>
        <pattern-item n="adj"/>
        <pattern-item n="det_al"/>
        <pattern-item n="np"/>
      </pattern>
      <action>
        <call-macro n="f_modgen">
          <with-param pos="3"/>
        </call-macro>
        <call-macro n="f_concord2_i">
          <with-param pos="2"/>
          <with-param pos="3"/>
          </call-macro>
            <choose>
              <when>
                <test>
                  <equal>
                    <clip pos="2" side="tl" part="gen"/>
                    <lit-tag v="mf"/>
                  </equal>
                </test>
               <out><chunk name="x"><tags><tag><lit-tag v="SX"/></tag></tags>
                  <lu>
                   <get-case-from pos="1">
                    <clip pos="1" side="tl" part="lem"/>
                    </get-case-from>
                    <clip pos="1" side="tl" part="a_prep"/>
                   </lu>
                  <b/>
                   <lu>
                    <lit v="el"/>
                    <lit-tag v="det.def"/>
                    <clip pos="2" side="sl" part="gen"/>
                    <clip pos="2" side="tl" part="a_nbr"/>
                  </lu>
                  <b/>
                  <lu>
                    <clip pos="2" side="tl" part="lem"/>
                    <clip pos="2" side="tl" part="a_nom"/>
                    <clip pos="2" side="tl" part="gen"/>
                    <clip pos="2" side="tl" part="a_nbr"/>
                  </lu>
                  <b/>
                  <lu>
                    <clip pos="3" side="tl" part="lem"/>
                    <clip pos="3" side="tl" part="a_adj"/>
                    <clip pos="3" side="tl" part="gen"/>
                    <clip pos="3" side="tl" part="a_nbr"/>
                  </lu>
                  <b/>
                  <lu>
                    <lit v="de"/>
                    <lit-tag v="pr"/>
                  </lu>
                  <b/>
                 <lu>
                    <clip pos="5" side="tl" part="lem"/>
                    <clip pos="5" side="tl" part="a_np"/>
                    <clip pos="5" side="tl" part="gen"/>
                    <clip pos="5" side="tl" part="a_nbr"/>
                  </lu>
                </chunk></out>
              </when>
              <otherwise>
               <out><chunk name="x"><tags><tag><lit-tag v="SX"/></tag></tags>
                  <lu>
                   <get-case-from pos="1">
                    <clip pos="1" side="tl" part="lem"/>
                    </get-case-from>
                    <clip pos="1" side="tl" part="a_prep"/>
                   </lu>
                  <b/>
                   <lu>
                    <lit v="el"/>
                    <lit-tag v="det.def"/>
                    <clip pos="2" side="tl" part="gen"/>
                    <clip pos="2" side="tl" part="a_nbr"/>
                  </lu>
                  <b/>
                  <lu>
                    <clip pos="2" side="tl" part="lem"/>
                    <clip pos="2" side="tl" part="a_nom"/>
                    <clip pos="2" side="tl" part="gen"/>
                    <clip pos="2" side="tl" part="a_nbr"/>
                  </lu>
                  <b/>
                  <lu>
                    <clip pos="3" side="tl" part="lem"/>
                    <clip pos="3" side="tl" part="a_adj"/>
                    <clip pos="3" side="tl" part="gen"/>
                    <clip pos="3" side="tl" part="a_nbr"/>
                  </lu>
                   <b/>
                  <lu>
                    <lit v="de"/>
                    <lit-tag v="pr"/>
                  </lu>
                  <b/>
                 <lu>
                    <clip pos="5" side="tl" part="lem"/>
                    <clip pos="5" side="tl" part="a_np"/>
                    <clip pos="5" side="tl" part="gen"/>
                    <clip pos="5" side="tl" part="a_nbr"/>
                  </lu>
                </chunk></out>
              </otherwise>
            </choose>
        <call-macro n="n_gen_nbr"/>
         </action>
    </rule>


<rule>
<!-- REGLA 48 DELIA: PREP NOM ADJECTIU  + DETA + NOMDG  cu legenda frumoasă a teatrului = amb la llegenda bella del teatre-->
      <pattern>
        <pattern-item n="prep"/>
        <pattern-item n="nom"/>
        <pattern-item n="adj"/>
        <pattern-item n="det_al"/>
        <pattern-item n="nom"/>
      </pattern>
      <action>
        <call-macro n="f_modgen">
          <with-param pos="3"/>
        </call-macro>
        <call-macro n="f_modgen">
          <with-param pos="4"/>
        </call-macro>
        <call-macro n="f_concord2_i">
          <with-param pos="2"/>
          <with-param pos="3"/>
          </call-macro>
            <call-macro n="mod_maj">
              <with-param pos="1"/>
            </call-macro>
            <choose>
              <when>
                <test>
                  <equal>
                    <clip pos="2" side="tl" part="gen"/>
                    <lit-tag v="mf"/>
                  </equal>
                </test>
               <out><chunk name="x"><tags><tag><lit-tag v="SX"/></tag></tags>
                  <lu>
                   <get-case-from pos="1">
                    <clip pos="1" side="tl" part="lem"/>
                    </get-case-from>
                    <clip pos="1" side="tl" part="a_prep"/>
                   </lu>
                  <b/>
                   <lu>
                    <lit v="el"/>
                    <lit-tag v="det.def"/>
                    <clip pos="2" side="sl" part="gen"/>
                    <clip pos="2" side="tl" part="a_nbr"/>
                  </lu>
                  <b/>
                  <lu>
                    <clip pos="2" side="tl" part="lem"/>
                    <clip pos="2" side="tl" part="a_nom"/>
                    <clip pos="2" side="tl" part="gen"/>
                    <clip pos="2" side="tl" part="a_nbr"/>
                  </lu>
                  <b/>
                  <lu>
                    <clip pos="3" side="tl" part="lem"/>
                    <clip pos="3" side="tl" part="a_adj"/>
                    <clip pos="3" side="tl" part="gen"/>
                    <clip pos="3" side="tl" part="a_nbr"/>
                  </lu>
                  <b/>
                  <lu>
                    <lit v="de"/>
                    <lit-tag v="pr"/>
                  </lu>
                  <b/>
                 <lu>
                    <lit v="el"/>
                    <lit-tag v="det.def"/>
                    <clip pos="5" side="sl" part="gen"/>
                    <clip pos="5" side="tl" part="a_nbr"/>
                  </lu>
                  <b/>
                 <lu>
                    <clip pos="5" side="tl" part="lem"/>
                    <clip pos="5" side="tl" part="a_nom"/>
                    <clip pos="5" side="tl" part="gen"/>
                    <clip pos="5" side="tl" part="a_nbr"/>
                  </lu>
                </chunk></out>
              </when>
              <otherwise>
               <out><chunk name="x"><tags><tag><lit-tag v="SX"/></tag></tags>
                  <lu>
                   <get-case-from pos="1">
                    <clip pos="1" side="tl" part="lem"/>
                    </get-case-from>
                    <clip pos="1" side="tl" part="a_prep"/>
                   </lu>
                  <b/>
                   <lu>
                    <lit v="el"/>
                    <lit-tag v="det.def"/>
                    <clip pos="2" side="tl" part="gen"/>
                    <clip pos="2" side="tl" part="a_nbr"/>
                  </lu>
                  <b/>
                  <lu>
                    <clip pos="2" side="tl" part="lem"/>
                    <clip pos="2" side="tl" part="a_nom"/>
                    <clip pos="2" side="tl" part="gen"/>
                    <clip pos="2" side="tl" part="a_nbr"/>
                  </lu>
                  <b/>
                  <lu>
                    <clip pos="3" side="tl" part="lem"/>
                    <clip pos="3" side="tl" part="a_adj"/>
                    <clip pos="3" side="tl" part="gen"/>
                    <clip pos="3" side="tl" part="a_nbr"/>
                  </lu>
                   <b/>
                  <lu>
                    <lit v="de"/>
                    <lit-tag v="pr"/>
                  </lu>
                  <b/>
                 <lu>
                    <lit v="el"/>
                    <lit-tag v="det.def"/>
                    <clip pos="5" side="tl" part="gen"/>
                    <clip pos="5" side="tl" part="a_nbr"/>
                  </lu>
                   <b/>
                 <lu>
                    <clip pos="5" side="tl" part="lem"/>
                    <clip pos="5" side="tl" part="a_nom"/>
                    <clip pos="5" side="tl" part="gen"/>
                    <clip pos="5" side="tl" part="a_nbr"/>
                  </lu>
                </chunk></out>
              </otherwise>
            </choose>
        <call-macro n="n_gen_nbr"/>
         </action>
    </rule>


<rule>
<!-- REGLA 50 DELIA: NOM (ind)+ DETA + NOMDG -->
      <pattern>
        <pattern-item n="nom"/>
        <pattern-item n="det_al"/>
        <pattern-item n="nom"/>
      </pattern>
      <action>
          <choose>
              <when>
                <test>
                  <equal>
                    <clip pos="1" side="tl" part="gen"/>
                    <lit-tag v="mf"/>
                  </equal>
                </test>
               <out><chunk name="x"><tags><tag><lit-tag v="SX"/></tag></tags>
                  <lu>
                    <clip pos="1" side="tl" part="lem"/>
                    <clip pos="1" side="tl" part="a_nom"/>
                    <clip pos="1" side="tl" part="gen"/>
                    <clip pos="1" side="tl" part="a_nbr"/>
                  </lu>
                  <b pos="1"/>
                  <lu>
                    <lit v="de"/>
                    <lit-tag v="pr"/>
                  </lu>
                  <b pos="2"/>
                 <lu>
                    <lit v="el"/>
                    <lit-tag v="det.def"/>
                    <clip pos="3" side="tl" part="gen"/>
                    <clip pos="3" side="tl" part="a_nbr"/>
                  </lu>
                  <b/>
                 <lu>
                    <clip pos="3" side="tl" part="lem"/>
                    <clip pos="3" side="tl" part="a_nom"/>
                    <clip pos="3" side="tl" part="gen"/>
                    <clip pos="3" side="tl" part="a_nbr"/>
                  </lu>
                </chunk></out>
              </when>
              <otherwise>
               <out><chunk name="x"><tags><tag><lit-tag v="SX"/></tag></tags>
                  <lu>
                    <clip pos="1" side="tl" part="lem"/>
                    <clip pos="1" side="tl" part="a_nom"/>
                    <clip pos="1" side="tl" part="gen"/>
                    <clip pos="1" side="tl" part="a_nbr"/>
                  </lu>
                   <b pos="1"/>
                  <lu>
                    <lit v="de"/>
                    <lit-tag v="pr"/>
                  </lu>
                  <b pos="2"/>
                 <lu>
                    <lit v="el"/>
                    <lit-tag v="det.def"/>
                    <clip pos="3" side="tl" part="gen"/>
                    <clip pos="3" side="tl" part="a_nbr"/>
                  </lu>
                   <b/>
                 <lu>
                    <clip pos="3" side="tl" part="lem"/>
                    <clip pos="3" side="tl" part="a_nom"/>
                    <clip pos="3" side="tl" part="gen"/>
                    <clip pos="3" side="tl" part="a_nbr"/>
                  </lu>
                </chunk></out>
              </otherwise>
            </choose>
        <call-macro n="n_gen_nbr"/>
         </action>
    </rule>


<rule>
<!-- REGLA 51 DELIA: NOM (det)+ DETIND + NOMDG -->
      <pattern>
        <pattern-item n="nom"/>
        <pattern-item n="det"/>
        <pattern-item n="nom"/>
      </pattern>
      <action>
        <call-macro n="f_concord1_i">
          <with-param pos="1"/>
        </call-macro>
          <choose>
              <when>
                <test>
                  <equal>
                    <clip pos="1" side="tl" part="gen"/>
                    <lit-tag v="mf"/>
                  </equal>
                </test>
               <out><chunk name="x"><tags><tag><lit-tag v="SX"/></tag></tags>
                  <lu>
                   <get-case-from pos="1">
                    <lit v="el"/>
                   </get-case-from>
                    <lit-tag v="det.def"/>
                    <var n="genere"/>
                    <var n="nombre"/>
                  </lu>
                  <b/>
                  <lu>
                    <clip pos="1" side="tl" part="lem"/>
                    <clip pos="1" side="tl" part="a_nom"/>
                    <clip pos="1" side="tl" part="gen"/>
                    <clip pos="1" side="tl" part="a_nbr"/>
                  </lu>
                  <b/>
                  <lu>
                    <lit v="de"/>
                    <lit-tag v="pr"/>
                  </lu>
                  <b/>
                  <lu>
                    <clip pos="2" side="tl" part="lem"/>
                    <clip pos="2" side="tl" part="a_det"/>
                    <clip pos="3" side="tl" part="gen"/>
                    <clip pos="3" side="tl" part="a_nbr"/>
                  </lu>
                  <b/>
                 <lu>
                    <clip pos="3" side="tl" part="lem"/>
                    <clip pos="3" side="tl" part="a_nom"/>
                    <clip pos="3" side="tl" part="gen"/>
                    <clip pos="3" side="tl" part="a_nbr"/>
                  </lu>
                </chunk></out>
              </when>
              <otherwise>
               <out><chunk name="x"><tags><tag><lit-tag v="SX"/></tag></tags>
                  <lu>
                   <get-case-from pos="1">
                    <lit v="el"/>
                   </get-case-from>
                    <lit-tag v="det.def"/>
                    <var n="genere"/>
                    <var n="nombre"/>
                  </lu>
                  <b/>
                  <lu>
                    <clip pos="1" side="tl" part="lem"/>
                    <clip pos="1" side="tl" part="a_nom"/>
                    <clip pos="1" side="tl" part="gen"/>
                    <clip pos="1" side="tl" part="a_nbr"/>
                  </lu>
                   <b pos="1"/>
                  <lu>
                    <lit v="de"/>
                    <lit-tag v="pr"/>
                  </lu>
                  <b/>
                  <lu>
                    <clip pos="2" side="tl" part="lem"/>
                    <clip pos="2" side="tl" part="a_det"/>
                    <clip pos="3" side="tl" part="gen"/>
                    <clip pos="3" side="tl" part="a_nbr"/>
                  </lu>
                  <b/>
                  <lu>
                    <clip pos="3" side="tl" part="lem"/>
                    <clip pos="3" side="tl" part="a_nom"/>
                    <clip pos="3" side="tl" part="gen"/>
                    <clip pos="3" side="tl" part="a_nbr"/>
                  </lu>
                </chunk></out>
              </otherwise>
            </choose>
        <call-macro n="n_gen_nbr"/>
         </action>
    </rule>


<rule>
<!-- REGLA 52 DELIA: NOM (ind)+ DETA + DETIND + NOMDG -->
      <pattern>
        <pattern-item n="nom"/>
        <pattern-item n="det_al"/>
        <pattern-item n="detind"/>
        <pattern-item n="nom"/>
      </pattern>
      <action>
          <call-macro n="f_concord2_i">
          <with-param pos="4"/>
          <with-param pos="3"/>
          </call-macro>
            <choose>
              <when>
                <test>
                  <equal>
                    <clip pos="1" side="tl" part="gen"/>
                    <lit-tag v="mf"/>
                  </equal>
                </test>
               <out><chunk name="x"><tags><tag><lit-tag v="SX"/></tag></tags>
                  <lu>
                    <clip pos="1" side="tl" part="lem"/>
                    <clip pos="1" side="tl" part="a_nom"/>
                    <clip pos="1" side="tl" part="gen"/>
                    <clip pos="1" side="tl" part="a_nbr"/>
                  </lu>
                  <b pos="1"/>
                  <lu>
                    <lit v="de"/>
                    <lit-tag v="pr"/>
                  </lu>
                  <b pos="2"/>
                  <lu>
                <clip pos="3" side="tl" part="lem"/>
                    <clip pos="3" side="tl" part="a_det"/>
                    <clip pos="4" side="tl" part="gen"/>
                    <clip pos="4" side="tl" part="a_nbr"/>
                  </lu>
                  <b/>
                  <lu>
                    <clip pos="4" side="tl" part="lem"/>
                    <clip pos="4" side="tl" part="a_nom"/>
                    <clip pos="4" side="tl" part="gen"/>
                    <clip pos="4" side="tl" part="a_nbr"/>
                  </lu>
                </chunk></out>
              </when>
              <otherwise>
               <out><chunk name="x"><tags><tag><lit-tag v="SX"/></tag></tags>
                  <lu>
                    <clip pos="1" side="tl" part="lem"/>
                    <clip pos="1" side="tl" part="a_nom"/>
                    <clip pos="1" side="tl" part="gen"/>
                    <clip pos="1" side="tl" part="a_nbr"/>
                  </lu>
                   <b pos="1"/>
                  <lu>
                    <lit v="de"/>
                    <lit-tag v="pr"/>
                  </lu>
                  <b pos="2"/>
                 <lu>
                <clip pos="3" side="tl" part="lem"/>
                    <clip pos="3" side="tl" part="a_det"/>
                    <clip pos="4" side="tl" part="gen"/>
                    <clip pos="4" side="tl" part="a_nbr"/>
                 </lu>
                 <b/>
                 <lu>
                    <clip pos="4" side="tl" part="lem"/>
                    <clip pos="4" side="tl" part="a_nom"/>
                    <clip pos="4" side="tl" part="gen"/>
                    <clip pos="4" side="tl" part="a_nbr"/>
                  </lu>
                </chunk></out>
              </otherwise>
            </choose>
        <call-macro n="n_gen_nbr"/>
         </action>
    </rule>



<rule>
<!-- REGLA 53 DELIA: DET NOM + DETA + NOMDG -->
      <pattern>
        <pattern-item n="det"/>
        <pattern-item n="nom"/>
        <pattern-item n="det_al"/>
        <pattern-item n="nom"/>
      </pattern>
      <action>
        <call-macro n="f_modgen">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="f_concord2_i">
          <with-param pos="2"/>
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="mod_maj">
              <with-param pos="1"/>
        </call-macro>
            <choose>
              <when>
                <test>
                  <equal>
                    <clip pos="2" side="tl" part="gen"/>
                    <lit-tag v="mf"/>
                  </equal>
                </test>
               <out><chunk name="x"><tags><tag><lit-tag v="SX"/></tag></tags>
                  <lu>
                    <clip pos="1" side="tl" part="lem"/>
                    <clip pos="1" side="tl" part="a_det"/>
                    <clip pos="1" side="tl" part="gen"/>
                    <clip pos="1" side="tl" part="a_nbr"/>
                  </lu>
                  <b pos="1"/>
                  <lu>
                    <clip pos="2" side="tl" part="lem"/>
                    <clip pos="2" side="tl" part="a_nom"/>
                    <clip pos="2" side="tl" part="gen"/>
                    <clip pos="2" side="tl" part="a_nbr"/>
                  </lu>
                  <b pos="2"/>
                  <lu>
                    <lit v="de"/>
                    <lit-tag v="pr"/>
                  </lu>
                  <b pos="3"/>
                 <lu>
                    <lit v="el"/>
                    <lit-tag v="det.def"/>
                    <clip pos="4" side="sl" part="gen"/>
                    <clip pos="4" side="tl" part="a_nbr"/>
                  </lu>
                  <b/>
                 <lu>
                    <clip pos="4" side="tl" part="lem"/>
                    <clip pos="4" side="tl" part="a_nom"/>
                    <clip pos="4" side="tl" part="gen"/>
                    <clip pos="4" side="tl" part="a_nbr"/>
                  </lu>
                </chunk></out>
              </when>
              <otherwise>
               <out><chunk name="x"><tags><tag><lit-tag v="SX"/></tag></tags>
                  <lu>
                    <clip pos="1" side="tl" part="lem"/>
                    <clip pos="1" side="tl" part="a_det"/>
                    <clip pos="1" side="tl" part="gen"/>
                    <clip pos="1" side="tl" part="a_nbr"/>
                  </lu>
                  <b pos="1"/>
                  <lu>
                    <clip pos="2" side="tl" part="lem"/>
                    <clip pos="2" side="tl" part="a_nom"/>
                    <clip pos="2" side="tl" part="gen"/>
                    <clip pos="2" side="tl" part="a_nbr"/>
                  </lu>
                   <b pos="2"/>
                  <lu>
                    <lit v="de"/>
                    <lit-tag v="pr"/>
                  </lu>
                  <b pos="3"/>
                 <lu>
                    <lit v="el"/>
                    <lit-tag v="det.def"/>
                    <clip pos="4" side="tl" part="gen"/>
                    <clip pos="4" side="tl" part="a_nbr"/>
                  </lu>
                   <b/>
                 <lu>
                    <clip pos="4" side="tl" part="lem"/>
                    <clip pos="4" side="tl" part="a_nom"/>
                    <clip pos="4" side="tl" part="gen"/>
                    <clip pos="4" side="tl" part="a_nbr"/>
                  </lu>
                </chunk></out>
              </otherwise>
            </choose>
        <call-macro n="n_gen_nbr"/>
         </action>
    </rule>

<rule>
<!-- REGLA 54 DELIA: DET ADJ NOM + DETA + NOMDG -->
      <pattern>
        <pattern-item n="det"/>
        <pattern-item n="adj"/>
        <pattern-item n="nom"/>
        <pattern-item n="det_al"/>
        <pattern-item n="nom"/>
      </pattern>
      <action>
        <call-macro n="f_modgen">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="f_modgen">
          <with-param pos="2"/>
        </call-macro>
        <call-macro n="f_concord3_i">
          <with-param pos="3"/>
          <with-param pos="2"/>
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="mod_maj">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="mod_maj">
          <with-param pos="2"/>
        </call-macro>
            <choose>
              <when>
                <test>
                  <equal>
                    <clip pos="3" side="tl" part="gen"/>
                    <lit-tag v="mf"/>
                  </equal>
                </test>
               <out><chunk name="x"><tags><tag><lit-tag v="SX"/></tag></tags>
                  <lu>
                    <clip pos="1" side="tl" part="lem"/>
                    <clip pos="1" side="tl" part="a_det"/>
                    <clip pos="1" side="tl" part="gen"/>
                    <clip pos="1" side="tl" part="a_nbr"/>
                  </lu>
                  <b pos="1"/>
                  <lu>
                    <clip pos="2" side="tl" part="lem"/>
                    <clip pos="2" side="tl" part="a_adj"/>
                    <clip pos="2" side="tl" part="gen"/>
                    <clip pos="2" side="tl" part="a_nbr"/>
                  </lu>
                  <b pos="2"/>
                  <lu>
                    <clip pos="3" side="tl" part="lem"/>
                    <clip pos="3" side="tl" part="a_nom"/>
                    <clip pos="3" side="tl" part="gen"/>
                    <clip pos="3" side="tl" part="a_nbr"/>
                  </lu>
                  <b pos="3"/>
                  <lu>
                    <lit v="de"/>
                    <lit-tag v="pr"/>
                  </lu>
                  <b pos="4"/>
                 <lu>
                    <lit v="el"/>
                    <lit-tag v="det.def"/>
                    <clip pos="5" side="sl" part="gen"/>
                    <clip pos="5" side="tl" part="a_nbr"/>
                  </lu>
                  <b/>
                 <lu>
                    <clip pos="5" side="tl" part="lem"/>
                    <clip pos="5" side="tl" part="a_nom"/>
                    <clip pos="5" side="tl" part="gen"/>
                    <clip pos="5" side="tl" part="a_nbr"/>
                  </lu>
                </chunk></out>
              </when>
              <otherwise>
               <out><chunk name="x"><tags><tag><lit-tag v="SX"/></tag></tags>
                  <lu>
                    <clip pos="1" side="tl" part="lem"/>
                    <clip pos="1" side="tl" part="a_det"/>
                    <clip pos="1" side="tl" part="gen"/>
                    <clip pos="1" side="tl" part="a_nbr"/>
                  </lu>
                  <b pos="1"/>
                  <lu>
                    <clip pos="2" side="tl" part="lem"/>
                    <clip pos="2" side="tl" part="a_adj"/>
                    <clip pos="2" side="tl" part="gen"/>
                    <clip pos="2" side="tl" part="a_nbr"/>
                  </lu>
                  <b pos="2"/>
                  <lu>
                    <clip pos="3" side="tl" part="lem"/>
                    <clip pos="3" side="tl" part="a_nom"/>
                    <clip pos="3" side="tl" part="gen"/>
                    <clip pos="3" side="tl" part="a_nbr"/>
                  </lu>
                   <b pos="3"/>
                  <lu>
                    <lit v="de"/>
                    <lit-tag v="pr"/>
                  </lu>
                  <b pos="4"/>
                 <lu>
                    <lit v="el"/>
                    <lit-tag v="det.def"/>
                    <clip pos="5" side="tl" part="gen"/>
                    <clip pos="5" side="tl" part="a_nbr"/>
                  </lu>
                   <b/>
                 <lu>
                    <clip pos="5" side="tl" part="lem"/>
                    <clip pos="5" side="tl" part="a_nom"/>
                    <clip pos="5" side="tl" part="gen"/>
                    <clip pos="5" side="tl" part="a_nbr"/>
                  </lu>
                </chunk></out>
              </otherwise>
            </choose>
        <call-macro n="n_gen_nbr"/>
         </action>
    </rule>



<!-- <rule> REGLA DELIA: DET NOM ADJ + DETA + NOMDG
      <pattern>
        <pattern-item n="det"/>
        <pattern-item n="nom"/>
        <pattern-item n="adj"/>
        <pattern-item n="det_al"/>
        <pattern-item n="nom"/>
      </pattern>
      <action>
        <call-macro n="f_modgen">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="f_modgen">
          <with-param pos="2"/>
        </call-macro>
        <call-macro n="f_concord3">
          <with-param pos="3"/>
          <with-param pos="2"/>
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="mod_maj">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="mod_maj">
          <with-param pos="2"/>
        </call-macro>
            <choose>
              <when>
                <test>
                  <equal>
                    <clip pos="3" side="tl" part="gen"/>
                    <lit-tag v="mf"/>
                  </equal>
                </test>
               <out><chunk name="x"><tags><tag><lit-tag v="SX"/></tag></tags>
                  <lu>
                    <clip pos="1" side="tl" part="lem"/>
                    <clip pos="1" side="tl" part="a_det"/>
                    <clip pos="1" side="tl" part="gen"/>
                    <clip pos="1" side="tl" part="a_nbr"/>
                  </lu>
                  <b pos="1"/>
                  <lu>
                    <clip pos="2" side="tl" part="lem"/>
                    <clip pos="2" side="tl" part="a_adj"/>
                    <clip pos="2" side="tl" part="gen"/>
                    <clip pos="2" side="tl" part="a_nbr"/>
                  </lu>
                  <b pos="2"/>
                  <lu>
                    <clip pos="3" side="tl" part="lem"/>
                    <clip pos="3" side="tl" part="a_nom"/>
                    <clip pos="3" side="tl" part="gen"/>
                    <clip pos="3" side="tl" part="a_nbr"/>
                  </lu>
                  <b pos="3"/>
                  <lu>
                    <lit v="de"/>
                    <lit-tag v="pr"/>
                  </lu>
                  <b pos="4"/>
                 <lu>
                    <lit v="el"/>
                    <lit-tag v="det.def"/>
                    <clip pos="5" side="sl" part="gen"/>
                    <clip pos="5" side="tl" part="a_nbr"/>
                  </lu>
                  <b/>
                 <lu>
                    <clip pos="5" side="tl" part="lem"/>
                    <clip pos="5" side="tl" part="a_nom"/>
                    <clip pos="5" side="tl" part="gen"/>
                    <clip pos="5" side="tl" part="a_nbr"/>
                  </lu>
                </chunk></out>
              </when>
              <otherwise>
               <out><chunk name="x"><tags><tag><lit-tag v="SX"/></tag></tags>
                  <lu>
                    <clip pos="1" side="tl" part="lem"/>
                    <clip pos="1" side="tl" part="a_det"/>
                    <clip pos="1" side="tl" part="gen"/>
                    <clip pos="1" side="tl" part="a_nbr"/>
                  </lu>
                  <b pos="1"/>
                  <lu>
                    <clip pos="2" side="tl" part="lem"/>
                    <clip pos="2" side="tl" part="a_adj"/>
                    <clip pos="2" side="tl" part="gen"/>
                    <clip pos="2" side="tl" part="a_nbr"/>
                  </lu>
                  <b pos="2"/>
                  <lu>
                    <clip pos="3" side="tl" part="lem"/>
                    <clip pos="3" side="tl" part="a_nom"/>
                    <clip pos="3" side="tl" part="gen"/>
                    <clip pos="3" side="tl" part="a_nbr"/>
                  </lu>
                   <b pos="3"/>
                  <lu>
                    <lit v="de"/>
                    <lit-tag v="pr"/>
                  </lu>
                  <b pos="4"/>
                 <lu>
                    <lit v="el"/>
                    <lit-tag v="det.def"/>
                    <clip pos="5" side="sl" part="gen"/>
                    <clip pos="5" side="tl" part="a_nbr"/>
                  </lu>
                   <b/>
                 <lu>
                    <clip pos="5" side="tl" part="lem"/>
                    <clip pos="5" side="tl" part="a_nom"/>
                    <clip pos="5" side="tl" part="gen"/>
                    <clip pos="5" side="tl" part="a_nbr"/>
                  </lu>
                </chunk></out>
              </otherwise>
            </choose>
         </action>
    </rule> -->

    <rule>
<!-- REGLA 59: NOM ADVERBI ADJECTIU -->
      <pattern>
        <pattern-item n="nom"/>
        <pattern-item n="adv"/>
        <pattern-item n="adj"/>
      </pattern>
      <action>
        <call-macro n="f_modgen">
          <with-param pos="3"/>
         </call-macro>
         <call-macro n="f_concord2_i">
          <with-param pos="1"/>
          <with-param pos="3"/>
         </call-macro>
         <choose>
          <when>
            <test>
              <and>
                <equal>
                  <clip pos="1" side="sl" part="a_def"/>
                  <lit-tag v="def"/>
                </equal>
                <equal>
                  <clip pos="1" side="sl" part="a_case"/>
                  <lit-tag v="nom"/>
                </equal>
              </and>
            </test>
            <call-macro n="mod_maj">
              <with-param pos="1"/>
            </call-macro>
            <choose>
              <when>
                <test>
                  <equal>
                    <clip pos="1" side="tl" part="gen"/>
                    <lit-tag v="mf"/>
                  </equal>
                </test>
               <out><chunk name="x"><tags><tag><lit-tag v="SX"/></tag></tags>
                  <lu>
                   <get-case-from pos="1">
                    <lit v="el"/>
                   </get-case-from>
                    <lit-tag v="det.def"/>
                    <clip pos="1" side="sl" part="gen"/>
                    <clip pos="1" side="tl" part="a_nbr"/>
                  </lu>
                  <b/>
                  <lu>

                    <clip pos="1" side="tl" part="lem"/>

                    <clip pos="1" side="tl" part="a_nom"/>
                    <clip pos="1" side="tl" part="gen"/>
                    <clip pos="1" side="tl" part="a_nbr"/>
                  </lu>
                  <b pos="1"/>
                  <lu>
                    <clip pos="2" side="tl" part="lem"/>
                    <clip pos="2" side="tl" part="a_adv"/>
                  </lu>
                  <b pos="2"/>
                  <lu>
                    <clip pos="3" side="tl" part="lem"/>
                    <clip pos="3" side="tl" part="a_adj"/>
                    <clip pos="3" side="tl" part="gen"/>
                    <clip pos="3" side="tl" part="a_nbr"/>
                  </lu>
                </chunk></out>
              </when>
              <otherwise>
               <out><chunk name="x"><tags><tag><lit-tag v="SX"/></tag></tags>
                  <lu>
                   <get-case-from pos="1">
                    <lit v="el"/>
                   </get-case-from>
                    <lit-tag v="det.def"/>
                    <clip pos="1" side="tl" part="gen"/>
                    <clip pos="1" side="tl" part="a_nbr"/>
                  </lu>
                  <b/>
                  <lu>

                    <clip pos="1" side="tl" part="lem"/>

                    <clip pos="1" side="tl" part="a_nom"/>
                    <clip pos="1" side="tl" part="gen"/>
                    <clip pos="1" side="tl" part="a_nbr"/>
                  </lu>
                  <b pos="1"/>
                  <lu>
                    <clip pos="2" side="tl" part="lem"/>
                    <clip pos="2" side="tl" part="a_adv"/>
                  </lu>
                  <b pos="2"/>
                  <lu>
                    <clip pos="3" side="tl" part="lem"/>
                    <clip pos="3" side="tl" part="a_adj"/>
                    <clip pos="3" side="tl" part="gen"/>
                    <clip pos="3" side="tl" part="a_nbr"/>
                  </lu>
                </chunk></out>
              </otherwise>
            </choose>
          </when>
          <otherwise>
            <choose>
              <when>
                <test>
                  <and>
                  <equal>
                    <clip pos="1" side="sl" part="a_def"/>
                    <lit-tag v="ind"/>
                  </equal>
                  <equal>
                    <clip pos="1" side="sl" part="a_case"/>
                    <lit-tag v="nom"/>
                  </equal>
                </and>
                </test>
                <out><chunk name="x"><tags><tag><lit-tag v="SX"/></tag></tags>
                  <lu>
                    <clip pos="1" side="tl" part="lem"/>
                    <clip pos="1" side="tl" part="a_nom"/>
                    <clip pos="1" side="tl" part="gen"/>
                    <clip pos="1" side="tl" part="a_nbr"/>
                  </lu>
                  <b pos="1"/>
                   <lu>
                    <clip pos="2" side="tl" part="lem"/>
                    <clip pos="2" side="tl" part="a_adv"/>
                  </lu>
                  <b pos="2"/>
                  <lu>
                    <clip pos="3" side="tl" part="lem"/>
                    <clip pos="3" side="tl" part="a_adj"/>
                    <clip pos="3" side="tl" part="gen"/>
                    <clip pos="3" side="tl" part="a_nbr"/>
                  </lu>
                </chunk></out>
              </when>
            </choose>
          </otherwise>
        </choose>
        <choose>
          <when>
            <test>
              <and>
                <equal>
                  <clip pos="1" side="sl" part="a_def"/>
                  <lit-tag v="def"/>
                </equal>
                <equal>
                  <clip pos="1" side="sl" part="a_case"/>
                  <lit-tag v="dg"/>
                </equal>
              </and>
            </test>
            <call-macro n="mod_maj">
              <with-param pos="1"/>
            </call-macro>
            <choose>
              <when>
                <test>
                  <equal>
                    <clip pos="1" side="tl" part="gen"/>
                    <lit-tag v="mf"/>
                  </equal>
                </test>
                <out><chunk name="x"><tags><tag><lit-tag v="SX"/></tag></tags>
                  <lu>
                   <get-case-from pos="1">
                    <lit v="a"/>
                   </get-case-from>
                    <lit-tag v="pr"/>
                  </lu>
                  <b/>
                  <lu>
                    <lit v="el"/>
                    <lit-tag v="det.def"/>
                    <clip pos="1" side="sl" part="gen"/>
                    <clip pos="1" side="tl" part="a_nbr"/>
                  </lu>
                  <b/>
                  <lu>

                    <clip pos="1" side="tl" part="lem"/>

                    <clip pos="1" side="tl" part="a_nom"/>
                    <clip pos="1" side="tl" part="gen"/>
                    <clip pos="1" side="tl" part="a_nbr"/>
                  </lu>
                  <b pos="1"/>
                  <lu>
                    <clip pos="2" side="tl" part="lem"/>
                    <clip pos="2" side="tl" part="a_adv"/>
                  </lu>
                  <b pos="2"/>
                  <lu>
                    <clip pos="3" side="tl" part="lem"/>
                    <clip pos="3" side="tl" part="a_adj"/>
                    <clip pos="3" side="tl" part="gen"/>
                    <clip pos="3" side="tl" part="a_nbr"/>
                  </lu>
                </chunk></out>
              </when>
              <otherwise>
                <out><chunk name="x"><tags><tag><lit-tag v="SX"/></tag></tags>
                  <lu>
                   <get-case-from pos="1">
                    <lit v="a"/>
                   </get-case-from>
                    <lit-tag v="pr"/>
                  </lu>
                  <b/>
                  <lu>
                    <lit v="el"/>
                    <lit-tag v="det.def"/>
                    <clip pos="1" side="tl" part="gen"/>
                    <clip pos="1" side="tl" part="a_nbr"/>
                  </lu>
                  <b/>
                  <lu>

                    <clip pos="1" side="tl" part="lem"/>

                    <clip pos="1" side="tl" part="a_nom"/>
                    <clip pos="1" side="tl" part="gen"/>
                    <clip pos="1" side="tl" part="a_nbr"/>
                  </lu>
                  <b pos="1"/>
                   <lu>
                    <clip pos="2" side="tl" part="lem"/>
                    <clip pos="2" side="tl" part="a_adv"/>
                  </lu>
                  <b pos="2"/>
                  <lu>
                    <clip pos="3" side="tl" part="lem"/>
                    <clip pos="3" side="tl" part="a_adj"/>
                    <clip pos="3" side="tl" part="gen"/>
                    <clip pos="3" side="tl" part="a_nbr"/>
                  </lu>
                </chunk></out>
              </otherwise>
            </choose>
          </when>
          <otherwise>
            <choose>
              <when>
                <test>
                  <and>
                  <equal>
                    <clip pos="1" side="sl" part="a_def"/>
                    <lit-tag v="ind"/>
                  </equal>
                  <equal>
                    <clip pos="1" side="sl" part="a_case"/>
                    <lit-tag v="dg"/>
                  </equal>
                </and>
                </test>
                <call-macro n="mod_maj">
                  <with-param pos="1"/>
                </call-macro>
                <out><chunk name="x"><tags><tag><lit-tag v="SX"/></tag></tags>
                  <lu>
                   <get-case-from pos="1">
                    <lit v="a"/>
                   </get-case-from>
                    <lit-tag v="pr"/>
                  </lu>
                  <b/>
                  <lu>

                    <clip pos="1" side="tl" part="lem"/>

                    <clip pos="1" side="tl" part="a_nom"/>
                    <clip pos="1" side="tl" part="gen"/>
                    <clip pos="1" side="tl" part="a_nbr"/>
                  </lu>
                  <b pos="1"/>
                  <lu>
                    <clip pos="2" side="tl" part="lem"/>
                    <clip pos="2" side="tl" part="a_adv"/>
                  </lu>
                  <b pos="2"/>
                  <lu>
                    <clip pos="3" side="tl" part="lem"/>
                    <clip pos="3" side="tl" part="a_adj"/>
                    <clip pos="3" side="tl" part="gen"/>
                    <clip pos="3" side="tl" part="a_nbr"/>
                  </lu>
                </chunk></out>
              </when>
            </choose>
          </otherwise>
        </choose>
        <call-macro n="n_gen_nbr"/>
      </action>
    </rule>








<!-- cel mai frumos/cei mai frumoși/cea mai frumoasă/cele mai frumoase - el más bello/los más bellos/la más bella/las más bellas-->
    <rule>
<!--REGLA 60: SUPERLATIU RELATIU-->
      <pattern>
        <pattern-item n="det_cel"/>
        <pattern-item n="adv_mai"/>
        <pattern-item n="adj"/>
      </pattern>
      <action>
        <call-macro n="f_modgen">
          <with-param pos="3"/>
        </call-macro>
        <call-macro n="f_concord2_i">
          <with-param pos="1"/>
          <with-param pos="3"/>
         </call-macro>
        <choose>
          <when>
            <test>
              <equal>
                <clip pos="1" side="sl" part="a_case"/>
                <lit-tag v="nom"/>
              </equal>
            </test>
            <choose>
              <when>
                <test>
                  <equal>
                    <clip pos="3" side="tl" part="gen"/>
                    <lit-tag v="mf"/>
                  </equal>
                </test>
               <out><chunk name="x"><tags><tag><lit-tag v="SX"/></tag></tags>
                  <lu>
                   <get-case-from pos="1">
                    <lit v="el"/>
                   </get-case-from>
                    <lit-tag v="det.def"/>
                    <clip pos="3" side="sl" part="gen"/>
                    <clip pos="3" side="tl" part="a_nbr"/>
                  </lu>
                  <b/>
                  <lu>
                    <clip pos="2" side="tl" part="lem"/>
                    <clip pos="2" side="tl" part="a_adv"/>
                  </lu>
                  <b/>
                  <lu>
                    <clip pos="3" side="tl" part="lem"/>
                    <clip pos="3" side="tl" part="a_adj"/>
                    <clip pos="3" side="tl" part="gen"/>
                    <clip pos="3" side="tl" part="a_nbr"/>
                  </lu>
                </chunk></out>
              </when>
              <otherwise>
               <out><chunk name="x"><tags><tag><lit-tag v="SX"/></tag></tags>
                  <lu>
                   <get-case-from pos="1">
                    <lit v="el"/>
                   </get-case-from>
                    <lit-tag v="det.def"/>
                    <clip pos="3" side="tl" part="gen"/>
                    <clip pos="3" side="tl" part="a_nbr"/>
                  </lu>
                  <b/>
                  <lu>
                    <clip pos="2" side="tl" part="lem"/>
                    <clip pos="2" side="tl" part="a_adv"/>
                  </lu>
                  <b/>
                  <lu>
                    <clip pos="3" side="tl" part="lem"/>
                    <clip pos="3" side="tl" part="a_adj"/>
                    <clip pos="3" side="tl" part="gen"/>
                    <clip pos="3" side="tl" part="a_nbr"/>
                  </lu>
                </chunk></out>
              </otherwise>
            </choose>
          </when>
         </choose>
         <choose>
          <when>
            <test>
              <equal>
                <clip pos="1" side="sl" part="a_case"/>
                <lit-tag v="dg"/>
              </equal>
            </test>
            <choose>
              <when>
                <test>
                  <equal>
                    <clip pos="3" side="tl" part="gen"/>
                    <lit-tag v="mf"/>
                  </equal>
                </test>
                <out><chunk name="x"><tags><tag><lit-tag v="SX"/></tag></tags>
                  <lu>
                   <get-case-from pos="1">
                    <lit v="a"/>
                   </get-case-from>
                    <lit-tag v="pr"/>
                  </lu>
                  <b/>
                  <lu>
                    <lit v="el"/>
                    <lit-tag v="det.def"/>
                    <clip pos="3" side="sl" part="gen"/>
                    <clip pos="3" side="tl" part="a_nbr"/>
                  </lu>
                  <b/>
                  <lu>
                    <clip pos="2" side="tl" part="lem"/>
                    <clip pos="2" side="tl" part="a_adv"/>
                  </lu>
                  <b/>
                  <lu>
                    <clip pos="3" side="tl" part="lem"/>
                    <clip pos="3" side="tl" part="a_adj"/>
                    <clip pos="3" side="sl" part="gen"/>
                    <clip pos="3" side="tl" part="a_nbr"/>
                  </lu>
                </chunk></out>
              </when>
                <otherwise>
                  <out><chunk name="x"><tags><tag><lit-tag v="SX"/></tag></tags>
                    <lu>
                    <get-case-from pos="1">
                      <lit v="a"/>
                    </get-case-from>
                      <lit-tag v="pr"/>
                    </lu>
                    <b/>
                    <lu>
                      <lit v="el"/>
                      <lit-tag v="det.def"/>
                      <clip pos="3" side="tl" part="gen"/>
                      <clip pos="3" side="tl" part="a_nbr"/>
                    </lu>
                    <b/>
                      <lu>
                        <clip pos="2" side="tl" part="lem"/>
                        <clip pos="2" side="tl" part="a_adv"/>
                      </lu>
                      <b/>
                      <lu>
                        <clip pos="3" side="tl" part="lem"/>
                        <clip pos="3" side="tl" part="a_adj"/>
                        <clip pos="3" side="tl" part="gen"/>
                        <clip pos="3" side="tl" part="a_nbr"/>
                      </lu>
                    </chunk></out>
              </otherwise>
            </choose>
          </when>
        </choose>
        <call-macro n="n_gen_nbr"/>
      </action>
    </rule>



<!-- nespus de frumos/nespus de frumoși/nespus de frumoasă/nespus de frumoase - bellíssimo/bellíssimos/bellíssima/bellíssimas-->
    <rule>
<!-- REGLA 61: SUPERLATIU ABSOLUT -->
      <pattern>
        <pattern-item n="advnespus"/>
        <pattern-item n="prepde"/>
        <pattern-item n="adj"/>
      </pattern>
      <action>
        <call-macro n="f_concord1_i">
          <with-param pos="3"/>
        </call-macro>
        <call-macro n="f_modgen">
          <with-param pos="3"/>
        </call-macro>
        <choose>
          <when>
            <test>
              <equal>
                <clip pos="3" side="sl" part="a_case"/>
                <lit-tag v="nom"/>
              </equal>
             </test>
                <out><chunk name="x"><tags><tag><lit-tag v="SX"/></tag></tags>
                  <lu>
                   <get-case-from pos="1">
                    <clip pos="3" side="tl" part="lem"/>
                   </get-case-from>
                    <clip pos="3" side="tl" part="a_adj"/>
                    <lit-tag v="sup"/>
                    <clip pos="3" side="tl" part="gen"/>
                    <clip pos="3" side="tl" part="a_nbr"/>
                  </lu>
                </chunk></out>
              </when>
              <otherwise>
                <out><chunk name="x"><tags><tag><lit-tag v="SX"/></tag></tags>
                  <lu>
                    <clip pos="3" side="tl" part="lem"/>
                    <clip pos="3" side="tl" part="a_adj"/>
                    <lit-tag v="sup"/>
                    <clip pos="3" side="tl" part="gen"/>
                    <clip pos="3" side="tl" part="a_nbr"/>
                  </lu>
                </chunk></out>
              </otherwise>
            </choose>
        <call-macro n="n_gen_nbr"/>
      </action>
    </rule>

     <rule>
<!-- REGLA 62: PREP + PREPA + PRN REFLEXIU + INF -->
      <pattern>
        <pattern-item n="prep"/>
        <pattern-item n="prepa"/>
        <pattern-item n="prnpro"/>
        <pattern-item n="inf"/>
      </pattern>
      <action>
          <out><chunk name="x"><tags><tag><lit-tag v="SX"/></tag></tags>
               <lu>
                  <get-case-from pos="1">
                  <clip pos="1" side="tl" part="lem"/>
                  </get-case-from>
                  <clip pos="1" side="tl" part="a_prep"/>
                </lu>
                <b pos="1"/>
                <mlu>
                 <lu>
                   <clip pos="4" side="tl" part="lemh"/>
                   <clip pos="4" side="tl" part="a_verb"/>
                   <lit-tag v="inf"/>
                 </lu>
               <lu>
                   <clip pos="3" side="tl" part="lem"/>
                   <lit-tag v="prn.enc"/>
                   <clip pos="3" side="tl" part="a_prnref"/>
                   <clip pos="3" side="tl" part="a_pers"/>
                   <clip pos="3" side="tl" part="gen"/>
                   <clip pos="3" side="tl" part="a_nbr"/>
                   <clip pos="4" side="tl" part="lemq"/>
                </lu>
               </mlu>
                </chunk></out>
      </action>
    </rule>



     <rule>
<!-- REGLA 63: PREP + PREPA + INF -->
      <pattern>
        <pattern-item n="prep"/>
        <pattern-item n="prepa"/>
        <pattern-item n="inf"/>
      </pattern>
      <action>
          <out><chunk name="x"><tags><tag><lit-tag v="SX"/></tag></tags>
               <lu>
                  <get-case-from pos="1">
                  <clip pos="1" side="tl" part="lem"/>
                  </get-case-from>
                  <clip pos="1" side="tl" part="a_prep"/>
                </lu>
                <b pos="1"/>
                <lu>
                  <clip pos="3" side="tl" part="lemh"/>
                  <clip pos="3" side="tl" part="a_verb"/>
                  <lit-tag v="inf"/>
                  <clip pos="3" side="tl" part="lemq"/>
                 </lu>
                </chunk></out>
      </action>
    </rule>


    <rule>
<!--REGLA 64: NOM DETERMINANT ADJECTIU -->
      <pattern>
        <pattern-item n="nom"/>
        <pattern-item n="det_cel"/>
        <pattern-item n="adj"/>
      </pattern>
      <action>
       <call-macro n="f_modgen">
              <with-param pos="3"/>
            </call-macro>
            <call-macro n="f_modgen">
              <with-param pos="2"/>
            </call-macro>
            <call-macro n="f_concord3_i">
              <with-param pos="1"/>
              <with-param pos="2"/>
              <with-param pos="3"/>
            </call-macro>
        <choose>
          <when>
            <test>
              <and>
                <equal>
                  <clip pos="1" side="sl" part="a_case"/>
                  <lit-tag v="nom"/>
                </equal>
                <equal>
                  <clip pos="1" side="sl" part="a_def"/>
                  <lit-tag v="def"/>
                </equal>
              </and>
            </test>
            <call-macro n="mod_maj">
               <with-param pos="1"/>
            </call-macro>
            <out><chunk name="x"><tags><tag><lit-tag v="SX"/></tag></tags>
              <lu>
               <get-case-from pos="1">
                <lit v="el"/>
               </get-case-from>
                <lit-tag v="det.def"/>
                <clip pos="1" side="tl" part="gen"/>
                <clip pos="1" side="tl" part="a_nbr"/>
              </lu>
              <b pos="1"/>
              <lu>
                <clip pos="1" side="tl" part="lem"/>
                <clip pos="1" side="tl" part="a_nom"/>
                <clip pos="1" side="tl" part="gen"/>
                <clip pos="1" side="tl" part="a_nbr"/>
              </lu>
              <b pos="2"/>
              <lu>
                <clip pos="3" side="tl" part="lem"/>
                <clip pos="3" side="tl" part="a_adj"/>
                <clip pos="3" side="tl" part="gen"/>
                <clip pos="3" side="tl" part="a_nbr"/>
              </lu>
            </chunk></out>
          </when>
          <when>
            <test>
              <and>
                <equal>
                  <clip pos="1" side="sl" part="a_def"/>
                  <lit-tag v="def"/>
                </equal>
                <equal>
                  <clip pos="1" side="sl" part="a_case"/>
                  <lit-tag v="dg"/>
                </equal>
              </and>
            </test>
            <call-macro n="mod_maj">
               <with-param pos="1"/>
            </call-macro>
            <out><chunk name="x"><tags><tag><lit-tag v="SX"/></tag></tags>
              <lu>
              <get-case-from pos="1">
                <lit v="a"/>
                </get-case-from>
                <lit-tag v="pr"/>
              </lu>
              <b/>
              <lu>
                <lit v="el"/>
                <lit-tag v="det.def"/>
                <clip pos="1" side="tl" part="gen"/>
                <clip pos="1" side="tl" part="a_nbr"/>
              </lu>
              <b pos="1"/>
              <lu>
                <clip pos="1" side="tl" part="lem"/>
                <clip pos="1" side="tl" part="a_nom"/>
                <clip pos="1" side="tl" part="gen"/>
                <clip pos="1" side="tl" part="a_nbr"/>
              </lu>
              <b/>
              <lu>
                <clip pos="2" side="tl" part="lem"/>
                <clip pos="2" side="tl" part="a_adj"/>
                <clip pos="1" side="tl" part="gen"/>
                <clip pos="1" side="tl" part="a_nbr"/>
              </lu>
            </chunk></out>
          </when>
          <otherwise>
            <out><chunk name="x"><tags><tag><lit-tag v="SX"/></tag></tags>
              <lu>
                <clip pos="1" side="tl" part="lem"/>
                <clip pos="1" side="tl" part="a_nom"/>
                <clip pos="1" side="tl" part="gen"/>
                <clip pos="1" side="tl" part="a_nbr"/>
              </lu>
              <b pos="1"/>
              <lu>
                <clip pos="3" side="tl" part="lem"/>
                <clip pos="3" side="tl" part="a_adj"/>
                <clip pos="3" side="tl" part="gen"/>
                <clip pos="3" side="tl" part="a_nbr"/>
              </lu>
            </chunk></out>
          </otherwise>
        </choose>
        <call-macro n="n_gen_nbr"/>
      </action>
    </rule>

    <rule>
<!-- REGLA 65: DETERMINANT  NOM ADJECTIU -->
      <pattern>
        <pattern-item n="det"/>
        <pattern-item n="nom"/>
        <pattern-item n="adj"/>
      </pattern>
      <action>
         <call-macro n="f_modgen">
              <with-param pos="1"/>
            </call-macro>
            <call-macro n="f_modgen">
              <with-param pos="3"/>
            </call-macro>
            <call-macro n="f_concord3_i">
              <with-param pos="2"/>
              <with-param pos="3"/>
              <with-param pos="1"/>
            </call-macro>
        <choose>
          <when>
            <test>
              <equal>
                <clip pos="1" side="sl" part="a_case"/>
                <lit-tag v="dg"/>
              </equal>
            </test>
            <call-macro n="mod_maj">
               <with-param pos="1"/>
            </call-macro>
            <out><chunk name="x"><tags><tag><lit-tag v="SX"/></tag></tags>
              <lu>
               <get-case-from pos="1">
                <lit v="a"/>
               </get-case-from>
                <lit-tag v="pr"/>
              </lu>
              <b/>
              <lu>
                <clip pos="1" side="tl" part="lem"/>
                <clip pos="1" side="tl" part="a_det"/>
                <clip pos="1" side="tl" part="gen"/>
                <clip pos="1" side="tl" part="a_nbr"/>
              </lu>
              <b pos="1"/>
              <lu>
                <clip pos="2" side="tl" part="lem"/>
                <clip pos="2" side="tl" part="a_nom"/>
                <clip pos="2" side="tl" part="gen"/>
                <clip pos="2" side="tl" part="a_nbr"/>
              </lu>
              <b pos="2"/>
              <lu>
                <clip pos="3" side="tl" part="lem"/>
                <clip pos="3" side="tl" part="a_adj"/>
                <clip pos="3" side="tl" part="gen"/>
                <clip pos="3" side="tl" part="a_nbr"/>
              </lu>
            </chunk></out>
          </when>
        <otherwise>
        <out><chunk name="x"><tags><tag><lit-tag v="SX"/></tag></tags>
              <lu>
                <clip pos="1" side="tl" part="lem"/>
                <clip pos="1" side="tl" part="a_det"/>
                <clip pos="1" side="tl" part="gen"/>
                <clip pos="1" side="tl" part="a_nbr"/>
              </lu>
              <b pos="1"/>
              <lu>
                <clip pos="2" side="tl" part="lem"/>
                <clip pos="2" side="tl" part="a_nom"/>
                <clip pos="2" side="tl" part="gen"/>
                <clip pos="2" side="tl" part="a_nbr"/>
              </lu>
              <b pos="2"/>
              <lu>
                <clip pos="3" side="tl" part="lem"/>
                <clip pos="3" side="tl" part="a_adj"/>
                <clip pos="3" side="tl" part="gen"/>
                <clip pos="3" side="tl" part="a_nbr"/>
              </lu>
            </chunk></out>
        </otherwise>
        </choose>
        <call-macro n="n_gen_nbr"/>
      </action>
     </rule>


      <rule>
<!-- REGLA 66: DETERMINANT ADJECTIU  NOM-->
      <pattern>
        <pattern-item n="det"/>
        <pattern-item n="adj"/>
        <pattern-item n="nom"/>
      </pattern>
      <action>
       <call-macro n="f_modgen">
              <with-param pos="1"/>
            </call-macro>
         <call-macro n="f_modgen">
              <with-param pos="2"/>
            </call-macro>
            <call-macro n="f_concord3_i">
              <with-param pos="3"/>
              <with-param pos="2"/>
              <with-param pos="1"/>
            </call-macro>
        <choose>
          <when>
            <test>
              <equal>
                <clip pos="1" side="sl" part="a_case"/>
                <lit-tag v="dg"/>
              </equal>
            </test>
            <call-macro n="mod_maj">
               <with-param pos="1"/>
            </call-macro>
            <out><chunk name="x"><tags><tag><lit-tag v="SX"/></tag></tags>
              <lu>
               <get-case-from pos="1">
                <lit v="a"/>
               </get-case-from>
                <lit-tag v="pr"/>
              </lu>
              <b/>
              <lu>
                <clip pos="1" side="tl" part="lem"/>
                <clip pos="1" side="tl" part="a_det"/>
                <clip pos="1" side="tl" part="gen"/>
                <clip pos="1" side="tl" part="a_nbr"/>
              </lu>
              <b pos="1"/>
              <lu>
                <clip pos="2" side="tl" part="lem"/>
                <clip pos="2" side="tl" part="a_adj"/>
                <clip pos="2" side="tl" part="gen"/>
                <clip pos="2" side="tl" part="a_nbr"/>
              </lu>
              <b pos="2"/>
              <lu>
                <clip pos="3" side="tl" part="lem"/>
                <clip pos="3" side="tl" part="a_nom"/>
                <clip pos="3" side="tl" part="gen"/>
                <clip pos="3" side="tl" part="a_nbr"/>
              </lu>
            </chunk></out>
          </when>
        <otherwise>
        <out><chunk name="x"><tags><tag><lit-tag v="SX"/></tag></tags>
              <lu>
                <clip pos="1" side="tl" part="lem"/>
                <clip pos="1" side="tl" part="a_det"/>
                <clip pos="1" side="tl" part="gen"/>
                <clip pos="1" side="tl" part="a_nbr"/>
              </lu>
              <b pos="1"/>
              <lu>
                <clip pos="2" side="tl" part="lem"/>
                <clip pos="2" side="tl" part="a_adj"/>
                <clip pos="2" side="tl" part="gen"/>
                <clip pos="2" side="tl" part="a_nbr"/>
              </lu>
              <b pos="2"/>
              <lu>
                <clip pos="3" side="tl" part="lem"/>
                <clip pos="3" side="tl" part="a_nom"/>
                <clip pos="3" side="tl" part="gen"/>
                <clip pos="3" side="tl" part="a_nbr"/>
              </lu>
            </chunk></out>
        </otherwise>
        </choose>
        <call-macro n="n_gen_nbr"/>
      </action>
     </rule>


<!--  REGLA 68: NOM NOM per a traduir "cartea fetei" com a "el llibre de la noia" o sigui el cas Genitiu -->
    <rule>
      <pattern>
        <pattern-item n="nom"/>
        <pattern-item n="nom"/>
      </pattern>
      <action>
         <call-macro n="f_concord1_i">
          <with-param pos="1"/>
        </call-macro>
         <call-macro n="f_concord1_i">
          <with-param pos="2"/>
        </call-macro>
        <choose>
          <when>
            <test>
              <and>
                <equal>
                  <clip pos="1" side="sl" part="a_case"/>
                  <lit-tag v="nom"/>
                </equal>
                <equal>
                  <clip pos="1" side="sl" part="a_def"/>
                  <lit-tag v="def"/>
                </equal>
                <equal>
                  <clip pos="2" side="sl" part="a_case"/>
                  <lit-tag v="dg"/>
                </equal>
                <equal>
                  <clip pos="2" side="sl" part="a_def"/>
                  <lit-tag v="def"/>
                </equal>
              </and>
            </test>
            <call-macro n="mod_maj">
               <with-param pos="1"/>
            </call-macro>
            <out><chunk name="x"><tags><tag><lit-tag v="SX"/></tag></tags>
              <lu>
              <get-case-from pos="1">
                <lit v="el"/>
              </get-case-from>
                <lit-tag v="det.def"/>
                <var n="genere1"/>
                <var n="nombre1"/>
              </lu>
              <b/>
              <lu>
                <clip pos="1" side="tl" part="lem"/>
                <clip pos="1" side="tl" part="a_nom"/>
                <clip pos="1" side="tl" part="gen"/>
                <clip pos="1" side="tl" part="a_nbr"/>
              </lu>
              <b/>
              <lu>
                <lit v="de"/>
                <lit-tag v="pr"/>
              </lu>
              <b/>
              <lu>
                <lit v="el"/>
                <lit-tag v="det.def"/>
                <var n="genere2"/>
                <var n="nombre2"/>
              </lu>
              <b/>
              <lu>
                <clip pos="2" side="tl" part="lem"/>
                <clip pos="2" side="tl" part="a_nom"/>
                <clip pos="2" side="tl" part="gen"/>
                <clip pos="2" side="tl" part="a_nbr"/>
              </lu>
            </chunk></out>
          </when>
          <otherwise>
            <out><chunk name="x"><tags><tag><lit-tag v="SX"/></tag></tags>
              <lu>
                <clip pos="1" side="tl" part="lem"/>
                <clip pos="1" side="tl" part="a_nom"/>
                <clip pos="1" side="tl" part="gen"/>
                <clip pos="1" side="tl" part="a_nbr"/>
              </lu>
              <b pos="1"/>
              <lu>
                <clip pos="2" side="tl" part="lem"/>
                <clip pos="2" side="tl" part="a_nom"/>
                <clip pos="2" side="tl" part="gen"/>
                <clip pos="2" side="tl" part="a_nbr"/>
              </lu>
            </chunk></out>
          </otherwise>
        </choose>
        <call-macro n="n_gen_nbr"/>
      </action>
    </rule>





<rule> <!-- REGLA 70 DELIA ADVNU + ADVMAI + VB : JA NO + VB -->
  <pattern>
      <pattern-item n="advnu"/>
      <pattern-item n="adv_mai"/>
      <pattern-item n="vbcnj"/>
    </pattern>
    <action>
      <out><chunk name="x"><tags><tag><lit-tag v="SX"/></tag></tags>
          <lu>
            <lit v="ja"/>
            <lit-tag v="adv"/>
          </lu>
          <b pos="1"/>
          <lu>
            <lit v="no"/>
            <lit-tag v="adv"/>
          </lu>
          <b pos="2"/>
          <lu>
            <clip pos="3" side="tl" part="lemh"/>
            <clip pos="3" side="tl" part="a_verb"/>
            <clip pos="3" side="tl" part="a_temps"/>
            <clip pos="3" side="tl" part="gen"/>
            <clip pos="3" side="tl" part="a_pers"/>
            <clip pos="3" side="tl" part="a_nbr"/>
            <clip pos="3" side="tl" part="lemq"/>
          </lu>
        </chunk></out>
    </action>
</rule>

<rule> <!-- REGLA 71 Futur TREBUI VBMOD - Hauré de inf-->
  <pattern>
      <pattern-item n="vrea"/>
      <pattern-item n="verbtrebui"/>
      <pattern-item n="conjsub"/>
      <pattern-item n="vbcnj"/>
    </pattern>
    <action>
        <out><chunk name="x"><tags><tag><lit-tag v="SX"/></tag></tags>
          <lu>
          <get-case-from pos="1">
            <clip pos="2" side="tl" part="lemh"/>
          </get-case-from>
            <clip pos="2" side="tl" part="a_verb"/>
            <lit v="haver"/>
            <lit-tag v="fti"/>
            <clip pos="4" side="tl" part="a_pers"/>
            <clip pos="2" side="tl" part="gen"/>
            <clip pos="4" side="tl" part="a_nbr"/>
            <clip pos="2" side="tl" part="lemq"/>
          </lu>
          <b pos="1"/>
            <lu>
            <lit v="de"/>
            <lit-tag v="pr"/>
          </lu>
          <b pos="2"/>
          <lu>
            <clip pos="4" side="tl" part="lemh"/>
            <clip pos="4" side="tl" part="a_verb"/>
            <lit-tag v="inf"/>
            <clip pos="4" side="tl" part="lemq"/>
          </lu>
        </chunk></out>
    </action>
</rule>

<rule> <!-- REGLA 72 DELIA CNJNICI + ADVNU + VB : NI + VB: nici nu plânge, nici nu râde = ni plora, ni riu -->
  <pattern>
      <pattern-item n="conjnici"/>
      <pattern-item n="advnu"/>
      <pattern-item n="vbcnj"/>
    </pattern>
    <action>
      <out><chunk name="x"><tags><tag><lit-tag v="SX"/></tag></tags>
          <lu>
            <lit v="ni"/>
            <lit-tag v="cnjcoo"/>
          </lu>
          <b pos="1"/>
          <lu>
            <clip pos="3" side="tl" part="lemh"/>
            <clip pos="3" side="tl" part="a_verb"/>
            <clip pos="3" side="tl" part="a_temps"/>
            <clip pos="3" side="tl" part="gen"/>
            <clip pos="3" side="tl" part="a_pers"/>
            <clip pos="3" side="tl" part="a_nbr"/>
            <clip pos="3" side="tl" part="lemq"/>
           </lu>
        </chunk></out>
    </action>
</rule>

<rule> <!-- REGLA 73 DELIA ADVNICIODATÄ + ADVNU + VB : NUNCA + VB: niciodată nu plânge = nunca llora -->
  <pattern>
      <pattern-item n="advnici-"/>
      <pattern-item n="advnu"/>
      <pattern-item n="vbcnj"/>
    </pattern>
    <action>
      <out><chunk name="x"><tags><tag><lit-tag v="SX"/></tag></tags>
          <lu>
            <clip pos="1" side="tl" part="lem"/>
            <clip pos="1" side="tl" part="a_adv"/>
          </lu>
          <b pos="1"/>
          <lu>
            <clip pos="3" side="tl" part="lemh"/>
            <clip pos="3" side="tl" part="a_verb"/>
            <clip pos="3" side="tl" part="a_temps"/>
            <clip pos="3" side="tl" part="gen"/>
            <clip pos="3" side="tl" part="a_pers"/>
            <clip pos="3" side="tl" part="a_nbr"/>
            <clip pos="3" side="tl" part="lemq"/>
           </lu>
        </chunk></out>
    </action>
</rule>


<rule> <!-- REGLA 74 DELIA ADVNU + VB + ADVDECÂT : NO + VB + MÁS + QUE -->
  <pattern>
      <pattern-item n="advnu"/>
      <pattern-item n="vbcnj"/>
       <pattern-item n="advdecât"/>
    </pattern>
    <action>
       <call-macro n="f_modgen">
          <with-param pos="2"/>
        </call-macro>
      <out><chunk name="x"><tags><tag><lit-tag v="SX"/></tag></tags>
          <lu>
            <clip pos="1" side="tl" part="lem"/>
            <clip pos="1" side="tl" part="a_adv"/>
          </lu>
          <b pos="1"/>
          <lu>
            <clip pos="2" side="tl" part="lemh"/>
            <clip pos="2" side="tl" part="a_verb"/>
            <clip pos="2" side="tl" part="a_temps"/>
            <clip pos="2" side="tl" part="gen"/>
            <clip pos="2" side="tl" part="a_pers"/>
            <clip pos="2" side="tl" part="a_nbr"/>
            <clip pos="2" side="tl" part="lemq"/>
          </lu>
          <b pos="2"/>
          <lu>
            <lit v="més"/>
            <lit-tag v="adv"/>
          </lu>
          <b/>
        </chunk></out>
    </action>
</rule>





<rule> <!-- REGLA 76 Condicional TREBUI VBMOD - Hauria de inf-->
  <pattern>
      <pattern-item n="vbaveacni"/>
      <pattern-item n="verbtrebui"/>
      <pattern-item n="conjsub"/>
      <pattern-item n="vbcnj"/>
    </pattern>
    <action>
        <out><chunk name="x"><tags><tag><lit-tag v="SX"/></tag></tags>
          <lu>
          <get-case-from pos="1">
            <clip pos="2" side="tl" part="lemh"/>
          </get-case-from>
            <clip pos="2" side="tl" part="a_verb"/>
            <lit-tag v="cni"/>
            <clip pos="4" side="tl" part="a_pers"/>
            <clip pos="2" side="tl" part="gen"/>
            <clip pos="4" side="tl" part="a_nbr"/>
            <clip pos="2" side="tl" part="lemq"/>
          </lu>
          <b pos="2"/>
          <lu>
            <clip pos="4" side="tl" part="lemh"/>
            <clip pos="4" side="tl" part="a_verb"/>
            <lit-tag v="inf"/>
            <clip pos="4" side="tl" part="lemq"/>
          </lu>
        </chunk></out>
    </action>
</rule>

<rule> <!-- REGLA 77 Perfecte compost  A TREBUIT VBMOD - Va haver de inf-->
  <pattern>
      <pattern-item n="vbaveapri"/>
      <pattern-item n="verbtrebui"/>
      <pattern-item n="conjsub"/>
      <pattern-item n="vbcnj"/>
    </pattern>
    <action>
        <out><chunk name="x"><tags><tag><lit-tag v="SX"/></tag></tags>
          <lu>
          <get-case-from pos="1">
            <clip pos="2" side="tl" part="lemh"/>
          </get-case-from>
            <clip pos="2" side="tl" part="a_verb"/>
            <lit v="haver"/>
            <lit-tag v="ifi"/>
            <clip pos="4" side="tl" part="a_pers"/>
            <clip pos="2" side="tl" part="gen"/>
            <clip pos="4" side="tl" part="a_nbr"/>
            <clip pos="2" side="tl" part="lemq"/>
          </lu>
          <b pos="1"/>
            <lu>
            <lit v="de"/>
            <lit-tag v="pr"/>
          </lu>
          <b pos="2"/>
          <lu>
            <clip pos="4" side="tl" part="lemh"/>
            <clip pos="4" side="tl" part="a_verb"/>
            <lit-tag v="inf"/>
            <clip pos="4" side="tl" part="lemq"/>
          </lu>
        </chunk></out>
    </action>
</rule>


<!-- REGLA 78 DATIU: VERB + NOM = VERB + A + NOM -->
    <rule>
      <pattern>
        <pattern-item n="vbcnj"/>
        <pattern-item n="nom"/>
      </pattern>
      <action>
      <call-macro n="f_modgen">
        <with-param pos="1"/>
      </call-macro>
      <call-macro n="conj_verb1">
        <with-param pos="1"/>
      </call-macro>
      <call-macro n="f_concord1_i">
        <with-param pos="2"/>
      </call-macro>
        <choose>
          <when>
            <test>
              <and>
                <equal>
                  <clip pos="2" side="sl" part="a_case"/>
                  <lit-tag v="dg"/>
                </equal>
                <equal>
                  <clip pos="2" side="sl" part="a_def"/>
                  <lit-tag v="def"/>
                </equal>
              </and>
            </test>
            <out><chunk name="x"><tags><tag><lit-tag v="SX"/></tag><tag><clip pos="1" side="tl" part="a_verb"/></tag><tag><var n="temps"/></tag><tag><var n="persona"/></tag><tag><var n="nombre"/></tag></tags>
              <lu>
                <var n="auxiliar_lema"/>
                <var n="auxiliar"/>
                <var n="verb"/>
              </lu>
              <b/>
              <lu>
                <lit v="a"/>
                <lit-tag v="pr"/>
              </lu>
              <b/>
              <lu>
                <lit v="el"/>
                <lit-tag v="det.def"/>
                <var n="genere1"/>
                <var n="nombre1"/>
              </lu>
              <b pos="1"/>
              <lu>
                <clip pos="2" side="tl" part="lem"/>
                <clip pos="2" side="tl" part="a_nom"/>
                <clip pos="2" side="tl" part="gen"/>
                <clip pos="2" side="tl" part="a_nbr"/>
              </lu>
            </chunk></out>
          </when>
          <when>
            <test>
              <and>
                <equal>
                  <clip pos="2" side="sl" part="a_case"/>
                  <lit-tag v="nom"/>
                </equal>
                <equal>
                  <clip pos="2" side="sl" part="a_def"/>
                  <lit-tag v="def"/>
                </equal>
              </and>
            </test>
            <out><chunk name="x"><tags><tag><lit-tag v="SX"/></tag><tag><clip pos="1" side="tl" part="a_verb"/></tag><tag><var n="temps"/></tag><tag><var n="persona"/></tag><tag><var n="nombre"/></tag></tags>
              <lu>
                <var n="auxiliar_lema"/>
                <var n="auxiliar"/>
                <var n="verb"/>
              </lu>
              <b/>
              <lu>
                <lit v="el"/>
                <lit-tag v="det.def"/>
                <var n="genere1"/>
                <var n="nombre1"/>
              </lu>
              <b/>
              <lu>
                <clip pos="2" side="tl" part="lemh"/>
                <clip pos="2" side="tl" part="a_nom"/>
                <clip pos="2" side="tl" part="gen"/>
                <clip pos="2" side="tl" part="a_nbr"/>
                <clip pos="2" side="tl" part="lemq"/>
              </lu>
            </chunk></out>
            </when>
          <otherwise>
            <out><chunk name="x"><tags><tag><lit-tag v="SX"/></tag><tag><clip pos="1" side="tl" part="a_verb"/></tag><tag><var n="temps"/></tag><tag><var n="persona"/></tag><tag><var n="nombre"/></tag></tags>
              <lu>
                <var n="auxiliar_lema"/>
                <var n="auxiliar"/>
                <var n="verb"/>
              </lu>
              <b/>
              <lu>
                <clip pos="2" side="tl" part="lemh"/>
                <clip pos="2" side="tl" part="a_nom"/>
                <clip pos="2" side="tl" part="gen"/>
                <clip pos="2" side="tl" part="a_nbr"/>
                <clip pos="2" side="tl" part="lemq"/>
              </lu>
            </chunk></out>
          </otherwise>
        </choose>
        <call-macro n="n_gen_nbr"/>
      </action>
    </rule>


     <!-- REGLA 21 VERB + SÄ + NU + VERB = NO + VERB + INF /o/ VERB + QUE + NO + SUBJ
    <rule>
      <pattern>
        <pattern-item n="vbcnj"/>
        <pattern-item n="conjsub"/>
        <pattern-item n="advnu"/>
        <pattern-item n="vbcnj"/>
      </pattern>
      <action>
        <choose>
              <when>
                 <test>
                  <and>
                    <equal>
                      <clip pos="1" side="sl" part="a_pers"/>
                      <lit-tag v="p1"/>
                    </equal>
                    <equal>
                      <clip pos="1" side="sl" part="a_nbr"/>
                      <lit-tag v="sg"/>
                    </equal>
                    <equal>
                      <clip pos="4" side="sl" part="a_pers"/>
                      <lit-tag v="p1"/>
                    </equal>
                    <equal>
                      <clip pos="4" side="sl" part="a_nbr"/>
                     <lit-tag v="sg"/>
                    </equal>
                    </and>
                  </test>
                  <out><chunk name="x"><tags><tag><lit-tag v="SX"/></tag></tags>
                     <lu>
                       <get-case-from pos="1">
                       <lit v="no"/>
                       </get-case-from>
                       <lit-tag v="adv"/>
                     </lu>
                       <b/>
                     <lu>
                       <clip pos="1" side="tl" part="lem"/>
                       <clip pos="1" side="tl" part="a_verb"/>
                       <clip pos="1" side="tl" part="a_temps"/>
                       <clip pos="1" side="tl" part="a_pers"/>
                       <clip pos="1" side="tl" part="gen"/>
                       <clip pos="1" side="tl" part="a_nbr"/>
                     </lu>
                        <b/>
                     <lu>
                       <clip pos="3" side="tl" part="lem"/>
                       <clip pos="3" side="tl" part="a_verb"/>
                       <lit-tag v="inf"/>
                     </lu>
                   </chunk></out>
                 </when>
                 <when>
                  <test>
                    <and>
                    <equal>
                      <clip pos="1" side="sl" part="a_pers"/>
                      <lit-tag v="p2"/>
                    </equal>
                    <equal>
                      <clip pos="1" side="sl" part="a_nbr"/>
                      <lit-tag v="sg"/>
                    </equal>
                    <equal>
                      <clip pos="4" side="sl" part="a_pers"/>
                      <lit-tag v="p2"/>
                    </equal>
                    <equal>
                      <clip pos="4" side="sl" part="a_nbr"/>
                     <lit-tag v="sg"/>
                    </equal>
                    </and>
                  </test>
                  <out><chunk name="x"><tags><tag><lit-tag v="SX"/></tag></tags>
                     <lu>
                       <get-case-from pos="1">
                       <lit v="no"/>
                       </get-case-from>
                       <lit-tag v="adv"/>
                     </lu>
                       <b/>
                     <lu>
                       <clip pos="1" side="tl" part="lem"/>
                       <clip pos="1" side="tl" part="a_verb"/>
                       <clip pos="1" side="tl" part="a_temps"/>
                       <clip pos="1" side="tl" part="a_pers"/>
                       <clip pos="1" side="tl" part="gen"/>
                       <clip pos="1" side="tl" part="a_nbr"/>
                     </lu>
                         <b/>
                     <lu>
                       <clip pos="3" side="tl" part="lem"/>
                       <clip pos="3" side="tl" part="a_verb"/>
                       <lit-tag v="inf"/>
                     </lu>
                 </chunk></out>
                 </when>
                 <when>
                 <test>
                    <and>
                    <equal>
                      <clip pos="1" side="sl" part="a_pers"/>
                      <lit-tag v="p3"/>
                    </equal>
                    <equal>
                      <clip pos="1" side="sl" part="a_nbr"/>
                      <lit-tag v="sg"/>
                    </equal>
                    <equal>
                      <clip pos="4" side="sl" part="a_pers"/>
                      <lit-tag v="p3"/>
                    </equal>
                    <equal>
                      <clip pos="4" side="sl" part="a_nbr"/>
                     <lit-tag v="sg"/>
                    </equal>
                    </and>
                  </test>
                  <out><chunk name="x"><tags><tag><lit-tag v="SX"/></tag></tags>
                     <lu>
                       <get-case-from pos="1">
                       <lit v="no"/>
                       </get-case-from>
                       <lit-tag v="adv"/>
                     </lu>
                       <b/>
                     <lu>
                       <clip pos="1" side="tl" part="lem"/>
                       <clip pos="1" side="tl" part="a_verb"/>
                       <clip pos="1" side="tl" part="a_temps"/>
                       <clip pos="1" side="tl" part="a_pers"/>
                       <clip pos="1" side="tl" part="gen"/>
                       <clip pos="1" side="tl" part="a_nbr"/>
                     </lu>
                         <b/>
                     <lu>
                       <clip pos="3" side="tl" part="lem"/>
                       <clip pos="3" side="tl" part="a_verb"/>
                       <lit-tag v="inf"/>
                     </lu>
                 </chunk></out>
                 </when>


                  <when>
                 <test>
                    <and>
                    <equal>
                      <clip pos="1" side="sl" part="a_pers"/>
                      <lit-tag v="p1"/>
                    </equal>
                    <equal>
                      <clip pos="1" side="sl" part="a_nbr"/>
                      <lit-tag v="pl"/>
                    </equal>
                    <equal>
                      <clip pos="4" side="sl" part="a_pers"/>
                      <lit-tag v="p1"/>
                    </equal>
                    <equal>
                      <clip pos="4" side="sl" part="a_nbr"/>
                     <lit-tag v="pl"/>
                    </equal>
                    </and>
                  </test>
                  <out><chunk name="x"><tags><tag><lit-tag v="SX"/></tag></tags>
                     <lu>
                       <get-case-from pos="1">
                       <lit v="no"/>
                       </get-case-from>
                       <lit-tag v="adv"/>
                     </lu>
                       <b/>
                     <lu>
                       <clip pos="1" side="tl" part="lem"/>
                       <clip pos="1" side="tl" part="a_verb"/>
                       <clip pos="1" side="tl" part="a_temps"/>
                       <clip pos="1" side="tl" part="a_pers"/>
                       <clip pos="1" side="tl" part="gen"/>
                       <clip pos="1" side="tl" part="a_nbr"/>
                     </lu>
                         <b/>
                     <lu>
                       <clip pos="3" side="tl" part="lem"/>
                       <clip pos="3" side="tl" part="a_verb"/>
                       <lit-tag v="inf"/>
                     </lu>
                 </chunk></out>
                 </when>
                  <when>
                 <test>
                    <and>
                    <equal>
                      <clip pos="1" side="sl" part="a_pers"/>
                      <lit-tag v="p2"/>
                    </equal>
                    <equal>
                      <clip pos="1" side="sl" part="a_nbr"/>
                      <lit-tag v="pl"/>
                    </equal>
                    <equal>
                      <clip pos="4" side="sl" part="a_pers"/>
                      <lit-tag v="p2"/>
                    </equal>
                    <equal>
                      <clip pos="4" side="sl" part="a_nbr"/>
                     <lit-tag v="pl"/>
                    </equal>
                    </and>
                  </test>
                  <out><chunk name="x"><tags><tag><lit-tag v="SX"/></tag></tags>
                     <lu>
                       <get-case-from pos="1">
                       <lit v="no"/>
                       </get-case-from>
                       <lit-tag v="adv"/>
                     </lu>
                       <b/>
                       <lu>
                       <clip pos="1" side="tl" part="lem"/>
                       <clip pos="1" side="tl" part="a_verb"/>
                       <clip pos="1" side="tl" part="a_temps"/>
                       <clip pos="1" side="tl" part="a_pers"/>
                       <clip pos="1" side="tl" part="gen"/>
                       <clip pos="1" side="tl" part="a_nbr"/>
                     </lu>
                         <b/>
                     <lu>
                       <clip pos="3" side="tl" part="lem"/>
                       <clip pos="3" side="tl" part="a_verb"/>
                       <lit-tag v="inf"/>
                     </lu>
                 </chunk></out>
                 </when>
                  <when>
                 <test>
                    <and>
                    <equal>
                      <clip pos="1" side="sl" part="a_pers"/>
                      <lit-tag v="p3"/>
                    </equal>
                    <equal>
                      <clip pos="1" side="sl" part="a_nbr"/>
                      <lit-tag v="pl"/>
                    </equal>
                    <equal>
                      <clip pos="4" side="sl" part="a_pers"/>
                      <lit-tag v="p3"/>
                    </equal>
                    <equal>
                      <clip pos="4" side="sl" part="a_nbr"/>
                     <lit-tag v="pl"/>
                    </equal>
                    </and>
                  </test>
                  <out><chunk name="x"><tags><tag><lit-tag v="SX"/></tag></tags>
                     <lu>
                       <get-case-from pos="1">
                       <lit v="no"/>
                       </get-case-from>
                       <lit-tag v="adv"/>
                     </lu>
                       <b/>
                     <lu>
                       <clip pos="1" side="tl" part="lem"/>
                       <clip pos="1" side="tl" part="a_verb"/>
                       <clip pos="1" side="tl" part="a_temps"/>
                       <clip pos="1" side="tl" part="a_pers"/>
                       <clip pos="1" side="tl" part="gen"/>
                       <clip pos="1" side="tl" part="a_nbr"/>
                     </lu>
                         <b/>
                     <lu>
                       <clip pos="3" side="tl" part="lem"/>
                       <clip pos="3" side="tl" part="a_verb"/>
                       <lit-tag v="inf"/>
                     </lu>
                 </chunk></out>
                 </when>
                 <otherwise>
                <out><chunk name="x"><tags><tag><lit-tag v="SX"/></tag></tags>
                     <lu>
                       <get-case-from pos="1">
                       <lit v="no"/>
                       </get-case-from>
                       <lit-tag v="adv"/>
                     </lu>
                       <b/>
                     <lu>
                       <clip pos="1" side="tl" part="lem"/>
                       <clip pos="1" side="tl" part="a_verb"/>
                       <clip pos="1" side="tl" part="a_temps"/>
                       <clip pos="1" side="tl" part="a_pers"/>
                       <clip pos="1" side="tl" part="gen"/>
                       <clip pos="1" side="tl" part="a_nbr"/>
                     </lu>
                         <b/>
                     <lu>
                       <clip pos="2" side="tl" part="lem"/>
                        <lit-tag v="cnjsub"/>
                     </lu>
                      <b/>
                     <lu>
                       <clip pos="3" side="tl" part="lem"/>
                       <clip pos="3" side="tl" part="a_verb"/>
                       <clip pos="3" side="tl" part="a_temps"/>
                       <clip pos="3" side="tl" part="a_pers"/>
                       <clip pos="3" side="tl" part="a_nbr"/>
                     </lu>
                </chunk></out>
             </otherwise>
        </choose>
      </action>
    </rule>    -->




    <!-- REGLA 82 VERB + SÄ + VERB = VERB + INF /o/ VERB + QUE +SUBJ -->
    <rule>
      <pattern>
        <pattern-item n="vbcnj"/>
        <pattern-item n="conjsub"/>
        <pattern-item n="vbcnj"/>
      </pattern>
      <action>

       <call-macro n="f_modgen">
           <with-param pos="1"/>
         </call-macro>
        <call-macro n="conj_verb1">
          <with-param pos="1"/>
        </call-macro>

        <choose>

             <when>
                 <test>
                    <and>
                    <equal>
                      <clip pos="1" side="sl" part="a_pers"/>
                      <clip pos="3" side="sl" part="a_pers"/>
                    </equal>
                    <equal>
                      <clip pos="1" side="sl" part="a_nbr"/>
                      <clip pos="3" side="sl" part="a_nbr"/>
                    </equal>
                    </and>
                  </test>
                  <out><chunk name="x"><tags><tag><lit-tag v="SX"/></tag><tag><clip pos="1" side="tl" part="a_verb"/></tag><tag><var n="temps"/></tag><tag><var n="persona"/></tag><tag><var n="nombre"/></tag></tags>
                       <lu>
                         <var n="auxiliar_lema"/>
                         <var n="auxiliar"/>
                         <var n="verb"/>
                       </lu>
                         <b/>
                       <lu>
                       <clip pos="3" side="tl" part="lemh"/>
                       <clip pos="3" side="tl" part="a_verb"/>
                       <lit-tag v="inf"/>
                       <clip pos="3" side="tl" part="lemq"/>
                       </lu>
                 </chunk></out>
              </when>

              <otherwise>
               <out><chunk name="x"><tags><tag><lit-tag v="SX"/></tag><tag><clip pos="1" side="tl" part="a_verb"/></tag><tag><var n="temps"/></tag><tag><var n="persona"/></tag><tag><var n="nombre"/></tag></tags>
                 <lu>
                   <var n="auxiliar_lema"/>
                   <var n="auxiliar"/>
                   <var n="verb"/>
                 </lu>
                 <b pos="1"/>
                 <lu>
                       <clip pos="2" side="tl" part="lem"/>
                        <lit-tag v="cnjsub"/>
                 </lu>
                 <b pos="2"/>
                 <lu>
                       <clip pos="3" side="tl" part="lemh"/>
                       <clip pos="3" side="tl" part="a_verb"/>
                       <clip pos="3" side="tl" part="a_temps"/>
                       <clip pos="3" side="tl" part="a_pers"/>
                       <clip pos="3" side="tl" part="gen"/>
                       <clip pos="3" side="tl" part="a_nbr"/>
                       <clip pos="3" side="tl" part="lemq"/>
                </lu>
                </chunk></out>
             </otherwise>
        </choose>
      </action>
    </rule>


    <rule>
<!-- REGLA 83: ADVERBI ADJECTIU NOM -->
      <pattern>
        <pattern-item n="adv"/>
        <pattern-item n="adj"/>
        <pattern-item n="nom"/>
      </pattern>
      <action>
       <call-macro n="f_modgen">
              <with-param pos="2"/>
            </call-macro>
            <call-macro n="f_concord2_i">
              <with-param pos="3"/>
              <with-param pos="2"/>
            </call-macro>
        <choose>
          <when>
            <test>
              <equal>
                <clip pos="2" side="sl" part="a_def"/>
                <lit-tag v="def"/>
              </equal>
            </test>
              <call-macro n="mod_maj">
              <with-param pos="1"/>
            </call-macro>
            <out><chunk name="x"><tags><tag><lit-tag v="SX"/></tag></tags>
              <lu>
               <get-case-from pos="1">
                <lit v="el"/>
                </get-case-from>
                <lit-tag v="det.def"/>
                <var n="genere1"/>
                <var n="nombre1"/>
              </lu>
              <b pos="1"/>
              <lu>
                <clip pos="1" side="tl" part="lem"/>
                <clip pos="1" side="tl" part="a_adv"/>
              </lu>
              <b pos="2"/>
              <lu>
                <clip pos="2" side="tl" part="lem"/>
                <clip pos="2" side="tl" part="a_adj"/>
                <clip pos="2" side="tl" part="gen"/>
                <clip pos="2" side="tl" part="a_nbr"/>
              </lu>
              <b/>
              <lu>
                <clip pos="3" side="tl" part="lem"/>
                <clip pos="3" side="tl" part="a_nom"/>
                <clip pos="3" side="tl" part="gen"/>
                <clip pos="3" side="tl" part="a_nbr"/>
              </lu>
            </chunk></out>
          </when>
          <otherwise>
            <out><chunk name="x"><tags><tag><lit-tag v="SX"/></tag></tags>
              <lu>
                <clip pos="1" side="tl" part="lem"/>
                <clip pos="1" side="tl" part="a_adv"/>
              </lu>
              <b pos="1"/>
              <lu>
                <clip pos="2" side="tl" part="lem"/>
                <clip pos="2" side="tl" part="a_adj"/>
                <clip pos="2" side="tl" part="gen"/>
                <clip pos="2" side="tl" part="a_nbr"/>
              </lu>
              <b pos="2"/>
              <lu>
                <clip pos="3" side="tl" part="lem"/>
                <clip pos="3" side="tl" part="a_nom"/>
                <clip pos="3" side="tl" part="gen"/>
                <clip pos="3" side="tl" part="a_nbr"/>
              </lu>
            </chunk></out>
          </otherwise>
        </choose>
        <call-macro n="n_gen_nbr"/>
      </action>
    </rule>

    <rule>
<!-- REGLA 84: NUMERAL ADJECTIU NOM -->
      <pattern>
        <pattern-item n="num"/>
        <pattern-item n="adj"/>
        <pattern-item n="nom"/>
      </pattern>
      <action>
        <call-macro n="f_modgen">
              <with-param pos="3"/>
        </call-macro>
        <call-macro n="f_concord3_i">
              <with-param pos="3"/>
              <with-param pos="2"/>
              <with-param pos="1"/>
        </call-macro>
        <choose>
          <when>
            <test>
              <not>
                <equal>
                  <clip pos="1" side="sl" part="lem"/>
                  <lit v="1"/>
                </equal>
              </not>
            </test>
        <let>
        <clip pos="3" side="tl" part="a_nbr"/>
        <lit-tag v="pl"/>
        </let>
     </when>
   </choose>
            <out><chunk name="x"><tags><tag><lit-tag v="SX"/></tag></tags>
              <lu>
                <clip pos="1" side="tl" part="lem"/>
                <clip pos="1" side="tl" part="a_num"/>
                <clip pos="1" side="tl" part="gen"/>
                <clip pos="1" side="tl" part="a_nbr"/>
              </lu>
              <b pos="1"/>
              <lu>
                <clip pos="2" side="tl" part="lem"/>
                <clip pos="2" side="tl" part="a_adj"/>
                <clip pos="2" side="tl" part="gen"/>
                <clip pos="2" side="tl" part="a_nbr"/>
              </lu>
              <b pos="2"/>
              <lu>
                <clip pos="3" side="tl" part="lem"/>
                <clip pos="3" side="tl" part="a_nom"/>
                <clip pos="3" side="tl" part="gen"/>
                <clip pos="3" side="tl" part="a_nbr"/>
              </lu>
            </chunk></out>
        <call-macro n="n_gen_nbr"/>
      </action>
    </rule>

<!--REGLA: NOM DET NUMERAL NOM
    <rule>
      <pattern>
        <pattern-item n="nom"/>
        <pattern-item n="det_cel"/>
        <pattern-item n="num"/>
        <pattern-item n="nom"/>
      </pattern>
      <action>
        <call-macro n="f_modgen">
              <with-param pos="2"/>
            </call-macro>
            <call-macro n="f_concord3">
              <with-param pos="4"/>
              <with-param pos="3"/>
              <with-param pos="2"/>
            </call-macro>
        <choose>
          <when>
            <test>
              <equal>
                <and>
                <clip pos="1" side="sl" part="a_case"/>
                <lit-tag v="nom"/>
              </equal>
              <equal>
                  <clip pos="1" side="sl" part="a_def"/>
                  <lit-tag v="def"/>
                </equal>
                </and>
              </test>
            <out><chunk name="x"><tags><tag><lit-tag v="SX"/></tag></tags>
             <lu>
               <get-case-from pos="1">
                 <lit v="el"/>
                 </get-case-from>
                <lit-tag v="det.def"/>
                <clip pos="1" side="tl" part="gen"/>
                <clip pos="1" side="tl" part="a_nbr"/>
              </lu>
              <b/>
              <lu>
                <clip pos="1" side="tl" part="nom"/>
                <clip pos="1" side="tl" part="a_nom"/>
                <clip pos="1" side="tl" part="gen"/>
                <clip pos="1" side="tl" part="a_nbr"/>
              </lu>
              <b/>
              <lu>
               <lit v="de"/>
               <lit-tag v="pr"/>
              </lu>
              <b/>
               <lu>
                <lit v="el"/>
                <lit-tag v="det.def"/>
                <clip pos="4" side="tl" part="gen"/>
                <clip pos="3" side="tl" part="a_nbr"/>
              </lu>
              <b/>
              <lu>
                <clip pos="3" side="tl" part="whole"/>
              </lu>
              <b/>
               <lu>
                <clip pos="4" side="tl" part="lem"/>
                <clip pos="4" side="tl" part="a_nom"/>
                <clip pos="4" side="tl" part="gen"/>
                <clip pos="3" side="tl" part="a_nbr"/>
              </lu>
            </chunk></out>
          </when>
          <when>
            <test>
              <and>
              <equal>
                <clip pos="1" side="sl" part="a_case"/>
                <lit-tag v="dg"/>
              </equal>
              <equal>
                  <clip pos="1" side="sl" part="a_def"/>
                  <lit-tag v="def"/>
                </equal>
                </and>
              </test>
              <out><chunk name="x"><tags><tag><lit-tag v="SX"/></tag></tags>
              <lu>
               <get-case-from pos="1">
               <lit v="de"/>
               </get-case-from>
               <lit-tag v="pr"/>
              </lu>
              <b/>
              <lu>
                <lit v="el"/>
                <lit-tag v="det.def"/>
                <clip pos="2" side="tl" part="gen"/>
                <clip pos="2" side="tl" part="a_nbr"/>
              </lu>
              <b/>
              <lu>
                <clip pos="2" side="tl" part="nom"/>
                <clip pos="2" side="tl" part="a_nom"/>
                <clip pos="2" side="tl" part="gen"/>
                <clip pos="2" side="tl" part="a_nbr"/>
              </lu>
              <b/>
              <lu>
               <lit v="de"/>
               <lit-tag v="pr"/>
              </lu>
              <b/>
              <lu>
                <lit v="el"/>
                <lit-tag v="det.def"/>
                <clip pos="4" side="tl" part="gen"/>
                <clip pos="3" side="tl" part="a_nbr"/>
              </lu>
              <b/>
              <lu>
                <clip pos="3" side="tl" part="whole"/>
              </lu>
              <b/>
              <lu>
                <clip pos="4" side="tl" part="lem"/>
                <clip pos="4" side="tl" part="a_nom"/>
                <clip pos="4" side="tl" part="gen"/>
                <clip pos="3" side="tl" part="a_nbr"/>
              </lu>
            </chunk></out>
          </when>
         </choose>
      </action>
    </rule> -->

    <rule>
<!--REGLA 86: VERB DET NUMERAL NOM -->
      <pattern>
        <pattern-item n="vbcnj"/>
        <pattern-item n="det_cel"/>
        <pattern-item n="num"/>
        <pattern-item n="nom"/>
      </pattern>
      <action>
        <call-macro n="f_modgen">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="f_modgen">
          <with-param pos="2"/>
        </call-macro>
        <call-macro n="f_concord3_i">
          <with-param pos="4"/>
          <with-param pos="3"/>
          <with-param pos="2"/>
        </call-macro>
        <choose>
          <when>
            <test>
              <equal>
                <clip pos="2" side="sl" part="a_case"/>
                <lit-tag v="nom"/>
              </equal>
            </test>
            <out><chunk name="x"><tags><tag><lit-tag v="SX"/></tag></tags>
               <lu>
               <get-case-from pos="1">
                <clip pos="1" side="tl" part="lemh"/>
                </get-case-from>
                <clip pos="1" side="tl" part="a_verb"/>
                <clip pos="1" side="tl" part="a_temps"/>
                <clip pos="1" side="tl" part="a_pers"/>
                <clip pos="1" side="tl" part="gen"/>
                <clip pos="1" side="tl" part="a_nbr"/>
                <clip pos="1" side="tl" part="lemq"/>
              </lu>
              <b pos="1"/>
              <lu>
                <lit v="el"/>
                <lit-tag v="det.def"/>
                <clip pos="4" side="tl" part="gen"/>
                <clip pos="3" side="tl" part="a_nbr"/>
              </lu>
              <b pos="2"/>
              <lu>
                <clip pos="3" side="tl" part="lem"/>
                <clip pos="3" side="tl" part="a_num"/>
                <clip pos="3" side="tl" part="gen"/>
                <clip pos="3" side="tl" part="a_nbr"/>
              </lu>
              <b pos="3"/>
              <lu>
                <clip pos="4" side="tl" part="lem"/>
                <clip pos="4" side="tl" part="a_nom"/>
                <clip pos="4" side="tl" part="gen"/>
                <lit-tag v="pl"/>
              </lu>
            </chunk></out>
          </when>
          <when>
            <test>
              <equal>
                <clip pos="2" side="sl" part="a_case"/>
                <lit-tag v="dg"/>
              </equal>
            </test>
         <call-macro n="mod_maj">
              <with-param pos="1"/>
            </call-macro>
            <out><chunk name="x"><tags><tag><lit-tag v="SX"/></tag></tags>
              <lu>
               <get-case-from pos="1">
                <clip pos="1" side="tl" part="lemh"/>
                </get-case-from>
                <clip pos="1" side="tl" part="a_verb"/>
                <clip pos="1" side="tl" part="a_temps"/>
                <clip pos="1" side="tl" part="a_pers"/>
                <clip pos="1" side="tl" part="gen"/>
                <clip pos="1" side="tl" part="a_nbr"/>
                <clip pos="1" side="tl" part="lemq"/>
              </lu>
              <b pos="1"/>
              <lu>
               <lit v="a"/>
               <lit-tag v="pr"/>
              </lu>
              <b/>
              <lu>
                <lit v="el"/>
                <lit-tag v="det.def"/>
                <clip pos="4" side="tl" part="gen"/>
                <clip pos="3" side="tl" part="a_nbr"/>
              </lu>
              <b pos="2"/>
              <lu>
                <clip pos="3" side="tl" part="lem"/>
                <clip pos="3" side="tl" part="a_num"/>
                <clip pos="3" side="tl" part="gen"/>
                <clip pos="3" side="tl" part="a_nbr"/>
              </lu>
              <b pos="3"/>
              <lu>
                <clip pos="4" side="tl" part="lem"/>
                <clip pos="4" side="tl" part="a_nom"/>
                <clip pos="4" side="tl" part="gen"/>
                <lit-tag v="pl"/>
              </lu>
            </chunk></out>
          </when>
        </choose>
        <call-macro n="n_gen_nbr"/>
      </action>
    </rule>


<!--REGLA 95 DELIA: VERB Acusativo + PREP PE + NOM - VERB + PREP A + NOM-->
      <rule>
      <pattern>
        <pattern-item n="vbcnj"/>
        <pattern-item n="prep"/>
        <pattern-item n="nom"/>
      </pattern>
       <action>
        <call-macro n="f_modgen">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="conj_verb1">
          <with-param pos="1"/>
        </call-macro>
        <call-macro n="f_concord1_i">
          <with-param pos="3"/>
        </call-macro>
      <choose>
       <when>
         <test>
           <equal>
              <clip pos="2" side="sl" part="lem"/>
                <lit v="pe"/>
           </equal>
        </test>
           <out><chunk name="x"><tags><tag><lit-tag v="SX"/></tag><tag><clip pos="1" side="tl" part="a_verb"/></tag><tag><var n="temps"/></tag><tag><var n="persona"/></tag><tag><var n="nombre"/></tag></tags>
              <lu>
                <var n="auxiliar_lema"/>
                <var n="auxiliar"/>
                <var n="verb"/>
              </lu>
          <b/>
           <lu>
              <lit v="a"/>
              <lit-tag v="pr"/>
           </lu>
           <b/>
           <lu>
                <lit v="el"/>
                <lit-tag v="det.def"/>
                <var n="genere1"/>
                <var n="nombre1"/>
           </lu>
           <b/>
           <lu>
              <clip pos="3" side="tl" part="lem"/>
              <clip pos="3" side="tl" part="a_nom"/>
              <clip pos="3" side="tl" part="gen"/>
              <clip pos="3" side="tl" part="a_nbr"/>
            </lu>
         </chunk></out>
         </when>
         <otherwise>
             <out><chunk name="x"><tags><tag><lit-tag v="SX"/></tag><tag><clip pos="1" side="tl" part="a_verb"/></tag><tag><var n="temps"/></tag><tag><var n="persona"/></tag><tag><var n="nombre"/></tag></tags>
             <lu>
                <var n="auxiliar_lema"/>
                <var n="auxiliar"/>
                <var n="verb"/>
              </lu>
             <b/>
                <lu>
                    <clip pos="2" side="tl" part="lem"/>
                    <clip pos="2" side="tl" part="a_prep"/>
                  </lu>
                  <b/>
                  <lu>
                    <clip pos="3" side="tl" part="lem"/>
                    <clip pos="3" side="tl" part="a_nom"/>
                    <clip pos="3" side="tl" part="gen"/>
                    <clip pos="3" side="tl" part="a_nbr"/>
                  </lu>
                </chunk></out>
            </otherwise>
          </choose>
        <!--<call-macro n="f_bcond">
          <with-param pos="1"/>
          <with-param pos="2"/>
        </call-macro> -->
        <call-macro n="n_gen_nbr"/>
      </action>
    </rule>



 <!--REGLA 96 DELIA: VERB FUTUR + PREP PE + PRONOM - FUTUR PREP A + PRON-->
      <rule>
      <pattern>
        <pattern-item n="vrea"/>
<!--GEMA <pattern-item n="inf"/>el tagger tria malament, quan trie inf canviar verb per inf-->
        <pattern-item n="vbcnj"/>
        <pattern-item n="prep"/>
        <pattern-item n="prn"/>
      </pattern>
       <action>
      <choose>
       <when>
         <test>
           <equal>
              <clip pos="3" side="sl" part="lem"/>
                <lit v="pe"/>
           </equal>
        </test>
        <out><chunk name="x"><tags><tag><lit-tag v="SX"/></tag></tags>
            <lu>
            <get-case-from pos="1">
              <clip pos="2" side="tl" part="lemh"/>
            </get-case-from>
            <clip pos="2" side="tl" part="a_verb"/>
            <lit-tag v="fti"/>
            <clip pos="1" side="tl" part="a_pers"/>
            <clip pos="1" side="tl" part="a_nbr"/>
            <clip pos="2" side="tl" part="lemq"/>
          </lu>
          <b/>
           <lu>
              <lit v="a"/>
              <lit-tag v="pr"/>
           </lu>
           <b/>
           <lu>
              <clip pos="4" side="tl" part="lem"/>
              <clip pos="4" side="tl" part="a_prn"/>
              <clip pos="4" side="tl" part="gen"/>
              <clip pos="4" side="tl" part="a_nbr"/>
            </lu>
         </chunk></out>
         </when>
         <otherwise>
             <out><chunk name="x"><tags><tag><lit-tag v="SX"/></tag></tags>
                 <lu>
            <get-case-from pos="1">
              <clip pos="2" side="tl" part="lemh"/>
            </get-case-from>
            <clip pos="2" side="tl" part="a_verb"/>
            <lit-tag v="fti"/>
            <clip pos="1" side="tl" part="a_pers"/>
            <clip pos="1" side="tl" part="a_nbr"/>
            <clip pos="2" side="tl" part="lemq"/>
            </lu>
            <b/>
                <lu>
                    <clip pos="3" side="tl" part="lem"/>
                    <clip pos="3" side="tl" part="a_prep"/>
                  </lu>
                  <b/>
                  <lu>
                    <clip pos="4" side="tl" part="lem"/>
                    <clip pos="4" side="tl" part="a_prn"/>
                    <clip pos="4" side="tl" part="gen"/>
                    <clip pos="4" side="tl" part="a_nbr"/>
                  </lu>
                </chunk></out>
            </otherwise>
          </choose>
        <call-macro n="f_bcond">
          <with-param pos="1"/>
          <with-param pos="2"/>
        </call-macro>
      </action>
    </rule>

<!--REGLA 97 DELIA: VERB FUTUR + PREP PE + NOM - FUTUR PREP A + NOM-->
      <rule>
      <pattern>
        <pattern-item n="vrea"/>
<!--GEMA <pattern-item n="inf"/>el tagger tria malament, quan trie inf canviar verb per inf-->
        <pattern-item n="vbcnj"/>
        <pattern-item n="prep"/>
        <pattern-item n="nom"/>
      </pattern>
       <action>
      <choose>
       <when>
         <test>
           <equal>
              <clip pos="3" side="sl" part="lem"/>
                <lit v="pe"/>
           </equal>
        </test>
        <out><chunk name="x"><tags><tag><lit-tag v="SX"/></tag></tags>
            <lu>
            <get-case-from pos="1">
              <clip pos="2" side="tl" part="lemh"/>
            </get-case-from>
            <clip pos="2" side="tl" part="a_verb"/>
            <lit-tag v="fti"/>
            <clip pos="1" side="tl" part="a_pers"/>
            <clip pos="1" side="tl" part="a_nbr"/>
            <clip pos="2" side="tl" part="lemq"/>
          </lu>
          <b/>
           <lu>
              <lit v="a"/>
              <lit-tag v="pr"/>
           </lu>
           <b/>
           <lu>
                <lit v="el"/>
                <lit-tag v="det.def"/>
                <clip pos="4" side="tl" part="gen"/>
                <clip pos="4" side="tl" part="a_nbr"/>
           </lu>
           <b/>
           <lu>
              <clip pos="4" side="tl" part="lem"/>
              <clip pos="4" side="tl" part="a_nom"/>
              <clip pos="4" side="tl" part="gen"/>
              <clip pos="4" side="tl" part="a_nbr"/>
            </lu>
         </chunk></out>
         </when>
         <otherwise>
             <out><chunk name="x"><tags><tag><lit-tag v="SX"/></tag></tags>
                 <lu>
            <get-case-from pos="1">
              <clip pos="2" side="tl" part="lemh"/>
            </get-case-from>
            <clip pos="2" side="tl" part="a_verb"/>
            <lit-tag v="fti"/>
            <clip pos="1" side="tl" part="a_pers"/>
            <clip pos="1" side="tl" part="a_nbr"/>
            <clip pos="2" side="tl" part="lemq"/>
            </lu>
            <b/>
                <lu>
                    <clip pos="3" side="tl" part="lem"/>
                    <clip pos="3" side="tl" part="a_prep"/>
                  </lu>
                  <b/>
                  <lu>
                    <clip pos="4" side="tl" part="lem"/>
                    <clip pos="4" side="tl" part="a_nom"/>
                    <clip pos="4" side="tl" part="gen"/>
                    <clip pos="4" side="tl" part="a_nbr"/>
                  </lu>
                </chunk></out>
            </otherwise>
          </choose>
        <call-macro n="f_bcond">
          <with-param pos="1"/>
          <with-param pos="2"/>
        </call-macro>
        <call-macro n="n_gen_nbr"/>
      </action>
    </rule>

<!--REGLA 98 DELIA: VERB COND + PREP PE + NOM - COND + PREP A + NOM-->
      <rule>
       <pattern>
        <pattern-item n="vbaveacni"/>
<!--GEMA<pattern-item n="inf"/> el tagger tria malament, quan trie inf canviar verb per inf-->
        <pattern-item n="vbcnj"/>
        <pattern-item n="prep"/>
        <pattern-item n="nom"/>
      </pattern>
       <action>
      <choose>
       <when>
         <test>
           <equal>
              <clip pos="3" side="sl" part="lem"/>
                <lit v="pe"/>
           </equal>
        </test>
        <out><chunk name="x"><tags><tag><lit-tag v="SX"/></tag></tags>
             <lu>
            <get-case-from pos="1">
              <clip pos="2" side="tl" part="lemh"/>
            </get-case-from>
            <clip pos="2" side="tl" part="a_verb"/>
            <lit-tag v="cni"/>
            <clip pos="1" side="tl" part="a_pers"/>
            <clip pos="1" side="tl" part="a_nbr"/>
            <clip pos="2" side="tl" part="lemq"/>
          </lu>
          <b/>
           <lu>
              <lit v="a"/>
              <lit-tag v="pr"/>
           </lu>
           <b/>
           <lu>
                <lit v="el"/>
                <lit-tag v="det.def"/>
                <clip pos="4" side="tl" part="gen"/>
                <clip pos="4" side="tl" part="a_nbr"/>
           </lu>
           <b/>
           <lu>
              <clip pos="4" side="tl" part="lem"/>
              <clip pos="4" side="tl" part="a_nom"/>
              <clip pos="4" side="tl" part="gen"/>
              <clip pos="4" side="tl" part="a_nbr"/>
            </lu>
         </chunk></out>
         </when>
         <otherwise>
             <out><chunk name="x"><tags><tag><lit-tag v="SX"/></tag></tags>
              <lu>
            <get-case-from pos="1">
              <clip pos="2" side="tl" part="lemh"/>
            </get-case-from>
            <clip pos="2" side="tl" part="a_verb"/>
            <lit-tag v="cni"/>
            <clip pos="1" side="tl" part="a_pers"/>
            <clip pos="1" side="tl" part="a_nbr"/>
            <clip pos="2" side="tl" part="lemq"/>
          </lu>
            <b/>
                <lu>
                    <clip pos="3" side="tl" part="lem"/>
                    <clip pos="3" side="tl" part="a_prep"/>
                  </lu>
                  <b/>
                  <lu>
                    <clip pos="4" side="tl" part="lem"/>
                    <clip pos="4" side="tl" part="a_nom"/>
                    <clip pos="4" side="tl" part="gen"/>
                    <clip pos="4" side="tl" part="a_nbr"/>
                  </lu>
                </chunk></out>
            </otherwise>
          </choose>
        <call-macro n="f_bcond">
          <with-param pos="1"/>
          <with-param pos="2"/>
        </call-macro>
        <call-macro n="n_gen_nbr"/>
      </action>
    </rule>

    <rule>
<!-- REGLA 100: SUPIN  per a traduir "de făcut" per "que hacer" /de + prep > que + inf -->
      <pattern>
        <pattern-item n="prepde"/>
        <pattern-item n="pp"/>
      </pattern>
      <action>
        <out><chunk name="x"><tags><tag><lit-tag v="SX"/></tag></tags>
          <lu>
            <lit v="que"/>
            <lit-tag v="cnjsub"/>
          </lu>
          <b/>
          <lu>
            <clip pos="2" side="tl" part="lem"/>
            <clip pos="2" side="sl" part="a_verb"/>
            <lit-tag v="inf"/>
          </lu>
        </chunk></out>
      </action>
    </rule>

    <rule>
<!--REGLA 101: VERB + ENCLÍTIC -->
      <pattern>
        <pattern-item n="catverb"/>
        <pattern-item n="prnenc"/>
      </pattern>
      <action>
        <call-macro n="f_modgen">
          <with-param pos="2"/>
        </call-macro>
        <out><chunk name="x"><tags><tag><lit-tag v="SX"/></tag></tags>
          <mlu>
            <lu>
              <clip pos="1" side="tl" part="lemh"/>
              <clip pos="1" side="tl" part="a_verb"/>
              <clip pos="1" side="tl" part="a_temps"/>
              <clip pos="1" side="tl" part="a_pers"/>
              <clip pos="1" side="tl" part="a_nbr"/>
            </lu>
            <lu>
              <clip pos="2" side="tl" part="lem"/>
              <clip pos="2" side="tl" part="a_prnenc"/>
              <clip pos="2" side="tl" part="a_pers"/>
              <clip pos="2" side="tl" part="gen"/>
              <clip pos="2" side="tl" part="a_nbr"/>
              <clip pos="1" side="tl" part="lemq"/>
            </lu>
          </mlu>
        </chunk></out>
      </action>
    </rule>


    <rule>
<!--REGLA 102: VERB + ENCLÍTIC + ENCLÍTIC-->
      <pattern>
        <pattern-item n="catverb"/>
        <pattern-item n="prnenc"/>
        <pattern-item n="prnenc"/>
      </pattern>
      <action>
        <call-macro n="f_modgen">
          <with-param pos="2"/>
        </call-macro>
        <call-macro n="f_modgen">
          <with-param pos="3"/>
        </call-macro>
        <out><chunk name="x"><tags><tag><lit-tag v="SX"/></tag></tags>
          <mlu>
            <lu>
              <clip pos="1" side="tl" part="lemh"/>
              <clip pos="1" side="tl" part="a_verb"/>
              <clip pos="1" side="tl" part="a_temps"/>
              <clip pos="1" side="tl" part="a_pers"/>
              <clip pos="1" side="tl" part="a_nbr"/>
            </lu>
            <lu>
              <clip pos="2" side="tl" part="lem"/>
              <clip pos="2" side="tl" part="a_prnenc"/>
              <clip pos="2" side="tl" part="a_pers"/>
              <clip pos="2" side="tl" part="gen"/>
              <clip pos="2" side="tl" part="a_nbr"/>
            </lu>
            <lu>
              <clip pos="3" side="tl" part="lem"/>
              <clip pos="3" side="tl" part="a_prnenc"/>
              <clip pos="3" side="tl" part="a_pers"/>
              <clip pos="3" side="tl" part="gen"/>
              <clip pos="3" side="tl" part="a_nbr"/>
              <clip pos="1" side="tl" part="lemq"/>
            </lu>
          </mlu>
        </chunk></out>
      </action>
    </rule>


<rule> <!-- REGLA 105 DELIA ADVCA + NOM: COMO + NOM-->
  <pattern>
      <pattern-item n="advca"/>
      <pattern-item n="nom"/>
    </pattern>
    <action>
      <call-macro n="f_modgen">
        <with-param pos="2"/>
      </call-macro>
          <out><chunk name="x"><tags><tag><lit-tag v="SX"/></tag></tags>
          <lu>
            <lit v="com"/>
            <lit-tag v="adv"/>
          </lu>
          <b/>
          <lu>
            <lit v="el"/>
            <lit-tag v="det.def"/>
            <clip pos="2" side="tl" part="gen"/>
            <clip pos="2" side="tl" part="a_nbr"/>
          </lu>
          <b/>
          <lu>
                <clip pos="2" side="tl" part="lem"/>
                <clip pos="2" side="tl" part="a_nom"/>
                <clip pos="2" side="tl" part="gen"/>
                <clip pos="2" side="tl" part="a_nbr"/>
          </lu>
        </chunk></out>
        <call-macro n="n_gen_nbr"/>
    </action>
</rule>

<rule> <!-- REGLA 106 DELIA ADVCA + DET IND + NOM: COMO + UN,A + NOM-->
  <pattern>
      <pattern-item n="advca"/>
      <pattern-item n="det"/>
      <pattern-item n="nom"/>
    </pattern>
    <action>
      <call-macro n="f_modgen">
        <with-param pos="2"/>
      </call-macro>
      <call-macro n="f_modgen">
        <with-param pos="3"/>
      </call-macro>
      <call-macro n="f_concord2_i">
           <with-param pos="3"/>
           <with-param pos="2"/>
        </call-macro>
          <out><chunk name="x"><tags><tag><lit-tag v="SX"/></tag></tags>
          <lu>
            <lit v="com"/>
            <lit-tag v="adv"/>
          </lu>
          <b/>
          <lu>
                <clip pos="2" side="tl" part="lem"/>
                <clip pos="2" side="tl" part="a_det"/>
                <clip pos="3" side="tl" part="gen"/>
                <clip pos="3" side="tl" part="a_nbr"/>
          </lu>
          <b/>
          <lu>
                <clip pos="3" side="tl" part="lem"/>
                <clip pos="3" side="tl" part="a_nom"/>
                <clip pos="3" side="tl" part="gen"/>
                <clip pos="3" side="tl" part="a_nbr"/>
          </lu>
        </chunk></out>
        <call-macro n="n_gen_nbr"/>
    </action>
</rule>

<rule>
<!--REGLA 107 mai + adj + ca = más + adj + que-->
<pattern>
        <pattern-item n="adv"/>
        <pattern-item n="adj"/>
        <pattern-item n="advca"/>
</pattern>
  <action>
        <call-macro n="f_modgen">
           <with-param pos="2"/>
        </call-macro>
        <call-macro n="f_concord1_i">
           <with-param pos="2"/>
        </call-macro>
        <choose>
          <when>
            <test>
              <equal>
                <clip pos="1" side="sl" part="lem"/>
                <lit v="mai"/>
              </equal>
             </test>
             <out><chunk name="x"><tags><tag><lit-tag v="SX"/></tag></tags>
             <lu>
               <lit v="més"/>
               <lit-tag v="adv"/>
              </lu>
                <b pos="1"/>
                <lu>
                    <clip pos="2" side="tl" part="lem"/>
                    <clip pos="2" side="tl" part="a_adj"/>
                    <clip pos="2" side="tl" part="gen"/>
                    <clip pos="2" side="tl" part="a_nbr"/>
                  </lu>
                <b pos="2"/>
              <lu>
                 <lit v="que"/>
                 <lit-tag v="cnjsub"/>
               </lu>
             </chunk></out>
           </when>
           <otherwise>
             <out><chunk name="x"><tags><tag><lit-tag v="SX"/></tag></tags>
               <lu>
                 <clip pos="1" side="tl" part="whole"/>
               </lu>
               <b pos="1"/>
               <lu>
                    <clip pos="2" side="tl" part="lem"/>
                    <clip pos="2" side="tl" part="a_adj"/>
                    <clip pos="2" side="tl" part="gen"/>
                    <clip pos="2" side="tl" part="a_nbr"/>
               </lu>
               <b pos="2"/>
               <lu>
                 <clip pos="3" side="tl" part="whole"/>
                </lu>
              </chunk></out>
            </otherwise>
           </choose>
          </action>
</rule>


<!-- <rule>
<!-*- REGLA 26 nu așa de + adj= no tan + adj-*->
<pattern>
        <pattern-item n="adv"/>
        <pattern-item n="adv"/>
        <pattern-item n="prep"/>
        <pattern-item n="adj"/>
</pattern>
    <action>
        <call-macro n="f_modgen">
           <with-param pos="3"/>
        </call-macro>
        <call-macro n="f_concord1">
           <with-param pos="3"/>
        </call-macro>
        <choose>
          <when>
            <test>
              <equal>
                <clip pos="2" side="sl" part="lem"/>
                <lit v="așa"/>
              </equal>
              </test>
             <out><chunk name="x"><tags><tag><lit-tag v="SX"/></tag></tags>
               <lu>
               <lit v="no"/>
               <lit-tag v="adv"/>
              </lu>
              <b pos="1"/>
               <lu>
               <lit v="tan"/>
               <lit-tag v="preadv"/>
              </lu>
                <b pos="2"/>
                <lu>
                    <clip pos="3" side="tl" part="lem"/>
                    <clip pos="3" side="tl" part="a_adj"/>
                    <clip pos="3" side="tl" part="gen"/>
                    <clip pos="3" side="tl" part="a_nbr"/>
                  </lu>
                <b pos="3"/>
              <lu>
                 <lit v="que"/>
                 <lit-tag v="adv"/>
               </lu>
             </chunk></out>
              </when>
         <otherwise>
             <out><chunk name="x"><tags><tag><lit-tag v="SX"/></tag></tags>
               <lu>
               <clip pos="1" side="tl" part="whole"/>
               </lu>
               <b pos="1"/>
               <lu>
               <clip pos="2" side="tl" part="whole"/>
               </lu>
               <b pos="2"/>
               <lu>
               <clip pos="3" side="tl" part="whole"/>
               </lu>
               </chunk></out>
             </otherwise>
            </choose>
           </action>
 </rule>

<rule>
<!-*- REGLA 27 nu așa de + adj + ca = no tan + adj + que-*->
<pattern>
        <pattern-item n="adv"/>
        <pattern-item n="adv"/>
        <pattern-item n="prep"/>
        <pattern-item n="adj"/>
        <pattern-item n="advca"/>
    </pattern>
    <action>
        <call-macro n="f_modgen">
           <with-param pos="4"/>
        </call-macro>
        <call-macro n="f_concord1">
           <with-param pos="4"/>
        </call-macro>
        <choose>
          <when>
            <test>
              <and>
              <equal>
                <clip pos="1" side="sl" part="lem"/>
                <lit v="nu"/>
              </equal>
              <equal>
                <clip pos="2" side="sl" part="lem"/>
                <lit v="așa"/>
              </equal>
              </and>
             </test>
             <out><chunk name="x"><tags><tag><lit-tag v="SX"/></tag></tags>
               <lu>
                 <lit v="no"/>
                 <lit-tag v="adv"/>
               </lu>
                 <b pos="1"/>
               <lu>
                 <lit v="tan"/>
                 <lit-tag v="preadv"/>
               </lu>
                 <b pos="2"/>
               <lu>
               <clip pos="4" side="tl" part="whole"/>
               </lu>
                 <b pos="3"/>
               <lu>
                 <lit v="que"/>
                 <lit-tag v="adv"/>
               </lu>
             </chunk></out>
           </when>
         <otherwise>
             <out><chunk name="x"><tags><tag><lit-tag v="SX"/></tag></tags>
               <lu>
               <clip pos="1" side="tl" part="whole"/>
               </lu>
               <b pos="1"/>
               <lu>
               <clip pos="2" side="tl" part="whole"/>
               </lu>
               <b pos="2"/>
               <lu>
               <clip pos="3" side="tl" part="whole"/>
               </lu>
               </chunk></out>
             </otherwise>
            </choose>
           </action>
 </rule> -->

 <rule>
 <!--  REGLA 109: PREP + NOM + NOM PROPI LLOC DG  ex. la hotarele Europei = als confins d'Europa -->
      <pattern>
        <pattern-item n="prep"/>
        <pattern-item n="nom"/>
        <pattern-item n="nptop"/>
      </pattern>
      <action>
         <call-macro n="f_concord1_i">
          <with-param pos="2"/>
        </call-macro>
         <call-macro n="f_concord1_i">
          <with-param pos="3"/>
        </call-macro>
         <choose>
          <when>
             <test>
              <and>
                <equal>
                  <clip pos="2" side="sl" part="a_case"/>
                  <lit-tag v="nom"/>
              </equal>
              <equal>
                <clip pos="2" side="sl" part="a_def"/>
                <lit-tag v="def"/>
              </equal>
              <equal>
                  <clip pos="3" side="sl" part="a_case"/>
                  <lit-tag v="dg"/>
                </equal>
              <equal>
                <clip pos="3" side="sl" part="a_def"/>
                  <lit-tag v="def"/>
              </equal>
              </and>
            </test>
             <call-macro n="mod_maj">
               <with-param pos="2"/>
            </call-macro>
               <out><chunk name="x"><tags><tag><lit-tag v="SX"/></tag></tags>
                  <lu>
                    <get-case-from pos="1">
                    <clip pos="1" side="tl" part="lem"/>
                    </get-case-from>
                    <clip pos="1" side="tl" part="a_prep"/>
                </lu>
                <b pos="1"/>
                  <lu>
                    <lit v="el"/>
                    <lit-tag v="det.def"/>
                    <clip pos="2" side="tl" part="gen"/>
                    <clip pos="2" side="tl" part="a_nbr"/>
                  </lu>
                  <b/>
                  <lu>
                    <clip pos="2" side="tl" part="lem"/>
                    <clip pos="2" side="tl" part="a_nom"/>
                    <clip pos="2" side="tl" part="gen"/>
                    <clip pos="2" side="tl" part="a_nbr"/>
                </lu>
                <b pos="2"/>
                  <lu>
                   <lit v="de"/>
                   <lit-tag v="pr"/>
                  </lu>
                 <b/>
                  <lu>
                    <clip pos="3" side="tl" part="lem"/>
                    <clip pos="3" side="tl" part="a_nptop"/>
                    <clip pos="3" side="tl" part="gen"/>
                    <clip pos="3" side="tl" part="a_nbr"/>
                  </lu>
                </chunk></out>
                </when>
               <otherwise>
                <out><chunk name="x"><tags><tag><lit-tag v="SX"/></tag></tags>
                  <lu>
                    <clip pos="1" side="tl" part="lem"/>
                    <clip pos="1" side="tl" part="a_prep"/>
                  </lu>
                  <b pos="1"/>
                  <lu>
                    <clip pos="2" side="tl" part="lem"/>
                    <clip pos="2" side="tl" part="a_nom"/>
                    <clip pos="2" side="tl" part="gen"/>
                    <clip pos="2" side="tl" part="a_nbr"/>
                  </lu>
                  <b pos="2"/>
                  <lu>
                    <clip pos="3" side="tl" part="lem"/>
                    <clip pos="3" side="tl" part="a_nptop"/>
                    <clip pos="3" side="tl" part="gen"/>
                    <clip pos="3" side="tl" part="a_nbr"/>
                  </lu>
                </chunk></out>
              </otherwise>
            </choose>
        <call-macro n="n_gen_nbr"/>
       </action>
    </rule>


  </section-rules>
</transfer>
